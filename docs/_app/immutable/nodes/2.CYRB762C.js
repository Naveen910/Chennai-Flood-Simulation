var N2=Object.defineProperty;var n_=i=>{throw TypeError(i)};var $2=(i,n,o)=>n in i?N2(i,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[n]=o;var lr=(i,n,o)=>$2(i,typeof n!="symbol"?n+"":n,o),sm=(i,n,o)=>n.has(i)||n_("Cannot "+o);var ha=(i,n,o)=>(sm(i,n,"read from private field"),o?o.call(i):n.get(i)),Bu=(i,n,o)=>n.has(i)?n_("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(i):n.set(i,o),am=(i,n,o,h)=>(sm(i,n,"write to private field"),h?h.call(i,o):n.set(i,o),o),r_=(i,n,o)=>(sm(i,n,"access private method"),o);import{d as ag,e as j2,a as rt,n as Jv,c as vi,t as Wt}from"../chunks/disclose-version.ACRLTizX.js";import{i as cn}from"../chunks/legacy.BGH10gZZ.js";import{B as Qv,k as Fg,ax as e1,p as gn,H as cc,G as gc,j as t1,av as i1,Z as V2,_ as s_,$ as Yu,q as Ns,ay as Zd,a0 as Ng,m as vf,a1 as n1,a4 as r1,D as nh,az as $g,aA as a_,aB as jg,aC as U2,au as W2,aD as q2,o as Vg,C as Ug,ar as Z2,al as s1,aE as G2,M as H2,R as o_,aF as X2,ao as a1,as as Y2,aq as K2,E as o1,aG as l1,a2 as Lt,b as bf,a3 as c1,e as Mi,s as J2,Y as Q2,aH as eT,aI as tT,aJ as iT,aK as nT,aL as rT,aM as sT,ab as aT,n as Fu,aN as oT,aO as lT,ak as l_,ae as c_,aP as cT,t as un,x as Ai,w as hn,y as pt,v as ni,A as Ht,z as ut,g as De,N as xf,aQ as u1,aR as Wg,aS as ei,aT as Br,I as di,aU as qi,ai as ur,aV as uT,aW as om,aX as yc}from"../chunks/runtime.DUsw9IWs.js";import{l as Ji,p as tt,s as Vr,d as As,e as kn,i as ji,b as Rr,m as h1,f as rh,c as hT}from"../chunks/props.nERTz99S.js";import{c as cl,a as d1,o as ph}from"../chunks/index-client.gyh0nVrW.js";import{w as vn,d as jr,g as ot,r as ro,a as u_}from"../chunks/index.BFxcx_la.js";import{i as dT,a as h_,b as fT,c as pT,d as mT,e as gT,f as yT,n as _T,g as vT,j as bT,l as xT,k as Ct,s as no,o as wT}from"../chunks/render.BNjvO54e.js";function _c(i,n){return n}function TT(i,n,o,h){for(var p=[],b=n.length,_=0;_<b;_++)U2(n[_].e,p,!0);var c=b>0&&p.length===0&&o!==null;if(c){var A=o.parentNode;W2(A),A.append(o),h.clear(),Qa(i,n[0].prev,n[b-1].next)}q2(p,()=>{for(var O=0;O<b;O++){var B=n[O];c||(h.delete(B.k),Qa(i,B.prev,B.next)),Vg(B.e,!c)}})}function vc(i,n,o,h,p,b=null){var _=i,c={flags:n,items:new Map,first:null},A=(n&e1)!==0;if(A){var O=i;_=gn?cc(Ug(O)):O.appendChild(Qv())}gn&&gc();var B=null,R=!1;Fg(()=>{var C=o(),Y=t1(C)?C:C==null?[]:i1(C),X=Y.length;if(R&&X===0)return;R=X===0;let H=!1;if(gn){var ae=_.data===V2;ae!==(X===0)&&(_=s_(),cc(_),Yu(!1),H=!0)}if(gn){for(var Z=null,te,ne=0;ne<X;ne++){if(Ns.nodeType===8&&Ns.data===Z2){_=Ns,H=!0,Yu(!1);break}var _e=Y[ne],ve=h(_e,ne);te=f1(Ns,c,Z,null,_e,ve,ne,p,n),c.items.set(ve,te),Z=te}X>0&&cc(s_())}if(!gn){var Se=s1;ST(Y,c,_,p,n,(Se.f&Zd)!==0,h)}b!==null&&(X===0?B?Ng(B):B=vf(()=>b(_)):B!==null&&n1(B,()=>{B=null})),H&&Yu(!0),o()}),gn&&(_=Ns)}function ST(i,n,o,h,p,b,_,c){var Ce,Ve,Ue,Ge;var A=(p&G2)!==0,O=(p&($g|jg))!==0,B=i.length,R=n.items,C=n.first,Y=C,X,H=null,ae,Z=[],te=[],ne,_e,ve,Se;if(A)for(Se=0;Se<B;Se+=1)ne=i[Se],_e=_(ne,Se),ve=R.get(_e),ve!==void 0&&((Ce=ve.a)==null||Ce.measure(),(ae??(ae=new Set)).add(ve));for(Se=0;Se<B;Se+=1){if(ne=i[Se],_e=_(ne,Se),ve=R.get(_e),ve===void 0){var de=Y?Y.e.nodes_start:o;H=f1(de,n,H,H===null?n.first:H.next,ne,_e,Se,h,p),R.set(_e,H),Z=[],te=[],Y=H.next;continue}if(O&&kT(ve,ne,Se,p),ve.e.f&Zd&&(Ng(ve.e),A&&((Ve=ve.a)==null||Ve.unfix(),(ae??(ae=new Set)).delete(ve))),ve!==Y){if(X!==void 0&&X.has(ve)){if(Z.length<te.length){var Fe=te[0],Re;H=Fe.prev;var Le=Z[0],Te=Z[Z.length-1];for(Re=0;Re<Z.length;Re+=1)d_(Z[Re],Fe,o);for(Re=0;Re<te.length;Re+=1)X.delete(te[Re]);Qa(n,Le.prev,Te.next),Qa(n,H,Le),Qa(n,Te,Fe),Y=Fe,H=Te,Se-=1,Z=[],te=[]}else X.delete(ve),d_(ve,Y,o),Qa(n,ve.prev,ve.next),Qa(n,ve,H===null?n.first:H.next),Qa(n,H,ve),H=ve;continue}for(Z=[],te=[];Y!==null&&Y.k!==_e;)(b||!(Y.e.f&Zd))&&(X??(X=new Set)).add(Y),te.push(Y),Y=Y.next;if(Y===null)continue;ve=Y}Z.push(ve),H=ve,Y=ve.next}if(Y!==null||X!==void 0){for(var we=X===void 0?[]:i1(X);Y!==null;)(b||!(Y.e.f&Zd))&&we.push(Y),Y=Y.next;var fe=we.length;if(fe>0){var Ae=p&e1&&B===0?o:null;if(A){for(Se=0;Se<fe;Se+=1)(Ue=we[Se].a)==null||Ue.measure();for(Se=0;Se<fe;Se+=1)(Ge=we[Se].a)==null||Ge.fix()}TT(n,we,Ae,R)}}A&&r1(()=>{var Oe;if(ae!==void 0)for(ve of ae)(Oe=ve.a)==null||Oe.apply()}),nh.first=n.first&&n.first.e,nh.last=H&&H.e}function kT(i,n,o,h){h&$g&&a_(i.v,n),h&jg?a_(i.i,o):i.i=o}function f1(i,n,o,h,p,b,_,c,A,O){var B=(A&$g)!==0,R=(A&X2)===0,C=B?R?H2(p):o_(p):p,Y=A&jg?o_(_):_,X={i:Y,v:C,k:b,a:null,e:null,prev:o,next:h};try{return X.e=vf(()=>c(i,C,Y),gn),X.e.prev=o&&o.e,X.e.next=h&&h.e,o===null?n.first=X:(o.next=X,o.e.next=X.e),h!==null&&(h.prev=X,h.e.prev=X.e),X}finally{}}function d_(i,n,o){for(var h=i.next?i.next.e.nodes_start:o,p=n?n.e.nodes_start:o,b=i.e.nodes_start;b!==h;){var _=a1(b);p.before(b),b=_}}function Qa(i,n,o){n===null?i.first=o:(n.next=o,n.e.next=o&&o.e),o!==null&&(o.prev=n,o.e.prev=n&&n.e)}function MT(i,n,o,h,p){var b=i,_="",c;Fg(()=>{if(_===(_=n()??"")){gn&&gc();return}c!==void 0&&(Vg(c),c=void 0),_!==""&&(c=vf(()=>{if(gn){Ns.data;for(var A=gc(),O=A;A!==null&&(A.nodeType!==8||A.data!=="");)O=A,A=a1(A);if(A===null)throw Y2(),K2;ag(Ns,O),b=cc(A);return}var B=_+"",R=j2(B);ag(Ug(R),R.lastChild),b.before(R)}))})}function zi(i,n,o,h,p){var c;gn&&gc();var b=(c=n.$$slots)==null?void 0:c[o],_=!1;b===!0&&(b=n[o==="default"?"children":o],_=!0),b===void 0?p!==null&&p(i):b(i,_?()=>h:h)}function AT(i){const n={};i.children&&(n.default=!0);for(const o in i.$$slots)n[o]=!0;return n}function IT(i,n,o,h,p,b){let _=gn;gn&&gc();var c,A,O=null;gn&&Ns.nodeType===1&&(O=Ns,gc());var B=gn?Ns:i,R;Fg(()=>{const C=n()||null;var Y=l1;C!==c&&(R&&(C===null?n1(R,()=>{R=null,A=null}):C===A?Ng(R):(Vg(R),h_(!1))),C&&C!==A&&(R=vf(()=>{O=gn?O:document.createElementNS(Y,C),ag(O,O);{gn&&dT(C)&&O.append(document.createComment(""));var X=gn?Ug(O):O.appendChild(Qv());gn&&(X===null?Yu(!1):cc(X)),h(O,X)}nh.nodes_end=O,B.before(O)})),c=C,c&&(A=c),h_(!0))},o1),_&&(Yu(!0),cc(B))}function Tr(i,n,o){Lt(()=>{var h=bf(()=>n(i,o==null?void 0:o())||{});if(o&&(h!=null&&h.update)){var p=!1,b={};c1(()=>{var _=o();Mi(_),p&&J2(b,_)&&(b=_,h.update(_))}),p=!0}if(h!=null&&h.destroy)return()=>h.destroy()})}function p1(i){var n,o,h="";if(typeof i=="string"||typeof i=="number")h+=i;else if(typeof i=="object")if(Array.isArray(i)){var p=i.length;for(n=0;n<p;n++)i[n]&&(o=p1(i[n]))&&(h&&(h+=" "),h+=o)}else for(o in i)i[o]&&(h&&(h+=" "),h+=o);return h}function m1(){for(var i,n,o=0,h="",p=arguments.length;o<p;o++)(i=arguments[o])&&(n=p1(i))&&(h&&(h+=" "),h+=n);return h}function el(i){return typeof i=="object"?m1(i):i??""}function ET(i){if(gn){var n=!1,o=()=>{if(!n){if(n=!0,i.hasAttribute("value")){var h=i.value;ki(i,"value",null),i.value=h}if(i.hasAttribute("checked")){var p=i.checked;ki(i,"checked",null),i.checked=p}}};i.__on_r=o,iT(o),fT()}}function CT(i,n){n?i.hasAttribute("selected")||i.setAttribute("selected",""):i.removeAttribute("selected")}function ki(i,n,o,h){var p=i.__attributes??(i.__attributes={});gn&&(p[n]=i.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&i.nodeName==="LINK")||p[n]!==(p[n]=o)&&(n==="style"&&"__styles"in i&&(i.__styles={}),n==="loading"&&(i[eT]=o),o==null?i.removeAttribute(n):typeof o!="string"&&g1(i).includes(n)?i[n]=o:i.setAttribute(n,o))}function Or(i,n,o,h,p=!1,b=!1,_=!1){var c=n||{},A=i.tagName==="OPTION";for(var O in n)O in o||(o[O]=null);o.class&&(o.class=el(o.class)),h!==void 0&&(o.class=o.class?o.class+" "+h:h);var B=g1(i),R=i.__attributes??(i.__attributes={});for(const Z in o){let te=o[Z];if(A&&Z==="value"&&te==null){i.value=i.__value="",c[Z]=te;continue}var C=c[Z];if(te!==C){c[Z]=te;var Y=Z[0]+Z[1];if(Y!=="$$"){if(Y==="on"){const ne={},_e="$$"+Z;let ve=Z.slice(2);var X=vT(ve);if(pT(ve)&&(ve=ve.slice(0,-7),ne.capture=!0),!X&&C){if(te!=null)continue;i.removeEventListener(ve,c[_e],ne),c[_e]=null}if(te!=null)if(X)i[`__${ve}`]=te,gT([ve]);else{let Se=function(de){c[Z].call(this,de)};c[_e]=mT(ve,i,Se,ne)}else X&&(i[`__${ve}`]=void 0)}else if(Z==="style"&&te!=null)i.style.cssText=te+"";else if(Z==="autofocus")yT(i,!!te);else if(Z==="__value"||Z==="value"&&te!=null)i.value=i[Z]=i.__value=te;else if(Z==="selected"&&A)CT(i,te);else{var H=Z;p||(H=_T(H));var ae=H==="defaultValue"||H==="defaultChecked";if(te==null&&!b&&!ae)if(R[Z]=null,H==="value"||H==="checked"){let ne=i;if(H==="value"){let _e=ne.defaultValue;ne.removeAttribute(H),ne.defaultValue=_e}else{let _e=ne.defaultChecked;ne.removeAttribute(H),ne.defaultChecked=_e}}else i.removeAttribute(Z);else ae||B.includes(H)&&(b||typeof te!="string")?i[H]=te:typeof te!="function"&&(gn&&(H==="src"||H==="href"||H==="srcset")||ki(i,H,te))}Z==="style"&&"__styles"in i&&(i.__styles={})}}}return c}var f_=new Map;function g1(i){var n=f_.get(i.nodeName);if(n)return n;f_.set(i.nodeName,n=[]);for(var o,h=i,p=Element.prototype;p!==h;){o=tT(h);for(var b in o)o[b].set&&n.push(b);h=Q2(h)}return n}function lc(i,n,o){var h=i.__className,p=PT(n);gn&&i.className===p?i.__className=p:(h!==p||gn&&i.className!==p)&&(n==null&&!o?i.removeAttribute("class"):i.className=p,i.__className=p)}function PT(i,n){return(i??"")+""}function zT(i,n,o){if(o){if(i.classList.contains(n))return;i.classList.add(n)}else{if(!i.classList.contains(n))return;i.classList.remove(n)}}const DT=()=>performance.now(),ya={tick:i=>requestAnimationFrame(i),now:()=>DT(),tasks:new Set};function y1(){const i=ya.now();ya.tasks.forEach(n=>{n.c(i)||(ya.tasks.delete(n),n.f())}),ya.tasks.size!==0&&ya.tick(y1)}function LT(i){let n;return ya.tasks.size===0&&ya.tick(y1),{promise:new Promise(o=>{ya.tasks.add(n={c:i,f:o})}),abort(){ya.tasks.delete(n)}}}function zd(i,n){i.dispatchEvent(new CustomEvent(n))}function RT(i){if(i==="float")return"cssFloat";if(i==="offset")return"cssOffset";if(i.startsWith("--"))return i;const n=i.split("-");return n.length===1?n[0]:n[0]+n.slice(1).map(o=>o[0].toUpperCase()+o.slice(1)).join("")}function p_(i){const n={},o=i.split(";");for(const h of o){const[p,b]=h.split(":");if(!p||b===void 0)break;const _=RT(p.trim());n[_]=b.trim()}return n}const OT=i=>i;function Vn(i,n,o,h){var p=(i&sT)!==0,b=(i&oT)!==0,_=p&&b,c=(i&lT)!==0,A=_?"both":p?"in":"out",O,B=n.inert,R,C;function Y(){var te=s1,ne=nh;l_(null),c_(null);try{return O??(O=o()(n,(h==null?void 0:h())??{},{direction:A}))}finally{l_(te),c_(ne)}}var X={is_global:c,in(){var te;if(n.inert=B,!p){C==null||C.abort(),(te=C==null?void 0:C.reset)==null||te.call(C);return}b||R==null||R.abort(),zd(n,"introstart"),R=og(n,Y(),C,1,()=>{zd(n,"introend"),R==null||R.abort(),R=O=void 0})},out(te){if(!b){te==null||te(),O=void 0;return}n.inert=!0,zd(n,"outrostart"),C=og(n,Y(),R,0,()=>{zd(n,"outroend"),te==null||te()})},stop:()=>{R==null||R.abort(),C==null||C.abort()}},H=nh;if((H.transitions??(H.transitions=[])).push(X),p&&bT){var ae=c;if(!ae){for(var Z=H.parent;Z&&Z.f&o1;)for(;(Z=Z.parent)&&!(Z.f&nT););ae=!Z||(Z.f&rT)!==0}ae&&Lt(()=>{bf(()=>X.in())})}}function og(i,n,o,h,p){var b=h===1;if(aT(n)){var _,c=!1;return r1(()=>{if(!c){var ae=n({direction:b?"in":"out"});_=og(i,ae,o,h,p)}}),{abort:()=>{c=!0,_==null||_.abort()},deactivate:()=>_.deactivate(),reset:()=>_.reset(),t:()=>_.t()}}if(o==null||o.deactivate(),!(n!=null&&n.duration))return p(),{abort:Fu,deactivate:Fu,reset:Fu,t:()=>h};const{delay:A=0,css:O,tick:B,easing:R=OT}=n;var C=[];if(b&&o===void 0&&(B&&B(0,1),O)){var Y=p_(O(0,1));C.push(Y,Y)}var X=()=>1-h,H=i.animate(C,{duration:A});return H.onfinish=()=>{var ae=(o==null?void 0:o.t())??1-h;o==null||o.abort();var Z=h-ae,te=n.duration*Math.abs(Z),ne=[];if(te>0){if(O)for(var _e=Math.ceil(te/16.666666666666668),ve=0;ve<=_e;ve+=1){var Se=ae+Z*R(ve/_e),de=O(Se,1-Se);ne.push(p_(de))}X=()=>{var Fe=H.currentTime;return ae+Z*R(Fe/te)},B&&LT(()=>{if(H.playState!=="running")return!1;var Fe=X();return B(Fe,1-Fe),!0})}H=i.animate(ne,{duration:te,fill:"forwards"}),H.onfinish=()=>{X=()=>h,B==null||B(h,1-h),p()}},{abort:()=>{H&&(H.cancel(),H.effect=null,H.onfinish=Fu)},deactivate:()=>{p=Fu},reset:()=>{h===0&&(B==null||B(1,0))},t:()=>X()}}function BT(i,n,o=n){var h=cT();xT(i,"input",p=>{var b=p?i.defaultValue:i.value;if(b=lm(i)?cm(b):b,o(b),h&&b!==(b=n())){var _=i.selectionStart,c=i.selectionEnd;i.value=b??"",c!==null&&(i.selectionStart=_,i.selectionEnd=Math.min(c,i.value.length))}}),(gn&&i.defaultValue!==i.value||bf(n)==null&&i.value)&&o(lm(i)?cm(i.value):i.value),c1(()=>{var p=n();lm(i)&&p===cm(i.value)||i.type==="date"&&!p&&!i.value||p!==i.value&&(i.value=p??"")})}function lm(i){var n=i.type;return n==="number"||n==="range"}function cm(i){return i===""?null:+i}var io,mc,fh,yf,_1;const _f=class _f{constructor(n){Bu(this,yf);Bu(this,io,new WeakMap);Bu(this,mc);Bu(this,fh);am(this,fh,n)}observe(n,o){var h=ha(this,io).get(n)||new Set;return h.add(o),ha(this,io).set(n,h),r_(this,yf,_1).call(this).observe(n,ha(this,fh)),()=>{var p=ha(this,io).get(n);p.delete(o),p.size===0&&(ha(this,io).delete(n),ha(this,mc).unobserve(n))}}};io=new WeakMap,mc=new WeakMap,fh=new WeakMap,yf=new WeakSet,_1=function(){return ha(this,mc)??am(this,mc,new ResizeObserver(n=>{for(var o of n){_f.entries.set(o.target,o);for(var h of ha(this,io).get(o.target)||[])h(o)}}))},lr(_f,"entries",new WeakMap);let lg=_f;var FT=new lg({box:"border-box"});function NT(i,n,o){var h=FT.observe(i,()=>o(i[n]));Lt(()=>(bf(()=>o(i[n])),h))}function Ft(i,n){var b;var o=(b=i.$$events)==null?void 0:b[n.type],h=t1(o)?o.slice():o==null?[]:[o];for(var p of h)p.call(this,n)}const $T="FeatureCollection",jT=[],v1={type:$T,features:jT},VT=!0,UT=async()=>({pois:v1.features.reduce((n,o)=>{const{name:h,date:p,url:b}=o.properties;return n[h]||(n[h]={links:{},coordinates:o.geometry.coordinates,neighborhood:o.properties.neighbourhood}),n[h].links[p]||(n[h].links[p]=[]),n[h].links[p].push(b),n},{})}),hD=Object.freeze(Object.defineProperty({__proto__:null,load:UT,prerender:VT},Symbol.toStringTag,{value:"Module"}));var WT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qT(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var b1={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(i,n){(function(o,h){i.exports=h()})(WT,function(){var o={},h={};function p(_,c,A){if(h[_]=A,_==="index"){var O="var sharedModule = {}; ("+h.shared+")(sharedModule); ("+h.worker+")(sharedModule);",B={};return h.shared(B),h.index(o,B),typeof window<"u"&&o.setWorkerUrl(window.URL.createObjectURL(new Blob([O],{type:"text/javascript"}))),o}}p("shared",["exports"],function(_){function c(r,t,s,l){return new(s||(s=Promise))(function(f,y){function v(M){try{T(l.next(M))}catch(I){y(I)}}function x(M){try{T(l.throw(M))}catch(I){y(I)}}function T(M){var I;M.done?f(M.value):(I=M.value,I instanceof s?I:new s(function(P){P(I)})).then(v,x)}T((l=l.apply(r,t||[])).next())})}function A(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var O=B;function B(r,t){this.x=r,this.y=t}B.prototype={clone:function(){return new B(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,s=r.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),s=Math.sin(r),l=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=l,this},_rotateAround:function(r,t){var s=Math.cos(r),l=Math.sin(r),f=t.y+l*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-l*(this.y-t.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},B.convert=function(r){return r instanceof B?r:Array.isArray(r)?new B(r[0],r[1]):r};var R=A(O),C=Y;function Y(r,t,s,l){this.cx=3*r,this.bx=3*(s-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=s,this.p2y=l}Y.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var s=r,l=0;l<8;l++){var f=this.sampleCurveX(s)-r;if(Math.abs(f)<t)return s;var y=this.sampleCurveDerivativeX(s);if(Math.abs(y)<1e-6)break;s-=f/y}var v=0,x=1;for(s=r,l=0;l<20&&(f=this.sampleCurveX(s),!(Math.abs(f-r)<t));l++)r>f?v=s:x=s,s=.5*(x-v)+v;return s},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var X=A(C);let H,ae;function Z(){return H==null&&(H=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),H}function te(){if(ae==null&&(ae=!1,Z())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let l=0;l<5*5;l++){const f=4*l;t.fillStyle=`rgb(${f},${f+1},${f+2})`,t.fillRect(l%5,Math.floor(l/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let l=0;l<5*5*4;l++)if(l%4!=3&&s[l]!==l){ae=!0;break}}}return ae||!1}function ne(r,t,s,l){const f=new X(r,t,s,l);return y=>f.solve(y)}const _e=ne(.25,.1,.25,1);function ve(r,t,s){return Math.min(s,Math.max(t,r))}function Se(r,t,s){const l=s-t,f=((r-t)%l+l)%l+t;return f===t?s:f}function de(r,...t){for(const s of t)for(const l in s)r[l]=s[l];return r}let Fe=1;function Re(r,t,s){const l={};for(const f in r)l[f]=t.call(this,r[f],f,r);return l}function Le(r,t,s){const l={};for(const f in r)t.call(this,r[f],f,r)&&(l[f]=r[f]);return l}function Te(r){return Array.isArray(r)?r.map(Te):typeof r=="object"&&r?Re(r,Te):r}const we={};function fe(r){we[r]||(typeof console<"u"&&console.warn(r),we[r]=!0)}function Ae(r,t,s){return(s.y-r.y)*(t.x-r.x)>(t.y-r.y)*(s.x-r.x)}function Ce(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let Ve=null;function Ue(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const Ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Oe(r,t,s,l,f){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const y=new VideoFrame(r,{timestamp:0});try{const v=y==null?void 0:y.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const x=v.startsWith("BGR"),T=new Uint8ClampedArray(l*f*4);if(yield y.copyTo(T,function(M,I,P,L,$){const V=4*Math.max(-I,0),U=(Math.max(0,P)-P)*L*4+V,J=4*L,re=Math.max(0,I),xe=Math.max(0,P);return{rect:{x:re,y:xe,width:Math.min(M.width,I+L)-re,height:Math.min(M.height,P+$)-xe},layout:[{offset:U,stride:J}]}}(r,t,s,l,f)),x)for(let M=0;M<T.length;M+=4){const I=T[M];T[M]=T[M+2],T[M+2]=I}return T}finally{y.close()}})}let Xe,We;const Et="AbortError";function Nt(){return new Error(Et)}const _t={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Xt(r){return _t.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const $t="global-dispatcher";class ai extends Error{constructor(t,s,l,f){super(`AJAXError: ${s} (${t}): ${l}`),this.status=t,this.statusText=s,this.url=l,this.body=f}}const fi=()=>Ce(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,qt=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const l=Xt(r.url);if(l)return l(r,t);if(Ce(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:$t},t)}if(!(/^file:/.test(s=r.url)||/^file:/.test(fi())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(l,f){return c(this,void 0,void 0,function*(){const y=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:fi(),signal:f.signal});l.type!=="json"||y.headers.has("Accept")||y.headers.set("Accept","application/json");const v=yield fetch(y);if(!v.ok){const M=yield v.blob();throw new ai(v.status,v.statusText,l.url,M)}let x;x=l.type==="arrayBuffer"||l.type==="image"?v.arrayBuffer():l.type==="json"?v.json():v.text();const T=yield x;if(f.signal.aborted)throw Nt();return{data:T,cacheControl:v.headers.get("Cache-Control"),expires:v.headers.get("Expires")}})}(r,t);if(Ce(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:$t},t)}var s;return function(l,f){return new Promise((y,v)=>{var x;const T=new XMLHttpRequest;T.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(T.responseType="arraybuffer");for(const M in l.headers)T.setRequestHeader(M,l.headers[M]);l.type==="json"&&(T.responseType="text",!((x=l.headers)===null||x===void 0)&&x.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=l.credentials==="include",T.onerror=()=>{v(new Error(T.statusText))},T.onload=()=>{if(!f.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let M=T.response;if(l.type==="json")try{M=JSON.parse(T.response)}catch(I){return void v(I)}y({data:M,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const M=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});v(new ai(T.status,T.statusText,l.url,M))}},f.signal.addEventListener("abort",()=>{T.abort(),v(Nt())}),T.send(l.body)})}(r,t)};function bi(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function Yt(r,t,s){s[r]&&s[r].indexOf(t)!==-1||(s[r]=s[r]||[],s[r].push(t))}function Oi(r,t,s){if(s&&s[r]){const l=s[r].indexOf(t);l!==-1&&s[r].splice(l,1)}}class Qi{constructor(t,s={}){de(this,s),this.type=t}}class hi extends Qi{constructor(t,s={}){super("error",de({error:t},s))}}class xi{on(t,s){return this._listeners=this._listeners||{},Yt(t,s,this._listeners),this}off(t,s){return Oi(t,s,this._listeners),Oi(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Yt(t,s,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,s){typeof t=="string"&&(t=new Qi(t,s||{}));const l=t.type;if(this.listens(l)){t.target=this;const f=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of f)x.call(this,t);const y=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of y)Oi(l,x,this._oneTimeListeners),x.call(this,t);const v=this._eventedParent;v&&(de(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof hi&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var Me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const dn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ii(r,t){const s={};for(const l in r)l!=="ref"&&(s[l]=r[l]);return dn.forEach(l=>{l in t&&(s[l]=t[l])}),s}function Kt(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let s=0;s<r.length;s++)if(!Kt(r[s],t[s]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const s in r)if(!Kt(r[s],t[s]))return!1;return!0}return r===t}function Ei(r,t){r.push(t)}function dr(r,t,s){Ei(s,{command:"addSource",args:[r,t[r]]})}function bn(r,t,s){Ei(t,{command:"removeSource",args:[r]}),s[r]=!0}function Jn(r,t,s,l){bn(r,s,l),dr(r,t,s)}function Is(r,t,s){let l;for(l in r[s])if(Object.prototype.hasOwnProperty.call(r[s],l)&&l!=="data"&&!Kt(r[s][l],t[s][l]))return!1;for(l in t[s])if(Object.prototype.hasOwnProperty.call(t[s],l)&&l!=="data"&&!Kt(r[s][l],t[s][l]))return!1;return!0}function Qn(r,t,s,l,f,y){r=r||{},t=t||{};for(const v in r)Object.prototype.hasOwnProperty.call(r,v)&&(Kt(r[v],t[v])||s.push({command:y,args:[l,v,t[v],f]}));for(const v in t)Object.prototype.hasOwnProperty.call(t,v)&&!Object.prototype.hasOwnProperty.call(r,v)&&(Kt(r[v],t[v])||s.push({command:y,args:[l,v,t[v],f]}))}function xt(r){return r.id}function Tt(r,t){return r[t.id]=t,r}class ze{constructor(t,s,l,f){this.message=(t?`${t}: `:"")+l,f&&(this.identifier=f),s!=null&&s.__line__&&(this.line=s.__line__)}}function jt(r,...t){for(const s of t)for(const l in s)r[l]=s[l];return r}class Ut extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class Qt{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[l,f]of s)this.bindings[l]=f}concat(t){return new Qt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Bi={kind:"null"},Ze={kind:"number"},Dt={kind:"string"},kt={kind:"boolean"},Di={kind:"color"},Fn={kind:"object"},Rt={kind:"value"},Mn={kind:"collator"},Mr={kind:"formatted"},Ur={kind:"padding"},En={kind:"resolvedImage"},ie={kind:"variableAnchorOffsetCollection"};function F(r,t){return{kind:"array",itemType:r,N:t}}function N(r){if(r.kind==="array"){const t=N(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const W=[Bi,Ze,Dt,kt,Di,Mr,Fn,F(Rt),Ur,En,ie];function Q(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Q(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const s of W)if(!Q(s,t))return null}}return`Expected ${N(r)} but found ${N(t)} instead.`}function he(r,t){return t.some(s=>s.kind===r.kind)}function me(r,t){return t.some(s=>s==="null"?r===null:s==="array"?Array.isArray(r):s==="object"?r&&!Array.isArray(r)&&typeof r=="object":s===typeof r)}function be(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const le=.96422,Pe=.82521,je=4/29,Ie=6/29,Ke=3*Ie*Ie,At=Ie*Ie*Ie,Pt=Math.PI/180,mi=180/Math.PI;function Zt(r){return(r%=360)<0&&(r+=360),r}function gi([r,t,s,l]){let f,y;const v=xn((.2225045*(r=oi(r))+.7168786*(t=oi(t))+.0606169*(s=oi(s)))/1);r===t&&t===s?f=y=v:(f=xn((.4360747*r+.3850649*t+.1430804*s)/le),y=xn((.0139322*r+.0971045*t+.7141733*s)/Pe));const x=116*v-16;return[x<0?0:x,500*(f-v),200*(v-y),l]}function oi(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function xn(r){return r>At?Math.pow(r,1/3):r/Ke+je}function nn([r,t,s,l]){let f=(r+16)/116,y=isNaN(t)?f:f+t/500,v=isNaN(s)?f:f-s/200;return f=1*Li(f),y=le*Li(y),v=Pe*Li(v),[ti(3.1338561*y-1.6168667*f-.4906146*v),ti(-.9787684*y+1.9161415*f+.033454*v),ti(.0719453*y-.2289914*f+1.4052427*v),l]}function ti(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Li(r){return r>Ie?r*r*r:Ke*(r-je)}function en(r){return parseInt(r.padEnd(2,r),16)/255}function Cn(r,t){return Nn(t?r/100:r,0,1)}function Nn(r,t,s){return Math.min(Math.max(t,r),s)}function er(r){return!r.some(Number.isNaN)}const Sa={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ri{constructor(t,s,l,f=1,y=!0){this.r=t,this.g=s,this.b=l,this.a=f,y||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[t,s,l,f]))}static parse(t){if(t instanceof Ri)return t;if(typeof t!="string")return;const s=function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=Sa[l];if(f){const[v,x,T]=f;return[v/255,x/255,T/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const v=l.length<6?1:2;let x=1;return[en(l.slice(x,x+=v)),en(l.slice(x,x+=v)),en(l.slice(x,x+=v)),en(l.slice(x,x+v)||"ff")]}if(l.startsWith("rgb")){const v=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,T,M,I,P,L,$,V,U,J,re,xe]=v,ue=[I||" ",$||" ",J].join("");if(ue==="  "||ue==="  /"||ue===",,"||ue===",,,"){const ye=[M,L,U].join(""),Ee=ye==="%%%"?100:ye===""?255:0;if(Ee){const qe=[Nn(+T/Ee,0,1),Nn(+P/Ee,0,1),Nn(+V/Ee,0,1),re?Cn(+re,xe):1];if(er(qe))return qe}}return}}const y=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[v,x,T,M,I,P,L,$,V]=y,U=[T||" ",I||" ",L].join("");if(U==="  "||U==="  /"||U===",,"||U===",,,"){const J=[+x,Nn(+M,0,100),Nn(+P,0,100),$?Cn(+$,V):1];if(er(J))return function([re,xe,ue,ye]){function Ee(qe){const ct=(qe+re/30)%12,zt=xe*Math.min(ue,1-ue);return ue-zt*Math.max(-1,Math.min(ct-3,9-ct,1))}return re=Zt(re),xe/=100,ue/=100,[Ee(0),Ee(8),Ee(4),ye]}(J)}}}(t);return s?new Ri(...s,!1):void 0}get rgb(){const{r:t,g:s,b:l,a:f}=this,y=f||1/0;return this.overwriteGetter("rgb",[t/y,s/y,l/y,f])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,l,f,y]=gi(t),v=Math.sqrt(l*l+f*f);return[Math.round(1e4*v)?Zt(Math.atan2(f,l)*mi):NaN,v,s,y]}(this.rgb))}get lab(){return this.overwriteGetter("lab",gi(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,l,f]=this.rgb;return`rgba(${[t,s,l].map(y=>Math.round(255*y)).join(",")},${f})`}}Ri.black=new Ri(0,0,0,1),Ri.white=new Ri(1,1,1,1),Ri.transparent=new Ri(0,0,0,0),Ri.red=new Ri(1,0,0,1);class Rc{constructor(t,s,l){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oc{constructor(t,s,l,f,y){this.text=t,this.image=s,this.scale=l,this.fontStack=f,this.textColor=y}}class Ar{constructor(t){this.sections=t}static fromString(t){return new Ar([new Oc(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Ar?t:Ar.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Ir{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ir)return t;if(typeof t=="number")return new Ir([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Ir(t)}}toString(){return JSON.stringify(this.values)}}const Uf=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Fr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Fr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const l=t[s],f=t[s+1];if(typeof l!="string"||!Uf.has(l)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new Fr(t)}}toString(){return JSON.stringify(this.values)}}class Er{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Er({name:t,available:!1}):null}}function ka(r,t,s,l){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[r,t,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[r,t,s,l]:[r,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Us(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Ri||r instanceof Rc||r instanceof Ar||r instanceof Ir||r instanceof Fr||r instanceof Er)return!0;if(Array.isArray(r)){for(const t of r)if(!Us(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!Us(r[t]))return!1;return!0}return!1}function wn(r){if(r===null)return Bi;if(typeof r=="string")return Dt;if(typeof r=="boolean")return kt;if(typeof r=="number")return Ze;if(r instanceof Ri)return Di;if(r instanceof Rc)return Mn;if(r instanceof Ar)return Mr;if(r instanceof Ir)return Ur;if(r instanceof Fr)return ie;if(r instanceof Er)return En;if(Array.isArray(r)){const t=r.length;let s;for(const l of r){const f=wn(l);if(s){if(s===f)continue;s=Rt;break}s=f}return F(s||Rt,t)}return Fn}function go(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof Ri||r instanceof Ar||r instanceof Ir||r instanceof Fr||r instanceof Er?r.toString():JSON.stringify(r)}class Wr{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Us(t[1]))return s.error("invalid value");const l=t[1];let f=wn(l);const y=s.expectedType;return f.kind!=="array"||f.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(f=y),new Wr(f,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class yn{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const dl={string:Dt,number:Ze,boolean:kt,object:Fn};class qr{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let l,f=1;const y=t[0];if(y==="array"){let x,T;if(t.length>2){const M=t[1];if(typeof M!="string"||!(M in dl)||M==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=dl[M],f++}else x=Rt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=t[2],f++}l=F(x,T)}else{if(!dl[y])throw new Error(`Types doesn't contain name = ${y}`);l=dl[y]}const v=[];for(;f<t.length;f++){const x=s.parse(t[f],f,Rt);if(!x)return null;v.push(x)}return new qr(l,v)}evaluate(t){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(t);if(!Q(this.type,wn(l)))return l;if(s===this.args.length-1)throw new yn(`Expected value to be of type ${N(this.type)}, but found ${N(wn(l))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Bc={"to-boolean":kt,"to-color":Di,"to-number":Ze,"to-string":Dt};class Zr{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const l=t[0];if(!Bc[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&t.length!==2)return s.error("Expected one argument.");const f=Bc[l],y=[];for(let v=1;v<t.length;v++){const x=s.parse(t[v],v,Rt);if(!x)return null;y.push(x)}return new Zr(f,y)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,l;for(const f of this.args){if(s=f.evaluate(t),l=null,s instanceof Ri)return s;if(typeof s=="string"){const y=t.parseColor(s);if(y)return y}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:ka(s[0],s[1],s[2],s[3]),!l))return new Ri(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new yn(l||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const l of this.args){s=l.evaluate(t);const f=Ir.parse(s);if(f)return f}throw new yn(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const l of this.args){s=l.evaluate(t);const f=Fr.parse(s);if(f)return f}throw new yn(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const l of this.args){if(s=l.evaluate(t),s===null)return 0;const f=Number(s);if(!isNaN(f))return f}throw new yn(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return Ar.fromString(go(this.args[0].evaluate(t)));case"resolvedImage":return Er.fromString(go(this.args[0].evaluate(t)));default:return go(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Wf=["Unknown","Point","LineString","Polygon"];class fl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Wf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=Ri.parse(t)),s}}class Ws{constructor(t,s,l=[],f,y=new Qt,v=[]){this.registry=t,this.path=l,this.key=l.map(x=>`[${x}]`).join(""),this.scope=y,this.errors=v,this.expectedType=f,this._isConstant=s}parse(t,s,l,f,y={}){return s?this.concat(s,l,f)._parse(t,y):this._parse(t,y)}_parse(t,s){function l(f,y,v){return v==="assert"?new qr(y,[f]):v==="coerce"?new Zr(y,[f]):f}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=t[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[f];if(y){let v=y.parse(t,this);if(!v)return null;if(this.expectedType){const x=this.expectedType,T=v.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||T.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(x.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(x.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(x,T))return null}else v=l(v,x,s.typeAnnotation||"coerce");else v=l(v,x,s.typeAnnotation||"coerce");else v=l(v,x,s.typeAnnotation||"coerce");else v=l(v,x,s.typeAnnotation||"assert")}if(!(v instanceof Wr)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const x=new fl;try{v=new Wr(v.type,v.evaluate(x))}catch(T){return this.error(T.message),null}}return v}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,l){const f=typeof t=="number"?this.path.concat(t):this.path,y=l?this.scope.concat(l):this.scope;return new Ws(this.registry,this._isConstant,f,s||null,y,this.errors)}error(t,...s){const l=`${this.key}${s.map(f=>`[${f}]`).join("")}`;this.errors.push(new Ut(l,t))}checkSubtype(t,s){const l=Q(t,s);return l&&this.error(l),l}}class Es{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let y=1;y<t.length-1;y+=2){const v=t[y];if(typeof v!="string")return s.error(`Expected string, but found ${typeof v} instead.`,y);if(/[^a-zA-Z0-9_]/.test(v))return s.error("Variable names must contain only alphanumeric characters or '_'.",y);const x=s.parse(t[y+1],y+1);if(!x)return null;l.push([v,x])}const f=s.parse(t[t.length-1],t.length-1,s.expectedType,l);return f?new Es(l,f):null}outputDefined(){return this.result.outputDefined()}}class wi{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const l=t[1];return s.scope.has(l)?new wi(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Fc{constructor(t,s,l){this.type=t,this.index=s,this.input=l}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,Ze),f=s.parse(t[2],2,F(s.expectedType||Rt));return l&&f?new Fc(f.type.itemType,l,f):null}evaluate(t){const s=this.index.evaluate(t),l=this.input.evaluate(t);if(s<0)throw new yn(`Array index out of bounds: ${s} < 0.`);if(s>=l.length)throw new yn(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s!==Math.floor(s))throw new yn(`Array index must be an integer, but found ${s} instead.`);return l[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Nc{constructor(t,s){this.type=kt,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,Rt),f=s.parse(t[2],2,Rt);return l&&f?he(l.type,[kt,Dt,Ze,Bi,Rt])?new Nc(l,f):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${N(l.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!me(s,["boolean","string","number","null"]))throw new yn(`Expected first argument to be of type boolean, string, number or null, but found ${N(wn(s))} instead.`);if(!me(l,["string","array"]))throw new yn(`Expected second argument to be of type array or string, but found ${N(wn(l))} instead.`);return l.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ma{constructor(t,s,l){this.type=Ze,this.needle=t,this.haystack=s,this.fromIndex=l}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,Rt),f=s.parse(t[2],2,Rt);if(!l||!f)return null;if(!he(l.type,[kt,Dt,Ze,Bi,Rt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${N(l.type)} instead`);if(t.length===4){const y=s.parse(t[3],3,Ze);return y?new Ma(l,f,y):null}return new Ma(l,f)}evaluate(t){const s=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!me(s,["boolean","string","number","null"]))throw new yn(`Expected first argument to be of type boolean, string, number or null, but found ${N(wn(s))} instead.`);let f;if(this.fromIndex&&(f=this.fromIndex.evaluate(t)),me(l,["string"])){const y=l.indexOf(s,f);return y===-1?-1:[...l.slice(0,y)].length}if(me(l,["array"]))return l.indexOf(s,f);throw new yn(`Expected second argument to be of type array or string, but found ${N(wn(l))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class $c{constructor(t,s,l,f,y,v){this.inputType=t,this.type=s,this.input=l,this.cases=f,this.outputs=y,this.otherwise=v}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let l,f;s.expectedType&&s.expectedType.kind!=="value"&&(f=s.expectedType);const y={},v=[];for(let M=2;M<t.length-1;M+=2){let I=t[M];const P=t[M+1];Array.isArray(I)||(I=[I]);const L=s.concat(M);if(I.length===0)return L.error("Expected at least one branch label.");for(const V of I){if(typeof V!="number"&&typeof V!="string")return L.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return L.error("Numeric branch labels must be integer values.");if(l){if(L.checkSubtype(l,wn(V)))return null}else l=wn(V);if(y[String(V)]!==void 0)return L.error("Branch labels must be unique.");y[String(V)]=v.length}const $=s.parse(P,M,f);if(!$)return null;f=f||$.type,v.push($)}const x=s.parse(t[1],1,Rt);if(!x)return null;const T=s.parse(t[t.length-1],t.length-1,f);return T?x.type.kind!=="value"&&s.concat(1).checkSubtype(l,x.type)?null:new $c(l,f,x,y,v,T):null}evaluate(t){const s=this.input.evaluate(t);return(wn(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class pl{constructor(t,s,l){this.type=t,this.branches=s,this.otherwise=l}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);const f=[];for(let v=1;v<t.length-1;v+=2){const x=s.parse(t[v],v,kt);if(!x)return null;const T=s.parse(t[v+1],v+1,l);if(!T)return null;f.push([x,T]),l=l||T.type}const y=s.parse(t[t.length-1],t.length-1,l);if(!y)return null;if(!l)throw new Error("Can't infer output type");return new pl(l,f,y)}evaluate(t){for(const[s,l]of this.branches)if(s.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,l]of this.branches)t(s),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class yo{constructor(t,s,l,f){this.type=t,this.input=s,this.beginIndex=l,this.endIndex=f}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,Rt),f=s.parse(t[2],2,Ze);if(!l||!f)return null;if(!he(l.type,[F(Rt),Dt,Rt]))return s.error(`Expected first argument to be of type array or string, but found ${N(l.type)} instead`);if(t.length===4){const y=s.parse(t[3],3,Ze);return y?new yo(l.type,l,f,y):null}return new yo(l.type,l,f)}evaluate(t){const s=this.input.evaluate(t),l=this.beginIndex.evaluate(t);let f;if(this.endIndex&&(f=this.endIndex.evaluate(t)),me(s,["string"]))return[...s].slice(l,f).join("");if(me(s,["array"]))return s.slice(l,f);throw new yn(`Expected first argument to be of type array or string, but found ${N(wn(s))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ml(r,t){const s=r.length-1;let l,f,y=0,v=s,x=0;for(;y<=v;)if(x=Math.floor((y+v)/2),l=r[x],f=r[x+1],l<=t){if(x===s||t<f)return x;y=x+1}else{if(!(l>t))throw new yn("Input is not a number.");v=x-1}return 0}class Aa{constructor(t,s,l){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[f,y]of l)this.labels.push(f),this.outputs.push(y)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(t[1],1,Ze);if(!l)return null;const f=[];let y=null;s.expectedType&&s.expectedType.kind!=="value"&&(y=s.expectedType);for(let v=1;v<t.length;v+=2){const x=v===1?-1/0:t[v],T=t[v+1],M=v,I=v+1;if(typeof x!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(f.length&&f[f.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const P=s.parse(T,I,y);if(!P)return null;y=y||P.type,f.push([x,P])}return new Aa(y,l,f)}evaluate(t){const s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(t);const f=this.input.evaluate(t);if(f<=s[0])return l[0].evaluate(t);const y=s.length;return f>=s[y-1]?l[y-1].evaluate(t):l[ml(s,f)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function kh(r){return r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var qf=Mh;function Mh(r,t,s,l){this.cx=3*r,this.bx=3*(s-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=s,this.p2y=l}Mh.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var s=r,l=0;l<8;l++){var f=this.sampleCurveX(s)-r;if(Math.abs(f)<t)return s;var y=this.sampleCurveDerivativeX(s);if(Math.abs(y)<1e-6)break;s-=f/y}var v=0,x=1;for(s=r,l=0;l<20&&(f=this.sampleCurveX(s),!(Math.abs(f-r)<t));l++)r>f?v=s:x=s,s=.5*(x-v)+v;return s},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Zf=kh(qf);function qs(r,t,s){return r+s*(t-r)}function _o(r,t,s){return r.map((l,f)=>qs(l,t[f],s))}const fr={number:qs,color:function(r,t,s,l="rgb"){switch(l){case"rgb":{const[f,y,v,x]=_o(r.rgb,t.rgb,s);return new Ri(f,y,v,x,!1)}case"hcl":{const[f,y,v,x]=r.hcl,[T,M,I,P]=t.hcl;let L,$;if(isNaN(f)||isNaN(T))isNaN(f)?isNaN(T)?L=NaN:(L=T,v!==1&&v!==0||($=M)):(L=f,I!==1&&I!==0||($=y));else{let xe=T-f;T>f&&xe>180?xe-=360:T<f&&f-T>180&&(xe+=360),L=f+s*xe}const[V,U,J,re]=function([xe,ue,ye,Ee]){return xe=isNaN(xe)?0:xe*Pt,nn([ye,Math.cos(xe)*ue,Math.sin(xe)*ue,Ee])}([L,$??qs(y,M,s),qs(v,I,s),qs(x,P,s)]);return new Ri(V,U,J,re,!1)}case"lab":{const[f,y,v,x]=nn(_o(r.lab,t.lab,s));return new Ri(f,y,v,x,!1)}}},array:_o,padding:function(r,t,s){return new Ir(_o(r.values,t.values,s))},variableAnchorOffsetCollection:function(r,t,s){const l=r.values,f=t.values;if(l.length!==f.length)throw new yn(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${t.toString()}`);const y=[];for(let v=0;v<l.length;v+=2){if(l[v]!==f[v])throw new yn(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${l[v]}, to[${v}]: ${f[v]}`);y.push(l[v]);const[x,T]=l[v+1],[M,I]=f[v+1];y.push([qs(x,M,s),qs(T,I,s)])}return new Fr(y)}};class pr{constructor(t,s,l,f,y){this.type=t,this.operator=s,this.interpolation=l,this.input=f,this.labels=[],this.outputs=[];for(const[v,x]of y)this.labels.push(v),this.outputs.push(x)}static interpolationFactor(t,s,l,f){let y=0;if(t.name==="exponential")y=gl(s,t.base,l,f);else if(t.name==="linear")y=gl(s,1,l,f);else if(t.name==="cubic-bezier"){const v=t.controlPoints;y=new Zf(v[0],v[1],v[2],v[3]).solve(gl(s,1,l,f))}return y}static parse(t,s){let[l,f,y,...v]=t;if(!Array.isArray(f)||f.length===0)return s.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const M=f[1];if(typeof M!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:M}}else{if(f[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const M=f.slice(1);if(M.length!==4||M.some(I=>typeof I!="number"||I<0||I>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:M}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(y=s.parse(y,2,Ze),!y)return null;const x=[];let T=null;l==="interpolate-hcl"||l==="interpolate-lab"?T=Di:s.expectedType&&s.expectedType.kind!=="value"&&(T=s.expectedType);for(let M=0;M<v.length;M+=2){const I=v[M],P=v[M+1],L=M+3,$=M+4;if(typeof I!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(x.length&&x[x.length-1][0]>=I)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const V=s.parse(P,$,T);if(!V)return null;T=T||V.type,x.push([I,V])}return be(T,Ze)||be(T,Di)||be(T,Ur)||be(T,ie)||be(T,F(Ze))?new pr(T,l,f,y,x):s.error(`Type ${N(T)} is not interpolatable.`)}evaluate(t){const s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(t);const f=this.input.evaluate(t);if(f<=s[0])return l[0].evaluate(t);const y=s.length;if(f>=s[y-1])return l[y-1].evaluate(t);const v=ml(s,f),x=pr.interpolationFactor(this.interpolation,f,s[v],s[v+1]),T=l[v].evaluate(t),M=l[v+1].evaluate(t);switch(this.operator){case"interpolate":return fr[this.type.kind](T,M,x);case"interpolate-hcl":return fr.color(T,M,x,"hcl");case"interpolate-lab":return fr.color(T,M,x,"lab")}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function gl(r,t,s,l){const f=l-s,y=r-s;return f===0?0:t===1?y/f:(Math.pow(t,y)-1)/(Math.pow(t,f)-1)}class yl{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let l=null;const f=s.expectedType;f&&f.kind!=="value"&&(l=f);const y=[];for(const x of t.slice(1)){const T=s.parse(x,1+y.length,l,void 0,{typeAnnotation:"omit"});if(!T)return null;l=l||T.type,y.push(T)}if(!l)throw new Error("No output type");const v=f&&y.some(x=>Q(f,x.type));return new yl(v?Rt:l,y)}evaluate(t){let s,l=null,f=0;for(const y of this.args)if(f++,l=y.evaluate(t),l&&l instanceof Er&&!l.available&&(s||(s=l.name),l=null,f===this.args.length&&(l=s)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function _l(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Ah(r,t,s,l){return l.compare(t,s)===0}function Ia(r,t,s){const l=r!=="=="&&r!=="!=";return class x1{constructor(y,v,x){this.type=kt,this.lhs=y,this.rhs=v,this.collator=x,this.hasUntypedArgument=y.type.kind==="value"||v.type.kind==="value"}static parse(y,v){if(y.length!==3&&y.length!==4)return v.error("Expected two or three arguments.");const x=y[0];let T=v.parse(y[1],1,Rt);if(!T)return null;if(!_l(x,T.type))return v.concat(1).error(`"${x}" comparisons are not supported for type '${N(T.type)}'.`);let M=v.parse(y[2],2,Rt);if(!M)return null;if(!_l(x,M.type))return v.concat(2).error(`"${x}" comparisons are not supported for type '${N(M.type)}'.`);if(T.type.kind!==M.type.kind&&T.type.kind!=="value"&&M.type.kind!=="value")return v.error(`Cannot compare types '${N(T.type)}' and '${N(M.type)}'.`);l&&(T.type.kind==="value"&&M.type.kind!=="value"?T=new qr(M.type,[T]):T.type.kind!=="value"&&M.type.kind==="value"&&(M=new qr(T.type,[M])));let I=null;if(y.length===4){if(T.type.kind!=="string"&&M.type.kind!=="string"&&T.type.kind!=="value"&&M.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(I=v.parse(y[3],3,Mn),!I)return null}return new x1(T,M,I)}evaluate(y){const v=this.lhs.evaluate(y),x=this.rhs.evaluate(y);if(l&&this.hasUntypedArgument){const T=wn(v),M=wn(x);if(T.kind!==M.kind||T.kind!=="string"&&T.kind!=="number")throw new yn(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${T.kind}, ${M.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const T=wn(v),M=wn(x);if(T.kind!=="string"||M.kind!=="string")return t(y,v,x)}return this.collator?s(y,v,x,this.collator.evaluate(y)):t(y,v,x)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const Gf=Ia("==",function(r,t,s){return t===s},Ah),Ih=Ia("!=",function(r,t,s){return t!==s},function(r,t,s,l){return!Ah(0,t,s,l)}),Eh=Ia("<",function(r,t,s){return t<s},function(r,t,s,l){return l.compare(t,s)<0}),Hf=Ia(">",function(r,t,s){return t>s},function(r,t,s,l){return l.compare(t,s)>0}),Xf=Ia("<=",function(r,t,s){return t<=s},function(r,t,s,l){return l.compare(t,s)<=0}),Ch=Ia(">=",function(r,t,s){return t>=s},function(r,t,s,l){return l.compare(t,s)>=0});class vo{constructor(t,s,l){this.type=Mn,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");const f=s.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,kt);if(!f)return null;const y=s.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,kt);if(!y)return null;let v=null;return l.locale&&(v=s.parse(l.locale,1,Dt),!v)?null:new vo(f,y,v)}evaluate(t){return new Rc(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class jc{constructor(t,s,l,f,y){this.type=Dt,this.number=t,this.locale=s,this.currency=l,this.minFractionDigits=f,this.maxFractionDigits=y}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const l=s.parse(t[1],1,Ze);if(!l)return null;const f=t[2];if(typeof f!="object"||Array.isArray(f))return s.error("NumberFormat options argument must be an object.");let y=null;if(f.locale&&(y=s.parse(f.locale,1,Dt),!y))return null;let v=null;if(f.currency&&(v=s.parse(f.currency,1,Dt),!v))return null;let x=null;if(f["min-fraction-digits"]&&(x=s.parse(f["min-fraction-digits"],1,Ze),!x))return null;let T=null;return f["max-fraction-digits"]&&(T=s.parse(f["max-fraction-digits"],1,Ze),!T)?null:new jc(l,y,v,x,T)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class vl{constructor(t){this.type=Mr,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");const f=[];let y=!1;for(let v=1;v<=t.length-1;++v){const x=t[v];if(y&&typeof x=="object"&&!Array.isArray(x)){y=!1;let T=null;if(x["font-scale"]&&(T=s.parse(x["font-scale"],1,Ze),!T))return null;let M=null;if(x["text-font"]&&(M=s.parse(x["text-font"],1,F(Dt)),!M))return null;let I=null;if(x["text-color"]&&(I=s.parse(x["text-color"],1,Di),!I))return null;const P=f[f.length-1];P.scale=T,P.font=M,P.textColor=I}else{const T=s.parse(t[v],1,Rt);if(!T)return null;const M=T.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,f.push({content:T,scale:null,font:null,textColor:null})}}return new vl(f)}evaluate(t){return new Ar(this.sections.map(s=>{const l=s.content.evaluate(t);return wn(l)===En?new Oc("",l,null,null,null):new Oc(go(l),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}}class Vc{constructor(t){this.type=En,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const l=s.parse(t[1],1,Dt);return l?new Vc(l):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),l=Er.fromString(s);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(s)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}}class Uc{constructor(t){this.type=Ze,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=s.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${N(l.type)} instead.`):new Uc(l):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new yn(`Expected value to be of type string or array, but found ${N(wn(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const ls=8192;function Yf(r,t){const s=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(s*f*ls),Math.round(l*f*ls)]}function Wc(r,t){const s=Math.pow(2,t.z);return[(f=(r[0]/ls+t.x)/s,360*f-180),(l=(r[1]/ls+t.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,f}function Zs(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Cs(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Si(r,t,s){const l=r[0]-t[0],f=r[1]-t[1],y=r[0]-s[0],v=r[1]-s[1];return l*v-y*f==0&&l*y<=0&&f*v<=0}function bl(r,t,s,l){return(f=[l[0]-s[0],l[1]-s[1]])[0]*(y=[t[0]-r[0],t[1]-r[1]])[1]-f[1]*y[0]!=0&&!(!zh(r,t,s,l)||!zh(s,l,r,t));var f,y}function Kf(r,t,s){for(const l of s)for(let f=0;f<l.length-1;++f)if(bl(r,t,l[f],l[f+1]))return!0;return!1}function Ea(r,t,s=!1){let l=!1;for(const x of t)for(let T=0;T<x.length-1;T++){if(Si(r,x[T],x[T+1]))return s;(y=x[T])[1]>(f=r)[1]!=(v=x[T+1])[1]>f[1]&&f[0]<(v[0]-y[0])*(f[1]-y[1])/(v[1]-y[1])+y[0]&&(l=!l)}var f,y,v;return l}function Jf(r,t){for(const s of t)if(Ea(r,s))return!0;return!1}function Ph(r,t){for(const s of r)if(!Ea(s,t))return!1;for(let s=0;s<r.length-1;++s)if(Kf(r[s],r[s+1],t))return!1;return!0}function Qf(r,t){for(const s of t)if(Ph(r,s))return!0;return!1}function zh(r,t,s,l){const f=l[0]-s[0],y=l[1]-s[1],v=(r[0]-s[0])*y-f*(r[1]-s[1]),x=(t[0]-s[0])*y-f*(t[1]-s[1]);return v>0&&x<0||v<0&&x>0}function qc(r,t,s){const l=[];for(let f=0;f<r.length;f++){const y=[];for(let v=0;v<r[f].length;v++){const x=Yf(r[f][v],s);Zs(t,x),y.push(x)}l.push(y)}return l}function Dh(r,t,s){const l=[];for(let f=0;f<r.length;f++){const y=qc(r[f],t,s);l.push(y)}return l}function Lh(r,t,s,l){if(r[0]<s[0]||r[0]>s[2]){const f=.5*l;let y=r[0]-s[0]>f?-l:s[0]-r[0]>f?l:0;y===0&&(y=r[0]-s[2]>f?-l:s[2]-r[0]>f?l:0),r[0]+=y}Zs(t,r)}function Rh(r,t,s,l){const f=Math.pow(2,l.z)*ls,y=[l.x*ls,l.y*ls],v=[];for(const x of r)for(const T of x){const M=[T.x+y[0],T.y+y[1]];Lh(M,t,s,f),v.push(M)}return v}function Oh(r,t,s,l){const f=Math.pow(2,l.z)*ls,y=[l.x*ls,l.y*ls],v=[];for(const T of r){const M=[];for(const I of T){const P=[I.x+y[0],I.y+y[1]];Zs(t,P),M.push(P)}v.push(M)}if(t[2]-t[0]<=f/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const T of v)for(const M of T)Lh(M,t,s,f)}var x;return v}class Gs{constructor(t,s){this.type=kt,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Us(t[1])){const l=t[1];if(l.type==="FeatureCollection"){const f=[];for(const y of l.features){const{type:v,coordinates:x}=y.geometry;v==="Polygon"&&f.push(x),v==="MultiPolygon"&&f.push(...x)}if(f.length)return new Gs(l,{type:"MultiPolygon",coordinates:f})}else if(l.type==="Feature"){const f=l.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Gs(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Gs(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,l){const f=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(l.type==="Polygon"){const x=qc(l.coordinates,y,v),T=Rh(s.geometry(),f,y,v);if(!Cs(f,y))return!1;for(const M of T)if(!Ea(M,x))return!1}if(l.type==="MultiPolygon"){const x=Dh(l.coordinates,y,v),T=Rh(s.geometry(),f,y,v);if(!Cs(f,y))return!1;for(const M of T)if(!Jf(M,x))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,l){const f=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(l.type==="Polygon"){const x=qc(l.coordinates,y,v),T=Oh(s.geometry(),f,y,v);if(!Cs(f,y))return!1;for(const M of T)if(!Ph(M,x))return!1}if(l.type==="MultiPolygon"){const x=Dh(l.coordinates,y,v),T=Oh(s.geometry(),f,y,v);if(!Cs(f,y))return!1;for(const M of T)if(!Qf(M,x))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Bh=class{constructor(r=[],t=(s,l)=>s<l?-1:s>l?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:s}=this,l=t[r];for(;r>0;){const f=r-1>>1,y=t[f];if(s(l,y)>=0)break;t[r]=y,r=f}t[r]=l}_down(r){const{data:t,compare:s}=this,l=this.length>>1,f=t[r];for(;r<l;){let y=1+(r<<1);const v=y+1;if(v<this.length&&s(t[v],t[y])<0&&(y=v),s(t[y],f)>=0)break;t[r]=t[y],r=y}t[r]=f}};function ep(r,t,s,l,f){Fh(r,t,s,l||r.length-1,f)}function Fh(r,t,s,l,f){for(;l>s;){if(l-s>600){var y=l-s+1,v=t-s+1,x=Math.log(y),T=.5*Math.exp(2*x/3),M=.5*Math.sqrt(x*T*(y-T)/y)*(v-y/2<0?-1:1);Fh(r,t,Math.max(s,Math.floor(t-v*T/y+M)),Math.min(l,Math.floor(t+(y-v)*T/y+M)),f)}var I=r[t],P=s,L=l;for(bo(r,s,t),f(r[l],I)>0&&bo(r,s,l);P<L;){for(bo(r,P,L),P++,L--;f(r[P],I)<0;)P++;for(;f(r[L],I)>0;)L--}f(r[s],I)===0?bo(r,s,L):bo(r,++L,l),L<=t&&(s=L+1),t<=L&&(l=L-1)}}function bo(r,t,s){var l=r[t];r[t]=r[s],r[s]=l}function xl(r,t){if(r.length<=1)return[r];const s=[];let l,f;for(const y of r){const v=ip(y);v!==0&&(y.area=Math.abs(v),f===void 0&&(f=v<0),f===v<0?(l&&s.push(l),l=[y]):l.push(y))}if(l&&s.push(l),t>1)for(let y=0;y<s.length;y++)s[y].length<=t||(ep(s[y],t,1,s[y].length-1,tp),s[y]=s[y].slice(0,t));return s}function tp(r,t){return t.area-r.area}function ip(r){let t=0;for(let s,l,f=0,y=r.length,v=y-1;f<y;v=f++)s=r[f],l=r[v],t+=(l.x-s.x)*(s.y+l.y);return t}const Nh=1/298.257223563,$h=Nh*(2-Nh),jh=Math.PI/180;class Zc{constructor(t){const s=6378.137*jh*1e3,l=Math.cos(t*jh),f=1/(1-$h*(1-l*l)),y=Math.sqrt(f);this.kx=s*y*l,this.ky=s*y*f*(1-$h)}distance(t,s){const l=this.wrap(t[0]-s[0])*this.kx,f=(t[1]-s[1])*this.ky;return Math.sqrt(l*l+f*f)}pointOnLine(t,s){let l,f,y,v,x=1/0;for(let T=0;T<t.length-1;T++){let M=t[T][0],I=t[T][1],P=this.wrap(t[T+1][0]-M)*this.kx,L=(t[T+1][1]-I)*this.ky,$=0;P===0&&L===0||($=(this.wrap(s[0]-M)*this.kx*P+(s[1]-I)*this.ky*L)/(P*P+L*L),$>1?(M=t[T+1][0],I=t[T+1][1]):$>0&&(M+=P/this.kx*$,I+=L/this.ky*$)),P=this.wrap(s[0]-M)*this.kx,L=(s[1]-I)*this.ky;const V=P*P+L*L;V<x&&(x=V,l=M,f=I,y=T,v=$)}return{point:[l,f],index:y,t:Math.max(0,Math.min(1,v))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Vh(r,t){return t[0]-r[0]}function wl(r){return r[1]-r[0]+1}function gs(r,t){return r[1]>=r[0]&&r[1]<t}function Gc(r,t){if(r[0]>r[1])return[null,null];const s=wl(r);if(t){if(s===2)return[r,null];const f=Math.floor(s/2);return[[r[0],r[0]+f],[r[0]+f,r[1]]]}if(s===1)return[r,null];const l=Math.floor(s/2)-1;return[[r[0],r[0]+l],[r[0]+l+1,r[1]]]}function Hc(r,t){if(!gs(t,r.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let l=t[0];l<=t[1];++l)Zs(s,r[l]);return s}function Xc(r){const t=[1/0,1/0,-1/0,-1/0];for(const s of r)for(const l of s)Zs(t,l);return t}function Uh(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function xo(r,t,s){if(!Uh(r)||!Uh(t))return NaN;let l=0,f=0;return r[2]<t[0]&&(l=t[0]-r[2]),r[0]>t[2]&&(l=r[0]-t[2]),r[1]>t[3]&&(f=r[1]-t[3]),r[3]<t[1]&&(f=t[1]-r[3]),s.distance([0,0],[l,f])}function Hs(r,t,s){const l=s.pointOnLine(t,r);return s.distance(r,l.point)}function Yc(r,t,s,l,f){const y=Math.min(Hs(r,[s,l],f),Hs(t,[s,l],f)),v=Math.min(Hs(s,[r,t],f),Hs(l,[r,t],f));return Math.min(y,v)}function np(r,t,s,l,f){if(!gs(t,r.length)||!gs(l,s.length))return 1/0;let y=1/0;for(let v=t[0];v<t[1];++v){const x=r[v],T=r[v+1];for(let M=l[0];M<l[1];++M){const I=s[M],P=s[M+1];if(bl(x,T,I,P))return 0;y=Math.min(y,Yc(x,T,I,P,f))}}return y}function rp(r,t,s,l,f){if(!gs(t,r.length)||!gs(l,s.length))return NaN;let y=1/0;for(let v=t[0];v<=t[1];++v)for(let x=l[0];x<=l[1];++x)if(y=Math.min(y,f.distance(r[v],s[x])),y===0)return y;return y}function fn(r,t,s){if(Ea(r,t,!0))return 0;let l=1/0;for(const f of t){const y=f[0],v=f[f.length-1];if(y!==v&&(l=Math.min(l,Hs(r,[v,y],s)),l===0))return l;const x=s.pointOnLine(f,r);if(l=Math.min(l,s.distance(r,x.point)),l===0)return l}return l}function sp(r,t,s,l){if(!gs(t,r.length))return NaN;for(let y=t[0];y<=t[1];++y)if(Ea(r[y],s,!0))return 0;let f=1/0;for(let y=t[0];y<t[1];++y){const v=r[y],x=r[y+1];for(const T of s)for(let M=0,I=T.length,P=I-1;M<I;P=M++){const L=T[P],$=T[M];if(bl(v,x,L,$))return 0;f=Math.min(f,Yc(v,x,L,$,l))}}return f}function ii(r,t){for(const s of r)for(const l of s)if(Ea(l,t,!0))return!0;return!1}function Kc(r,t,s,l=1/0){const f=Xc(r),y=Xc(t);if(l!==1/0&&xo(f,y,s)>=l)return l;if(Cs(f,y)){if(ii(r,t))return 0}else if(ii(t,r))return 0;let v=1/0;for(const x of r)for(let T=0,M=x.length,I=M-1;T<M;I=T++){const P=x[I],L=x[T];for(const $ of t)for(let V=0,U=$.length,J=U-1;V<U;J=V++){const re=$[J],xe=$[V];if(bl(P,L,re,xe))return 0;v=Math.min(v,Yc(P,L,re,xe,s))}}return v}function Ui(r,t,s,l,f,y){if(!y)return;const v=xo(Hc(l,y),f,s);v<t&&r.push([v,y,[0,0]])}function Ci(r,t,s,l,f,y,v){if(!y||!v)return;const x=xo(Hc(l,y),Hc(f,v),s);x<t&&r.push([x,y,v])}function Xs(r,t,s,l,f=1/0){let y=Math.min(l.distance(r[0],s[0][0]),f);if(y===0)return y;const v=new Bh([[0,[0,r.length-1],[0,0]]],Vh),x=Xc(s);for(;v.length>0;){const T=v.pop();if(T[0]>=y)continue;const M=T[1],I=t?50:100;if(wl(M)<=I){if(!gs(M,r.length))return NaN;if(t){const P=sp(r,M,s,l);if(isNaN(P)||P===0)return P;y=Math.min(y,P)}else for(let P=M[0];P<=M[1];++P){const L=fn(r[P],s,l);if(y=Math.min(y,L),y===0)return 0}}else{const P=Gc(M,t);Ui(v,y,l,r,x,P[0]),Ui(v,y,l,r,x,P[1])}}return y}function wo(r,t,s,l,f,y=1/0){let v=Math.min(y,f.distance(r[0],s[0]));if(v===0)return v;const x=new Bh([[0,[0,r.length-1],[0,s.length-1]]],Vh);for(;x.length>0;){const T=x.pop();if(T[0]>=v)continue;const M=T[1],I=T[2],P=t?50:100,L=l?50:100;if(wl(M)<=P&&wl(I)<=L){if(!gs(M,r.length)&&gs(I,s.length))return NaN;let $;if(t&&l)$=np(r,M,s,I,f),v=Math.min(v,$);else if(t&&!l){const V=r.slice(M[0],M[1]+1);for(let U=I[0];U<=I[1];++U)if($=Hs(s[U],V,f),v=Math.min(v,$),v===0)return v}else if(!t&&l){const V=s.slice(I[0],I[1]+1);for(let U=M[0];U<=M[1];++U)if($=Hs(r[U],V,f),v=Math.min(v,$),v===0)return v}else $=rp(r,M,s,I,f),v=Math.min(v,$)}else{const $=Gc(M,t),V=Gc(I,l);Ci(x,v,f,r,s,$[0],V[0]),Ci(x,v,f,r,s,$[0],V[1]),Ci(x,v,f,r,s,$[1],V[0]),Ci(x,v,f,r,s,$[1],V[1])}}return v}function Tl(r){return r.type==="MultiPolygon"?r.coordinates.map(t=>({type:"Polygon",coordinates:t})):r.type==="MultiLineString"?r.coordinates.map(t=>({type:"LineString",coordinates:t})):r.type==="MultiPoint"?r.coordinates.map(t=>({type:"Point",coordinates:t})):[r]}class Ys{constructor(t,s){this.type=Ze,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Us(t[1])){const l=t[1];if(l.type==="FeatureCollection")return new Ys(l,l.features.map(f=>Tl(f.geometry)).flat());if(l.type==="Feature")return new Ys(l,Tl(l.geometry));if("type"in l&&"coordinates"in l)return new Ys(l,Tl(l))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,l){const f=s.geometry(),y=f.flat().map(T=>Wc([T.x,T.y],s.canonical));if(f.length===0)return NaN;const v=new Zc(y[0][1]);let x=1/0;for(const T of l){switch(T.type){case"Point":x=Math.min(x,wo(y,!1,[T.coordinates],!1,v,x));break;case"LineString":x=Math.min(x,wo(y,!1,T.coordinates,!0,v,x));break;case"Polygon":x=Math.min(x,Xs(y,!1,T.coordinates,v,x))}if(x===0)return x}return x}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,l){const f=s.geometry(),y=f.flat().map(T=>Wc([T.x,T.y],s.canonical));if(f.length===0)return NaN;const v=new Zc(y[0][1]);let x=1/0;for(const T of l){switch(T.type){case"Point":x=Math.min(x,wo(y,!0,[T.coordinates],!1,v,x));break;case"LineString":x=Math.min(x,wo(y,!0,T.coordinates,!0,v,x));break;case"Polygon":x=Math.min(x,Xs(y,!0,T.coordinates,v,x))}if(x===0)return x}return x}(t,this.geometries);if(t.geometryType()==="Polygon")return function(s,l){const f=s.geometry();if(f.length===0||f[0].length===0)return NaN;const y=xl(f,0).map(T=>T.map(M=>M.map(I=>Wc([I.x,I.y],s.canonical)))),v=new Zc(y[0][0][0][1]);let x=1/0;for(const T of l)for(const M of y){switch(T.type){case"Point":x=Math.min(x,Xs([T.coordinates],!1,M,v,x));break;case"LineString":x=Math.min(x,Xs(T.coordinates,!0,M,v,x));break;case"Polygon":x=Math.min(x,Kc(M,T.coordinates,v,x))}if(x===0)return x}return x}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ca={"==":Gf,"!=":Ih,">":Hf,"<":Eh,">=":Ch,"<=":Xf,array:qr,at:Fc,boolean:qr,case:pl,coalesce:yl,collator:vo,format:vl,image:Vc,in:Nc,"index-of":Ma,interpolate:pr,"interpolate-hcl":pr,"interpolate-lab":pr,length:Uc,let:Es,literal:Wr,match:$c,number:qr,"number-format":jc,object:qr,slice:yo,step:Aa,string:qr,"to-boolean":Zr,"to-color":Zr,"to-number":Zr,"to-string":Zr,var:wi,within:Gs,distance:Ys};class Nr{constructor(t,s,l,f){this.name=t,this.type=s,this._evaluate=l,this.args=f}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const l=t[0],f=Nr.definitions[l];if(!f)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(f)?f[0]:f.type,v=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,x=v.filter(([M])=>!Array.isArray(M)||M.length===t.length-1);let T=null;for(const[M,I]of x){T=new Ws(s.registry,kl,s.path,null,s.scope);const P=[];let L=!1;for(let $=1;$<t.length;$++){const V=t[$],U=Array.isArray(M)?M[$-1]:M.type,J=T.parse(V,1+P.length,U);if(!J){L=!0;break}P.push(J)}if(!L)if(Array.isArray(M)&&M.length!==P.length)T.error(`Expected ${M.length} arguments, but found ${P.length} instead.`);else{for(let $=0;$<P.length;$++){const V=Array.isArray(M)?M[$]:M.type,U=P[$];T.concat($+1).checkSubtype(V,U.type)}if(T.errors.length===0)return new Nr(l,y,I,P)}}if(x.length===1)s.errors.push(...T.errors);else{const M=(x.length?x:v).map(([P])=>{return L=P,Array.isArray(L)?`(${L.map(N).join(", ")})`:`(${N(L.type)}...)`;var L}).join(" | "),I=[];for(let P=1;P<t.length;P++){const L=s.parse(t[P],1+I.length);if(!L)return null;I.push(N(L.type))}s.error(`Expected arguments of type ${M}, but found (${I.join(", ")}) instead.`)}return null}static register(t,s){Nr.definitions=s;for(const l in s)t[l]=Nr}}function Wh(r,[t,s,l,f]){t=t.evaluate(r),s=s.evaluate(r),l=l.evaluate(r);const y=f?f.evaluate(r):1,v=ka(t,s,l,y);if(v)throw new yn(v);return new Ri(t/255,s/255,l/255,y,!1)}function Jc(r,t){return r in t}function Sl(r,t){const s=t[r];return s===void 0?null:s}function Ks(r){return{type:r}}function kl(r){if(r instanceof wi)return kl(r.boundExpression);if(r instanceof Nr&&r.name==="error"||r instanceof vo||r instanceof Gs||r instanceof Ys)return!1;const t=r instanceof Zr||r instanceof qr;let s=!0;return r.eachChild(l=>{s=t?s&&kl(l):s&&l instanceof Wr}),!!s&&To(r)&&So(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function To(r){if(r instanceof Nr&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Gs||r instanceof Ys)return!1;let t=!0;return r.eachChild(s=>{t&&!To(s)&&(t=!1)}),t}function Pa(r){if(r instanceof Nr&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(s=>{t&&!Pa(s)&&(t=!1)}),t}function So(r,t){if(r instanceof Nr&&t.indexOf(r.name)>=0)return!1;let s=!0;return r.eachChild(l=>{s&&!So(l,t)&&(s=!1)}),s}function Qc(r){return{result:"success",value:r}}function Ps(r){return{result:"error",value:r}}function za(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function qh(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function eu(r){return!!r.expression&&r.expression.interpolated}function yi(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Ml(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function ap(r){return r}function Zh(r,t){const s=t.type==="color",l=r.stops&&typeof r.stops[0][0]=="object",f=l||!(l||r.property!==void 0),y=r.type||(eu(t)?"exponential":"interval");if(s||t.type==="padding"){const I=s?Ri.parse:Ir.parse;(r=jt({},r)).stops&&(r.stops=r.stops.map(P=>[P[0],I(P[1])])),r.default=I(r.default?r.default:t.default)}if(r.colorSpace&&(v=r.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var v;let x,T,M;if(y==="exponential")x=Mo;else if(y==="interval")x=Hh;else if(y==="categorical"){x=Gh,T=Object.create(null);for(const I of r.stops)T[I[0]]=I[1];M=typeof r.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);x=op}if(l){const I={},P=[];for(let V=0;V<r.stops.length;V++){const U=r.stops[V],J=U[0].zoom;I[J]===void 0&&(I[J]={zoom:J,type:r.type,property:r.property,default:r.default,stops:[]},P.push(J)),I[J].stops.push([U[0].value,U[1]])}const L=[];for(const V of P)L.push([I[V].zoom,Zh(I[V],t)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:pr.interpolationFactor.bind(void 0,$),zoomStops:L.map(V=>V[0]),evaluate:({zoom:V},U)=>Mo({stops:L,base:r.base},t,V).evaluate(V,U)}}if(f){const I=y==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:pr.interpolationFactor.bind(void 0,I),zoomStops:r.stops.map(P=>P[0]),evaluate:({zoom:P})=>x(r,t,P,T,M)}}return{kind:"source",evaluate(I,P){const L=P&&P.properties?P.properties[r.property]:void 0;return L===void 0?ko(r.default,t.default):x(r,t,L,T,M)}}}function ko(r,t,s){return r!==void 0?r:t!==void 0?t:s!==void 0?s:void 0}function Gh(r,t,s,l,f){return ko(typeof s===f?l[s]:void 0,r.default,t.default)}function Hh(r,t,s){if(yi(s)!=="number")return ko(r.default,t.default);const l=r.stops.length;if(l===1||s<=r.stops[0][0])return r.stops[0][1];if(s>=r.stops[l-1][0])return r.stops[l-1][1];const f=ml(r.stops.map(y=>y[0]),s);return r.stops[f][1]}function Mo(r,t,s){const l=r.base!==void 0?r.base:1;if(yi(s)!=="number")return ko(r.default,t.default);const f=r.stops.length;if(f===1||s<=r.stops[0][0])return r.stops[0][1];if(s>=r.stops[f-1][0])return r.stops[f-1][1];const y=ml(r.stops.map(I=>I[0]),s),v=function(I,P,L,$){const V=$-L,U=I-L;return V===0?0:P===1?U/V:(Math.pow(P,U)-1)/(Math.pow(P,V)-1)}(s,l,r.stops[y][0],r.stops[y+1][0]),x=r.stops[y][1],T=r.stops[y+1][1],M=fr[t.type]||ap;return typeof x.evaluate=="function"?{evaluate(...I){const P=x.evaluate.apply(void 0,I),L=T.evaluate.apply(void 0,I);if(P!==void 0&&L!==void 0)return M(P,L,v,r.colorSpace)}}:M(x,T,v,r.colorSpace)}function op(r,t,s){switch(t.type){case"color":s=Ri.parse(s);break;case"formatted":s=Ar.fromString(s.toString());break;case"resolvedImage":s=Er.fromString(s.toString());break;case"padding":s=Ir.parse(s);break;default:yi(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return ko(s,r.default,t.default)}Nr.register(Ca,{error:[{kind:"error"},[Dt],(r,[t])=>{throw new yn(t.evaluate(r))}],typeof:[Dt,[Rt],(r,[t])=>N(wn(t.evaluate(r)))],"to-rgba":[F(Ze,4),[Di],(r,[t])=>{const[s,l,f,y]=t.evaluate(r).rgb;return[255*s,255*l,255*f,y]}],rgb:[Di,[Ze,Ze,Ze],Wh],rgba:[Di,[Ze,Ze,Ze,Ze],Wh],has:{type:kt,overloads:[[[Dt],(r,[t])=>Jc(t.evaluate(r),r.properties())],[[Dt,Fn],(r,[t,s])=>Jc(t.evaluate(r),s.evaluate(r))]]},get:{type:Rt,overloads:[[[Dt],(r,[t])=>Sl(t.evaluate(r),r.properties())],[[Dt,Fn],(r,[t,s])=>Sl(t.evaluate(r),s.evaluate(r))]]},"feature-state":[Rt,[Dt],(r,[t])=>Sl(t.evaluate(r),r.featureState||{})],properties:[Fn,[],r=>r.properties()],"geometry-type":[Dt,[],r=>r.geometryType()],id:[Rt,[],r=>r.id()],zoom:[Ze,[],r=>r.globals.zoom],"heatmap-density":[Ze,[],r=>r.globals.heatmapDensity||0],"line-progress":[Ze,[],r=>r.globals.lineProgress||0],accumulated:[Rt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Ze,Ks(Ze),(r,t)=>{let s=0;for(const l of t)s+=l.evaluate(r);return s}],"*":[Ze,Ks(Ze),(r,t)=>{let s=1;for(const l of t)s*=l.evaluate(r);return s}],"-":{type:Ze,overloads:[[[Ze,Ze],(r,[t,s])=>t.evaluate(r)-s.evaluate(r)],[[Ze],(r,[t])=>-t.evaluate(r)]]},"/":[Ze,[Ze,Ze],(r,[t,s])=>t.evaluate(r)/s.evaluate(r)],"%":[Ze,[Ze,Ze],(r,[t,s])=>t.evaluate(r)%s.evaluate(r)],ln2:[Ze,[],()=>Math.LN2],pi:[Ze,[],()=>Math.PI],e:[Ze,[],()=>Math.E],"^":[Ze,[Ze,Ze],(r,[t,s])=>Math.pow(t.evaluate(r),s.evaluate(r))],sqrt:[Ze,[Ze],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[Ze,[Ze],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[Ze,[Ze],(r,[t])=>Math.log(t.evaluate(r))],log2:[Ze,[Ze],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[Ze,[Ze],(r,[t])=>Math.sin(t.evaluate(r))],cos:[Ze,[Ze],(r,[t])=>Math.cos(t.evaluate(r))],tan:[Ze,[Ze],(r,[t])=>Math.tan(t.evaluate(r))],asin:[Ze,[Ze],(r,[t])=>Math.asin(t.evaluate(r))],acos:[Ze,[Ze],(r,[t])=>Math.acos(t.evaluate(r))],atan:[Ze,[Ze],(r,[t])=>Math.atan(t.evaluate(r))],min:[Ze,Ks(Ze),(r,t)=>Math.min(...t.map(s=>s.evaluate(r)))],max:[Ze,Ks(Ze),(r,t)=>Math.max(...t.map(s=>s.evaluate(r)))],abs:[Ze,[Ze],(r,[t])=>Math.abs(t.evaluate(r))],round:[Ze,[Ze],(r,[t])=>{const s=t.evaluate(r);return s<0?-Math.round(-s):Math.round(s)}],floor:[Ze,[Ze],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[Ze,[Ze],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[kt,[Dt,Rt],(r,[t,s])=>r.properties()[t.value]===s.value],"filter-id-==":[kt,[Rt],(r,[t])=>r.id()===t.value],"filter-type-==":[kt,[Dt],(r,[t])=>r.geometryType()===t.value],"filter-<":[kt,[Dt,Rt],(r,[t,s])=>{const l=r.properties()[t.value],f=s.value;return typeof l==typeof f&&l<f}],"filter-id-<":[kt,[Rt],(r,[t])=>{const s=r.id(),l=t.value;return typeof s==typeof l&&s<l}],"filter->":[kt,[Dt,Rt],(r,[t,s])=>{const l=r.properties()[t.value],f=s.value;return typeof l==typeof f&&l>f}],"filter-id->":[kt,[Rt],(r,[t])=>{const s=r.id(),l=t.value;return typeof s==typeof l&&s>l}],"filter-<=":[kt,[Dt,Rt],(r,[t,s])=>{const l=r.properties()[t.value],f=s.value;return typeof l==typeof f&&l<=f}],"filter-id-<=":[kt,[Rt],(r,[t])=>{const s=r.id(),l=t.value;return typeof s==typeof l&&s<=l}],"filter->=":[kt,[Dt,Rt],(r,[t,s])=>{const l=r.properties()[t.value],f=s.value;return typeof l==typeof f&&l>=f}],"filter-id->=":[kt,[Rt],(r,[t])=>{const s=r.id(),l=t.value;return typeof s==typeof l&&s>=l}],"filter-has":[kt,[Rt],(r,[t])=>t.value in r.properties()],"filter-has-id":[kt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[kt,[F(Dt)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[kt,[F(Rt)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[kt,[Dt,F(Rt)],(r,[t,s])=>s.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[kt,[Dt,F(Rt)],(r,[t,s])=>function(l,f,y,v){for(;y<=v;){const x=y+v>>1;if(f[x]===l)return!0;f[x]>l?v=x-1:y=x+1}return!1}(r.properties()[t.value],s.value,0,s.value.length-1)],all:{type:kt,overloads:[[[kt,kt],(r,[t,s])=>t.evaluate(r)&&s.evaluate(r)],[Ks(kt),(r,t)=>{for(const s of t)if(!s.evaluate(r))return!1;return!0}]]},any:{type:kt,overloads:[[[kt,kt],(r,[t,s])=>t.evaluate(r)||s.evaluate(r)],[Ks(kt),(r,t)=>{for(const s of t)if(s.evaluate(r))return!0;return!1}]]},"!":[kt,[kt],(r,[t])=>!t.evaluate(r)],"is-supported-script":[kt,[Dt],(r,[t])=>{const s=r.globals&&r.globals.isSupportedScript;return!s||s(t.evaluate(r))}],upcase:[Dt,[Dt],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[Dt,[Dt],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[Dt,Ks(Rt),(r,t)=>t.map(s=>go(s.evaluate(r))).join("")],"resolved-locale":[Dt,[Mn],(r,[t])=>t.evaluate(r).resolvedLocale()]});class Al{constructor(t,s){var l;this.expression=t,this._warningHistory={},this._evaluator=new fl,this._defaultValue=s?(l=s).type==="color"&&Ml(l.default)?new Ri(0,0,0,0):l.type==="color"?Ri.parse(l.default)||null:l.type==="padding"?Ir.parse(l.default)||null:l.type==="variableAnchorOffsetCollection"?Fr.parse(l.default)||null:l.default===void 0?null:l.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,l,f,y,v){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=f,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(t,s,l,f,y,v){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=f,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new yn(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Ao(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Ca}function Il(r,t){const s=new Ws(Ca,kl,[],t?function(f){const y={color:Di,string:Dt,number:Ze,enum:Dt,boolean:kt,formatted:Mr,padding:Ur,resolvedImage:En,variableAnchorOffsetCollection:ie};return f.type==="array"?F(y[f.value]||Rt,f.length):y[f.type]}(t):void 0),l=s.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Qc(new Al(l,t)):Ps(s.errors)}class Io{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!Pa(s.expression)}evaluateWithoutErrorHandling(t,s,l,f,y,v){return this._styleExpression.evaluateWithoutErrorHandling(t,s,l,f,y,v)}evaluate(t,s,l,f,y,v){return this._styleExpression.evaluate(t,s,l,f,y,v)}}class Da{constructor(t,s,l,f){this.kind=t,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!Pa(s.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,s,l,f,y,v){return this._styleExpression.evaluateWithoutErrorHandling(t,s,l,f,y,v)}evaluate(t,s,l,f,y,v){return this._styleExpression.evaluate(t,s,l,f,y,v)}interpolationFactor(t,s,l){return this.interpolationType?pr.interpolationFactor(this.interpolationType,t,s,l):0}}function Eo(r,t){const s=Il(r,t);if(s.result==="error")return s;const l=s.value.expression,f=To(l);if(!f&&!za(t))return Ps([new Ut("","data expressions not supported")]);const y=So(l,["zoom"]);if(!y&&!qh(t))return Ps([new Ut("","zoom expressions not supported")]);const v=La(l);return v||y?v instanceof Ut?Ps([v]):v instanceof pr&&!eu(t)?Ps([new Ut("",'"interpolate" expressions cannot be used with this property')]):Qc(v?new Da(f?"camera":"composite",s.value,v.labels,v instanceof pr?v.interpolation:void 0):new Io(f?"constant":"source",s.value)):Ps([new Ut("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Co{constructor(t,s){this._parameters=t,this._specification=s,jt(this,Zh(this._parameters,this._specification))}static deserialize(t){return new Co(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function La(r){let t=null;if(r instanceof Es)t=La(r.result);else if(r instanceof yl){for(const s of r.args)if(t=La(s),t)break}else(r instanceof Aa||r instanceof pr)&&r.input instanceof Nr&&r.input.name==="zoom"&&(t=r);return t instanceof Ut||r.eachChild(s=>{const l=La(s);l instanceof Ut?t=l:!t&&l?t=new Ut("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new Ut("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function El(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!El(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Xh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ra(r){if(r==null)return{filter:()=>!0,needGeometry:!1};El(r)||(r=Cl(r));const t=Il(r,Xh);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,l,f)=>t.value.evaluate(s,l,{},f),needGeometry:Yh(r)}}function lp(r,t){return r<t?-1:r>t?1:0}function Yh(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(Yh(r[t]))return!0;return!1}function Cl(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?tu(r[1],r[2],"=="):t==="!="?Js(tu(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?tu(r[1],r[2],t):t==="any"?(s=r.slice(1),["any"].concat(s.map(Cl))):t==="all"?["all"].concat(r.slice(1).map(Cl)):t==="none"?["all"].concat(r.slice(1).map(Cl).map(Js)):t==="in"?Kh(r[1],r.slice(2)):t==="!in"?Js(Kh(r[1],r.slice(2))):t==="has"?Po(r[1]):t!=="!has"||Js(Po(r[1]));var s}function tu(r,t,s){switch(r){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,r,t]}}function Kh(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",r,["literal",t.sort(lp)]]:["filter-in-small",r,["literal",t]]}}function Po(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Js(r){return["!",r]}function tr(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let f="[";for(const y of r)f+=`${tr(y)},`;return`${f}]`}const s=Object.keys(r).sort();let l="{";for(let f=0;f<s.length;f++)l+=`${JSON.stringify(s[f])}:${tr(r[s[f]])},`;return`${l}}`}function zo(r){let t="";for(const s of dn)t+=`/${tr(r[s])}`;return t}function iu(r){const t=r.value;return t?[new ze(r.key,t,"constants have been deprecated as of v8")]:[]}function pn(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Qs(r){if(Array.isArray(r))return r.map(Qs);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const s in r)t[s]=Qs(r[s]);return t}return pn(r)}function Wn(r){const t=r.key,s=r.value,l=r.valueSpec||{},f=r.objectElementValidators||{},y=r.style,v=r.styleSpec,x=r.validateSpec;let T=[];const M=yi(s);if(M!=="object")return[new ze(t,s,`object expected, ${M} found`)];for(const I in s){const P=I.split(".")[0],L=l[P]||l["*"];let $;if(f[P])$=f[P];else if(l[P])$=x;else if(f["*"])$=f["*"];else{if(!l["*"]){T.push(new ze(t,s[I],`unknown property "${I}"`));continue}$=x}T=T.concat($({key:(t&&`${t}.`)+I,value:s[I],valueSpec:L,style:y,styleSpec:v,object:s,objectKey:I,validateSpec:x},s))}for(const I in l)f[I]||l[I].required&&l[I].default===void 0&&s[I]===void 0&&T.push(new ze(t,s,`missing required property "${I}"`));return T}function Pl(r){const t=r.value,s=r.valueSpec,l=r.style,f=r.styleSpec,y=r.key,v=r.arrayElementValidator||r.validateSpec;if(yi(t)!=="array")return[new ze(y,t,`array expected, ${yi(t)} found`)];if(s.length&&t.length!==s.length)return[new ze(y,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new ze(y,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let x={type:s.value,values:s.values};f.$version<7&&(x.function=s.function),yi(s.value)==="object"&&(x=s.value);let T=[];for(let M=0;M<t.length;M++)T=T.concat(v({array:t,arrayIndex:M,value:t[M],valueSpec:x,validateSpec:r.validateSpec,style:l,styleSpec:f,key:`${y}[${M}]`}));return T}function Do(r){const t=r.key,s=r.value,l=r.valueSpec;let f=yi(s);return f==="number"&&s!=s&&(f="NaN"),f!=="number"?[new ze(t,s,`number expected, ${f} found`)]:"minimum"in l&&s<l.minimum?[new ze(t,s,`${s} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&s>l.maximum?[new ze(t,s,`${s} is greater than the maximum value ${l.maximum}`)]:[]}function Jh(r){const t=r.valueSpec,s=pn(r.value.type);let l,f,y,v={};const x=s!=="categorical"&&r.value.property===void 0,T=!x,M=yi(r.value.stops)==="array"&&yi(r.value.stops[0])==="array"&&yi(r.value.stops[0][0])==="object",I=Wn({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function($){if(s==="identity")return[new ze($.key,$.value,'identity function may not have a "stops" property')];let V=[];const U=$.value;return V=V.concat(Pl({key:$.key,value:U,valueSpec:$.valueSpec,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:P})),yi(U)==="array"&&U.length===0&&V.push(new ze($.key,U,"array must have at least one stop")),V},default:function($){return $.validateSpec({key:$.key,value:$.value,valueSpec:t,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec})}}});return s==="identity"&&x&&I.push(new ze(r.key,r.value,'missing required property "property"')),s==="identity"||r.value.stops||I.push(new ze(r.key,r.value,'missing required property "stops"')),s==="exponential"&&r.valueSpec.expression&&!eu(r.valueSpec)&&I.push(new ze(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(T&&!za(r.valueSpec)?I.push(new ze(r.key,r.value,"property functions not supported")):x&&!qh(r.valueSpec)&&I.push(new ze(r.key,r.value,"zoom functions not supported"))),s!=="categorical"&&!M||r.value.property!==void 0||I.push(new ze(r.key,r.value,'"property" property is required')),I;function P($){let V=[];const U=$.value,J=$.key;if(yi(U)!=="array")return[new ze(J,U,`array expected, ${yi(U)} found`)];if(U.length!==2)return[new ze(J,U,`array length 2 expected, length ${U.length} found`)];if(M){if(yi(U[0])!=="object")return[new ze(J,U,`object expected, ${yi(U[0])} found`)];if(U[0].zoom===void 0)return[new ze(J,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new ze(J,U,"object stop key must have value")];if(y&&y>pn(U[0].zoom))return[new ze(J,U[0].zoom,"stop zoom values must appear in ascending order")];pn(U[0].zoom)!==y&&(y=pn(U[0].zoom),f=void 0,v={}),V=V.concat(Wn({key:`${J}[0]`,value:U[0],valueSpec:{zoom:{}},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:Do,value:L}}))}else V=V.concat(L({key:`${J}[0]`,value:U[0],valueSpec:{},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec},U));return Ao(Qs(U[1]))?V.concat([new ze(`${J}[1]`,U[1],"expressions are not allowed in function stops.")]):V.concat($.validateSpec({key:`${J}[1]`,value:U[1],valueSpec:t,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec}))}function L($,V){const U=yi($.value),J=pn($.value),re=$.value!==null?$.value:V;if(l){if(U!==l)return[new ze($.key,re,`${U} stop domain type must match previous stop domain type ${l}`)]}else l=U;if(U!=="number"&&U!=="string"&&U!=="boolean")return[new ze($.key,re,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&s!=="categorical"){let xe=`number expected, ${U} found`;return za(t)&&s===void 0&&(xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ze($.key,re,xe)]}return s!=="categorical"||U!=="number"||isFinite(J)&&Math.floor(J)===J?s!=="categorical"&&U==="number"&&f!==void 0&&J<f?[new ze($.key,re,"stop domain values must appear in ascending order")]:(f=J,s==="categorical"&&J in v?[new ze($.key,re,"stop domain values must be unique")]:(v[J]=!0,[])):[new ze($.key,re,`integer expected, found ${J}`)]}}function zs(r){const t=(r.expressionContext==="property"?Eo:Il)(Qs(r.value),r.valueSpec);if(t.result==="error")return t.value.map(l=>new ze(`${r.key}${l.key}`,r.value,l.message));const s=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!s.outputDefined())return[new ze(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Pa(s))return[new ze(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Pa(s))return[new ze(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!So(s,["zoom","feature-state"]))return[new ze(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!To(s))return[new ze(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Lo(r){const t=r.key,s=r.value,l=r.valueSpec,f=[];return Array.isArray(l.values)?l.values.indexOf(pn(s))===-1&&f.push(new ze(t,s,`expected one of [${l.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(l.values).indexOf(pn(s))===-1&&f.push(new ze(t,s,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(s)} found`)),f}function ea(r){return El(Qs(r.value))?zs(jt({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Qh(r)}function Qh(r){const t=r.value,s=r.key;if(yi(t)!=="array")return[new ze(s,t,`array expected, ${yi(t)} found`)];const l=r.styleSpec;let f,y=[];if(t.length<1)return[new ze(s,t,"filter array must have at least 1 element")];switch(y=y.concat(Lo({key:`${s}[0]`,value:t[0],valueSpec:l.filter_operator,style:r.style,styleSpec:r.styleSpec})),pn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&pn(t[1])==="$type"&&y.push(new ze(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new ze(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=yi(t[1]),f!=="string"&&y.push(new ze(`${s}[1]`,t[1],`string expected, ${f} found`)));for(let v=2;v<t.length;v++)f=yi(t[v]),pn(t[1])==="$type"?y=y.concat(Lo({key:`${s}[${v}]`,value:t[v],valueSpec:l.geometry_type,style:r.style,styleSpec:r.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&y.push(new ze(`${s}[${v}]`,t[v],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)y=y.concat(Qh({key:`${s}[${v}]`,value:t[v],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":f=yi(t[1]),t.length!==2?y.push(new ze(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&y.push(new ze(`${s}[1]`,t[1],`string expected, ${f} found`))}return y}function zl(r,t){const s=r.key,l=r.validateSpec,f=r.style,y=r.styleSpec,v=r.value,x=r.objectKey,T=y[`${t}_${r.layerType}`];if(!T)return[];const M=x.match(/^(.*)-transition$/);if(t==="paint"&&M&&T[M[1]]&&T[M[1]].transition)return l({key:s,value:v,valueSpec:y.transition,style:f,styleSpec:y});const I=r.valueSpec||T[x];if(!I)return[new ze(s,v,`unknown property "${x}"`)];let P;if(yi(v)==="string"&&za(I)&&!I.tokens&&(P=/^{([^}]+)}$/.exec(v)))return[new ze(s,v,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const L=[];return r.layerType==="symbol"&&(x==="text-field"&&f&&!f.glyphs&&L.push(new ze(s,v,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&Ml(Qs(v))&&pn(v.type)==="identity"&&L.push(new ze(s,v,'"text-font" does not support identity functions'))),L.concat(l({key:r.key,value:v,valueSpec:I,style:f,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:x}))}function nu(r){return zl(r,"paint")}function Dl(r){return zl(r,"layout")}function ru(r){let t=[];const s=r.value,l=r.key,f=r.style,y=r.styleSpec;s.type||s.ref||t.push(new ze(l,s,'either "type" or "ref" is required'));let v=pn(s.type);const x=pn(s.ref);if(s.id){const T=pn(s.id);for(let M=0;M<r.arrayIndex;M++){const I=f.layers[M];pn(I.id)===T&&t.push(new ze(l,s.id,`duplicate layer id "${s.id}", previously used at line ${I.id.__line__}`))}}if("ref"in s){let T;["type","source","source-layer","filter","layout"].forEach(M=>{M in s&&t.push(new ze(l,s[M],`"${M}" is prohibited for ref layers`))}),f.layers.forEach(M=>{pn(M.id)===x&&(T=M)}),T?T.ref?t.push(new ze(l,s.ref,"ref cannot reference another ref layer")):v=pn(T.type):t.push(new ze(l,s.ref,`ref layer "${x}" not found`))}else if(v!=="background")if(s.source){const T=f.sources&&f.sources[s.source],M=T&&pn(T.type);T?M==="vector"&&v==="raster"?t.push(new ze(l,s.source,`layer "${s.id}" requires a raster source`)):M!=="raster-dem"&&v==="hillshade"?t.push(new ze(l,s.source,`layer "${s.id}" requires a raster-dem source`)):M==="raster"&&v!=="raster"?t.push(new ze(l,s.source,`layer "${s.id}" requires a vector source`)):M!=="vector"||s["source-layer"]?M==="raster-dem"&&v!=="hillshade"?t.push(new ze(l,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!s.paint||!s.paint["line-gradient"]||M==="geojson"&&T.lineMetrics||t.push(new ze(l,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ze(l,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new ze(l,s.source,`source "${s.source}" not found`))}else t.push(new ze(l,s,'missing required property "source"'));return t=t.concat(Wn({key:l,value:s,valueSpec:y.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${l}.type`,value:s.type,valueSpec:y.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:s,objectKey:"type"}),filter:ea,layout:T=>Wn({layer:s,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":M=>Dl(jt({layerType:v},M))}}),paint:T=>Wn({layer:s,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":M=>nu(jt({layerType:v},M))}})}})),t}function Ds(r){const t=r.value,s=r.key,l=yi(t);return l!=="string"?[new ze(s,t,`string expected, ${l} found`)]:[]}const ed={promoteId:function({key:r,value:t}){if(yi(t)==="string")return Ds({key:r,value:t});{const s=[];for(const l in t)s.push(...Ds({key:`${r}.${l}`,value:t[l]}));return s}}};function Ll(r){const t=r.value,s=r.key,l=r.styleSpec,f=r.style,y=r.validateSpec;if(!t.type)return[new ze(s,t,'"type" is required')];const v=pn(t.type);let x;switch(v){case"vector":case"raster":return x=Wn({key:s,value:t,valueSpec:l[`source_${v.replace("-","_")}`],style:r.style,styleSpec:l,objectElementValidators:ed,validateSpec:y}),x;case"raster-dem":return x=function(T){var M;const I=(M=T.sourceName)!==null&&M!==void 0?M:"",P=T.value,L=T.styleSpec,$=L.source_raster_dem,V=T.style;let U=[];const J=yi(P);if(P===void 0)return U;if(J!=="object")return U.push(new ze("source_raster_dem",P,`object expected, ${J} found`)),U;const re=pn(P.encoding)==="custom",xe=["redFactor","greenFactor","blueFactor","baseShift"],ue=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const ye in P)!re&&xe.includes(ye)?U.push(new ze(ye,P[ye],`In "${I}": "${ye}" is only valid when "encoding" is set to "custom". ${ue} encoding found`)):$[ye]?U=U.concat(T.validateSpec({key:ye,value:P[ye],valueSpec:$[ye],validateSpec:T.validateSpec,style:V,styleSpec:L})):U.push(new ze(ye,P[ye],`unknown property "${ye}"`));return U}({sourceName:s,value:t,style:r.style,styleSpec:l,validateSpec:y}),x;case"geojson":if(x=Wn({key:s,value:t,valueSpec:l.source_geojson,style:f,styleSpec:l,validateSpec:y,objectElementValidators:ed}),t.cluster)for(const T in t.clusterProperties){const[M,I]=t.clusterProperties[T],P=typeof M=="string"?[M,["accumulated"],["get",T]]:M;x.push(...zs({key:`${s}.${T}.map`,value:I,validateSpec:y,expressionContext:"cluster-map"})),x.push(...zs({key:`${s}.${T}.reduce`,value:P,validateSpec:y,expressionContext:"cluster-reduce"}))}return x;case"video":return Wn({key:s,value:t,valueSpec:l.source_video,style:f,validateSpec:y,styleSpec:l});case"image":return Wn({key:s,value:t,valueSpec:l.source_image,style:f,validateSpec:y,styleSpec:l});case"canvas":return[new ze(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Lo({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,validateSpec:y,styleSpec:l})}}function Ro(r){const t=r.value,s=r.styleSpec,l=s.light,f=r.style;let y=[];const v=yi(t);if(t===void 0)return y;if(v!=="object")return y=y.concat([new ze("light",t,`object expected, ${v} found`)]),y;for(const x in t){const T=x.match(/^(.*)-transition$/);y=y.concat(T&&l[T[1]]&&l[T[1]].transition?r.validateSpec({key:x,value:t[x],valueSpec:s.transition,validateSpec:r.validateSpec,style:f,styleSpec:s}):l[x]?r.validateSpec({key:x,value:t[x],valueSpec:l[x],validateSpec:r.validateSpec,style:f,styleSpec:s}):[new ze(x,t[x],`unknown property "${x}"`)])}return y}function su(r){const t=r.value,s=r.styleSpec,l=s.sky,f=r.style,y=yi(t);if(t===void 0)return[];if(y!=="object")return[new ze("sky",t,`object expected, ${y} found`)];let v=[];for(const x in t)v=v.concat(l[x]?r.validateSpec({key:x,value:t[x],valueSpec:l[x],style:f,styleSpec:s}):[new ze(x,t[x],`unknown property "${x}"`)]);return v}function au(r){const t=r.value,s=r.styleSpec,l=s.terrain,f=r.style;let y=[];const v=yi(t);if(t===void 0)return y;if(v!=="object")return y=y.concat([new ze("terrain",t,`object expected, ${v} found`)]),y;for(const x in t)y=y.concat(l[x]?r.validateSpec({key:x,value:t[x],valueSpec:l[x],validateSpec:r.validateSpec,style:f,styleSpec:s}):[new ze(x,t[x],`unknown property "${x}"`)]);return y}function ou(r){let t=[];const s=r.value,l=r.key;if(Array.isArray(s)){const f=[],y=[];for(const v in s)s[v].id&&f.includes(s[v].id)&&t.push(new ze(l,s,`all the sprites' ids must be unique, but ${s[v].id} is duplicated`)),f.push(s[v].id),s[v].url&&y.includes(s[v].url)&&t.push(new ze(l,s,`all the sprites' URLs must be unique, but ${s[v].url} is duplicated`)),y.push(s[v].url),t=t.concat(Wn({key:`${l}[${v}]`,value:s[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return Ds({key:l,value:s})}const lu={"*":()=>[],array:Pl,boolean:function(r){const t=r.value,s=r.key,l=yi(t);return l!=="boolean"?[new ze(s,t,`boolean expected, ${l} found`)]:[]},number:Do,color:function(r){const t=r.key,s=r.value,l=yi(s);return l!=="string"?[new ze(t,s,`color expected, ${l} found`)]:Ri.parse(String(s))?[]:[new ze(t,s,`color expected, "${s}" found`)]},constants:iu,enum:Lo,filter:ea,function:Jh,layer:ru,object:Wn,source:Ll,light:Ro,sky:su,terrain:au,projection:function(r){const t=r.value,s=r.styleSpec,l=s.projection,f=r.style,y=yi(t);if(t===void 0)return[];if(y!=="object")return[new ze("projection",t,`object expected, ${y} found`)];let v=[];for(const x in t)v=v.concat(l[x]?r.validateSpec({key:x,value:t[x],valueSpec:l[x],style:f,styleSpec:s}):[new ze(x,t[x],`unknown property "${x}"`)]);return v},string:Ds,formatted:function(r){return Ds(r).length===0?[]:zs(r)},resolvedImage:function(r){return Ds(r).length===0?[]:zs(r)},padding:function(r){const t=r.key,s=r.value;if(yi(s)==="array"){if(s.length<1||s.length>4)return[new ze(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const l={type:"number"};let f=[];for(let y=0;y<s.length;y++)f=f.concat(r.validateSpec({key:`${t}[${y}]`,value:s[y],validateSpec:r.validateSpec,valueSpec:l}));return f}return Do({key:t,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const t=r.key,s=r.value,l=yi(s),f=r.styleSpec;if(l!=="array"||s.length<1||s.length%2!=0)return[new ze(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let y=[];for(let v=0;v<s.length;v+=2)y=y.concat(Lo({key:`${t}[${v}]`,value:s[v],valueSpec:f.layout_symbol["text-anchor"]})),y=y.concat(Pl({key:`${t}[${v+1}]`,value:s[v+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:f}));return y},sprite:ou};function ta(r){const t=r.value,s=r.valueSpec,l=r.styleSpec;return r.validateSpec=ta,s.expression&&Ml(pn(t))?Jh(r):s.expression&&Ao(Qs(t))?zs(r):s.type&&lu[s.type]?lu[s.type](r):Wn(jt({},r,{valueSpec:s.type?l[s.type]:s}))}function cu(r){const t=r.value,s=r.key,l=Ds(r);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new ze(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new ze(s,t,'"glyphs" url must include a "{range}" token'))),l}function Gr(r,t=Me){let s=[];return s=s.concat(ta({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:ta,objectElementValidators:{glyphs:cu,"*":()=>[]}})),r.constants&&(s=s.concat(iu({key:"constants",value:r.constants,style:r,styleSpec:t,validateSpec:ta}))),td(s)}function Hr(r){return function(t){return r({...t,validateSpec:ta})}}function td(r){return[].concat(r).sort((t,s)=>t.line-s.line)}function Xr(r){return function(...t){return td(r.apply(this,t))}}Gr.source=Xr(Hr(Ll)),Gr.sprite=Xr(Hr(ou)),Gr.glyphs=Xr(Hr(cu)),Gr.light=Xr(Hr(Ro)),Gr.sky=Xr(Hr(su)),Gr.terrain=Xr(Hr(au)),Gr.layer=Xr(Hr(ru)),Gr.filter=Xr(Hr(ea)),Gr.paintProperty=Xr(Hr(nu)),Gr.layoutProperty=Xr(Hr(Dl));const ia=Gr,id=ia.light,cp=ia.sky,up=ia.paintProperty,nd=ia.layoutProperty;function uu(r,t){let s=!1;if(t&&t.length)for(const l of t)r.fire(new hi(new Error(l.message))),s=!0;return s}class Oa{constructor(t,s,l){const f=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const v=new Int32Array(this.arrayBuffer);t=v[0],this.d=(s=v[1])+2*(l=v[2]);for(let T=0;T<this.d*this.d;T++){const M=v[3+T],I=v[3+T+1];f.push(M===I?null:v.subarray(M,I))}const x=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],x),this.bboxes=v.subarray(x),this.insert=this._insertReadonly}else{this.d=s+2*l;for(let v=0;v<this.d*this.d;v++)f.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=l,this.scale=s/t,this.uid=0;const y=l/s*t;this.min=-y,this.max=t+y}insert(t,s,l,f,y){this._forEachCell(s,l,f,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,l,f,y,v){this.cells[y].push(v)}query(t,s,l,f,y){const v=this.min,x=this.max;if(t<=v&&s<=v&&x<=l&&x<=f&&!y)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(t,s,l,f,this._queryCell,T,{},y),T}}_queryCell(t,s,l,f,y,v,x,T){const M=this.cells[y];if(M!==null){const I=this.keys,P=this.bboxes;for(let L=0;L<M.length;L++){const $=M[L];if(x[$]===void 0){const V=4*$;(T?T(P[V+0],P[V+1],P[V+2],P[V+3]):t<=P[V+2]&&s<=P[V+3]&&l>=P[V+0]&&f>=P[V+1])?(x[$]=!0,v.push(I[$])):x[$]=!1}}}}_forEachCell(t,s,l,f,y,v,x,T){const M=this._convertToCellCoord(t),I=this._convertToCellCoord(s),P=this._convertToCellCoord(l),L=this._convertToCellCoord(f);for(let $=M;$<=P;$++)for(let V=I;V<=L;V++){const U=this.d*V+$;if((!T||T(this._convertFromCellCoord($),this._convertFromCellCoord(V),this._convertFromCellCoord($+1),this._convertFromCellCoord(V+1)))&&y.call(this,t,s,l,f,U,v,x,T))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let l=0;for(let v=0;v<this.cells.length;v++)l+=this.cells[v].length;const f=new Int32Array(s+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let y=s;for(let v=0;v<t.length;v++){const x=t[v];f[3+v]=y,f.set(x,y),y+=x.length}return f[3+t.length]=y,f.set(this.keys,y),y+=this.keys.length,f[3+t.length+1]=y,f.set(this.bboxes,y),y+=this.bboxes.length,f.buffer}static serialize(t,s){const l=t.toArrayBuffer();return s&&s.push(l),{buffer:l}}static deserialize(t){return new Oa(t.buffer)}}const cs={};function ht(r,t,s={}){if(cs[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),cs[r]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}ht("Object",Object),ht("TransferableGridIndex",Oa),ht("Color",Ri),ht("Error",Error),ht("AJAXError",ai),ht("ResolvedImage",Er),ht("StylePropertyFunction",Co),ht("StyleExpression",Al,{omit:["_evaluator"]}),ht("ZoomDependentExpression",Da),ht("ZoomConstantExpression",Io),ht("CompoundExpression",Nr,{omit:["_evaluate"]});for(const r in Ca)Ca[r]._classRegistryKey||ht(`Expression_${r}`,Ca[r]);function rd(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Oo(r){return r.$name||r.constructor._classRegistryKey}function sd(r){return!function(t){if(t===null||typeof t!="object")return!1;const s=Oo(t);return!(!s||s==="Object")}(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||rd(r)||Ue(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function Bo(r,t){if(sd(r))return(rd(r)||Ue(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const y=[];for(const v of r)y.push(Bo(v,t));return y}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const s=Oo(r);if(!s)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!cs[s])throw new Error(`${s} is not registered.`);const{klass:l}=cs[s],f=l.serialize?l.serialize(r,t):{};if(l.serialize){if(t&&f===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in r){if(!r.hasOwnProperty(y)||cs[s].omit.indexOf(y)>=0)continue;const v=r[y];f[y]=cs[s].shallow.indexOf(y)>=0?v:Bo(v,t)}r instanceof Error&&(f.message=r.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(f.$name=s),f}function Ba(r){if(sd(r))return r;if(Array.isArray(r))return r.map(Ba);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=Oo(r)||"Object";if(!cs[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=cs[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(r);const l=Object.create(s.prototype);for(const f of Object.keys(r)){if(f==="$name")continue;const y=r[f];l[f]=cs[t].shallow.indexOf(f)>=0?y:Ba(y)}return l}class hu{constructor(){this.first=!0}update(t,s){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const li={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function du(r){for(const t of r)if(pu(t.charCodeAt(0)))return!0;return!1}function hp(r){for(const t of r)if(!fp(t.charCodeAt(0)))return!1;return!0}function fu(r){const t=r.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(t.join("|"),"u")}const dp=fu(["Arab","Dupl","Mong","Ougr","Syrc"]);function fp(r){return!dp.test(String.fromCodePoint(r))}const na=fu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function pu(r){return!(r!==746&&r!==747&&(r<4352||!(li["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||li["CJK Compatibility"](r)||li["CJK Strokes"](r)||!(!li["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||li["Enclosed CJK Letters and Months"](r)||li["Ideographic Description Characters"](r)||li.Kanbun(r)||li.Katakana(r)&&r!==12540||!(!li["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!li["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||li["Vertical Forms"](r)||li["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||na.test(String.fromCodePoint(r)))))}function ad(r){return!(pu(r)||function(t){return!!(li["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||li["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||li["Letterlike Symbols"](t)||li["Number Forms"](t)||li["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||li["Control Pictures"](t)&&t!==9251||li["Optical Character Recognition"](t)||li["Enclosed Alphanumerics"](t)||li["Geometric Shapes"](t)||li["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||li["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||li["CJK Symbols and Punctuation"](t)||li.Katakana(t)||li["Private Use Area"](t)||li["CJK Compatibility Forms"](t)||li["Small Form Variants"](t)||li["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}const pp=fu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function od(r){return pp.test(String.fromCodePoint(r))}function ld(r,t){return!(!t&&od(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||li.Khmer(r))}function mp(r){for(const t of r)if(od(t.charCodeAt(0)))return!0;return!1}const ra=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Pi{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new hu,this.transition={})}isSupportedScript(t){return function(s,l){for(const f of s)if(!ld(f.charCodeAt(0),l))return!1;return!0}(t,ra.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}}}class Fo{constructor(t,s){this.property=t,this.value=s,this.expression=function(l,f){if(Ml(l))return new Co(l,f);if(Ao(l)){const y=Eo(l,f);if(y.result==="error")throw new Error(y.value.map(v=>`${v.key}: ${v.message}`).join(", "));return y.value}{let y=l;return f.type==="color"&&typeof l=="string"?y=Ri.parse(l):f.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(l)&&(y=Fr.parse(l)):y=Ir.parse(l),{kind:"constant",evaluate:()=>y}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,l){return this.property.possiblyEvaluate(this,t,s,l)}}class No{constructor(t){this.property=t,this.value=new Fo(t,void 0)}transitioned(t,s){return new Rl(this.property,this.value,s,de({},t.transition,this.transition),t.now)}untransitioned(){return new Rl(this.property,this.value,null,{},0)}}class mu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Te(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new No(this._values[t].property)),this._values[t].value=new Fo(this._values[t].property,s===null?void 0:Te(s))}getTransition(t){return Te(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new No(this._values[t].property)),this._values[t].transition=Te(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const l=this.getValue(s);l!==void 0&&(t[s]=l);const f=this.getTransition(s);f!==void 0&&(t[`${s}-transition`]=f)}return t}transitioned(t,s){const l=new cd(this._properties);for(const f of Object.keys(this._values))l._values[f]=this._values[f].transitioned(t,s._values[f]);return l}untransitioned(){const t=new cd(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class Rl{constructor(t,s,l,f,y){this.property=t,this.value=s,this.begin=y+f.delay||0,this.end=this.begin+f.duration||0,t.specification.transition&&(f.delay||f.duration)&&(this.prior=l)}possiblyEvaluate(t,s,l){const f=t.now||0,y=this.value.possiblyEvaluate(t,s,l),v=this.prior;if(v){if(f>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(f<this.begin)return v.possiblyEvaluate(t,s,l);{const x=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,s,l),y,function(T){if(T<=0)return 0;if(T>=1)return 1;const M=T*T,I=M*T;return 4*(T<.5?I:3*(T-M)+I-.75)}(x))}}return y}}class cd{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,l){const f=new Bl(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].possiblyEvaluate(t,s,l);return f}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ol{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Te(this._values[t].value)}setValue(t,s){this._values[t]=new Fo(this._values[t].property,s===null?void 0:Te(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const l=this.getValue(s);l!==void 0&&(t[s]=l)}return t}possiblyEvaluate(t,s,l){const f=new Bl(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].possiblyEvaluate(t,s,l);return f}}class mr{constructor(t,s,l){this.property=t,this.value=s,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,l,f){return this.property.evaluate(this.value,this.parameters,t,s,l,f)}}class Bl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class St{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,l){const f=fr[this.specification.type];return f?f(t,s,l):t}}class It{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,l,f){return new mr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},l,f)}:t.expression,s)}interpolate(t,s,l){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new mr(this,{kind:"constant",value:void 0},t.parameters);const f=fr[this.specification.type];if(f){const y=f(t.value.value,s.value.value,l);return new mr(this,{kind:"constant",value:y},t.parameters)}return t}evaluate(t,s,l,f,y,v){return t.kind==="constant"?t.value:t.evaluate(s,l,f,y,v)}}class Fl extends It{possiblyEvaluate(t,s,l,f){if(t.value===void 0)return new mr(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const y=t.expression.evaluate(s,null,{},l,f),v=t.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,x=this._calculate(v,v,v,s);return new mr(this,{kind:"constant",value:x},s)}if(t.expression.kind==="camera"){const y=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new mr(this,{kind:"constant",value:y},s)}return new mr(this,t.expression,s)}evaluate(t,s,l,f,y,v){if(t.kind==="source"){const x=t.evaluate(s,l,f,y,v);return this._calculate(x,x,x,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},l,f),t.evaluate({zoom:Math.floor(s.zoom)},l,f),t.evaluate({zoom:Math.floor(s.zoom)+1},l,f),s):t.value}_calculate(t,s,l,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:l,to:s}}interpolate(t){return t}}class gu{constructor(t){this.specification=t}possiblyEvaluate(t,s,l,f){if(t.value!==void 0){if(t.expression.kind==="constant"){const y=t.expression.evaluate(s,null,{},l,f);return this._calculate(y,y,y,s)}return this._calculate(t.expression.evaluate(new Pi(Math.floor(s.zoom-1),s)),t.expression.evaluate(new Pi(Math.floor(s.zoom),s)),t.expression.evaluate(new Pi(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,l,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:l,to:s}}interpolate(t){return t}}class Nl{constructor(t){this.specification=t}possiblyEvaluate(t,s,l,f){return!!t.expression.evaluate(s,null,{},l,f)}interpolate(){return!1}}class gr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const l=t[s];l.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new Fo(l,void 0),y=this.defaultTransitionablePropertyValues[s]=new No(l);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate({})}}}ht("DataDrivenProperty",It),ht("DataConstantProperty",St),ht("CrossFadedDataDrivenProperty",Fl),ht("CrossFadedProperty",gu),ht("ColorRampProperty",Nl);const g="-transition";class e extends xi{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new Ol(s.layout)),s.paint)){this._transitionablePaint=new mu(s.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bl(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,l={}){s!=null&&this._validate(nd,`layers.${this.id}.layout.${t}`,t,s,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(g)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,l={}){if(s!=null&&this._validate(up,`layers.${this.id}.paint.${t}`,t,s,l))return!1;if(t.endsWith(g))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const f=this._transitionablePaint._values[t],y=f.property.specification["property-type"]==="cross-faded-data-driven",v=f.value.isDataDriven(),x=f.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const T=this._transitionablePaint._values[t].value;return T.isDataDriven()||v||y||this._handleOverridablePaintPropertyUpdate(t,x,T)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Le(t,(s,l)=>!(s===void 0||l==="layout"&&!Object.keys(s).length||l==="paint"&&!Object.keys(s).length))}_validate(t,s,l,f,y={}){return(!y||y.validate!==!1)&&uu(this,t.call(ia,{key:s,layerType:this.type,objectKey:l,value:f,styleSpec:Me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof mr&&za(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const a={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class u{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class d{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function m(r,t=1){let s=0,l=0;return{members:r.map(f=>{const y=a[f.type].BYTES_PER_ELEMENT,v=s=w(s,Math.max(t,y)),x=f.components||1;return l=Math.max(l,y),s+=y*x,{name:f.name,type:f.type,components:x,offset:v}}),size:w(s,Math.max(l,t)),alignment:t}}function w(r,t){return Math.ceil(r/t)*t}class S extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const f=2*t;return this.int16[f+0]=s,this.int16[f+1]=l,t}}S.prototype.bytesPerElement=4,ht("StructArrayLayout2i4",S);class k extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,l)}emplace(t,s,l,f){const y=3*t;return this.int16[y+0]=s,this.int16[y+1]=l,this.int16[y+2]=f,t}}k.prototype.bytesPerElement=6,ht("StructArrayLayout3i6",k);class E extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,f){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,l,f)}emplace(t,s,l,f,y){const v=4*t;return this.int16[v+0]=s,this.int16[v+1]=l,this.int16[v+2]=f,this.int16[v+3]=y,t}}E.prototype.bytesPerElement=8,ht("StructArrayLayout4i8",E);class z extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,f,y,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,l,f,y,v)}emplace(t,s,l,f,y,v,x){const T=6*t;return this.int16[T+0]=s,this.int16[T+1]=l,this.int16[T+2]=f,this.int16[T+3]=y,this.int16[T+4]=v,this.int16[T+5]=x,t}}z.prototype.bytesPerElement=12,ht("StructArrayLayout2i4i12",z);class D extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,f,y,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,l,f,y,v)}emplace(t,s,l,f,y,v,x){const T=4*t,M=8*t;return this.int16[T+0]=s,this.int16[T+1]=l,this.uint8[M+4]=f,this.uint8[M+5]=y,this.uint8[M+6]=v,this.uint8[M+7]=x,t}}D.prototype.bytesPerElement=8,ht("StructArrayLayout2i4ub8",D);class j extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const f=2*t;return this.float32[f+0]=s,this.float32[f+1]=l,t}}j.prototype.bytesPerElement=8,ht("StructArrayLayout2f8",j);class q extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,f,y,v,x,T,M,I){const P=this.length;return this.resize(P+1),this.emplace(P,t,s,l,f,y,v,x,T,M,I)}emplace(t,s,l,f,y,v,x,T,M,I,P){const L=10*t;return this.uint16[L+0]=s,this.uint16[L+1]=l,this.uint16[L+2]=f,this.uint16[L+3]=y,this.uint16[L+4]=v,this.uint16[L+5]=x,this.uint16[L+6]=T,this.uint16[L+7]=M,this.uint16[L+8]=I,this.uint16[L+9]=P,t}}q.prototype.bytesPerElement=20,ht("StructArrayLayout10ui20",q);class G extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,f,y,v,x,T,M,I,P,L){const $=this.length;return this.resize($+1),this.emplace($,t,s,l,f,y,v,x,T,M,I,P,L)}emplace(t,s,l,f,y,v,x,T,M,I,P,L,$){const V=12*t;return this.int16[V+0]=s,this.int16[V+1]=l,this.int16[V+2]=f,this.int16[V+3]=y,this.uint16[V+4]=v,this.uint16[V+5]=x,this.uint16[V+6]=T,this.uint16[V+7]=M,this.int16[V+8]=I,this.int16[V+9]=P,this.int16[V+10]=L,this.int16[V+11]=$,t}}G.prototype.bytesPerElement=24,ht("StructArrayLayout4i4ui4i24",G);class ee extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,l)}emplace(t,s,l,f){const y=3*t;return this.float32[y+0]=s,this.float32[y+1]=l,this.float32[y+2]=f,t}}ee.prototype.bytesPerElement=12,ht("StructArrayLayout3f12",ee);class se extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}se.prototype.bytesPerElement=4,ht("StructArrayLayout1ul4",se);class oe extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,f,y,v,x,T,M){const I=this.length;return this.resize(I+1),this.emplace(I,t,s,l,f,y,v,x,T,M)}emplace(t,s,l,f,y,v,x,T,M,I){const P=10*t,L=5*t;return this.int16[P+0]=s,this.int16[P+1]=l,this.int16[P+2]=f,this.int16[P+3]=y,this.int16[P+4]=v,this.int16[P+5]=x,this.uint32[L+3]=T,this.uint16[P+8]=M,this.uint16[P+9]=I,t}}oe.prototype.bytesPerElement=20,ht("StructArrayLayout6i1ul2ui20",oe);class ce extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,f,y,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,l,f,y,v)}emplace(t,s,l,f,y,v,x){const T=6*t;return this.int16[T+0]=s,this.int16[T+1]=l,this.int16[T+2]=f,this.int16[T+3]=y,this.int16[T+4]=v,this.int16[T+5]=x,t}}ce.prototype.bytesPerElement=12,ht("StructArrayLayout2i2i2i12",ce);class K extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,f,y){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,l,f,y)}emplace(t,s,l,f,y,v){const x=4*t,T=8*t;return this.float32[x+0]=s,this.float32[x+1]=l,this.float32[x+2]=f,this.int16[T+6]=y,this.int16[T+7]=v,t}}K.prototype.bytesPerElement=16,ht("StructArrayLayout2f1f2i16",K);class pe extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,f,y,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,l,f,y,v)}emplace(t,s,l,f,y,v,x){const T=16*t,M=4*t,I=8*t;return this.uint8[T+0]=s,this.uint8[T+1]=l,this.float32[M+1]=f,this.float32[M+2]=y,this.int16[I+6]=v,this.int16[I+7]=x,t}}pe.prototype.bytesPerElement=16,ht("StructArrayLayout2ub2f2i16",pe);class ge extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,l)}emplace(t,s,l,f){const y=3*t;return this.uint16[y+0]=s,this.uint16[y+1]=l,this.uint16[y+2]=f,t}}ge.prototype.bytesPerElement=6,ht("StructArrayLayout3ui6",ge);class ke extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,f,y,v,x,T,M,I,P,L,$,V,U,J,re){const xe=this.length;return this.resize(xe+1),this.emplace(xe,t,s,l,f,y,v,x,T,M,I,P,L,$,V,U,J,re)}emplace(t,s,l,f,y,v,x,T,M,I,P,L,$,V,U,J,re,xe){const ue=24*t,ye=12*t,Ee=48*t;return this.int16[ue+0]=s,this.int16[ue+1]=l,this.uint16[ue+2]=f,this.uint16[ue+3]=y,this.uint32[ye+2]=v,this.uint32[ye+3]=x,this.uint32[ye+4]=T,this.uint16[ue+10]=M,this.uint16[ue+11]=I,this.uint16[ue+12]=P,this.float32[ye+7]=L,this.float32[ye+8]=$,this.uint8[Ee+36]=V,this.uint8[Ee+37]=U,this.uint8[Ee+38]=J,this.uint32[ye+10]=re,this.int16[ue+22]=xe,t}}ke.prototype.bytesPerElement=48,ht("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ke);class $e extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,f,y,v,x,T,M,I,P,L,$,V,U,J,re,xe,ue,ye,Ee,qe,ct,zt,at,nt,wt,yt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,t,s,l,f,y,v,x,T,M,I,P,L,$,V,U,J,re,xe,ue,ye,Ee,qe,ct,zt,at,nt,wt,yt)}emplace(t,s,l,f,y,v,x,T,M,I,P,L,$,V,U,J,re,xe,ue,ye,Ee,qe,ct,zt,at,nt,wt,yt,ft){const Be=32*t,Mt=16*t;return this.int16[Be+0]=s,this.int16[Be+1]=l,this.int16[Be+2]=f,this.int16[Be+3]=y,this.int16[Be+4]=v,this.int16[Be+5]=x,this.int16[Be+6]=T,this.int16[Be+7]=M,this.uint16[Be+8]=I,this.uint16[Be+9]=P,this.uint16[Be+10]=L,this.uint16[Be+11]=$,this.uint16[Be+12]=V,this.uint16[Be+13]=U,this.uint16[Be+14]=J,this.uint16[Be+15]=re,this.uint16[Be+16]=xe,this.uint16[Be+17]=ue,this.uint16[Be+18]=ye,this.uint16[Be+19]=Ee,this.uint16[Be+20]=qe,this.uint16[Be+21]=ct,this.uint16[Be+22]=zt,this.uint32[Mt+12]=at,this.float32[Mt+13]=nt,this.float32[Mt+14]=wt,this.uint16[Be+30]=yt,this.uint16[Be+31]=ft,t}}$e.prototype.bytesPerElement=64,ht("StructArrayLayout8i15ui1ul2f2ui64",$e);class He extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}He.prototype.bytesPerElement=4,ht("StructArrayLayout1f4",He);class st extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,l)}emplace(t,s,l,f){const y=3*t;return this.uint16[6*t+0]=s,this.float32[y+1]=l,this.float32[y+2]=f,t}}st.prototype.bytesPerElement=12,ht("StructArrayLayout1ui2f12",st);class dt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,s,l)}emplace(t,s,l,f){const y=4*t;return this.uint32[2*t+0]=s,this.uint16[y+2]=l,this.uint16[y+3]=f,t}}dt.prototype.bytesPerElement=8,ht("StructArrayLayout1ul2ui8",dt);class Qe extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const f=2*t;return this.uint16[f+0]=s,this.uint16[f+1]=l,t}}Qe.prototype.bytesPerElement=4,ht("StructArrayLayout2ui4",Qe);class Je extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}Je.prototype.bytesPerElement=2,ht("StructArrayLayout1ui2",Je);class vt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,f){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,l,f)}emplace(t,s,l,f,y){const v=4*t;return this.float32[v+0]=s,this.float32[v+1]=l,this.float32[v+2]=f,this.float32[v+3]=y,t}}vt.prototype.bytesPerElement=16,ht("StructArrayLayout4f16",vt);class Vt extends u{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new R(this.anchorPointX,this.anchorPointY)}}Vt.prototype.size=20;class it extends oe{get(t){return new Vt(this,t)}}ht("CollisionBoxArray",it);class lt extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}lt.prototype.size=48;class Ot extends ke{get(t){return new lt(this,t)}}ht("PlacedSymbolArray",Ot);class Hi extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Hi.prototype.size=64;class Jt extends $e{get(t){return new Hi(this,t)}}ht("SymbolInstanceArray",Jt);class ci extends He{getoffsetX(t){return this.float32[1*t+0]}}ht("GlyphOffsetArray",ci);class Xi extends k{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}ht("SymbolLineVertexArray",Xi);class qn extends u{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}qn.prototype.size=12;class Yr extends st{get(t){return new qn(this,t)}}ht("TextAnchorOffsetArray",Yr);class Yi extends u{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Yi.prototype.size=8;class yr extends dt{get(t){return new Yi(this,t)}}ht("FeatureIndexArray",yr);class ir extends S{}class nr extends S{}class rr extends S{}class us extends z{}class Fa extends D{}class $l extends j{}class Kr extends q{}class sa extends G{}class jl extends ee{}class yu extends se{}class Cr extends ce{}class Jr extends pe{}class Pr extends ge{}class Ls extends Qe{}const sr=m([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zn}=sr;class Fi{constructor(t=[]){this.segments=t}prepareSegment(t,s,l,f){let y=this.segments[this.segments.length-1];return t>Fi.MAX_VERTEX_ARRAY_LENGTH&&fe(`Max vertices per segment is ${Fi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!y||y.vertexLength+t>Fi.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==f)&&(y={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},f!==void 0&&(y.sortKey=f),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,l,f){return new Fi([{vertexOffset:t,primitiveOffset:s,vertexLength:l,primitiveLength:f,vaos:{},sortKey:0}])}}function rn(r,t){return 256*(r=ve(Math.floor(r),0,255))+ve(Math.floor(t),0,255)}Fi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ht("SegmentVector",Fi);const ys=m([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Na={exports:{}},Vl={exports:{}};Vl.exports=function(r,t){var s,l,f,y,v,x,T,M;for(l=r.length-(s=3&r.length),f=t,v=3432918353,x=461845907,M=0;M<l;)T=255&r.charCodeAt(M)|(255&r.charCodeAt(++M))<<8|(255&r.charCodeAt(++M))<<16|(255&r.charCodeAt(++M))<<24,++M,f=27492+(65535&(y=5*(65535&(f=(f^=T=(65535&(T=(T=(65535&T)*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*x+(((T>>>16)*x&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(T=0,s){case 3:T^=(255&r.charCodeAt(M+2))<<16;case 2:T^=(255&r.charCodeAt(M+1))<<8;case 1:f^=T=(65535&(T=(T=(65535&(T^=255&r.charCodeAt(M)))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*x+(((T>>>16)*x&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var gp=Vl.exports,ud={exports:{}};ud.exports=function(r,t){for(var s,l=r.length,f=t^l,y=0;l>=4;)s=1540483477*(65535&(s=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(s>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),l-=4,++y;switch(l){case 3:f^=(255&r.charCodeAt(y+2))<<16;case 2:f^=(255&r.charCodeAt(y+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(y)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var hd=gp,aa=ud.exports;Na.exports=hd,Na.exports.murmur3=hd,Na.exports.murmur2=aa;var Ul=A(Na.exports);class $o{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,l,f){this.ids.push(_u(t)),this.positions.push(s,l,f)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=_u(t);let l=0,f=this.ids.length-1;for(;l<f;){const v=l+f>>1;this.ids[v]>=s?f=v:l=v+1}const y=[];for(;this.ids[l]===s;)y.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return y}static serialize(t,s){const l=new Float64Array(t.ids),f=new Uint32Array(t.positions);return jo(l,f,0,l.length-1),s&&s.push(l.buffer,f.buffer),{ids:l,positions:f}}static deserialize(t){const s=new $o;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function _u(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ul(String(r))}function jo(r,t,s,l){for(;s<l;){const f=r[s+l>>1];let y=s-1,v=l+1;for(;;){do y++;while(r[y]<f);do v--;while(r[v]>f);if(y>=v)break;Vo(r,y,v),Vo(t,3*y,3*v),Vo(t,3*y+1,3*v+1),Vo(t,3*y+2,3*v+2)}v-s<l-v?(jo(r,t,s,v),s=v+1):(jo(r,t,v+1,l),l=v)}}function Vo(r,t,s){const l=r[t];r[t]=r[s],r[s]=l}ht("FeaturePositionMap",$o);class _s{constructor(t,s){this.gl=t.gl,this.location=s}}class dd extends _s{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class b0 extends _s{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class x0 extends _s{constructor(t,s){super(t,s),this.current=Ri.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Gx=new Float32Array(16);function yp(r){return[rn(255*r.r,255*r.g),rn(255*r.b,255*r.a)]}class vu{constructor(t,s,l){this.value=t,this.uniformNames=s.map(f=>`u_${f}`),this.type=l}setUniform(t,s,l){t.set(l.constantOr(this.value))}getBinding(t,s,l){return this.type==="color"?new x0(t,s):new dd(t,s)}}class Wl{constructor(t,s){this.uniformNames=s.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,l,f){const y=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)}getBinding(t,s,l){return l.substr(0,9)==="u_pattern"?new b0(t,s):new dd(t,s)}}class oa{constructor(t,s,l,f){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(y=>({name:`a_${y}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,s,l,f,y){const v=this.paintVertexArray.length,x=this.expression.evaluate(new Pi(0),s,{},f,[],y);this.paintVertexArray.resize(t),this._setPaintValue(v,t,x)}updatePaintArray(t,s,l,f){const y=this.expression.evaluate({zoom:0},l,f);this._setPaintValue(t,s,y)}_setPaintValue(t,s,l){if(this.type==="color"){const f=yp(l);for(let y=t;y<s;y++)this.paintVertexArray.emplace(y,f[0],f[1])}else{for(let f=t;f<s;f++)this.paintVertexArray.emplace(f,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class vs{constructor(t,s,l,f,y,v){this.expression=t,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=f,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(t,s,l,f,y){const v=this.expression.evaluate(new Pi(this.zoom),s,{},f,[],y),x=this.expression.evaluate(new Pi(this.zoom+1),s,{},f,[],y),T=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(T,t,v,x)}updatePaintArray(t,s,l,f){const y=this.expression.evaluate({zoom:this.zoom},l,f),v=this.expression.evaluate({zoom:this.zoom+1},l,f);this._setPaintValue(t,s,y,v)}_setPaintValue(t,s,l,f){if(this.type==="color"){const y=yp(l),v=yp(f);for(let x=t;x<s;x++)this.paintVertexArray.emplace(x,y[0],y[1],v[0],v[1])}else{for(let y=t;y<s;y++)this.paintVertexArray.emplace(y,l,f);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,f=ve(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(f)}getBinding(t,s,l){return new dd(t,s)}}class $a{constructor(t,s,l,f,y,v){this.expression=t,this.type=s,this.useIntegerZoom=l,this.zoom=f,this.layerId=v,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(t,s,l){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(f,t,s.patterns&&s.patterns[this.layerId],l)}updatePaintArray(t,s,l,f,y){this._setPaintValues(t,s,l.patterns&&l.patterns[this.layerId],y)}_setPaintValues(t,s,l,f){if(!f||!l)return;const{min:y,mid:v,max:x}=l,T=f[y],M=f[v],I=f[x];if(T&&M&&I)for(let P=t;P<s;P++)this.zoomInPaintVertexArray.emplace(P,M.tl[0],M.tl[1],M.br[0],M.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],M.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,M.tl[0],M.tl[1],M.br[0],M.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],M.pixelRatio,I.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,ys.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,ys.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class w0{constructor(t,s,l){this.binders={},this._buffers=[];const f=[];for(const y in t.paint._values){if(!l(y))continue;const v=t.paint.get(y);if(!(v instanceof mr&&za(v.property.specification)))continue;const x=Hx(y,t.type),T=v.value,M=v.property.specification.type,I=v.property.useIntegerZoom,P=v.property.specification["property-type"],L=P==="cross-faded"||P==="cross-faded-data-driven";if(T.kind==="constant")this.binders[y]=L?new Wl(T.value,x):new vu(T.value,x,M),f.push(`/u_${y}`);else if(T.kind==="source"||L){const $=T0(y,M,"source");this.binders[y]=L?new $a(T,M,I,s,$,t.id):new oa(T,x,M,$),f.push(`/a_${y}`)}else{const $=T0(y,M,"composite");this.binders[y]=new vs(T,x,M,I,s,$),f.push(`/z_${y}`)}}this.cacheKey=f.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof oa||s instanceof vs?s.maxValue:0}populatePaintArrays(t,s,l,f,y){for(const v in this.binders){const x=this.binders[v];(x instanceof oa||x instanceof vs||x instanceof $a)&&x.populatePaintArray(t,s,l,f,y)}}setConstantPatternPositions(t,s){for(const l in this.binders){const f=this.binders[l];f instanceof Wl&&f.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,l,f,y){let v=!1;for(const x in t){const T=s.getPositions(x);for(const M of T){const I=l.feature(M.index);for(const P in this.binders){const L=this.binders[P];if((L instanceof oa||L instanceof vs||L instanceof $a)&&L.expression.isStateDependent===!0){const $=f.paint.get(P);L.expression=$.value,L.updatePaintArray(M.start,M.end,I,t[x],y),v=!0}}}}return v}defines(){const t=[];for(const s in this.binders){const l=this.binders[s];(l instanceof vu||l instanceof Wl)&&t.push(...l.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof oa||l instanceof vs)for(let f=0;f<l.paintVertexAttributes.length;f++)t.push(l.paintVertexAttributes[f].name);else if(l instanceof $a)for(let f=0;f<ys.members.length;f++)t.push(ys.members[f].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof vu||l instanceof Wl||l instanceof vs)for(const f of l.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const l=[];for(const f in this.binders){const y=this.binders[f];if(y instanceof vu||y instanceof Wl||y instanceof vs){for(const v of y.uniformNames)if(s[v]){const x=y.getBinding(t,s[v],v);l.push({name:v,property:f,binding:x})}}}return l}setUniforms(t,s,l,f){for(const{name:y,property:v,binding:x}of s)this.binders[v].setUniform(x,f,l.get(v),y)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const l=this.binders[s];if(t&&l instanceof $a){const f=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(l instanceof oa||l instanceof vs)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const s in this.binders){const l=this.binders[s];(l instanceof oa||l instanceof vs||l instanceof $a)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof oa||s instanceof vs||s instanceof $a)&&s.destroy()}}}class Uo{constructor(t,s,l=()=>!0){this.programConfigurations={};for(const f of t)this.programConfigurations[f.id]=new w0(f,s,l);this.needsUpload=!1,this._featureMap=new $o,this._bufferOffset=0}populatePaintArrays(t,s,l,f,y,v){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(t,s,f,y,v);s.id!==void 0&&this._featureMap.add(s.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,l,f){for(const y of l)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(t,this._featureMap,s,y,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Hx(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function T0(r,t,s){const l={color:{source:j,composite:vt},number:{source:He,composite:j}},f=function(y){return{"line-pattern":{source:Kr,composite:Kr},"fill-pattern":{source:Kr,composite:Kr},"fill-extrusion-pattern":{source:Kr,composite:Kr}}[y]}(r);return f&&f[s]||l[t][s]}ht("ConstantBinder",vu),ht("CrossFadedConstantBinder",Wl),ht("SourceExpressionBinder",oa),ht("CrossFadedCompositeBinder",$a),ht("CompositeExpressionBinder",vs),ht("ProgramConfiguration",w0,{omit:["_buffers"]}),ht("ProgramConfigurationSet",Uo);const Tn=8192,_p=Math.pow(2,14)-1,S0=-_p-1;function Wo(r){const t=Tn/r.extent,s=r.loadGeometry();for(let l=0;l<s.length;l++){const f=s[l];for(let y=0;y<f.length;y++){const v=f[y],x=Math.round(v.x*t),T=Math.round(v.y*t);v.x=ve(x,S0,_p),v.y=ve(T,S0,_p),(x<v.x||x>v.x+1||T<v.y||T>v.y+1)&&fe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function qo(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?Wo(r):[]}}function fd(r,t,s,l,f){r.emplaceBack(2*t+(l+1)/2,2*s+(f+1)/2)}class vp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new nr,this.indexArray=new Pr,this.segments=new Fi,this.programConfigurations=new Uo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){const f=this.layers[0],y=[];let v=null,x=!1;f.type==="circle"&&(v=f.layout.get("circle-sort-key"),x=!v.isConstant());for(const{feature:T,id:M,index:I,sourceLayerIndex:P}of t){const L=this.layers[0]._featureFilter.needGeometry,$=qo(T,L);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom),$,l))continue;const V=x?v.evaluate($,{},l):void 0,U={id:M,properties:T.properties,type:T.type,sourceLayerIndex:P,index:I,geometry:L?$.geometry:Wo(T),patterns:{},sortKey:V};y.push(U)}x&&y.sort((T,M)=>T.sortKey-M.sortKey);for(const T of y){const{geometry:M,index:I,sourceLayerIndex:P}=T,L=t[I].feature;this.addFeature(T,M,I,l),s.featureIndex.insert(L,M,I,P,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,l,f){for(const y of s)for(const v of y){const x=v.x,T=v.y;if(x<0||x>=Tn||T<0||T>=Tn)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),I=M.vertexLength;fd(this.layoutVertexArray,x,T,-1,-1),fd(this.layoutVertexArray,x,T,1,-1),fd(this.layoutVertexArray,x,T,1,1),fd(this.layoutVertexArray,x,T,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},f)}}function k0(r,t){for(let s=0;s<r.length;s++)if(ql(t,r[s]))return!0;for(let s=0;s<t.length;s++)if(ql(r,t[s]))return!0;return!!bp(r,t)}function Xx(r,t,s){return!!ql(r,t)||!!xp(t,r,s)}function M0(r,t){if(r.length===1)return I0(t,r[0]);for(let s=0;s<t.length;s++){const l=t[s];for(let f=0;f<l.length;f++)if(ql(r,l[f]))return!0}for(let s=0;s<r.length;s++)if(I0(t,r[s]))return!0;for(let s=0;s<t.length;s++)if(bp(r,t[s]))return!0;return!1}function Yx(r,t,s){if(r.length>1){if(bp(r,t))return!0;for(let l=0;l<t.length;l++)if(xp(t[l],r,s))return!0}for(let l=0;l<r.length;l++)if(xp(r[l],t,s))return!0;return!1}function bp(r,t){if(r.length===0||t.length===0)return!1;for(let s=0;s<r.length-1;s++){const l=r[s],f=r[s+1];for(let y=0;y<t.length-1;y++)if(Kx(l,f,t[y],t[y+1]))return!0}return!1}function Kx(r,t,s,l){return Ae(r,s,l)!==Ae(t,s,l)&&Ae(r,t,s)!==Ae(r,t,l)}function xp(r,t,s){const l=s*s;if(t.length===1)return r.distSqr(t[0])<l;for(let f=1;f<t.length;f++)if(A0(r,t[f-1],t[f])<l)return!0;return!1}function A0(r,t,s){const l=t.distSqr(s);if(l===0)return r.distSqr(t);const f=((r.x-t.x)*(s.x-t.x)+(r.y-t.y)*(s.y-t.y))/l;return r.distSqr(f<0?t:f>1?s:s.sub(t)._mult(f)._add(t))}function I0(r,t){let s,l,f,y=!1;for(let v=0;v<r.length;v++){s=r[v];for(let x=0,T=s.length-1;x<s.length;T=x++)l=s[x],f=s[T],l.y>t.y!=f.y>t.y&&t.x<(f.x-l.x)*(t.y-l.y)/(f.y-l.y)+l.x&&(y=!y)}return y}function ql(r,t){let s=!1;for(let l=0,f=r.length-1;l<r.length;f=l++){const y=r[l],v=r[f];y.y>t.y!=v.y>t.y&&t.x<(v.x-y.x)*(t.y-y.y)/(v.y-y.y)+y.x&&(s=!s)}return s}function Jx(r,t,s){const l=s[0],f=s[2];if(r.x<l.x&&t.x<l.x||r.x>f.x&&t.x>f.x||r.y<l.y&&t.y<l.y||r.y>f.y&&t.y>f.y)return!1;const y=Ae(r,t,s[0]);return y!==Ae(r,t,s[1])||y!==Ae(r,t,s[2])||y!==Ae(r,t,s[3])}function bu(r,t,s){const l=t.paint.get(r).value;return l.kind==="constant"?l.value:s.programConfigurations.get(t.id).getMaxValue(r)}function pd(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function md(r,t,s,l,f){if(!t[0]&&!t[1])return r;const y=R.convert(t)._mult(f);s==="viewport"&&y._rotate(-l);const v=[];for(let x=0;x<r.length;x++)v.push(r[x].sub(y));return v}let E0,C0;ht("CircleBucket",vp,{omit:["layers"]});var Qx={get paint(){return C0=C0||new gr({"circle-radius":new It(Me.paint_circle["circle-radius"]),"circle-color":new It(Me.paint_circle["circle-color"]),"circle-blur":new It(Me.paint_circle["circle-blur"]),"circle-opacity":new It(Me.paint_circle["circle-opacity"]),"circle-translate":new St(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new St(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new St(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new St(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new It(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new It(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new It(Me.paint_circle["circle-stroke-opacity"])})},get layout(){return E0=E0||new gr({"circle-sort-key":new It(Me.layout_circle["circle-sort-key"])})}},_r=1e-6,Zl=typeof Float32Array<"u"?Float32Array:Array;function wp(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function P0(r,t,s){var l=t[0],f=t[1],y=t[2],v=t[3],x=t[4],T=t[5],M=t[6],I=t[7],P=t[8],L=t[9],$=t[10],V=t[11],U=t[12],J=t[13],re=t[14],xe=t[15],ue=s[0],ye=s[1],Ee=s[2],qe=s[3];return r[0]=ue*l+ye*x+Ee*P+qe*U,r[1]=ue*f+ye*T+Ee*L+qe*J,r[2]=ue*y+ye*M+Ee*$+qe*re,r[3]=ue*v+ye*I+Ee*V+qe*xe,r[4]=(ue=s[4])*l+(ye=s[5])*x+(Ee=s[6])*P+(qe=s[7])*U,r[5]=ue*f+ye*T+Ee*L+qe*J,r[6]=ue*y+ye*M+Ee*$+qe*re,r[7]=ue*v+ye*I+Ee*V+qe*xe,r[8]=(ue=s[8])*l+(ye=s[9])*x+(Ee=s[10])*P+(qe=s[11])*U,r[9]=ue*f+ye*T+Ee*L+qe*J,r[10]=ue*y+ye*M+Ee*$+qe*re,r[11]=ue*v+ye*I+Ee*V+qe*xe,r[12]=(ue=s[12])*l+(ye=s[13])*x+(Ee=s[14])*P+(qe=s[15])*U,r[13]=ue*f+ye*T+Ee*L+qe*J,r[14]=ue*y+ye*M+Ee*$+qe*re,r[15]=ue*v+ye*I+Ee*V+qe*xe,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var xu,ew=P0;function gd(r,t,s){var l=t[0],f=t[1],y=t[2],v=t[3];return r[0]=s[0]*l+s[4]*f+s[8]*y+s[12]*v,r[1]=s[1]*l+s[5]*f+s[9]*y+s[13]*v,r[2]=s[2]*l+s[6]*f+s[10]*y+s[14]*v,r[3]=s[3]*l+s[7]*f+s[11]*y+s[15]*v,r}xu=new Zl(4),Zl!=Float32Array&&(xu[0]=0,xu[1]=0,xu[2]=0,xu[3]=0);class tw extends e{constructor(t){super(t,Qx)}createBucket(t){return new vp(t)}queryRadius(t){const s=t;return bu("circle-radius",this,s)+bu("circle-stroke-width",this,s)+pd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,s,l,f,y,v,x,T){const M=md(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,x),I=this.paint.get("circle-radius").evaluate(s,l)+this.paint.get("circle-stroke-width").evaluate(s,l),P=this.paint.get("circle-pitch-alignment")==="map",L=P?M:function(V,U){return V.map(J=>z0(J,U))}(M,T),$=P?I*x:I;for(const V of f)for(const U of V){const J=P?U:z0(U,T);let re=$;const xe=gd([],[U.x,U.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?re*=xe[3]/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(re*=v.cameraToCenterDistance/xe[3]),Xx(L,J,re))return!0}return!1}}function z0(r,t){const s=gd([],[r.x,r.y,0,1],t);return new R(s[0]/s[3],s[1]/s[3])}class D0 extends vp{}let L0;ht("HeatmapBucket",D0,{omit:["layers"]});var iw={get paint(){return L0=L0||new gr({"heatmap-radius":new It(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new It(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new St(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Nl(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new St(Me.paint_heatmap["heatmap-opacity"])})}};function Tp(r,{width:t,height:s},l,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*s*l)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${t*s*l}`)}else f=new Uint8Array(t*s*l);return r.width=t,r.height=s,r.data=f,r}function R0(r,{width:t,height:s},l){if(t===r.width&&s===r.height)return;const f=Tp({},{width:t,height:s},l);Sp(r,f,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,s)},l),r.width=t,r.height=s,r.data=f.data}function Sp(r,t,s,l,f,y){if(f.width===0||f.height===0)return t;if(f.width>r.width||f.height>r.height||s.x>r.width-f.width||s.y>r.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||l.x>t.width-f.width||l.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const v=r.data,x=t.data;if(v===x)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<f.height;T++){const M=((s.y+T)*r.width+s.x)*y,I=((l.y+T)*t.width+l.x)*y;for(let P=0;P<f.width*y;P++)x[I+P]=v[M+P]}return t}class wu{constructor(t,s){Tp(this,t,1,s)}resize(t){R0(this,t,1)}clone(){return new wu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,l,f,y){Sp(t,s,l,f,y,1)}}class Qr{constructor(t,s){Tp(this,t,4,s)}resize(t){R0(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,l,f,y){Sp(t,s,l,f,y,4)}}function O0(r){const t={},s=r.resolution||256,l=r.clips?r.clips.length:1,f=r.image||new Qr({width:s,height:l});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const y=(v,x,T)=>{t[r.evaluationKey]=T;const M=r.expression.evaluate(t);f.data[v+x+0]=Math.floor(255*M.r/M.a),f.data[v+x+1]=Math.floor(255*M.g/M.a),f.data[v+x+2]=Math.floor(255*M.b/M.a),f.data[v+x+3]=Math.floor(255*M.a)};if(r.clips)for(let v=0,x=0;v<l;++v,x+=4*s)for(let T=0,M=0;T<s;T++,M+=4){const I=T/(s-1),{start:P,end:L}=r.clips[v];y(x,M,P*(1-I)+L*I)}else for(let v=0,x=0;v<s;v++,x+=4)y(0,x,v/(s-1));return f}ht("AlphaImage",wu),ht("RGBAImage",Qr);const kp="big-fb";class nw extends e{createBucket(t){return new D0(t)}constructor(t){super(t,iw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=O0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(kp)&&this.heatmapFbos.delete(kp)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let B0;var rw={get paint(){return B0=B0||new gr({"hillshade-illumination-direction":new St(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new St(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new St(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new St(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new St(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new St(Me.paint_hillshade["hillshade-accent-color"])})}};class sw extends e{constructor(t){super(t,rw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const aw=m([{name:"a_pos",components:2,type:"Int16"}],4),{members:ow}=aw;function F0(r,t,s=2){const l=t&&t.length,f=l?t[0]*s:r.length;let y=N0(r,0,f,s,!0);const v=[];if(!y||y.next===y.prev)return v;let x,T,M;if(l&&(y=function(I,P,L,$){const V=[];for(let U=0,J=P.length;U<J;U++){const re=N0(I,P[U]*$,U<J-1?P[U+1]*$:I.length,$,!1);re===re.next&&(re.steiner=!0),V.push(mw(re))}V.sort(dw);for(let U=0;U<V.length;U++)L=fw(V[U],L);return L}(r,t,y,s)),r.length>80*s){x=1/0,T=1/0;let I=-1/0,P=-1/0;for(let L=s;L<f;L+=s){const $=r[L],V=r[L+1];$<x&&(x=$),V<T&&(T=V),$>I&&(I=$),V>P&&(P=V)}M=Math.max(I-x,P-T),M=M!==0?32767/M:0}return Tu(y,v,s,x,T,M,0),v}function N0(r,t,s,l,f){let y;if(f===function(v,x,T,M){let I=0;for(let P=x,L=T-M;P<T;P+=M)I+=(v[L]-v[P])*(v[P+1]+v[L+1]),L=P;return I}(r,t,s,l)>0)for(let v=t;v<s;v+=l)y=V0(v/l|0,r[v],r[v+1],y);else for(let v=s-l;v>=t;v-=l)y=V0(v/l|0,r[v],r[v+1],y);return y&&yd(y,y.next)&&(ku(y),y=y.next),y}function Zo(r,t){if(!r)return r;t||(t=r);let s,l=r;do if(s=!1,l.steiner||!yd(l,l.next)&&_n(l.prev,l,l.next)!==0)l=l.next;else{if(ku(l),l=t=l.prev,l===l.next)break;s=!0}while(s||l!==t);return t}function Tu(r,t,s,l,f,y,v){if(!r)return;!v&&y&&function(T,M,I,P){let L=T;do L.z===0&&(L.z=Mp(L.x,L.y,M,I,P)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==T);L.prevZ.nextZ=null,L.prevZ=null,function($){let V,U=1;do{let J,re=$;$=null;let xe=null;for(V=0;re;){V++;let ue=re,ye=0;for(let qe=0;qe<U&&(ye++,ue=ue.nextZ,ue);qe++);let Ee=U;for(;ye>0||Ee>0&&ue;)ye!==0&&(Ee===0||!ue||re.z<=ue.z)?(J=re,re=re.nextZ,ye--):(J=ue,ue=ue.nextZ,Ee--),xe?xe.nextZ=J:$=J,J.prevZ=xe,xe=J;re=ue}xe.nextZ=null,U*=2}while(V>1)}(L)}(r,l,f,y);let x=r;for(;r.prev!==r.next;){const T=r.prev,M=r.next;if(y?cw(r,l,f,y):lw(r))t.push(T.i,r.i,M.i),ku(r),r=M.next,x=M.next;else if((r=M)===x){v?v===1?Tu(r=uw(Zo(r),t),t,s,l,f,y,2):v===2&&hw(r,t,s,l,f,y):Tu(Zo(r),t,s,l,f,y,1);break}}}function lw(r){const t=r.prev,s=r,l=r.next;if(_n(t,s,l)>=0)return!1;const f=t.x,y=s.x,v=l.x,x=t.y,T=s.y,M=l.y,I=f<y?f<v?f:v:y<v?y:v,P=x<T?x<M?x:M:T<M?T:M,L=f>y?f>v?f:v:y>v?y:v,$=x>T?x>M?x:M:T>M?T:M;let V=l.next;for(;V!==t;){if(V.x>=I&&V.x<=L&&V.y>=P&&V.y<=$&&Gl(f,x,y,T,v,M,V.x,V.y)&&_n(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function cw(r,t,s,l){const f=r.prev,y=r,v=r.next;if(_n(f,y,v)>=0)return!1;const x=f.x,T=y.x,M=v.x,I=f.y,P=y.y,L=v.y,$=x<T?x<M?x:M:T<M?T:M,V=I<P?I<L?I:L:P<L?P:L,U=x>T?x>M?x:M:T>M?T:M,J=I>P?I>L?I:L:P>L?P:L,re=Mp($,V,t,s,l),xe=Mp(U,J,t,s,l);let ue=r.prevZ,ye=r.nextZ;for(;ue&&ue.z>=re&&ye&&ye.z<=xe;){if(ue.x>=$&&ue.x<=U&&ue.y>=V&&ue.y<=J&&ue!==f&&ue!==v&&Gl(x,I,T,P,M,L,ue.x,ue.y)&&_n(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,ye.x>=$&&ye.x<=U&&ye.y>=V&&ye.y<=J&&ye!==f&&ye!==v&&Gl(x,I,T,P,M,L,ye.x,ye.y)&&_n(ye.prev,ye,ye.next)>=0))return!1;ye=ye.nextZ}for(;ue&&ue.z>=re;){if(ue.x>=$&&ue.x<=U&&ue.y>=V&&ue.y<=J&&ue!==f&&ue!==v&&Gl(x,I,T,P,M,L,ue.x,ue.y)&&_n(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;ye&&ye.z<=xe;){if(ye.x>=$&&ye.x<=U&&ye.y>=V&&ye.y<=J&&ye!==f&&ye!==v&&Gl(x,I,T,P,M,L,ye.x,ye.y)&&_n(ye.prev,ye,ye.next)>=0)return!1;ye=ye.nextZ}return!0}function uw(r,t){let s=r;do{const l=s.prev,f=s.next.next;!yd(l,f)&&$0(l,s,s.next,f)&&Su(l,f)&&Su(f,l)&&(t.push(l.i,s.i,f.i),ku(s),ku(s.next),s=r=f),s=s.next}while(s!==r);return Zo(s)}function hw(r,t,s,l,f,y){let v=r;do{let x=v.next.next;for(;x!==v.prev;){if(v.i!==x.i&&gw(v,x)){let T=j0(v,x);return v=Zo(v,v.next),T=Zo(T,T.next),Tu(v,t,s,l,f,y,0),void Tu(T,t,s,l,f,y,0)}x=x.next}v=v.next}while(v!==r)}function dw(r,t){return r.x-t.x}function fw(r,t){const s=function(f,y){let v=y;const x=f.x,T=f.y;let M,I=-1/0;do{if(T<=v.y&&T>=v.next.y&&v.next.y!==v.y){const U=v.x+(T-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(U<=x&&U>I&&(I=U,M=v.x<v.next.x?v:v.next,U===x))return M}v=v.next}while(v!==y);if(!M)return null;const P=M,L=M.x,$=M.y;let V=1/0;v=M;do{if(x>=v.x&&v.x>=L&&x!==v.x&&Gl(T<$?x:I,T,L,$,T<$?I:x,T,v.x,v.y)){const U=Math.abs(T-v.y)/(x-v.x);Su(v,f)&&(U<V||U===V&&(v.x>M.x||v.x===M.x&&pw(M,v)))&&(M=v,V=U)}v=v.next}while(v!==P);return M}(r,t);if(!s)return t;const l=j0(s,r);return Zo(l,l.next),Zo(s,s.next)}function pw(r,t){return _n(r.prev,r,t.prev)<0&&_n(t.next,r,r.next)<0}function Mp(r,t,s,l,f){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-s)*f|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*f|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function mw(r){let t=r,s=r;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==r);return s}function Gl(r,t,s,l,f,y,v,x){return(f-v)*(t-x)>=(r-v)*(y-x)&&(r-v)*(l-x)>=(s-v)*(t-x)&&(s-v)*(y-x)>=(f-v)*(l-x)}function gw(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(s,l){let f=s;do{if(f.i!==s.i&&f.next.i!==s.i&&f.i!==l.i&&f.next.i!==l.i&&$0(f,f.next,s,l))return!0;f=f.next}while(f!==s);return!1}(r,t)&&(Su(r,t)&&Su(t,r)&&function(s,l){let f=s,y=!1;const v=(s.x+l.x)/2,x=(s.y+l.y)/2;do f.y>x!=f.next.y>x&&f.next.y!==f.y&&v<(f.next.x-f.x)*(x-f.y)/(f.next.y-f.y)+f.x&&(y=!y),f=f.next;while(f!==s);return y}(r,t)&&(_n(r.prev,r,t.prev)||_n(r,t.prev,t))||yd(r,t)&&_n(r.prev,r,r.next)>0&&_n(t.prev,t,t.next)>0)}function _n(r,t,s){return(t.y-r.y)*(s.x-t.x)-(t.x-r.x)*(s.y-t.y)}function yd(r,t){return r.x===t.x&&r.y===t.y}function $0(r,t,s,l){const f=vd(_n(r,t,s)),y=vd(_n(r,t,l)),v=vd(_n(s,l,r)),x=vd(_n(s,l,t));return f!==y&&v!==x||!(f!==0||!_d(r,s,t))||!(y!==0||!_d(r,l,t))||!(v!==0||!_d(s,r,l))||!(x!==0||!_d(s,t,l))}function _d(r,t,s){return t.x<=Math.max(r.x,s.x)&&t.x>=Math.min(r.x,s.x)&&t.y<=Math.max(r.y,s.y)&&t.y>=Math.min(r.y,s.y)}function vd(r){return r>0?1:r<0?-1:0}function Su(r,t){return _n(r.prev,r,r.next)<0?_n(r,t,r.next)>=0&&_n(r,r.prev,t)>=0:_n(r,t,r.prev)<0||_n(r,r.next,t)<0}function j0(r,t){const s=Ap(r.i,r.x,r.y),l=Ap(t.i,t.x,t.y),f=r.next,y=t.prev;return r.next=t,t.prev=r,s.next=f,f.prev=s,l.next=s,s.prev=l,y.next=l,l.prev=y,l}function V0(r,t,s,l){const f=Ap(r,t,s);return l?(f.next=l.next,f.prev=l,l.next.prev=f,l.next=f):(f.prev=f,f.next=f),f}function ku(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Ap(r,t,s){return{i:r,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Ip(r,t,s){const l=s.patternDependencies;let f=!1;for(const y of t){const v=y.paint.get(`${r}-pattern`);v.isConstant()||(f=!0);const x=v.constantOr(null);x&&(f=!0,l[x.to]=!0,l[x.from]=!0)}return f}function Ep(r,t,s,l,f){const y=f.patternDependencies;for(const v of t){const x=v.paint.get(`${r}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:l-1},s,{},f.availableImages),M=x.evaluate({zoom:l},s,{},f.availableImages),I=x.evaluate({zoom:l+1},s,{},f.availableImages);T=T&&T.name?T.name:T,M=M&&M.name?M.name:M,I=I&&I.name?I.name:I,y[T]=!0,y[M]=!0,y[I]=!0,s.patterns[v.id]={min:T,mid:M,max:I}}}return s}class Cp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rr,this.indexArray=new Pr,this.indexArray2=new Ls,this.programConfigurations=new Uo(t.layers,t.zoom),this.segments=new Fi,this.segments2=new Fi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.hasPattern=Ip("fill",this.layers,s);const f=this.layers[0].layout.get("fill-sort-key"),y=!f.isConstant(),v=[];for(const{feature:x,id:T,index:M,sourceLayerIndex:I}of t){const P=this.layers[0]._featureFilter.needGeometry,L=qo(x,P);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom),L,l))continue;const $=y?f.evaluate(L,{},l,s.availableImages):void 0,V={id:T,properties:x.properties,type:x.type,sourceLayerIndex:I,index:M,geometry:P?L.geometry:Wo(x),patterns:{},sortKey:$};v.push(V)}y&&v.sort((x,T)=>x.sortKey-T.sortKey);for(const x of v){const{geometry:T,index:M,sourceLayerIndex:I}=x;if(this.hasPattern){const P=Ep("fill",this.layers,x,this.zoom,s);this.patternFeatures.push(P)}else this.addFeature(x,T,M,l,{});s.featureIndex.insert(t[M].feature,T,M,I,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}addFeatures(t,s,l){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ow),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,l,f,y){for(const v of xl(s,500)){let x=0;for(const $ of v)x+=$.length;const T=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),M=T.vertexLength,I=[],P=[];for(const $ of v){if($.length===0)continue;$!==v[0]&&P.push(I.length/2);const V=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),U=V.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(U+$.length-1,U),I.push($[0].x),I.push($[0].y);for(let J=1;J<$.length;J++)this.layoutVertexArray.emplaceBack($[J].x,$[J].y),this.indexArray2.emplaceBack(U+J-1,U+J),I.push($[J].x),I.push($[J].y);V.vertexLength+=$.length,V.primitiveLength+=$.length}const L=F0(I,P);for(let $=0;$<L.length;$+=3)this.indexArray.emplaceBack(M+L[$],M+L[$+1],M+L[$+2]);T.vertexLength+=x,T.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,y,f)}}let U0,W0;ht("FillBucket",Cp,{omit:["layers","patternFeatures"]});var yw={get paint(){return W0=W0||new gr({"fill-antialias":new St(Me.paint_fill["fill-antialias"]),"fill-opacity":new It(Me.paint_fill["fill-opacity"]),"fill-color":new It(Me.paint_fill["fill-color"]),"fill-outline-color":new It(Me.paint_fill["fill-outline-color"]),"fill-translate":new St(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new St(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fl(Me.paint_fill["fill-pattern"])})},get layout(){return U0=U0||new gr({"fill-sort-key":new It(Me.layout_fill["fill-sort-key"])})}};class _w extends e{constructor(t){super(t,yw)}recalculate(t,s){super.recalculate(t,s);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Cp(t)}queryRadius(){return pd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,s,l,f,y,v,x){return M0(md(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,x),f)}isTileClipped(){return!0}}const vw=m([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),bw=m([{name:"a_centroid",components:2,type:"Int16"}],4),{members:xw}=vw;var ja={},ww=O,q0=Hl;function Hl(r,t,s,l,f){this.properties={},this.extent=s,this.type=0,this._pbf=r,this._geometry=-1,this._keys=l,this._values=f,r.readFields(Tw,this,t)}function Tw(r,t,s){r==1?t.id=s.readVarint():r==2?function(l,f){for(var y=l.readVarint()+l.pos;l.pos<y;){var v=f._keys[l.readVarint()],x=f._values[l.readVarint()];f.properties[v]=x}}(s,t):r==3?t.type=s.readVarint():r==4&&(t._geometry=s.pos)}function Sw(r){for(var t,s,l=0,f=0,y=r.length,v=y-1;f<y;v=f++)l+=((s=r[v]).x-(t=r[f]).x)*(t.y+s.y);return l}Hl.types=["Unknown","Point","LineString","Polygon"],Hl.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,s=r.readVarint()+r.pos,l=1,f=0,y=0,v=0,x=[];r.pos<s;){if(f<=0){var T=r.readVarint();l=7&T,f=T>>3}if(f--,l===1||l===2)y+=r.readSVarint(),v+=r.readSVarint(),l===1&&(t&&x.push(t),t=[]),t.push(new ww(y,v));else{if(l!==7)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&x.push(t),x},Hl.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,s=1,l=0,f=0,y=0,v=1/0,x=-1/0,T=1/0,M=-1/0;r.pos<t;){if(l<=0){var I=r.readVarint();s=7&I,l=I>>3}if(l--,s===1||s===2)(f+=r.readSVarint())<v&&(v=f),f>x&&(x=f),(y+=r.readSVarint())<T&&(T=y),y>M&&(M=y);else if(s!==7)throw new Error("unknown command "+s)}return[v,T,x,M]},Hl.prototype.toGeoJSON=function(r,t,s){var l,f,y=this.extent*Math.pow(2,s),v=this.extent*r,x=this.extent*t,T=this.loadGeometry(),M=Hl.types[this.type];function I($){for(var V=0;V<$.length;V++){var U=$[V];$[V]=[360*(U.x+v)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+x)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(l=0;l<T.length;l++)P[l]=T[l][0];I(T=P);break;case 2:for(l=0;l<T.length;l++)I(T[l]);break;case 3:for(T=function($){var V=$.length;if(V<=1)return[$];for(var U,J,re=[],xe=0;xe<V;xe++){var ue=Sw($[xe]);ue!==0&&(J===void 0&&(J=ue<0),J===ue<0?(U&&re.push(U),U=[$[xe]]):U.push($[xe]))}return U&&re.push(U),re}(T),l=0;l<T.length;l++)for(f=0;f<T[l].length;f++)I(T[l][f])}T.length===1?T=T[0]:M="Multi"+M;var L={type:"Feature",geometry:{type:M,coordinates:T},properties:this.properties};return"id"in this&&(L.id=this.id),L};var kw=q0,Z0=G0;function G0(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Mw,this,t),this.length=this._features.length}function Mw(r,t,s){r===15?t.version=s.readVarint():r===1?t.name=s.readString():r===5?t.extent=s.readVarint():r===2?t._features.push(s.pos):r===3?t._keys.push(s.readString()):r===4&&t._values.push(function(l){for(var f=null,y=l.readVarint()+l.pos;l.pos<y;){var v=l.readVarint()>>3;f=v===1?l.readString():v===2?l.readFloat():v===3?l.readDouble():v===4?l.readVarint64():v===5?l.readVarint():v===6?l.readSVarint():v===7?l.readBoolean():null}return f}(s))}G0.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new kw(this._pbf,t,this.extent,this._keys,this._values)};var Aw=Z0;function Iw(r,t,s){if(r===3){var l=new Aw(s,s.readVarint()+s.pos);l.length&&(t[l.name]=l)}}ja.VectorTile=function(r,t){this.layers=r.readFields(Iw,{},t)},ja.VectorTileFeature=q0,ja.VectorTileLayer=Z0;const Ew=ja.VectorTileFeature.types,Pp=Math.pow(2,13);function Mu(r,t,s,l,f,y,v,x){r.emplaceBack(t,s,2*Math.floor(l*Pp)+v,f*Pp*2,y*Pp*2,Math.round(x))}class zp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new us,this.centroidVertexArray=new ir,this.indexArray=new Pr,this.programConfigurations=new Uo(t.layers,t.zoom),this.segments=new Fi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.features=[],this.hasPattern=Ip("fill-extrusion",this.layers,s);for(const{feature:f,id:y,index:v,sourceLayerIndex:x}of t){const T=this.layers[0]._featureFilter.needGeometry,M=qo(f,T);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom),M,l))continue;const I={id:y,sourceLayerIndex:x,index:v,geometry:T?M.geometry:Wo(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(Ep("fill-extrusion",this.layers,I,this.zoom,s)):this.addFeature(I,I.geometry,v,l,{}),s.featureIndex.insert(f,I.geometry,v,x,this.index,!0)}}addFeatures(t,s,l){for(const f of this.features){const{geometry:y}=f;this.addFeature(f,y,f.index,s,l)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xw),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,bw.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,l,f,y){for(const v of xl(s,500)){const x={x:0,y:0,vertexCount:0};let T=0;for(const V of v)T+=V.length;let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const V of v){if(V.length===0||Pw(V))continue;let U=0;for(let J=0;J<V.length;J++){const re=V[J];if(J>=1){const xe=V[J-1];if(!Cw(re,xe)){M.vertexLength+4>Fi.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ue=re.sub(xe)._perp()._unit(),ye=xe.dist(re);U+ye>32768&&(U=0),Mu(this.layoutVertexArray,re.x,re.y,ue.x,ue.y,0,0,U),Mu(this.layoutVertexArray,re.x,re.y,ue.x,ue.y,0,1,U),x.x+=2*re.x,x.y+=2*re.y,x.vertexCount+=2,U+=ye,Mu(this.layoutVertexArray,xe.x,xe.y,ue.x,ue.y,0,0,U),Mu(this.layoutVertexArray,xe.x,xe.y,ue.x,ue.y,0,1,U),x.x+=2*xe.x,x.y+=2*xe.y,x.vertexCount+=2;const Ee=M.vertexLength;this.indexArray.emplaceBack(Ee,Ee+2,Ee+1),this.indexArray.emplaceBack(Ee+1,Ee+2,Ee+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+T>Fi.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),Ew[t.type]!=="Polygon")continue;const I=[],P=[],L=M.vertexLength;for(const V of v)if(V.length!==0){V!==v[0]&&P.push(I.length/2);for(let U=0;U<V.length;U++){const J=V[U];Mu(this.layoutVertexArray,J.x,J.y,0,0,1,1,0),x.x+=J.x,x.y+=J.y,x.vertexCount+=1,I.push(J.x),I.push(J.y)}}const $=F0(I,P);for(let V=0;V<$.length;V+=3)this.indexArray.emplaceBack(L+$[V],L+$[V+2],L+$[V+1]);M.primitiveLength+=$.length/3,M.vertexLength+=T;for(let V=0;V<x.vertexCount;V++){const U=Math.floor(x.x/x.vertexCount),J=Math.floor(x.y/x.vertexCount);this.centroidVertexArray.emplaceBack(U,J)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,y,f)}}function Cw(r,t){return r.x===t.x&&(r.x<0||r.x>Tn)||r.y===t.y&&(r.y<0||r.y>Tn)}function Pw(r){return r.every(t=>t.x<0)||r.every(t=>t.x>Tn)||r.every(t=>t.y<0)||r.every(t=>t.y>Tn)}let H0;ht("FillExtrusionBucket",zp,{omit:["layers","features"]});var zw={get paint(){return H0=H0||new gr({"fill-extrusion-opacity":new St(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new It(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new St(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new St(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fl(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new It(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new It(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new St(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Dw extends e{constructor(t){super(t,zw)}createBucket(t){return new zp(t)}queryRadius(){return pd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,s,l,f,y,v,x,T){const M=md(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,x),I=this.paint.get("fill-extrusion-height").evaluate(s,l),P=this.paint.get("fill-extrusion-base").evaluate(s,l),L=function(V,U,J,re){const xe=[];for(const ue of V){const ye=[ue.x,ue.y,0,1];gd(ye,ye,U),xe.push(new R(ye[0]/ye[3],ye[1]/ye[3]))}return xe}(M,T),$=function(V,U,J,re){const xe=[],ue=[],ye=re[8]*U,Ee=re[9]*U,qe=re[10]*U,ct=re[11]*U,zt=re[8]*J,at=re[9]*J,nt=re[10]*J,wt=re[11]*J;for(const yt of V){const ft=[],Be=[];for(const Mt of yt){const bt=Mt.x,Bt=Mt.y,Wi=re[0]*bt+re[4]*Bt+re[12],$i=re[1]*bt+re[5]*Bt+re[13],Pn=re[2]*bt+re[6]*Bt+re[14],hs=re[3]*bt+re[7]*Bt+re[15],Hn=Pn+qe,zn=hs+ct,vr=Wi+zt,br=$i+at,xr=Pn+nt,mn=hs+wt,Dn=new R((Wi+ye)/zn,($i+Ee)/zn);Dn.z=Hn/zn,ft.push(Dn);const ar=new R(vr/mn,br/mn);ar.z=xr/mn,Be.push(ar)}xe.push(ft),ue.push(Be)}return[xe,ue]}(f,P,I,T);return function(V,U,J){let re=1/0;M0(J,U)&&(re=X0(J,U[0]));for(let xe=0;xe<U.length;xe++){const ue=U[xe],ye=V[xe];for(let Ee=0;Ee<ue.length-1;Ee++){const qe=ue[Ee],ct=[qe,ue[Ee+1],ye[Ee+1],ye[Ee],qe];k0(J,ct)&&(re=Math.min(re,X0(J,ct)))}}return re!==1/0&&re}($[0],$[1],L)}}function Au(r,t){return r.x*t.x+r.y*t.y}function X0(r,t){if(r.length===1){let s=0;const l=t[s++];let f;for(;!f||l.equals(f);)if(f=t[s++],!f)return 1/0;for(;s<t.length;s++){const y=t[s],v=r[0],x=f.sub(l),T=y.sub(l),M=v.sub(l),I=Au(x,x),P=Au(x,T),L=Au(T,T),$=Au(M,x),V=Au(M,T),U=I*L-P*P,J=(L*$-P*V)/U,re=(I*V-P*$)/U,xe=l.z*(1-J-re)+f.z*J+y.z*re;if(isFinite(xe))return xe}return 1/0}{let s=1/0;for(const l of t)s=Math.min(s,l.z);return s}}const Lw=m([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Rw}=Lw,Ow=m([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Bw}=Ow,Fw=ja.VectorTileFeature.types,Nw=Math.cos(Math.PI/180*37.5),Y0=Math.pow(2,14)/.5;class Dp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Fa,this.layoutVertexArray2=new $l,this.indexArray=new Pr,this.programConfigurations=new Uo(t.layers,t.zoom),this.segments=new Fi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.hasPattern=Ip("line",this.layers,s);const f=this.layers[0].layout.get("line-sort-key"),y=!f.isConstant(),v=[];for(const{feature:x,id:T,index:M,sourceLayerIndex:I}of t){const P=this.layers[0]._featureFilter.needGeometry,L=qo(x,P);if(!this.layers[0]._featureFilter.filter(new Pi(this.zoom),L,l))continue;const $=y?f.evaluate(L,{},l):void 0,V={id:T,properties:x.properties,type:x.type,sourceLayerIndex:I,index:M,geometry:P?L.geometry:Wo(x),patterns:{},sortKey:$};v.push(V)}y&&v.sort((x,T)=>x.sortKey-T.sortKey);for(const x of v){const{geometry:T,index:M,sourceLayerIndex:I}=x;if(this.hasPattern){const P=Ep("line",this.layers,x,this.zoom,s);this.patternFeatures.push(P)}else this.addFeature(x,T,M,l,{});s.featureIndex.insert(t[M].feature,T,M,I,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}addFeatures(t,s,l){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Bw)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Rw),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,l,f,y){const v=this.layers[0].layout,x=v.get("line-join").evaluate(t,{}),T=v.get("line-cap"),M=v.get("line-miter-limit"),I=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const P of s)this.addLine(P,t,x,T,M,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,y,f)}addLine(t,s,l,f,y,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<t.length-1;re++)this.totalDistance+=t[re].dist(t[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=Fw[s.type]==="Polygon";let T=t.length;for(;T>=2&&t[T-1].equals(t[T-2]);)T--;let M=0;for(;M<T-1&&t[M].equals(t[M+1]);)M++;if(T<(x?3:2))return;l==="bevel"&&(y=1.05);const I=this.overscaling<=16?15*Tn/(512*this.overscaling):0,P=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let L,$,V,U,J;this.e1=this.e2=-1,x&&(L=t[T-2],J=t[M].sub(L)._unit()._perp());for(let re=M;re<T;re++){if(V=re===T-1?x?t[M+1]:void 0:t[re+1],V&&t[re].equals(V))continue;J&&(U=J),L&&($=L),L=t[re],J=V?V.sub(L)._unit()._perp():U,U=U||J;let xe=U.add(J);xe.x===0&&xe.y===0||xe._unit();const ue=U.x*J.x+U.y*J.y,ye=xe.x*J.x+xe.y*J.y,Ee=ye!==0?1/ye:1/0,qe=2*Math.sqrt(2-2*ye),ct=ye<Nw&&$&&V,zt=U.x*J.y-U.y*J.x>0;if(ct&&re>M){const wt=L.dist($);if(wt>2*I){const yt=L.sub(L.sub($)._mult(I/wt)._round());this.updateDistance($,yt),this.addCurrentVertex(yt,U,0,0,P),$=yt}}const at=$&&V;let nt=at?l:x?"butt":f;if(at&&nt==="round"&&(Ee<v?nt="miter":Ee<=2&&(nt="fakeround")),nt==="miter"&&Ee>y&&(nt="bevel"),nt==="bevel"&&(Ee>2&&(nt="flipbevel"),Ee<y&&(nt="miter")),$&&this.updateDistance($,L),nt==="miter")xe._mult(Ee),this.addCurrentVertex(L,xe,0,0,P);else if(nt==="flipbevel"){if(Ee>100)xe=J.mult(-1);else{const wt=Ee*U.add(J).mag()/U.sub(J).mag();xe._perp()._mult(wt*(zt?-1:1))}this.addCurrentVertex(L,xe,0,0,P),this.addCurrentVertex(L,xe.mult(-1),0,0,P)}else if(nt==="bevel"||nt==="fakeround"){const wt=-Math.sqrt(Ee*Ee-1),yt=zt?wt:0,ft=zt?0:wt;if($&&this.addCurrentVertex(L,U,yt,ft,P),nt==="fakeround"){const Be=Math.round(180*qe/Math.PI/20);for(let Mt=1;Mt<Be;Mt++){let bt=Mt/Be;if(bt!==.5){const Wi=bt-.5;bt+=bt*Wi*(bt-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*Wi*Wi+(.848013+ue*(.215638*ue-1.06021)))}const Bt=J.sub(U)._mult(bt)._add(U)._unit()._mult(zt?-1:1);this.addHalfVertex(L,Bt.x,Bt.y,!1,zt,0,P)}}V&&this.addCurrentVertex(L,J,-yt,-ft,P)}else if(nt==="butt")this.addCurrentVertex(L,xe,0,0,P);else if(nt==="square"){const wt=$?1:-1;this.addCurrentVertex(L,xe,wt,wt,P)}else nt==="round"&&($&&(this.addCurrentVertex(L,U,0,0,P),this.addCurrentVertex(L,U,1,1,P,!0)),V&&(this.addCurrentVertex(L,J,-1,-1,P,!0),this.addCurrentVertex(L,J,0,0,P)));if(ct&&re<T-1){const wt=L.dist(V);if(wt>2*I){const yt=L.add(V.sub(L)._mult(I/wt)._round());this.updateDistance(L,yt),this.addCurrentVertex(yt,J,0,0,P),L=yt}}}}addCurrentVertex(t,s,l,f,y,v=!1){const x=s.y*f-s.x,T=-s.y-s.x*f;this.addHalfVertex(t,s.x+s.y*l,s.y-s.x*l,v,!1,l,y),this.addHalfVertex(t,x,T,v,!0,-f,y),this.distance>Y0/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,l,f,y,v))}addHalfVertex({x:t,y:s},l,f,y,v,x,T){const M=.5*(this.lineClips?this.scaledDistance*(Y0-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(y?1:0),(s<<1)+(v?1:0),Math.round(63*l)+128,Math.round(63*f)+128,1+(x===0?0:x<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),T.primitiveLength++),v?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let K0,J0;ht("LineBucket",Dp,{omit:["layers","patternFeatures"]});var Q0={get paint(){return J0=J0||new gr({"line-opacity":new It(Me.paint_line["line-opacity"]),"line-color":new It(Me.paint_line["line-color"]),"line-translate":new St(Me.paint_line["line-translate"]),"line-translate-anchor":new St(Me.paint_line["line-translate-anchor"]),"line-width":new It(Me.paint_line["line-width"]),"line-gap-width":new It(Me.paint_line["line-gap-width"]),"line-offset":new It(Me.paint_line["line-offset"]),"line-blur":new It(Me.paint_line["line-blur"]),"line-dasharray":new gu(Me.paint_line["line-dasharray"]),"line-pattern":new Fl(Me.paint_line["line-pattern"]),"line-gradient":new Nl(Me.paint_line["line-gradient"])})},get layout(){return K0=K0||new gr({"line-cap":new St(Me.layout_line["line-cap"]),"line-join":new It(Me.layout_line["line-join"]),"line-miter-limit":new St(Me.layout_line["line-miter-limit"]),"line-round-limit":new St(Me.layout_line["line-round-limit"]),"line-sort-key":new It(Me.layout_line["line-sort-key"])})}};class $w extends It{possiblyEvaluate(t,s){return s=new Pi(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,l,f){return s=de({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,l,f)}}let bd;class jw extends e{constructor(t){super(t,Q0),this.gradientVersion=0,bd||(bd=new $w(Q0.paint.properties["line-width"].specification),bd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(l){return l._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof Aa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=bd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Dp(t)}queryRadius(t){const s=t,l=ey(bu("line-width",this,s),bu("line-gap-width",this,s)),f=bu("line-offset",this,s);return l/2+Math.abs(f)+pd(this.paint.get("line-translate"))}queryIntersectsFeature(t,s,l,f,y,v,x){const T=md(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,x),M=x/2*ey(this.paint.get("line-width").evaluate(s,l),this.paint.get("line-gap-width").evaluate(s,l)),I=this.paint.get("line-offset").evaluate(s,l);return I&&(f=function(P,L){const $=[];for(let V=0;V<P.length;V++){const U=P[V],J=[];for(let re=0;re<U.length;re++){const xe=U[re-1],ue=U[re],ye=U[re+1],Ee=re===0?new R(0,0):ue.sub(xe)._unit()._perp(),qe=re===U.length-1?new R(0,0):ye.sub(ue)._unit()._perp(),ct=Ee._add(qe)._unit(),zt=ct.x*qe.x+ct.y*qe.y;zt!==0&&ct._mult(1/zt),J.push(ct._mult(L)._add(ue))}$.push(J)}return $}(f,I*x)),function(P,L,$){for(let V=0;V<L.length;V++){const U=L[V];if(P.length>=3){for(let J=0;J<U.length;J++)if(ql(P,U[J]))return!0}if(Yx(P,U,$))return!0}return!1}(T,f,M)}isTileClipped(){return!0}}function ey(r,t){return t>0?t+2*r:r}const Vw=m([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Uw=m([{name:"a_projected_pos",components:3,type:"Float32"}],4);m([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ww=m([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);m([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ty=m([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),qw=m([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Zw(r,t,s){return r.sections.forEach(l=>{l.text=function(f,y,v){const x=y.layout.get("text-transform").evaluate(v,{});return x==="uppercase"?f=f.toLocaleUpperCase():x==="lowercase"&&(f=f.toLocaleLowerCase()),ra.applyArabicShaping&&(f=ra.applyArabicShaping(f)),f}(l.text,t,s)}),r}m([{name:"triangle",components:3,type:"Uint16"}]),m([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),m([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),m([{type:"Float32",name:"offsetX"}]),m([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),m([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Iu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var An=24,iy=Ni,ny=function(r,t,s,l,f){var y,v,x=8*f-l-1,T=(1<<x)-1,M=T>>1,I=-7,P=f-1,L=-1,$=r[t+P];for(P+=L,y=$&(1<<-I)-1,$>>=-I,I+=x;I>0;y=256*y+r[t+P],P+=L,I-=8);for(v=y&(1<<-I)-1,y>>=-I,I+=l;I>0;v=256*v+r[t+P],P+=L,I-=8);if(y===0)y=1-M;else{if(y===T)return v?NaN:1/0*($?-1:1);v+=Math.pow(2,l),y-=M}return($?-1:1)*v*Math.pow(2,y-l)},ry=function(r,t,s,l,f,y){var v,x,T,M=8*y-f-1,I=(1<<M)-1,P=I>>1,L=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,$=0,V=1,U=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,v=I):(v=Math.floor(Math.log(t)/Math.LN2),t*(T=Math.pow(2,-v))<1&&(v--,T*=2),(t+=v+P>=1?L/T:L*Math.pow(2,1-P))*T>=2&&(v++,T/=2),v+P>=I?(x=0,v=I):v+P>=1?(x=(t*T-1)*Math.pow(2,f),v+=P):(x=t*Math.pow(2,P-1)*Math.pow(2,f),v=0));f>=8;r[s+$]=255&x,$+=V,x/=256,f-=8);for(v=v<<f|x,M+=f;M>0;r[s+$]=255&v,$+=V,v/=256,M-=8);r[s+$-V]|=128*U};function Ni(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Ni.Varint=0,Ni.Fixed64=1,Ni.Bytes=2,Ni.Fixed32=5;var Lp=4294967296,sy=1/Lp,ay=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function la(r){return r.type===Ni.Bytes?r.readVarint()+r.pos:r.pos+1}function Xl(r,t,s){return s?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function oy(r,t,s){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(l);for(var f=s.pos-1;f>=r;f--)s.buf[f+l]=s.buf[f]}function Gw(r,t){for(var s=0;s<r.length;s++)t.writeVarint(r[s])}function Hw(r,t){for(var s=0;s<r.length;s++)t.writeSVarint(r[s])}function Xw(r,t){for(var s=0;s<r.length;s++)t.writeFloat(r[s])}function Yw(r,t){for(var s=0;s<r.length;s++)t.writeDouble(r[s])}function Kw(r,t){for(var s=0;s<r.length;s++)t.writeBoolean(r[s])}function Jw(r,t){for(var s=0;s<r.length;s++)t.writeFixed32(r[s])}function Qw(r,t){for(var s=0;s<r.length;s++)t.writeSFixed32(r[s])}function e2(r,t){for(var s=0;s<r.length;s++)t.writeFixed64(r[s])}function t2(r,t){for(var s=0;s<r.length;s++)t.writeSFixed64(r[s])}function xd(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function Yl(r,t,s){r[s]=t,r[s+1]=t>>>8,r[s+2]=t>>>16,r[s+3]=t>>>24}function ly(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}Ni.prototype={destroy:function(){this.buf=null},readFields:function(r,t,s){for(s=s||this.length;this.pos<s;){var l=this.readVarint(),f=l>>3,y=this.pos;this.type=7&l,r(f,t,this),this.pos===y&&this.skip(l)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=xd(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=ly(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=xd(this.buf,this.pos)+xd(this.buf,this.pos+4)*Lp;return this.pos+=8,r},readSFixed64:function(){var r=xd(this.buf,this.pos)+ly(this.buf,this.pos+4)*Lp;return this.pos+=8,r},readFloat:function(){var r=ny(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=ny(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,s,l=this.buf;return t=127&(s=l[this.pos++]),s<128?t:(t|=(127&(s=l[this.pos++]))<<7,s<128?t:(t|=(127&(s=l[this.pos++]))<<14,s<128?t:(t|=(127&(s=l[this.pos++]))<<21,s<128?t:function(f,y,v){var x,T,M=v.buf;if(x=(112&(T=M[v.pos++]))>>4,T<128||(x|=(127&(T=M[v.pos++]))<<3,T<128)||(x|=(127&(T=M[v.pos++]))<<10,T<128)||(x|=(127&(T=M[v.pos++]))<<17,T<128)||(x|=(127&(T=M[v.pos++]))<<24,T<128)||(x|=(1&(T=M[v.pos++]))<<31,T<128))return Xl(f,x,y);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=l[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&ay?function(s,l,f){return ay.decode(s.subarray(l,f))}(this.buf,t,r):function(s,l,f){for(var y="",v=l;v<f;){var x,T,M,I=s[v],P=null,L=I>239?4:I>223?3:I>191?2:1;if(v+L>f)break;L===1?I<128&&(P=I):L===2?(192&(x=s[v+1]))==128&&(P=(31&I)<<6|63&x)<=127&&(P=null):L===3?(T=s[v+2],(192&(x=s[v+1]))==128&&(192&T)==128&&((P=(15&I)<<12|(63&x)<<6|63&T)<=2047||P>=55296&&P<=57343)&&(P=null)):L===4&&(T=s[v+2],M=s[v+3],(192&(x=s[v+1]))==128&&(192&T)==128&&(192&M)==128&&((P=(15&I)<<18|(63&x)<<12|(63&T)<<6|63&M)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,L=1):P>65535&&(P-=65536,y+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),y+=String.fromCharCode(P),v+=L}return y}(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==Ni.Bytes)return r.push(this.readVarint(t));var s=la(this);for(r=r||[];this.pos<s;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==Ni.Bytes)return r.push(this.readSVarint());var t=la(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Ni.Bytes)return r.push(this.readBoolean());var t=la(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Ni.Bytes)return r.push(this.readFloat());var t=la(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Ni.Bytes)return r.push(this.readDouble());var t=la(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Ni.Bytes)return r.push(this.readFixed32());var t=la(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Ni.Bytes)return r.push(this.readSFixed32());var t=la(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Ni.Bytes)return r.push(this.readFixed64());var t=la(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Ni.Bytes)return r.push(this.readSFixed64());var t=la(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===Ni.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ni.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ni.Fixed32)this.pos+=4;else{if(t!==Ni.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Yl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Yl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Yl(this.buf,-1&r,this.pos),Yl(this.buf,Math.floor(r*sy),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Yl(this.buf,-1&r,this.pos),Yl(this.buf,Math.floor(r*sy),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(t,s){var l,f;if(t>=0?(l=t%4294967296|0,f=t/4294967296|0):(f=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,f=f+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(y,v,x){x.buf[x.pos++]=127&y|128,y>>>=7,x.buf[x.pos++]=127&y|128,y>>>=7,x.buf[x.pos++]=127&y|128,y>>>=7,x.buf[x.pos++]=127&y|128,x.buf[x.pos]=127&(y>>>=7)}(l,0,s),function(y,v){var x=(7&y)<<4;v.buf[v.pos++]|=x|((y>>>=3)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y)))))}(f,s)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=function(l,f,y){for(var v,x,T=0;T<f.length;T++){if((v=f.charCodeAt(T))>55295&&v<57344){if(!x){v>56319||T+1===f.length?(l[y++]=239,l[y++]=191,l[y++]=189):x=v;continue}if(v<56320){l[y++]=239,l[y++]=191,l[y++]=189,x=v;continue}v=x-55296<<10|v-56320|65536,x=null}else x&&(l[y++]=239,l[y++]=191,l[y++]=189,x=null);v<128?l[y++]=v:(v<2048?l[y++]=v>>6|192:(v<65536?l[y++]=v>>12|224:(l[y++]=v>>18|240,l[y++]=v>>12&63|128),l[y++]=v>>6&63|128),l[y++]=63&v|128)}return y}(this.buf,r,this.pos);var s=this.pos-t;s>=128&&oy(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(r){this.realloc(4),ry(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),ry(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=r[s]},writeRawMessage:function(r,t){this.pos++;var s=this.pos;r(t,this);var l=this.pos-s;l>=128&&oy(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeMessage:function(r,t,s){this.writeTag(r,Ni.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,Gw,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,Hw,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,Kw,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,Xw,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,Yw,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,Jw,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,Qw,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,e2,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,t2,t)},writeBytesField:function(r,t){this.writeTag(r,Ni.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,Ni.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,Ni.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,Ni.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,Ni.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,Ni.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,Ni.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,Ni.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,Ni.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,Ni.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var Rp=A(iy);const Op=3;function i2(r,t,s){r===1&&s.readMessage(n2,t)}function n2(r,t,s){if(r===3){const{id:l,bitmap:f,width:y,height:v,left:x,top:T,advance:M}=s.readMessage(r2,{});t.push({id:l,bitmap:new wu({width:y+2*Op,height:v+2*Op},f),metrics:{width:y,height:v,left:x,top:T,advance:M}})}}function r2(r,t,s){r===1?t.id=s.readVarint():r===2?t.bitmap=s.readBytes():r===3?t.width=s.readVarint():r===4?t.height=s.readVarint():r===5?t.left=s.readSVarint():r===6?t.top=s.readSVarint():r===7&&(t.advance=s.readVarint())}const cy=Op;function uy(r){let t=0,s=0;for(const v of r)t+=v.w*v.h,s=Math.max(s,v.w);r.sort((v,x)=>x.h-v.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let f=0,y=0;for(const v of r)for(let x=l.length-1;x>=0;x--){const T=l[x];if(!(v.w>T.w||v.h>T.h)){if(v.x=T.x,v.y=T.y,y=Math.max(y,v.y+v.h),f=Math.max(f,v.x+v.w),v.w===T.w&&v.h===T.h){const M=l.pop();x<l.length&&(l[x]=M)}else v.h===T.h?(T.x+=v.w,T.w-=v.w):v.w===T.w?(T.y+=v.h,T.h-=v.h):(l.push({x:T.x+v.w,y:T.y,w:T.w-v.w,h:v.h}),T.y+=v.h,T.h-=v.h);break}}return{w:f,h:y,fill:t/(f*y)||0}}const zr=1;class Bp{constructor(t,{pixelRatio:s,version:l,stretchX:f,stretchY:y,content:v,textFitWidth:x,textFitHeight:T}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=f,this.stretchY=y,this.content=v,this.version=l,this.textFitWidth=x,this.textFitHeight=T}get tl(){return[this.paddedRect.x+zr,this.paddedRect.y+zr]}get br(){return[this.paddedRect.x+this.paddedRect.w-zr,this.paddedRect.y+this.paddedRect.h-zr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*zr)/this.pixelRatio,(this.paddedRect.h-2*zr)/this.pixelRatio]}}class hy{constructor(t,s){const l={},f={};this.haveRenderCallbacks=[];const y=[];this.addImages(t,l,y),this.addImages(s,f,y);const{w:v,h:x}=uy(y),T=new Qr({width:v||1,height:x||1});for(const M in t){const I=t[M],P=l[M].paddedRect;Qr.copy(I.data,T,{x:0,y:0},{x:P.x+zr,y:P.y+zr},I.data)}for(const M in s){const I=s[M],P=f[M].paddedRect,L=P.x+zr,$=P.y+zr,V=I.data.width,U=I.data.height;Qr.copy(I.data,T,{x:0,y:0},{x:L,y:$},I.data),Qr.copy(I.data,T,{x:0,y:U-1},{x:L,y:$-1},{width:V,height:1}),Qr.copy(I.data,T,{x:0,y:0},{x:L,y:$+U},{width:V,height:1}),Qr.copy(I.data,T,{x:V-1,y:0},{x:L-1,y:$},{width:1,height:U}),Qr.copy(I.data,T,{x:0,y:0},{x:L+V,y:$},{width:1,height:U})}this.image=T,this.iconPositions=l,this.patternPositions=f}addImages(t,s,l){for(const f in t){const y=t[f],v={x:0,y:0,w:y.data.width+2*zr,h:y.data.height+2*zr};l.push(v),s[f]=new Bp(v,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),s)}patchUpdatedImage(t,s,l){if(!t||!s||t.version===s.version)return;t.version=s.version;const[f,y]=t.tl;l.update(s.data,void 0,{x:f,y})}}var Va;ht("ImagePosition",Bp),ht("ImageAtlas",hy),_.ah=void 0,(Va=_.ah||(_.ah={}))[Va.none=0]="none",Va[Va.horizontal=1]="horizontal",Va[Va.vertical=2]="vertical",Va[Va.horizontalOnly=3]="horizontalOnly";const Eu=-17;class Cu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const l=new Cu;return l.scale=t||1,l.fontStack=s,l}static forImage(t){const s=new Cu;return s.imageName=t,s}}class Kl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const l=new Kl;for(let f=0;f<t.sections.length;f++){const y=t.sections[f];y.image?l.addImageSection(y):l.addTextSection(y,s)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let l=0;l<t.length;l++){const f=t.charCodeAt(l+1)||null,y=t.charCodeAt(l-1)||null;s+=f&&ad(f)&&!Iu[t[l+1]]||y&&ad(y)&&!Iu[t[l-1]]||!Iu[t[l]]?t[l]:Iu[t[l]]}return s}(this.text)}trim(){let t=0;for(let l=0;l<this.text.length&&Td[this.text.charCodeAt(l)];l++)t++;let s=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&Td[this.text.charCodeAt(l)];l--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const l=new Kl;return l.text=this.text.substring(t,s),l.sectionIndex=this.sectionIndex.slice(t,s),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(Cu.forText(t.scale,t.fontStack||s));const l=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(l)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void fe("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Cu.forImage(s)),this.sectionIndex.push(this.sections.length-1)):fe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wd(r,t,s,l,f,y,v,x,T,M,I,P,L,$,V){const U=Kl.fromFeature(r,f);let J;P===_.ah.vertical&&U.verticalizePunctuation();const{processBidirectionalText:re,processStyledBidirectionalText:xe}=ra;if(re&&U.sections.length===1){J=[];const Ee=re(U.toString(),Fp(U,M,y,t,l,$));for(const qe of Ee){const ct=new Kl;ct.text=qe,ct.sections=U.sections;for(let zt=0;zt<qe.length;zt++)ct.sectionIndex.push(0);J.push(ct)}}else if(xe){J=[];const Ee=xe(U.text,U.sectionIndex,Fp(U,M,y,t,l,$));for(const qe of Ee){const ct=new Kl;ct.text=qe[0],ct.sectionIndex=qe[1],ct.sections=U.sections,J.push(ct)}}else J=function(Ee,qe){const ct=[],zt=Ee.text;let at=0;for(const nt of qe)ct.push(Ee.substring(at,nt)),at=nt;return at<zt.length&&ct.push(Ee.substring(at,zt.length)),ct}(U,Fp(U,M,y,t,l,$));const ue=[],ye={positionedLines:ue,text:U.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(Ee,qe,ct,zt,at,nt,wt,yt,ft,Be,Mt,bt){let Bt=0,Wi=Eu,$i=0,Pn=0;const hs=yt==="right"?1:yt==="left"?0:.5;let Hn=0;for(const mn of at){mn.trim();const Dn=mn.getMaxScale(),ar=(Dn-1)*An,Xn={positionedGlyphs:[],lineOffset:0};Ee.positionedLines[Hn]=Xn;const wr=Xn.positionedGlyphs;let Yn=0;if(!mn.length()){Wi+=nt,++Hn;continue}for(let Dr=0;Dr<mn.length();Dr++){const _i=mn.getSection(Dr),Gi=mn.getSectionIndex(Dr),Ki=mn.getCharCode(Dr);let $r=0,sn=null,tc=null,Os=null,Bs=An;const ds=!(ft===_.ah.horizontal||!Mt&&!pu(Ki)||Mt&&(Td[Ki]||(zn=Ki,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(zn)))));if(_i.imageName){const is=zt[_i.imageName];if(!is)continue;Os=_i.imageName,Ee.iconsInText=Ee.iconsInText||!0,tc=is.paddedRect;const $n=is.displaySize;_i.scale=_i.scale*An/bt,sn={width:$n[0],height:$n[1],left:zr,top:-cy,advance:ds?$n[1]:$n[0]},$r=ar+(An-$n[1]*_i.scale),Bs=sn.advance;const ca=ds?$n[0]*_i.scale-An*Dn:$n[1]*_i.scale-An*Dn;ca>0&&ca>Yn&&(Yn=ca)}else{const is=ct[_i.fontStack],$n=is&&is[Ki];if($n&&$n.rect)tc=$n.rect,sn=$n.metrics;else{const ca=qe[_i.fontStack],Ou=ca&&ca[Ki];if(!Ou)continue;sn=Ou.metrics}$r=(Dn-_i.scale)*An}ds?(Ee.verticalizable=!0,wr.push({glyph:Ki,imageName:Os,x:Bt,y:Wi+$r,vertical:ds,scale:_i.scale,fontStack:_i.fontStack,sectionIndex:Gi,metrics:sn,rect:tc}),Bt+=Bs*_i.scale+Be):(wr.push({glyph:Ki,imageName:Os,x:Bt,y:Wi+$r,vertical:ds,scale:_i.scale,fontStack:_i.fontStack,sectionIndex:Gi,metrics:sn,rect:tc}),Bt+=sn.advance*_i.scale+Be)}wr.length!==0&&($i=Math.max(Bt-Be,$i),l2(wr,0,wr.length-1,hs,Yn)),Bt=0;const ts=nt*Dn+Yn;Xn.lineOffset=Math.max(Yn,ar),Wi+=ts,Pn=Math.max(ts,Pn),++Hn}var zn;const vr=Wi-Eu,{horizontalAlign:br,verticalAlign:xr}=Np(wt);(function(mn,Dn,ar,Xn,wr,Yn,ts,Dr,_i){const Gi=(Dn-ar)*wr;let Ki=0;Ki=Yn!==ts?-Dr*Xn-Eu:(-Xn*_i+.5)*ts;for(const $r of mn)for(const sn of $r.positionedGlyphs)sn.x+=Gi,sn.y+=Ki})(Ee.positionedLines,hs,br,xr,$i,Pn,nt,vr,at.length),Ee.top+=-xr*vr,Ee.bottom=Ee.top+vr,Ee.left+=-br*$i,Ee.right=Ee.left+$i}(ye,t,s,l,J,v,x,T,P,M,L,V),!function(Ee){for(const qe of Ee)if(qe.positionedGlyphs.length!==0)return!1;return!0}(ue)&&ye}const Td={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},s2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},a2={40:!0};function dy(r,t,s,l,f,y){if(t.imageName){const v=l[t.imageName];return v?v.displaySize[0]*t.scale*An/y+f:0}{const v=s[t.fontStack],x=v&&v[r];return x?x.metrics.advance*t.scale+f:0}}function fy(r,t,s,l){const f=Math.pow(r-t,2);return l?r<t?f/2:2*f:f+Math.abs(s)*s}function o2(r,t,s){let l=0;return r===10&&(l-=1e4),s&&(l+=150),r!==40&&r!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function py(r,t,s,l,f,y){let v=null,x=fy(t,s,f,y);for(const T of l){const M=fy(t-T.x,s,f,y)+T.badness;M<=x&&(v=T,x=M)}return{index:r,x:t,priorBreak:v,badness:x}}function my(r){return r?my(r.priorBreak).concat(r.index):[]}function Fp(r,t,s,l,f,y){if(!r)return[];const v=[],x=function(P,L,$,V,U,J){let re=0;for(let xe=0;xe<P.length();xe++){const ue=P.getSection(xe);re+=dy(P.getCharCode(xe),ue,V,U,L,J)}return re/Math.max(1,Math.ceil(re/$))}(r,t,s,l,f,y),T=r.text.indexOf("")>=0;let M=0;for(let P=0;P<r.length();P++){const L=r.getSection(P),$=r.getCharCode(P);if(Td[$]||(M+=dy($,L,l,f,t,y)),P<r.length()-1){const V=!((I=$)<11904)&&(!!li["CJK Compatibility Forms"](I)||!!li["CJK Compatibility"](I)||!!li["CJK Strokes"](I)||!!li["CJK Symbols and Punctuation"](I)||!!li["Enclosed CJK Letters and Months"](I)||!!li["Halfwidth and Fullwidth Forms"](I)||!!li["Ideographic Description Characters"](I)||!!li["Vertical Forms"](I)||na.test(String.fromCodePoint(I)));(s2[$]||V||L.imageName||P!==r.length()-2&&a2[r.getCharCode(P+1)])&&v.push(py(P+1,M,x,v,o2($,r.getCharCode(P+1),V&&T),!1))}}var I;return my(py(r.length(),M,x,v,0,!0))}function Np(r){let t=.5,s=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function l2(r,t,s,l,f){if(!l&&!f)return;const y=r[s],v=(r[s].x+y.metrics.advance*y.scale)*l;for(let x=t;x<=s;x++)r[x].x-=v,r[x].y+=f}function c2(r,t,s){const{horizontalAlign:l,verticalAlign:f}=Np(s),y=t[0]-r.displaySize[0]*l,v=t[1]-r.displaySize[1]*f;return{image:r,top:v,bottom:v+r.displaySize[1],left:y,right:y+r.displaySize[0]}}function gy(r){var t,s;let l=r.left,f=r.top,y=r.right-l,v=r.bottom-f;const x=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",T=(s=r.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",M=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(T==="proportional"){if(x==="stretchOnly"&&y/v<M||x==="proportional"){const I=Math.ceil(v*M);l*=I/y,y=I}}else if(x==="proportional"&&T==="stretchOnly"&&M!==0&&y/v>M){const I=Math.ceil(y/M);f*=I/v,v=I}return{x1:l,y1:f,x2:l+y,y2:f+v}}function yy(r,t,s,l,f,y){const v=r.image;let x;if(v.content){const J=v.content,re=v.pixelRatio||1;x=[J[0]/re,J[1]/re,v.displaySize[0]-J[2]/re,v.displaySize[1]-J[3]/re]}const T=t.left*y,M=t.right*y;let I,P,L,$;s==="width"||s==="both"?($=f[0]+T-l[3],P=f[0]+M+l[1]):($=f[0]+(T+M-v.displaySize[0])/2,P=$+v.displaySize[0]);const V=t.top*y,U=t.bottom*y;return s==="height"||s==="both"?(I=f[1]+V-l[0],L=f[1]+U+l[2]):(I=f[1]+(V+U-v.displaySize[1])/2,L=I+v.displaySize[1]),{image:v,top:I,right:P,bottom:L,left:$,collisionPadding:x}}const Pu=255,Rs=128,Ua=Pu*Rs;function _y(r,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Pi(r+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:f}=s;let y=0;for(;y<l.length&&l[y]<=r;)y++;y=Math.max(0,y-1);let v=y;for(;v<l.length&&l[v]<r+1;)v++;v=Math.min(l.length-1,v);const x=l[y],T=l[v];return s.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:x,maxZoom:T,minSize:s.evaluate(new Pi(x)),maxSize:s.evaluate(new Pi(T)),interpolationType:f}}}function $p(r,t,s){let l="never";const f=r.get(t);return f?l=f:r.get(s)&&(l="always"),l}const u2=ja.VectorTileFeature.types,h2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sd(r,t,s,l,f,y,v,x,T,M,I,P,L){const $=x?Math.min(Ua,Math.round(x[0])):0,V=x?Math.min(Ua,Math.round(x[1])):0;r.emplaceBack(t,s,Math.round(32*l),Math.round(32*f),y,v,($<<1)+(T?1:0),V,16*M,16*I,256*P,256*L)}function jp(r,t,s){r.emplaceBack(t.x,t.y,s),r.emplaceBack(t.x,t.y,s),r.emplaceBack(t.x,t.y,s),r.emplaceBack(t.x,t.y,s)}function d2(r){for(const t of r.sections)if(mp(t.text))return!0;return!1}class Vp{constructor(t){this.layoutVertexArray=new sa,this.indexArray=new Pr,this.programConfigurations=t,this.segments=new Fi,this.dynamicLayoutVertexArray=new jl,this.opacityVertexArray=new yu,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ot}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,l,f){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vw.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Uw.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,h2,!0),this.opacityVertexBuffer.itemSize=1),(l||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ht("SymbolBuffers",Vp);class Up{constructor(t,s,l){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Fi,this.collisionVertexArray=new Jr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ww.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ht("CollisionBuffers",Up);class Jl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(v=>v.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=wp([]),this.placementViewportMatrix=wp([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_y(this.zoom,s["text-size"]),this.iconSizeData=_y(this.zoom,s["icon-size"]);const l=this.layers[0].layout,f=l.get("symbol-sort-key"),y=l.get("symbol-z-order");this.canOverlap=$p(l,"text-overlap","text-allow-overlap")!=="never"||$p(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(v=>_.ah[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=t.sourceID}createArrays(){this.text=new Vp(new Uo(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Vp(new Uo(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new ci,this.lineVertexArray=new Xi,this.symbolInstances=new Jt,this.textAnchorOffsets=new Yr}calculateGlyphDependencies(t,s,l,f,y){for(let v=0;v<t.length;v++)if(s[t.charCodeAt(v)]=!0,(l||f)&&y){const x=Iu[t.charAt(v)];x&&(s[x.charCodeAt(0)]=!0)}}populate(t,s,l){const f=this.layers[0],y=f.layout,v=y.get("text-font"),x=y.get("text-field"),T=y.get("icon-image"),M=(x.value.kind!=="constant"||x.value.value instanceof Ar&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),I=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,P=y.get("symbol-sort-key");if(this.features=[],!M&&!I)return;const L=s.iconDependencies,$=s.glyphDependencies,V=s.availableImages,U=new Pi(this.zoom);for(const{feature:J,id:re,index:xe,sourceLayerIndex:ue}of t){const ye=f._featureFilter.needGeometry,Ee=qo(J,ye);if(!f._featureFilter.filter(U,Ee,l))continue;let qe,ct;if(ye||(Ee.geometry=Wo(J)),M){const at=f.getValueAndResolveTokens("text-field",Ee,l,V),nt=Ar.factory(at),wt=this.hasRTLText=this.hasRTLText||d2(nt);(!wt||ra.getRTLTextPluginStatus()==="unavailable"||wt&&ra.isParsed())&&(qe=Zw(nt,f,Ee))}if(I){const at=f.getValueAndResolveTokens("icon-image",Ee,l,V);ct=at instanceof Er?at:Er.fromString(at)}if(!qe&&!ct)continue;const zt=this.sortFeaturesByKey?P.evaluate(Ee,{},l):void 0;if(this.features.push({id:re,text:qe,icon:ct,index:xe,sourceLayerIndex:ue,geometry:Ee.geometry,properties:J.properties,type:u2[J.type],sortKey:zt}),ct&&(L[ct.name]=!0),qe){const at=v.evaluate(Ee,{},l).join(","),nt=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_.ah.vertical)>=0;for(const wt of qe.sections)if(wt.image)L[wt.image.name]=!0;else{const yt=du(qe.toString()),ft=wt.fontStack||at,Be=$[ft]=$[ft]||{};this.calculateGlyphDependencies(wt.text,Be,nt,this.allowVerticalPlacement,yt)}}}y.get("symbol-placement")==="line"&&(this.features=function(J){const re={},xe={},ue=[];let ye=0;function Ee(at){ue.push(J[at]),ye++}function qe(at,nt,wt){const yt=xe[at];return delete xe[at],xe[nt]=yt,ue[yt].geometry[0].pop(),ue[yt].geometry[0]=ue[yt].geometry[0].concat(wt[0]),yt}function ct(at,nt,wt){const yt=re[nt];return delete re[nt],re[at]=yt,ue[yt].geometry[0].shift(),ue[yt].geometry[0]=wt[0].concat(ue[yt].geometry[0]),yt}function zt(at,nt,wt){const yt=wt?nt[0][nt[0].length-1]:nt[0][0];return`${at}:${yt.x}:${yt.y}`}for(let at=0;at<J.length;at++){const nt=J[at],wt=nt.geometry,yt=nt.text?nt.text.toString():null;if(!yt){Ee(at);continue}const ft=zt(yt,wt),Be=zt(yt,wt,!0);if(ft in xe&&Be in re&&xe[ft]!==re[Be]){const Mt=ct(ft,Be,wt),bt=qe(ft,Be,ue[Mt].geometry);delete re[ft],delete xe[Be],xe[zt(yt,ue[bt].geometry,!0)]=bt,ue[Mt].geometry=null}else ft in xe?qe(ft,Be,wt):Be in re?ct(ft,Be,wt):(Ee(at),re[ft]=ye-1,xe[Be]=ye-1)}return ue.filter(at=>at.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,re)=>J.sortKey-re.sortKey)}update(t,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,l),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const l=this.lineVertexArray.length;if(t.segment!==void 0){let f=t.dist(s[t.segment+1]),y=t.dist(s[t.segment]);const v={};for(let x=t.segment+1;x<s.length;x++)v[x]={x:s[x].x,y:s[x].y,tileUnitDistanceFromAnchor:f},x<s.length-1&&(f+=s[x+1].dist(s[x]));for(let x=t.segment||0;x>=0;x--)v[x]={x:s[x].x,y:s[x].y,tileUnitDistanceFromAnchor:y},x>0&&(y+=s[x-1].dist(s[x]));for(let x=0;x<s.length;x++){const T=v[x];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,s,l,f,y,v,x,T,M,I,P,L){const $=t.indexArray,V=t.layoutVertexArray,U=t.segments.prepareSegment(4*s.length,V,$,this.canOverlap?v.sortKey:void 0),J=this.glyphOffsetArray.length,re=U.vertexLength,xe=this.allowVerticalPlacement&&x===_.ah.vertical?Math.PI/2:0,ue=v.text&&v.text.sections;for(let ye=0;ye<s.length;ye++){const{tl:Ee,tr:qe,bl:ct,br:zt,tex:at,pixelOffsetTL:nt,pixelOffsetBR:wt,minFontScaleX:yt,minFontScaleY:ft,glyphOffset:Be,isSDF:Mt,sectionIndex:bt}=s[ye],Bt=U.vertexLength,Wi=Be[1];Sd(V,T.x,T.y,Ee.x,Wi+Ee.y,at.x,at.y,l,Mt,nt.x,nt.y,yt,ft),Sd(V,T.x,T.y,qe.x,Wi+qe.y,at.x+at.w,at.y,l,Mt,wt.x,nt.y,yt,ft),Sd(V,T.x,T.y,ct.x,Wi+ct.y,at.x,at.y+at.h,l,Mt,nt.x,wt.y,yt,ft),Sd(V,T.x,T.y,zt.x,Wi+zt.y,at.x+at.w,at.y+at.h,l,Mt,wt.x,wt.y,yt,ft),jp(t.dynamicLayoutVertexArray,T,xe),$.emplaceBack(Bt,Bt+1,Bt+2),$.emplaceBack(Bt+1,Bt+2,Bt+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Be[0]),ye!==s.length-1&&bt===s[ye+1].sectionIndex||t.programConfigurations.populatePaintArrays(V.length,v,v.index,{},L,ue&&ue[bt])}t.placedSymbolArray.emplaceBack(T.x,T.y,J,this.glyphOffsetArray.length-J,re,M,I,T.segment,l?l[0]:0,l?l[1]:0,f[0],f[1],x,0,!1,0,P)}_addCollisionDebugVertex(t,s,l,f,y,v){return s.emplaceBack(0,0),t.emplaceBack(l.x,l.y,f,y,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(t,s,l,f,y,v,x){const T=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),M=T.vertexLength,I=y.layoutVertexArray,P=y.collisionVertexArray,L=x.anchorX,$=x.anchorY;this._addCollisionDebugVertex(I,P,v,L,$,new R(t,s)),this._addCollisionDebugVertex(I,P,v,L,$,new R(l,s)),this._addCollisionDebugVertex(I,P,v,L,$,new R(l,f)),this._addCollisionDebugVertex(I,P,v,L,$,new R(t,f)),T.vertexLength+=4;const V=y.indexArray;V.emplaceBack(M,M+1),V.emplaceBack(M+1,M+2),V.emplaceBack(M+2,M+3),V.emplaceBack(M+3,M),T.primitiveLength+=4}addDebugCollisionBoxes(t,s,l,f){for(let y=t;y<s;y++){const v=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,f?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Up(Cr,ty.members,Ls),this.iconCollisionBox=new Up(Cr,ty.members,Ls);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,l,f,y,v,x,T,M){const I={};for(let P=s;P<l;P++){const L=t.get(P);I.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.textFeatureIndex=L.featureIndex;break}for(let P=f;P<y;P++){const L=t.get(P);I.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalTextFeatureIndex=L.featureIndex;break}for(let P=v;P<x;P++){const L=t.get(P);I.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.iconFeatureIndex=L.featureIndex;break}for(let P=T;P<M;P++){const L=t.get(P);I.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalIconFeatureIndex=L.featureIndex;break}return I}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const l=t.placedSymbolArray.get(s),f=l.vertexStartIndex+4*l.numGlyphs;for(let y=l.vertexStartIndex;y<f;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),l=Math.cos(t),f=[],y=[],v=[];for(let x=0;x<this.symbolInstances.length;++x){v.push(x);const T=this.symbolInstances.get(x);f.push(0|Math.round(s*T.anchorX+l*T.anchorY)),y.push(T.featureIndex)}return v.sort((x,T)=>f[x]-f[T]||y[T]-y[x]),v}addToSortKeyRanges(t,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((f,y,v)=>{f>=0&&v.indexOf(f)===y&&this.addIndicesForPlacedSymbol(this.text,f)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let vy,by;ht("SymbolBucket",Jl,{omit:["layers","collisionBoxArray","features","compareText"]}),Jl.MAX_GLYPHS=65535,Jl.addDynamicAttributes=jp;var Wp={get paint(){return by=by||new gr({"icon-opacity":new It(Me.paint_symbol["icon-opacity"]),"icon-color":new It(Me.paint_symbol["icon-color"]),"icon-halo-color":new It(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new It(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new It(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new St(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new St(Me.paint_symbol["icon-translate-anchor"]),"text-opacity":new It(Me.paint_symbol["text-opacity"]),"text-color":new It(Me.paint_symbol["text-color"],{runtimeType:Di,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new It(Me.paint_symbol["text-halo-color"]),"text-halo-width":new It(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new It(Me.paint_symbol["text-halo-blur"]),"text-translate":new St(Me.paint_symbol["text-translate"]),"text-translate-anchor":new St(Me.paint_symbol["text-translate-anchor"])})},get layout(){return vy=vy||new gr({"symbol-placement":new St(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new St(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new St(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new It(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new St(Me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new St(Me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new St(Me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new St(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new St(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new St(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new It(Me.layout_symbol["icon-size"]),"icon-text-fit":new St(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new St(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new It(Me.layout_symbol["icon-image"]),"icon-rotate":new It(Me.layout_symbol["icon-rotate"]),"icon-padding":new It(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new St(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new It(Me.layout_symbol["icon-offset"]),"icon-anchor":new It(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new St(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new St(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new St(Me.layout_symbol["text-rotation-alignment"]),"text-field":new It(Me.layout_symbol["text-field"]),"text-font":new It(Me.layout_symbol["text-font"]),"text-size":new It(Me.layout_symbol["text-size"]),"text-max-width":new It(Me.layout_symbol["text-max-width"]),"text-line-height":new St(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new It(Me.layout_symbol["text-letter-spacing"]),"text-justify":new It(Me.layout_symbol["text-justify"]),"text-radial-offset":new It(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new St(Me.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new It(Me.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new It(Me.layout_symbol["text-anchor"]),"text-max-angle":new St(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new St(Me.layout_symbol["text-writing-mode"]),"text-rotate":new It(Me.layout_symbol["text-rotate"]),"text-padding":new St(Me.layout_symbol["text-padding"]),"text-keep-upright":new St(Me.layout_symbol["text-keep-upright"]),"text-transform":new It(Me.layout_symbol["text-transform"]),"text-offset":new It(Me.layout_symbol["text-offset"]),"text-allow-overlap":new St(Me.layout_symbol["text-allow-overlap"]),"text-overlap":new St(Me.layout_symbol["text-overlap"]),"text-ignore-placement":new St(Me.layout_symbol["text-ignore-placement"]),"text-optional":new St(Me.layout_symbol["text-optional"])})}};class xy{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Bi,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ht("FormatSectionOverride",xy,{omit:["defaultValue"]});class kd extends e{constructor(t){super(t,Wp)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const f=[];for(const y of l)f.indexOf(y)<0&&f.push(y);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,l,f){const y=this.layout.get(t).evaluate(s,{},l,f),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||Ao(v.value)||!y?y:function(x,T){return T.replace(/{([^{}]+)}/g,(M,I)=>x&&I in x?String(x[I]):"")}(s.properties,y)}createBucket(t){return new Jl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Wp.paint.overridableProperties){if(!kd.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),l=new xy(s),f=new Al(l,s.property.specification);let y=null;y=s.value.kind==="constant"||s.value.kind==="source"?new Io("source",f):new Da("composite",f,s.value.zoomStops),this.paint._values[t]=new mr(s.property,y,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&kd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const l=t.get("text-field"),f=Wp.paint.properties[s];let y=!1;const v=x=>{for(const T of x)if(f.overrides&&f.overrides.hasOverride(T))return void(y=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Ar)v(l.value.value.sections);else if(l.value.kind==="source"){const x=M=>{y||(M instanceof Wr&&wn(M.value)===Mr?v(M.value.sections):M instanceof vl?v(M.sections):M.eachChild(x))},T=l.value;T._styleExpression&&x(T._styleExpression.expression)}return y}}let wy;var f2={get paint(){return wy=wy||new gr({"background-color":new St(Me.paint_background["background-color"]),"background-pattern":new gu(Me.paint_background["background-pattern"]),"background-opacity":new St(Me.paint_background["background-opacity"])})}};class p2 extends e{constructor(t){super(t,f2)}}let Ty;var m2={get paint(){return Ty=Ty||new gr({"raster-opacity":new St(Me.paint_raster["raster-opacity"]),"raster-hue-rotate":new St(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new St(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new St(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new St(Me.paint_raster["raster-saturation"]),"raster-contrast":new St(Me.paint_raster["raster-contrast"]),"raster-resampling":new St(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new St(Me.paint_raster["raster-fade-duration"])})}};class g2 extends e{constructor(t){super(t,m2)}}class y2 extends e{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class _2{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const qp=63710088e-1;class Wa{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Wa(Se(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,l=this.lat*s,f=t.lat*s,y=Math.sin(l)*Math.sin(f)+Math.cos(l)*Math.cos(f)*Math.cos((t.lng-this.lng)*s);return qp*Math.acos(Math.min(y,1))}static convert(t){if(t instanceof Wa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Wa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Wa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Sy=2*Math.PI*qp;function ky(r){return Sy*Math.cos(r*Math.PI/180)}function My(r){return(180+r)/360}function Ay(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Iy(r,t){return r/ky(t)}function Zp(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class zu{constructor(t,s,l=0){this.x=+t,this.y=+s,this.z=+l}static fromLngLat(t,s=0){const l=Wa.convert(t);return new zu(My(l.lng),Ay(l.lat),Iy(s,l.lat))}toLngLat(){return new Wa(360*this.x-180,Zp(this.y))}toAltitude(){return this.z*ky(Zp(this.y))}meterInMercatorCoordinateUnits(){return 1/Sy*(t=Zp(this.y),1/Math.cos(t*Math.PI/180));var t}}function Ey(r,t,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[r*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class Gp{constructor(t,s,l){if(!function(f,y,v){return!(f<0||f>25||v<0||v>=Math.pow(2,f)||y<0||y>=Math.pow(2,f))}(t,s,l))throw new Error(`x=${s}, y=${l}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=l,this.key=Du(0,t,t,s,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,l){const f=(v=this.y,x=this.z,T=Ey(256*(y=this.x),256*(v=Math.pow(2,x)-v-1),x),M=Ey(256*(y+1),256*(v+1),x),T[0]+","+T[1]+","+M[0]+","+M[1]);var y,v,x,T,M;const I=function(P,L,$){let V,U="";for(let J=P;J>0;J--)V=1<<J-1,U+=(L&V?1:0)+($&V?2:0);return U}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,f)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new R((t.x*s-this.x)*Tn,(t.y*s-this.y)*Tn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Cy{constructor(t,s){this.wrap=t,this.canonical=s,this.key=Du(t,s.z,s.z,s.x,s.y)}}class es{constructor(t,s,l,f,y){if(t<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${l}`);this.overscaledZ=t,this.wrap=s,this.canonical=new Gp(l,+f,+y),this.key=Du(s,t,l,f,y)}clone(){return new es(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new es(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new es(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?Du(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):Du(this.wrap*+s,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new es(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,f=2*this.canonical.y;return[new es(s,this.wrap,s,l,f),new es(s,this.wrap,s,l+1,f),new es(s,this.wrap,s,l,f+1),new es(s,this.wrap,s,l+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new es(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new es(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new zu(t.x-this.wrap,t.y))}}function Du(r,t,s,l,f){(r*=2)<0&&(r=-1*r-1);const y=1<<s;return(y*y*r+y*f+l).toString(36)+s.toString(36)+t.toString(36)}ht("CanonicalTileID",Gp),ht("OverscaledTileID",es,{omit:["posMatrix"]});class Py{constructor(t,s,l,f=1,y=1,v=1,x=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void fe(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const T=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=y,this.blueFactor=v,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<T;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(T,M)]=this.data[this._idx(T-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,T)]=this.data[this._idx(M,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<T;M++)for(let I=0;I<T;I++){const P=this.get(M,I);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(t,s){const l=new Uint8Array(this.data.buffer),f=4*this._idx(t,s);return this.unpack(l[f],l[f+1],l[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,l){return t*this.redFactor+s*this.greenFactor+l*this.blueFactor-this.baseShift}getPixels(){return new Qr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=s*this.dim,y=s*this.dim+this.dim,v=l*this.dim,x=l*this.dim+this.dim;switch(s){case-1:f=y-1;break;case 1:y=f+1}switch(l){case-1:v=x-1;break;case 1:x=v+1}const T=-s*this.dim,M=-l*this.dim;for(let I=v;I<x;I++)for(let P=f;P<y;P++)this.data[this._idx(P,I)]=t.data[this._idx(P+T,I+M)]}}ht("DEMData",Py);class zy{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const l=t[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Dy{constructor(t,s,l,f,y){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=l,t._y=f,this.properties=t.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class Ly{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Oa(Tn,16,0),this.grid3D=new Oa(Tn,16,0),this.featureIndexArray=new yr,this.promoteId=s}insert(t,s,l,f,y,v){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,f,y);const T=v?this.grid3D:this.grid;for(let M=0;M<s.length;M++){const I=s[M],P=[1/0,1/0,-1/0,-1/0];for(let L=0;L<I.length;L++){const $=I[L];P[0]=Math.min(P[0],$.x),P[1]=Math.min(P[1],$.y),P[2]=Math.max(P[2],$.x),P[3]=Math.max(P[3],$.y)}P[0]<Tn&&P[1]<Tn&&P[2]>=0&&P[3]>=0&&T.insert(x,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ja.VectorTile(new Rp(this.rawTileData)).layers,this.sourceLayerCoder=new zy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,l,f){this.loadVTLayers();const y=t.params||{},v=Tn/t.tileSize/t.scale,x=Ra(y.filter),T=t.queryGeometry,M=t.queryPadding*v,I=Oy(T),P=this.grid.query(I.minX-M,I.minY-M,I.maxX+M,I.maxY+M),L=Oy(t.cameraQueryGeometry),$=this.grid3D.query(L.minX-M,L.minY-M,L.maxX+M,L.maxY+M,(J,re,xe,ue)=>function(ye,Ee,qe,ct,zt){for(const nt of ye)if(Ee<=nt.x&&qe<=nt.y&&ct>=nt.x&&zt>=nt.y)return!0;const at=[new R(Ee,qe),new R(Ee,zt),new R(ct,zt),new R(ct,qe)];if(ye.length>2){for(const nt of at)if(ql(ye,nt))return!0}for(let nt=0;nt<ye.length-1;nt++)if(Jx(ye[nt],ye[nt+1],at))return!0;return!1}(t.cameraQueryGeometry,J-M,re-M,xe+M,ue+M));for(const J of $)P.push(J);P.sort(v2);const V={};let U;for(let J=0;J<P.length;J++){const re=P[J];if(re===U)continue;U=re;const xe=this.featureIndexArray.get(re);let ue=null;this.loadMatchingFeature(V,xe.bucketIndex,xe.sourceLayerIndex,xe.featureIndex,x,y.layers,y.availableImages,s,l,f,(ye,Ee,qe)=>(ue||(ue=Wo(ye)),Ee.queryIntersectsFeature(T,ye,qe,ue,this.z,t.transform,v,t.pixelPosMatrix)))}return V}loadMatchingFeature(t,s,l,f,y,v,x,T,M,I,P){const L=this.bucketLayerIDs[s];if(v&&!function(J,re){for(let xe=0;xe<J.length;xe++)if(re.indexOf(J[xe])>=0)return!0;return!1}(v,L))return;const $=this.sourceLayerCoder.decode(l),V=this.vtLayers[$].feature(f);if(y.needGeometry){const J=qo(V,!0);if(!y.filter(new Pi(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!y.filter(new Pi(this.tileID.overscaledZ),V))return;const U=this.getId(V,$);for(let J=0;J<L.length;J++){const re=L[J];if(v&&v.indexOf(re)<0)continue;const xe=T[re];if(!xe)continue;let ue={};U&&I&&(ue=I.getState(xe.sourceLayer||"_geojsonTileLayer",U));const ye=de({},M[re]);ye.paint=Ry(ye.paint,xe.paint,V,ue,x),ye.layout=Ry(ye.layout,xe.layout,V,ue,x);const Ee=!P||P(V,xe,ue);if(!Ee)continue;const qe=new Dy(V,this.z,this.x,this.y,U);qe.layer=ye;let ct=t[re];ct===void 0&&(ct=t[re]=[]),ct.push({featureIndex:f,feature:qe,intersectionZ:Ee})}}lookupSymbolFeatures(t,s,l,f,y,v,x,T){const M={};this.loadVTLayers();const I=Ra(y);for(const P of t)this.loadMatchingFeature(M,l,f,P,I,v,x,T,s);return M}hasLayer(t){for(const s of this.bucketLayerIDs)for(const l of s)if(t===l)return!0;return!1}getId(t,s){let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof l=="boolean"&&(l=Number(l))),l}}function Ry(r,t,s,l,f){return Re(r,(y,v)=>{const x=t instanceof Bl?t.get(v):null;return x&&x.evaluate?x.evaluate(s,l,f):x})}function Oy(r){let t=1/0,s=1/0,l=-1/0,f=-1/0;for(const y of r)t=Math.min(t,y.x),s=Math.min(s,y.y),l=Math.max(l,y.x),f=Math.max(f,y.y);return{minX:t,minY:s,maxX:l,maxY:f}}function v2(r,t){return t-r}function By(r,t,s,l,f){const y=[];for(let v=0;v<r.length;v++){const x=r[v];let T;for(let M=0;M<x.length-1;M++){let I=x[M],P=x[M+1];I.x<t&&P.x<t||(I.x<t?I=new R(t,I.y+(t-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x<t&&(P=new R(t,I.y+(t-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y<s&&P.y<s||(I.y<s?I=new R(I.x+(s-I.y)/(P.y-I.y)*(P.x-I.x),s)._round():P.y<s&&(P=new R(I.x+(s-I.y)/(P.y-I.y)*(P.x-I.x),s)._round()),I.x>=l&&P.x>=l||(I.x>=l?I=new R(l,I.y+(l-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x>=l&&(P=new R(l,I.y+(l-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y>=f&&P.y>=f||(I.y>=f?I=new R(I.x+(f-I.y)/(P.y-I.y)*(P.x-I.x),f)._round():P.y>=f&&(P=new R(I.x+(f-I.y)/(P.y-I.y)*(P.x-I.x),f)._round()),T&&I.equals(T[T.length-1])||(T=[I],y.push(T)),T.push(P)))))}}return y}ht("FeatureIndex",Ly,{omit:["rawTileData","sourceLayerCoder"]});class qa extends R{constructor(t,s,l,f){super(t,s),this.angle=l,f!==void 0&&(this.segment=f)}clone(){return new qa(this.x,this.y,this.angle,this.segment)}}function Fy(r,t,s,l,f){if(t.segment===void 0||s===0)return!0;let y=t,v=t.segment+1,x=0;for(;x>-s/2;){if(v--,v<0)return!1;x-=r[v].dist(y),y=r[v]}x+=r[v].dist(r[v+1]),v++;const T=[];let M=0;for(;x<s/2;){const I=r[v],P=r[v+1];if(!P)return!1;let L=r[v-1].angleTo(I)-I.angleTo(P);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:x,angleDelta:L}),M+=L;x-T[0].distance>l;)M-=T.shift().angleDelta;if(M>f)return!1;v++,x+=I.dist(P)}return!0}function Ny(r){let t=0;for(let s=0;s<r.length-1;s++)t+=r[s].dist(r[s+1]);return t}function $y(r,t,s){return r?.6*t*s:0}function jy(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function b2(r,t,s,l,f,y){const v=$y(s,f,y),x=jy(s,l)*y;let T=0;const M=Ny(r)/2;for(let I=0;I<r.length-1;I++){const P=r[I],L=r[I+1],$=P.dist(L);if(T+$>M){const V=(M-T)/$,U=fr.number(P.x,L.x,V),J=fr.number(P.y,L.y,V),re=new qa(U,J,L.angleTo(P),I);return re._round(),!v||Fy(r,re,x,v,t)?re:void 0}T+=$}}function x2(r,t,s,l,f,y,v,x,T){const M=$y(l,y,v),I=jy(l,f),P=I*v,L=r[0].x===0||r[0].x===T||r[0].y===0||r[0].y===T;return t-P<t/4&&(t=P+t/4),Vy(r,L?t/2*x%t:(I/2+2*y)*v*x%t,t,M,s,P,L,!1,T)}function Vy(r,t,s,l,f,y,v,x,T){const M=y/2,I=Ny(r);let P=0,L=t-s,$=[];for(let V=0;V<r.length-1;V++){const U=r[V],J=r[V+1],re=U.dist(J),xe=J.angleTo(U);for(;L+s<P+re;){L+=s;const ue=(L-P)/re,ye=fr.number(U.x,J.x,ue),Ee=fr.number(U.y,J.y,ue);if(ye>=0&&ye<T&&Ee>=0&&Ee<T&&L-M>=0&&L+M<=I){const qe=new qa(ye,Ee,xe,V);qe._round(),l&&!Fy(r,qe,y,l,f)||$.push(qe)}}P+=re}return x||$.length||v||($=Vy(r,P/2,s,l,f,y,v,!0,T)),$}ht("Anchor",qa);const Ql=zr;function Uy(r,t,s,l){const f=[],y=r.image,v=y.pixelRatio,x=y.paddedRect.w-2*Ql,T=y.paddedRect.h-2*Ql;let M={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const I=y.stretchX||[[0,x]],P=y.stretchY||[[0,T]],L=(Be,Mt)=>Be+Mt[1]-Mt[0],$=I.reduce(L,0),V=P.reduce(L,0),U=x-$,J=T-V;let re=0,xe=$,ue=0,ye=V,Ee=0,qe=U,ct=0,zt=J;if(y.content&&l){const Be=y.content,Mt=Be[2]-Be[0],bt=Be[3]-Be[1];(y.textFitWidth||y.textFitHeight)&&(M=gy(r)),re=Md(I,0,Be[0]),ue=Md(P,0,Be[1]),xe=Md(I,Be[0],Be[2]),ye=Md(P,Be[1],Be[3]),Ee=Be[0]-re,ct=Be[1]-ue,qe=Mt-xe,zt=bt-ye}const at=M.x1,nt=M.y1,wt=M.x2-at,yt=M.y2-nt,ft=(Be,Mt,bt,Bt)=>{const Wi=Ad(Be.stretch-re,xe,wt,at),$i=Id(Be.fixed-Ee,qe,Be.stretch,$),Pn=Ad(Mt.stretch-ue,ye,yt,nt),hs=Id(Mt.fixed-ct,zt,Mt.stretch,V),Hn=Ad(bt.stretch-re,xe,wt,at),zn=Id(bt.fixed-Ee,qe,bt.stretch,$),vr=Ad(Bt.stretch-ue,ye,yt,nt),br=Id(Bt.fixed-ct,zt,Bt.stretch,V),xr=new R(Wi,Pn),mn=new R(Hn,Pn),Dn=new R(Hn,vr),ar=new R(Wi,vr),Xn=new R($i/v,hs/v),wr=new R(zn/v,br/v),Yn=t*Math.PI/180;if(Yn){const _i=Math.sin(Yn),Gi=Math.cos(Yn),Ki=[Gi,-_i,_i,Gi];xr._matMult(Ki),mn._matMult(Ki),ar._matMult(Ki),Dn._matMult(Ki)}const ts=Be.stretch+Be.fixed,Dr=Mt.stretch+Mt.fixed;return{tl:xr,tr:mn,bl:ar,br:Dn,tex:{x:y.paddedRect.x+Ql+ts,y:y.paddedRect.y+Ql+Dr,w:bt.stretch+bt.fixed-ts,h:Bt.stretch+Bt.fixed-Dr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xn,pixelOffsetBR:wr,minFontScaleX:qe/v/wt,minFontScaleY:zt/v/yt,isSDF:s}};if(l&&(y.stretchX||y.stretchY)){const Be=Wy(I,U,$),Mt=Wy(P,J,V);for(let bt=0;bt<Be.length-1;bt++){const Bt=Be[bt],Wi=Be[bt+1];for(let $i=0;$i<Mt.length-1;$i++)f.push(ft(Bt,Mt[$i],Wi,Mt[$i+1]))}}else f.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:T+1}));return f}function Md(r,t,s){let l=0;for(const f of r)l+=Math.max(t,Math.min(s,f[1]))-Math.max(t,Math.min(s,f[0]));return l}function Wy(r,t,s){const l=[{fixed:-Ql,stretch:0}];for(const[f,y]of r){const v=l[l.length-1];l.push({fixed:f-v.stretch,stretch:v.stretch}),l.push({fixed:f-v.stretch,stretch:v.stretch+(y-f)})}return l.push({fixed:t+Ql,stretch:s}),l}function Ad(r,t,s,l){return r/t*s+l}function Id(r,t,s,l){return r-t*s/l}class Ed{constructor(t,s,l,f,y,v,x,T,M,I){var P;if(this.boxStartIndex=t.length,M){let L=v.top,$=v.bottom;const V=v.collisionPadding;V&&(L-=V[1],$+=V[3]);let U=$-L;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{const L=!((P=v.image)===null||P===void 0)&&P.content&&(v.image.textFitWidth||v.image.textFitHeight)?gy(v):{x1:v.left,y1:v.top,x2:v.right,y2:v.bottom};L.y1=L.y1*x-T[0],L.y2=L.y2*x+T[2],L.x1=L.x1*x-T[3],L.x2=L.x2*x+T[1];const $=v.collisionPadding;if($&&(L.x1-=$[0]*x,L.y1-=$[1]*x,L.x2+=$[2]*x,L.y2+=$[3]*x),I){const V=new R(L.x1,L.y1),U=new R(L.x2,L.y1),J=new R(L.x1,L.y2),re=new R(L.x2,L.y2),xe=I*Math.PI/180;V._rotate(xe),U._rotate(xe),J._rotate(xe),re._rotate(xe),L.x1=Math.min(V.x,U.x,J.x,re.x),L.x2=Math.max(V.x,U.x,J.x,re.x),L.y1=Math.min(V.y,U.y,J.y,re.y),L.y2=Math.max(V.y,U.y,J.y,re.y)}t.emplaceBack(s.x,s.y,L.x1,L.y1,L.x2,L.y2,l,f,y)}this.boxEndIndex=t.length}}class w2{constructor(t=[],s=(l,f)=>l<f?-1:l>f?1:0){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:l}=this,f=s[t];for(;t>0;){const y=t-1>>1,v=s[y];if(l(f,v)>=0)break;s[t]=v,t=y}s[t]=f}_down(t){const{data:s,compare:l}=this,f=this.length>>1,y=s[t];for(;t<f;){let v=1+(t<<1);const x=v+1;if(x<this.length&&l(s[x],s[v])<0&&(v=x),l(s[v],y)>=0)break;s[t]=s[v],t=v}s[t]=y}}function T2(r,t=1,s=!1){let l=1/0,f=1/0,y=-1/0,v=-1/0;const x=r[0];for(let $=0;$<x.length;$++){const V=x[$];(!$||V.x<l)&&(l=V.x),(!$||V.y<f)&&(f=V.y),(!$||V.x>y)&&(y=V.x),(!$||V.y>v)&&(v=V.y)}const T=Math.min(y-l,v-f);let M=T/2;const I=new w2([],S2);if(T===0)return new R(l,f);for(let $=l;$<y;$+=T)for(let V=f;V<v;V+=T)I.push(new ec($+M,V+M,M,r));let P=function($){let V=0,U=0,J=0;const re=$[0];for(let xe=0,ue=re.length,ye=ue-1;xe<ue;ye=xe++){const Ee=re[xe],qe=re[ye],ct=Ee.x*qe.y-qe.x*Ee.y;U+=(Ee.x+qe.x)*ct,J+=(Ee.y+qe.y)*ct,V+=3*ct}return new ec(U/V,J/V,0,$)}(r),L=I.length;for(;I.length;){const $=I.pop();($.d>P.d||!P.d)&&(P=$,s&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,L)),$.max-P.d<=t||(M=$.h/2,I.push(new ec($.p.x-M,$.p.y-M,M,r)),I.push(new ec($.p.x+M,$.p.y-M,M,r)),I.push(new ec($.p.x-M,$.p.y+M,M,r)),I.push(new ec($.p.x+M,$.p.y+M,M,r)),L+=4)}return s&&(console.log(`num probes: ${L}`),console.log(`best distance: ${P.d}`)),P.p}function S2(r,t){return t.max-r.max}function ec(r,t,s,l){this.p=new R(r,t),this.h=s,this.d=function(f,y){let v=!1,x=1/0;for(let T=0;T<y.length;T++){const M=y[T];for(let I=0,P=M.length,L=P-1;I<P;L=I++){const $=M[I],V=M[L];$.y>f.y!=V.y>f.y&&f.x<(V.x-$.x)*(f.y-$.y)/(V.y-$.y)+$.x&&(v=!v),x=Math.min(x,A0(f,$,V))}}return(v?1:-1)*Math.sqrt(x)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}var Gn;_.aq=void 0,(Gn=_.aq||(_.aq={}))[Gn.center=1]="center",Gn[Gn.left=2]="left",Gn[Gn.right=3]="right",Gn[Gn.top=4]="top",Gn[Gn.bottom=5]="bottom",Gn[Gn["top-left"]=6]="top-left",Gn[Gn["top-right"]=7]="top-right",Gn[Gn["bottom-left"]=8]="bottom-left",Gn[Gn["bottom-right"]=9]="bottom-right";const Za=7,Hp=Number.POSITIVE_INFINITY;function qy(r,t){return t[1]!==Hp?function(s,l,f){let y=0,v=0;switch(l=Math.abs(l),f=Math.abs(f),s){case"top-right":case"top-left":case"top":v=f-Za;break;case"bottom-right":case"bottom-left":case"bottom":v=-f+Za}switch(s){case"top-right":case"bottom-right":case"right":y=-l;break;case"top-left":case"bottom-left":case"left":y=l}return[y,v]}(r,t[0],t[1]):function(s,l){let f=0,y=0;l<0&&(l=0);const v=l/Math.SQRT2;switch(s){case"top-right":case"top-left":y=v-Za;break;case"bottom-right":case"bottom-left":y=-v+Za;break;case"bottom":y=-l+Za;break;case"top":y=l-Za}switch(s){case"top-right":case"bottom-right":f=-v;break;case"top-left":case"bottom-left":f=v;break;case"left":f=l;break;case"right":f=-l}return[f,y]}(r,t[0])}function Zy(r,t,s){var l;const f=r.layout,y=(l=f.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(t,{},s);if(y){const x=y.values,T=[];for(let M=0;M<x.length;M+=2){const I=T[M]=x[M],P=x[M+1].map(L=>L*An);I.startsWith("top")?P[1]-=Za:I.startsWith("bottom")&&(P[1]+=Za),T[M+1]=P}return new Fr(T)}const v=f.get("text-variable-anchor");if(v){let x;x=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(t,{},s)*An,Hp]:f.get("text-offset").evaluate(t,{},s).map(M=>M*An);const T=[];for(const M of v)T.push(M,qy(M,x));return new Fr(T)}return null}function Xp(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function k2(r,t,s,l,f,y,v,x,T,M,I){let P=y.textMaxSize.evaluate(t,{});P===void 0&&(P=v);const L=r.layers[0].layout,$=L.get("icon-offset").evaluate(t,{},I),V=Hy(s.horizontal),U=v/24,J=r.tilePixelRatio*U,re=r.tilePixelRatio*P/24,xe=r.tilePixelRatio*x,ue=r.tilePixelRatio*L.get("symbol-spacing"),ye=L.get("text-padding")*r.tilePixelRatio,Ee=function(Be,Mt,bt,Bt=1){const Wi=Be.get("icon-padding").evaluate(Mt,{},bt),$i=Wi&&Wi.values;return[$i[0]*Bt,$i[1]*Bt,$i[2]*Bt,$i[3]*Bt]}(L,t,I,r.tilePixelRatio),qe=L.get("text-max-angle")/180*Math.PI,ct=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point",zt=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",at=L.get("symbol-placement"),nt=ue/2,wt=L.get("icon-text-fit");let yt;l&&wt!=="none"&&(r.allowVerticalPlacement&&s.vertical&&(yt=yy(l,s.vertical,wt,L.get("icon-text-fit-padding"),$,U)),V&&(l=yy(l,V,wt,L.get("icon-text-fit-padding"),$,U)));const ft=(Be,Mt)=>{Mt.x<0||Mt.x>=Tn||Mt.y<0||Mt.y>=Tn||function(bt,Bt,Wi,$i,Pn,hs,Hn,zn,vr,br,xr,mn,Dn,ar,Xn,wr,Yn,ts,Dr,_i,Gi,Ki,$r,sn,tc){const Os=bt.addToLineVertexArray(Bt,Wi);let Bs,ds,is,$n,ca=0,Ou=0,Jy=0,Qy=0,nm=-1,rm=-1;const ua={};let e_=Ul("");if(bt.allowVerticalPlacement&&$i.vertical){const or=zn.layout.get("text-rotate").evaluate(Gi,{},sn)+90;is=new Ed(vr,Bt,br,xr,mn,$i.vertical,Dn,ar,Xn,or),Hn&&($n=new Ed(vr,Bt,br,xr,mn,Hn,Yn,ts,Xn,or))}if(Pn){const or=zn.layout.get("icon-rotate").evaluate(Gi,{}),ns=zn.layout.get("icon-text-fit")!=="none",Go=Uy(Pn,or,$r,ns),xs=Hn?Uy(Hn,or,$r,ns):void 0;ds=new Ed(vr,Bt,br,xr,mn,Pn,Yn,ts,!1,or),ca=4*Go.length;const Ho=bt.iconSizeData;let Fs=null;Ho.kind==="source"?(Fs=[Rs*zn.layout.get("icon-size").evaluate(Gi,{})],Fs[0]>Ua&&fe(`${bt.layerIds[0]}: Value for "icon-size" is >= ${Pu}. Reduce your "icon-size".`)):Ho.kind==="composite"&&(Fs=[Rs*Ki.compositeIconSizes[0].evaluate(Gi,{},sn),Rs*Ki.compositeIconSizes[1].evaluate(Gi,{},sn)],(Fs[0]>Ua||Fs[1]>Ua)&&fe(`${bt.layerIds[0]}: Value for "icon-size" is >= ${Pu}. Reduce your "icon-size".`)),bt.addSymbols(bt.icon,Go,Fs,_i,Dr,Gi,_.ah.none,Bt,Os.lineStartIndex,Os.lineLength,-1,sn),nm=bt.icon.placedSymbolArray.length-1,xs&&(Ou=4*xs.length,bt.addSymbols(bt.icon,xs,Fs,_i,Dr,Gi,_.ah.vertical,Bt,Os.lineStartIndex,Os.lineLength,-1,sn),rm=bt.icon.placedSymbolArray.length-1)}const t_=Object.keys($i.horizontal);for(const or of t_){const ns=$i.horizontal[or];if(!Bs){e_=Ul(ns.text);const xs=zn.layout.get("text-rotate").evaluate(Gi,{},sn);Bs=new Ed(vr,Bt,br,xr,mn,ns,Dn,ar,Xn,xs)}const Go=ns.positionedLines.length===1;if(Jy+=Gy(bt,Bt,ns,hs,zn,Xn,Gi,wr,Os,$i.vertical?_.ah.horizontal:_.ah.horizontalOnly,Go?t_:[or],ua,nm,Ki,sn),Go)break}$i.vertical&&(Qy+=Gy(bt,Bt,$i.vertical,hs,zn,Xn,Gi,wr,Os,_.ah.vertical,["vertical"],ua,rm,Ki,sn));const I2=Bs?Bs.boxStartIndex:bt.collisionBoxArray.length,E2=Bs?Bs.boxEndIndex:bt.collisionBoxArray.length,C2=is?is.boxStartIndex:bt.collisionBoxArray.length,P2=is?is.boxEndIndex:bt.collisionBoxArray.length,z2=ds?ds.boxStartIndex:bt.collisionBoxArray.length,D2=ds?ds.boxEndIndex:bt.collisionBoxArray.length,L2=$n?$n.boxStartIndex:bt.collisionBoxArray.length,R2=$n?$n.boxEndIndex:bt.collisionBoxArray.length;let bs=-1;const Pd=(or,ns)=>or&&or.circleDiameter?Math.max(or.circleDiameter,ns):ns;bs=Pd(Bs,bs),bs=Pd(is,bs),bs=Pd(ds,bs),bs=Pd($n,bs);const i_=bs>-1?1:0;i_&&(bs*=tc/An),bt.glyphOffsetArray.length>=Jl.MAX_GLYPHS&&fe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Gi.sortKey!==void 0&&bt.addToSortKeyRanges(bt.symbolInstances.length,Gi.sortKey);const O2=Zy(zn,Gi,sn),[B2,F2]=function(or,ns){const Go=or.length,xs=ns==null?void 0:ns.values;if((xs==null?void 0:xs.length)>0)for(let Ho=0;Ho<xs.length;Ho+=2){const Fs=xs[Ho+1];or.emplaceBack(_.aq[xs[Ho]],Fs[0],Fs[1])}return[Go,or.length]}(bt.textAnchorOffsets,O2);bt.symbolInstances.emplaceBack(Bt.x,Bt.y,ua.right>=0?ua.right:-1,ua.center>=0?ua.center:-1,ua.left>=0?ua.left:-1,ua.vertical||-1,nm,rm,e_,I2,E2,C2,P2,z2,D2,L2,R2,br,Jy,Qy,ca,Ou,i_,0,Dn,bs,B2,F2)}(r,Mt,Be,s,l,f,yt,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,J,[ye,ye,ye,ye],ct,T,xe,Ee,zt,$,t,y,M,I,v)};if(at==="line")for(const Be of By(t.geometry,0,0,Tn,Tn)){const Mt=x2(Be,ue,qe,s.vertical||V,l,24,re,r.overscaling,Tn);for(const bt of Mt)V&&M2(r,V.text,nt,bt)||ft(Be,bt)}else if(at==="line-center"){for(const Be of t.geometry)if(Be.length>1){const Mt=b2(Be,qe,s.vertical||V,l,24,re);Mt&&ft(Be,Mt)}}else if(t.type==="Polygon")for(const Be of xl(t.geometry,0)){const Mt=T2(Be,16);ft(Be[0],new qa(Mt.x,Mt.y,0))}else if(t.type==="LineString")for(const Be of t.geometry)ft(Be,new qa(Be[0].x,Be[0].y,0));else if(t.type==="Point")for(const Be of t.geometry)for(const Mt of Be)ft([Mt],new qa(Mt.x,Mt.y,0))}function Gy(r,t,s,l,f,y,v,x,T,M,I,P,L,$,V){const U=function(xe,ue,ye,Ee,qe,ct,zt,at){const nt=Ee.layout.get("text-rotate").evaluate(ct,{})*Math.PI/180,wt=[];for(const yt of ue.positionedLines)for(const ft of yt.positionedGlyphs){if(!ft.rect)continue;const Be=ft.rect||{};let Mt=cy+1,bt=!0,Bt=1,Wi=0;const $i=(qe||at)&&ft.vertical,Pn=ft.metrics.advance*ft.scale/2;if(at&&ue.verticalizable&&(Wi=yt.lineOffset/2-(ft.imageName?-(An-ft.metrics.width*ft.scale)/2:(ft.scale-1)*An)),ft.imageName){const _i=zt[ft.imageName];bt=_i.sdf,Bt=_i.pixelRatio,Mt=zr/Bt}const hs=qe?[ft.x+Pn,ft.y]:[0,0];let Hn=qe?[0,0]:[ft.x+Pn+ye[0],ft.y+ye[1]-Wi],zn=[0,0];$i&&(zn=Hn,Hn=[0,0]);const vr=ft.metrics.isDoubleResolution?2:1,br=(ft.metrics.left-Mt)*ft.scale-Pn+Hn[0],xr=(-ft.metrics.top-Mt)*ft.scale+Hn[1],mn=br+Be.w/vr*ft.scale/Bt,Dn=xr+Be.h/vr*ft.scale/Bt,ar=new R(br,xr),Xn=new R(mn,xr),wr=new R(br,Dn),Yn=new R(mn,Dn);if($i){const _i=new R(-Pn,Pn-Eu),Gi=-Math.PI/2,Ki=An/2-Pn,$r=new R(5-Eu-Ki,-(ft.imageName?Ki:0)),sn=new R(...zn);ar._rotateAround(Gi,_i)._add($r)._add(sn),Xn._rotateAround(Gi,_i)._add($r)._add(sn),wr._rotateAround(Gi,_i)._add($r)._add(sn),Yn._rotateAround(Gi,_i)._add($r)._add(sn)}if(nt){const _i=Math.sin(nt),Gi=Math.cos(nt),Ki=[Gi,-_i,_i,Gi];ar._matMult(Ki),Xn._matMult(Ki),wr._matMult(Ki),Yn._matMult(Ki)}const ts=new R(0,0),Dr=new R(0,0);wt.push({tl:ar,tr:Xn,bl:wr,br:Yn,tex:Be,writingMode:ue.writingMode,glyphOffset:hs,sectionIndex:ft.sectionIndex,isSDF:bt,pixelOffsetTL:ts,pixelOffsetBR:Dr,minFontScaleX:0,minFontScaleY:0})}return wt}(0,s,x,f,y,v,l,r.allowVerticalPlacement),J=r.textSizeData;let re=null;J.kind==="source"?(re=[Rs*f.layout.get("text-size").evaluate(v,{})],re[0]>Ua&&fe(`${r.layerIds[0]}: Value for "text-size" is >= ${Pu}. Reduce your "text-size".`)):J.kind==="composite"&&(re=[Rs*$.compositeTextSizes[0].evaluate(v,{},V),Rs*$.compositeTextSizes[1].evaluate(v,{},V)],(re[0]>Ua||re[1]>Ua)&&fe(`${r.layerIds[0]}: Value for "text-size" is >= ${Pu}. Reduce your "text-size".`)),r.addSymbols(r.text,U,re,x,y,v,M,t,T.lineStartIndex,T.lineLength,L,V);for(const xe of I)P[xe]=r.text.placedSymbolArray.length-1;return 4*U.length}function Hy(r){for(const t in r)return r[t];return null}function M2(r,t,s,l){const f=r.compareText;if(t in f){const y=f[t];for(let v=y.length-1;v>=0;v--)if(l.dist(y[v])<s)return!0}else f[t]=[];return f[t].push(l),!1}const Xy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yp{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,l]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=l>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const y=Xy[15&l];if(!y)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new Yp(x,v,y,t)}constructor(t,s=64,l=Float64Array,f){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const y=Xy.indexOf(this.ArrayType),v=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-x%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${l}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+T,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+v+x+T),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+T,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=s,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Kp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:v,nodeSize:x}=this,T=[0,y.length-1,0],M=[];for(;T.length;){const I=T.pop()||0,P=T.pop()||0,L=T.pop()||0;if(P-L<=x){for(let J=L;J<=P;J++){const re=v[2*J],xe=v[2*J+1];re>=t&&re<=l&&xe>=s&&xe<=f&&M.push(y[J])}continue}const $=L+P>>1,V=v[2*$],U=v[2*$+1];V>=t&&V<=l&&U>=s&&U<=f&&M.push(y[$]),(I===0?t<=V:s<=U)&&(T.push(L),T.push($-1),T.push(1-I)),(I===0?l>=V:f>=U)&&(T.push($+1),T.push(P),T.push(1-I))}return M}within(t,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:y,nodeSize:v}=this,x=[0,f.length-1,0],T=[],M=l*l;for(;x.length;){const I=x.pop()||0,P=x.pop()||0,L=x.pop()||0;if(P-L<=v){for(let J=L;J<=P;J++)Ky(y[2*J],y[2*J+1],t,s)<=M&&T.push(f[J]);continue}const $=L+P>>1,V=y[2*$],U=y[2*$+1];Ky(V,U,t,s)<=M&&T.push(f[$]),(I===0?t-l<=V:s-l<=U)&&(x.push(L),x.push($-1),x.push(1-I)),(I===0?t+l>=V:s+l>=U)&&(x.push($+1),x.push(P),x.push(1-I))}return T}}function Kp(r,t,s,l,f,y){if(f-l<=s)return;const v=l+f>>1;Yy(r,t,v,l,f,y),Kp(r,t,s,l,v-1,1-y),Kp(r,t,s,v+1,f,1-y)}function Yy(r,t,s,l,f,y){for(;f>l;){if(f-l>600){const M=f-l+1,I=s-l+1,P=Math.log(M),L=.5*Math.exp(2*P/3),$=.5*Math.sqrt(P*L*(M-L)/M)*(I-M/2<0?-1:1);Yy(r,t,s,Math.max(l,Math.floor(s-I*L/M+$)),Math.min(f,Math.floor(s+(M-I)*L/M+$)),y)}const v=t[2*s+y];let x=l,T=f;for(Lu(r,t,l,s),t[2*f+y]>v&&Lu(r,t,l,f);x<T;){for(Lu(r,t,x,T),x++,T--;t[2*x+y]<v;)x++;for(;t[2*T+y]>v;)T--}t[2*l+y]===v?Lu(r,t,l,T):(T++,Lu(r,t,T,f)),T<=s&&(l=T+1),s<=T&&(f=T-1)}}function Lu(r,t,s,l){Jp(r,s,l),Jp(t,2*s,2*l),Jp(t,2*s+1,2*l+1)}function Jp(r,t,s){const l=r[t];r[t]=r[s],r[s]=l}function Ky(r,t,s,l){const f=r-s,y=t-l;return f*f+y*y}var Qp;_.bg=void 0,(Qp=_.bg||(_.bg={})).create="create",Qp.load="load",Qp.fullLoad="fullLoad";let Cd=null,Ru=[];const em=1e3/60,tm="loadTime",im="fullLoadTime",A2={mark(r){performance.mark(r)},frame(r){const t=r;Cd!=null&&Ru.push(t-Cd),Cd=t},clearMetrics(){Cd=null,Ru=[],performance.clearMeasures(tm),performance.clearMeasures(im);for(const r in _.bg)performance.clearMarks(_.bg[r])},getPerformanceMetrics(){performance.measure(tm,_.bg.create,_.bg.load),performance.measure(im,_.bg.create,_.bg.fullLoad);const r=performance.getEntriesByName(tm)[0].duration,t=performance.getEntriesByName(im)[0].duration,s=Ru.length,l=1/(Ru.reduce((y,v)=>y+v,0)/s/1e3),f=Ru.filter(y=>y>em).reduce((y,v)=>y+(v-em)/em,0);return{loadTime:r,fullLoadTime:t,fps:l,percentDroppedFrames:f/(s+f)*100,totalFrames:s}}};_.$=class extends E{},_.A=Zl,_.B=cp,_.C=function(r){if(Ve==null){const t=r.navigator?r.navigator.userAgent:null;Ve=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ve},_.D=St,_.E=xi,_.F=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new _2(()=>this.process()),this.subscription=function(s,l,f,y){return s.addEventListener(l,f,!1),{unsubscribe:()=>{s.removeEventListener(l,f,!1)}}}(this.target,"message",s=>this.receive(s)),this.globalScope=Ce(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise((s,l)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[f]={resolve:s,reject:l},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[f];const x={id:f,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)},{once:!0});const y=[],v=Object.assign(Object.assign({},r),{id:f,sourceMapId:this.mapId,origin:location.origin,data:Bo(r.data,y)});this.target.postMessage(v,{transfer:y})})}receive(r){const t=r.data,s=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[s];const l=this.abortControllers[s];return delete this.abortControllers[s],void(l&&l.abort())}if(Ce(self)||t.mustQueue)return this.tasks[s]=t,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const f=this.resolveRejects[r];return delete this.resolveRejects[r],f?void(t.error?f.reject(Ba(t.error)):f.resolve(Ba(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=Ba(t.data),l=new AbortController;this.abortControllers[r]=l;try{const f=yield this.messageHandlers[t.type](t.sourceMapId,s,l);this.completeTask(r,null,f)}catch(f){this.completeTask(r,f)}})}completeTask(r,t,s){const l=[];delete this.abortControllers[r];const f={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Bo(t):null,data:Bo(s,l)};this.target.postMessage(f,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},_.G=$t,_.H=function(){var r=new Zl(16);return Zl!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},_.I=Bp,_.J=function(r,t,s){var l,f,y,v,x,T,M,I,P,L,$,V,U=s[0],J=s[1],re=s[2];return t===r?(r[12]=t[0]*U+t[4]*J+t[8]*re+t[12],r[13]=t[1]*U+t[5]*J+t[9]*re+t[13],r[14]=t[2]*U+t[6]*J+t[10]*re+t[14],r[15]=t[3]*U+t[7]*J+t[11]*re+t[15]):(f=t[1],y=t[2],v=t[3],x=t[4],T=t[5],M=t[6],I=t[7],P=t[8],L=t[9],$=t[10],V=t[11],r[0]=l=t[0],r[1]=f,r[2]=y,r[3]=v,r[4]=x,r[5]=T,r[6]=M,r[7]=I,r[8]=P,r[9]=L,r[10]=$,r[11]=V,r[12]=l*U+x*J+P*re+t[12],r[13]=f*U+T*J+L*re+t[13],r[14]=y*U+M*J+$*re+t[14],r[15]=v*U+I*J+V*re+t[15]),r},_.K=function(r,t,s){var l=s[0],f=s[1],y=s[2];return r[0]=t[0]*l,r[1]=t[1]*l,r[2]=t[2]*l,r[3]=t[3]*l,r[4]=t[4]*f,r[5]=t[5]*f,r[6]=t[6]*f,r[7]=t[7]*f,r[8]=t[8]*y,r[9]=t[9]*y,r[10]=t[10]*y,r[11]=t[11]*y,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},_.L=P0,_.M=function(r,t){const s={};for(let l=0;l<t.length;l++){const f=t[l];f in r&&(s[f]=r[f])}return s},_.N=Wa,_.O=My,_.P=R,_.Q=Ay,_.R=Qr,_.S=es,_.T=mu,_.U=Z,_.V=te,_.W=Oe,_.X=Tn,_.Y=m,_.Z=zu,_._=c,_.a=_t,_.a$=function(r,t){var s=r[0],l=r[1],f=r[2],y=r[3],v=r[4],x=r[5],T=r[6],M=r[7],I=r[8],P=r[9],L=r[10],$=r[11],V=r[12],U=r[13],J=r[14],re=r[15],xe=t[0],ue=t[1],ye=t[2],Ee=t[3],qe=t[4],ct=t[5],zt=t[6],at=t[7],nt=t[8],wt=t[9],yt=t[10],ft=t[11],Be=t[12],Mt=t[13],bt=t[14],Bt=t[15];return Math.abs(s-xe)<=_r*Math.max(1,Math.abs(s),Math.abs(xe))&&Math.abs(l-ue)<=_r*Math.max(1,Math.abs(l),Math.abs(ue))&&Math.abs(f-ye)<=_r*Math.max(1,Math.abs(f),Math.abs(ye))&&Math.abs(y-Ee)<=_r*Math.max(1,Math.abs(y),Math.abs(Ee))&&Math.abs(v-qe)<=_r*Math.max(1,Math.abs(v),Math.abs(qe))&&Math.abs(x-ct)<=_r*Math.max(1,Math.abs(x),Math.abs(ct))&&Math.abs(T-zt)<=_r*Math.max(1,Math.abs(T),Math.abs(zt))&&Math.abs(M-at)<=_r*Math.max(1,Math.abs(M),Math.abs(at))&&Math.abs(I-nt)<=_r*Math.max(1,Math.abs(I),Math.abs(nt))&&Math.abs(P-wt)<=_r*Math.max(1,Math.abs(P),Math.abs(wt))&&Math.abs(L-yt)<=_r*Math.max(1,Math.abs(L),Math.abs(yt))&&Math.abs($-ft)<=_r*Math.max(1,Math.abs($),Math.abs(ft))&&Math.abs(V-Be)<=_r*Math.max(1,Math.abs(V),Math.abs(Be))&&Math.abs(U-Mt)<=_r*Math.max(1,Math.abs(U),Math.abs(Mt))&&Math.abs(J-bt)<=_r*Math.max(1,Math.abs(J),Math.abs(bt))&&Math.abs(re-Bt)<=_r*Math.max(1,Math.abs(re),Math.abs(Bt))},_.a0=Fi,_.a1=Gp,_.a2=ze,_.a3=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(s=>{t.onloadstart=()=>{s(t)};for(const l of r){const f=window.document.createElement("source");bi(l)||(t.crossOrigin="Anonymous"),f.src=l,t.appendChild(f)}})},_.a4=function(){return Fe++},_.a5=it,_.a6=Jl,_.a7=Ra,_.a8=qo,_.a9=Dy,_.aA=function(r){if(r.type==="custom")return new y2(r);switch(r.type){case"background":return new p2(r);case"circle":return new tw(r);case"fill":return new _w(r);case"fill-extrusion":return new Dw(r);case"heatmap":return new nw(r);case"hillshade":return new sw(r);case"line":return new jw(r);case"raster":return new g2(r);case"symbol":return new kd(r)}},_.aB=Te,_.aC=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let s=[];try{if(!Kt(r.version,t.version))return[{command:"setStyle",args:[t]}];Kt(r.center,t.center)||s.push({command:"setCenter",args:[t.center]}),Kt(r.zoom,t.zoom)||s.push({command:"setZoom",args:[t.zoom]}),Kt(r.bearing,t.bearing)||s.push({command:"setBearing",args:[t.bearing]}),Kt(r.pitch,t.pitch)||s.push({command:"setPitch",args:[t.pitch]}),Kt(r.sprite,t.sprite)||s.push({command:"setSprite",args:[t.sprite]}),Kt(r.glyphs,t.glyphs)||s.push({command:"setGlyphs",args:[t.glyphs]}),Kt(r.transition,t.transition)||s.push({command:"setTransition",args:[t.transition]}),Kt(r.light,t.light)||s.push({command:"setLight",args:[t.light]}),Kt(r.terrain,t.terrain)||s.push({command:"setTerrain",args:[t.terrain]}),Kt(r.sky,t.sky)||s.push({command:"setSky",args:[t.sky]}),Kt(r.projection,t.projection)||s.push({command:"setProjection",args:[t.projection]});const l={},f=[];(function(v,x,T,M){let I;for(I in x=x||{},v=v||{})Object.prototype.hasOwnProperty.call(v,I)&&(Object.prototype.hasOwnProperty.call(x,I)||bn(I,T,M));for(I in x)Object.prototype.hasOwnProperty.call(x,I)&&(Object.prototype.hasOwnProperty.call(v,I)?Kt(v[I],x[I])||(v[I].type==="geojson"&&x[I].type==="geojson"&&Is(v,x,I)?Ei(T,{command:"setGeoJSONSourceData",args:[I,x[I].data]}):Jn(I,x,T,M)):dr(I,x,T))})(r.sources,t.sources,f,l);const y=[];r.layers&&r.layers.forEach(v=>{"source"in v&&l[v.source]?s.push({command:"removeLayer",args:[v.id]}):y.push(v)}),s=s.concat(f),function(v,x,T){x=x||[];const M=(v=v||[]).map(xt),I=x.map(xt),P=v.reduce(Tt,{}),L=x.reduce(Tt,{}),$=M.slice(),V=Object.create(null);let U,J,re,xe,ue;for(let ye=0,Ee=0;ye<M.length;ye++)U=M[ye],Object.prototype.hasOwnProperty.call(L,U)?Ee++:(Ei(T,{command:"removeLayer",args:[U]}),$.splice($.indexOf(U,Ee),1));for(let ye=0,Ee=0;ye<I.length;ye++)U=I[I.length-1-ye],$[$.length-1-ye]!==U&&(Object.prototype.hasOwnProperty.call(P,U)?(Ei(T,{command:"removeLayer",args:[U]}),$.splice($.lastIndexOf(U,$.length-Ee),1)):Ee++,xe=$[$.length-ye],Ei(T,{command:"addLayer",args:[L[U],xe]}),$.splice($.length-ye,0,U),V[U]=!0);for(let ye=0;ye<I.length;ye++)if(U=I[ye],J=P[U],re=L[U],!V[U]&&!Kt(J,re))if(Kt(J.source,re.source)&&Kt(J["source-layer"],re["source-layer"])&&Kt(J.type,re.type)){for(ue in Qn(J.layout,re.layout,T,U,null,"setLayoutProperty"),Qn(J.paint,re.paint,T,U,null,"setPaintProperty"),Kt(J.filter,re.filter)||Ei(T,{command:"setFilter",args:[U,re.filter]}),Kt(J.minzoom,re.minzoom)&&Kt(J.maxzoom,re.maxzoom)||Ei(T,{command:"setLayerZoomRange",args:[U,re.minzoom,re.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?Qn(J[ue],re[ue],T,U,ue.slice(6),"setPaintProperty"):Kt(J[ue],re[ue])||Ei(T,{command:"setLayerProperty",args:[U,ue,re[ue]]}));for(ue in re)Object.prototype.hasOwnProperty.call(re,ue)&&!Object.prototype.hasOwnProperty.call(J,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?Qn(J[ue],re[ue],T,U,ue.slice(6),"setPaintProperty"):Kt(J[ue],re[ue])||Ei(T,{command:"setLayerProperty",args:[U,ue,re[ue]]}))}else Ei(T,{command:"removeLayer",args:[U]}),xe=$[$.lastIndexOf(U)+1],Ei(T,{command:"addLayer",args:[re,xe]})}(y,t.layers,s)}catch(l){console.warn("Unable to compute style diff:",l),s=[{command:"setStyle",args:[t]}]}return s},_.aD=function(r){const t=[],s=r.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},_.aE=function r(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let l=0;l<t.length;l++)if(!r(t[l],s[l]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const l in t)if(!r(t[l],s[l]))return!1;return!0}return t===s},_.aF=Re,_.aG=Le,_.aH=class extends _s{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},_.aI=dd,_.aJ=class extends _s{constructor(r,t){super(r,t),this.current=Gx}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},_.aK=b0,_.aL=x0,_.aM=Ri,_.aN=class extends _s{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},_.aO=class extends _s{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},_.aP=function(r,t,s,l,f,y,v){var x=1/(t-s),T=1/(l-f),M=1/(y-v);return r[0]=-2*x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*T,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*M,r[11]=0,r[12]=(t+s)*x,r[13]=(f+l)*T,r[14]=(v+y)*M,r[15]=1,r},_.aQ=ew,_.aR=class extends K{},_.aS=qw,_.aT=class extends ge{},_.aU=kp,_.aV=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},_.aW=O0,_.aX=ir,_.aY=Pr,_.aZ=class extends Je{},_.a_=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},_.aa=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,l,f,y)=>{const v=f||y;return t[l]=!v||v.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},_.ab=function(r,t){const s=[];for(const l in r)l in t||s.push(l);return s},_.ac=ve,_.ad=function(r,t,s){var l=Math.sin(s),f=Math.cos(s),y=t[0],v=t[1],x=t[2],T=t[3],M=t[4],I=t[5],P=t[6],L=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=y*f+M*l,r[1]=v*f+I*l,r[2]=x*f+P*l,r[3]=T*f+L*l,r[4]=M*f-y*l,r[5]=I*f-v*l,r[6]=P*f-x*l,r[7]=L*f-T*l,r},_.ae=function(r){var t=new Zl(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},_.af=gd,_.ag=function(r,t){let s=0,l=0;if(r.kind==="constant")l=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:f,minZoom:y,maxZoom:v}=r,x=f?ve(pr.interpolationFactor(f,t,y,v),0,1):0;r.kind==="camera"?l=fr.number(r.minSize,r.maxSize,x):s=x}return{uSizeT:s,uSize:l}},_.ai=function(r,{uSize:t,uSizeT:s},{lowerSize:l,upperSize:f}){return r.kind==="source"?l/Rs:r.kind==="composite"?fr.number(l/Rs,f/Rs,s):t},_.aj=jp,_.ak=function(r,t,s,l){const f=t.y-r.y,y=t.x-r.x,v=l.y-s.y,x=l.x-s.x,T=v*y-x*f;if(T===0)return null;const M=(x*(r.y-s.y)-v*(r.x-s.x))/T;return new R(r.x+M*y,r.y+M*f)},_.al=By,_.am=k0,_.an=wp,_.ao=function(r){let t=1/0,s=1/0,l=-1/0,f=-1/0;for(const y of r)t=Math.min(t,y.x),s=Math.min(s,y.y),l=Math.max(l,y.x),f=Math.max(f,y.y);return[t,s,l,f]},_.ap=An,_.ar=$p,_.as=function(r,t){var s=t[0],l=t[1],f=t[2],y=t[3],v=t[4],x=t[5],T=t[6],M=t[7],I=t[8],P=t[9],L=t[10],$=t[11],V=t[12],U=t[13],J=t[14],re=t[15],xe=s*x-l*v,ue=s*T-f*v,ye=s*M-y*v,Ee=l*T-f*x,qe=l*M-y*x,ct=f*M-y*T,zt=I*U-P*V,at=I*J-L*V,nt=I*re-$*V,wt=P*J-L*U,yt=P*re-$*U,ft=L*re-$*J,Be=xe*ft-ue*yt+ye*wt+Ee*nt-qe*at+ct*zt;return Be?(r[0]=(x*ft-T*yt+M*wt)*(Be=1/Be),r[1]=(f*yt-l*ft-y*wt)*Be,r[2]=(U*ct-J*qe+re*Ee)*Be,r[3]=(L*qe-P*ct-$*Ee)*Be,r[4]=(T*nt-v*ft-M*at)*Be,r[5]=(s*ft-f*nt+y*at)*Be,r[6]=(J*ye-V*ct-re*ue)*Be,r[7]=(I*ct-L*ye+$*ue)*Be,r[8]=(v*yt-x*nt+M*zt)*Be,r[9]=(l*nt-s*yt-y*zt)*Be,r[10]=(V*qe-U*ye+re*xe)*Be,r[11]=(P*ye-I*qe-$*xe)*Be,r[12]=(x*at-v*wt-T*zt)*Be,r[13]=(s*wt-l*at+f*zt)*Be,r[14]=(U*ue-V*Ee-J*xe)*Be,r[15]=(I*Ee-P*ue+L*xe)*Be,r):null},_.at=Xp,_.au=Np,_.av=Yp,_.aw=function(){const r={},t=Me.$version;for(const s in Me.$root){const l=Me.$root[s];if(l.required){let f=null;f=s==="version"?t:l.type==="array"?[]:{},f!=null&&(r[s]=f)}}return r},_.ax=hu,_.ay=fi,_.az=function(r){r=r.slice();const t=Object.create(null);for(let s=0;s<r.length;s++)t[r[s].id]=r[s];for(let s=0;s<r.length;s++)"ref"in r[s]&&(r[s]=Ii(r[s],t[r[s].ref]));return r},_.b=Ue,_.b0=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},_.b1=function(r,t,s){return r[0]=t[0]*s[0],r[1]=t[1]*s[1],r[2]=t[2]*s[2],r[3]=t[3]*s[3],r},_.b2=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},_.b3=Se,_.b4=Cy,_.b5=Iy,_.b6=function(r,t,s,l,f){var y,v=1/Math.tan(t/2);return r[0]=v/s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=v,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,f!=null&&f!==1/0?(r[10]=(f+l)*(y=1/(l-f)),r[14]=2*f*l*y):(r[10]=-1,r[14]=-2*l),r},_.b7=function(r,t,s){var l=Math.sin(s),f=Math.cos(s),y=t[4],v=t[5],x=t[6],T=t[7],M=t[8],I=t[9],P=t[10],L=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=y*f+M*l,r[5]=v*f+I*l,r[6]=x*f+P*l,r[7]=T*f+L*l,r[8]=M*f-y*l,r[9]=I*f-v*l,r[10]=P*f-x*l,r[11]=L*f-T*l,r},_.b8=ne,_.b9=_e,_.bA=iy,_.bB=function(r){return r.message===Et},_.bC=Il,_.bD=ra,_.ba=function(r){return r*Math.PI/180},_.bb=function(r,t){const{x:s,y:l}=zu.fromLngLat(t);return!(r<0||r>25||l<0||l>=1||s<0||s>=1)},_.bc=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},_.bd=class extends k{},_.be=qp,_.bf=A2,_.bh=ai,_.bi=function(r,t){_t.REGISTERED_PROTOCOLS[r]=t},_.bj=function(r){delete _t.REGISTERED_PROTOCOLS[r]},_.bk=function(r,t){const s={};for(let f=0;f<r.length;f++){const y=t&&t[r[f].id]||zo(r[f]);t&&(t[r[f].id]=y);let v=s[y];v||(v=s[y]=[]),v.push(r[f])}const l=[];for(const f in s)l.push(s[f]);return l},_.bl=ht,_.bm=zy,_.bn=Ly,_.bo=hy,_.bp=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Tn/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],s=t.layout,l=t._unevaluatedLayout._values,f={layoutIconSize:l["icon-size"].possiblyEvaluate(new Pi(r.bucket.zoom+1),r.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new Pi(r.bucket.zoom+1),r.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new Pi(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:I}=r.bucket.textSizeData;f.compositeTextSizes=[l["text-size"].possiblyEvaluate(new Pi(M),r.canonical),l["text-size"].possiblyEvaluate(new Pi(I),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:I}=r.bucket.iconSizeData;f.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new Pi(M),r.canonical),l["icon-size"].possiblyEvaluate(new Pi(I),r.canonical)]}const y=s.get("text-line-height")*An,v=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",x=s.get("text-keep-upright"),T=s.get("text-size");for(const M of r.bucket.features){const I=s.get("text-font").evaluate(M,{},r.canonical).join(","),P=T.evaluate(M,{},r.canonical),L=f.layoutTextSize.evaluate(M,{},r.canonical),$=f.layoutIconSize.evaluate(M,{},r.canonical),V={horizontal:{},vertical:void 0},U=M.text;let J,re=[0,0];if(U){const ye=U.toString(),Ee=s.get("text-letter-spacing").evaluate(M,{},r.canonical)*An,qe=hp(ye)?Ee:0,ct=s.get("text-anchor").evaluate(M,{},r.canonical),zt=Zy(t,M,r.canonical);if(!zt){const yt=s.get("text-radial-offset").evaluate(M,{},r.canonical);re=yt?qy(ct,[yt*An,Hp]):s.get("text-offset").evaluate(M,{},r.canonical).map(ft=>ft*An)}let at=v?"center":s.get("text-justify").evaluate(M,{},r.canonical);const nt=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(M,{},r.canonical)*An:1/0,wt=()=>{r.bucket.allowVerticalPlacement&&du(ye)&&(V.vertical=wd(U,r.glyphMap,r.glyphPositions,r.imagePositions,I,nt,y,ct,"left",qe,re,_.ah.vertical,!0,L,P))};if(!v&&zt){const yt=new Set;if(at==="auto")for(let Be=0;Be<zt.values.length;Be+=2)yt.add(Xp(zt.values[Be]));else yt.add(at);let ft=!1;for(const Be of yt)if(!V.horizontal[Be])if(ft)V.horizontal[Be]=V.horizontal[0];else{const Mt=wd(U,r.glyphMap,r.glyphPositions,r.imagePositions,I,nt,y,"center",Be,qe,re,_.ah.horizontal,!1,L,P);Mt&&(V.horizontal[Be]=Mt,ft=Mt.positionedLines.length===1)}wt()}else{at==="auto"&&(at=Xp(ct));const yt=wd(U,r.glyphMap,r.glyphPositions,r.imagePositions,I,nt,y,ct,at,qe,re,_.ah.horizontal,!1,L,P);yt&&(V.horizontal[at]=yt),wt(),du(ye)&&v&&x&&(V.vertical=wd(U,r.glyphMap,r.glyphPositions,r.imagePositions,I,nt,y,ct,at,qe,re,_.ah.vertical,!1,L,P))}}let xe=!1;if(M.icon&&M.icon.name){const ye=r.imageMap[M.icon.name];ye&&(J=c2(r.imagePositions[M.icon.name],s.get("icon-offset").evaluate(M,{},r.canonical),s.get("icon-anchor").evaluate(M,{},r.canonical)),xe=!!ye.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=xe:r.bucket.sdfIcons!==xe&&fe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ye.pixelRatio!==r.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const ue=Hy(V.horizontal)||V.vertical;r.bucket.iconsInText=!!ue&&ue.iconsInText,(ue||J)&&k2(r.bucket,M,V,J,r.imageMap,f,L,$,re,xe,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},_.bq=Dp,_.br=Cp,_.bs=zp,_.bt=ja,_.bu=Rp,_.bv=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},_.bw=function(r,t,s,l,f){return c(this,void 0,void 0,function*(){if(te())try{return yield Oe(r,t,s,l,f)}catch{}return function(y,v,x,T,M){const I=y.width,P=y.height;Xe&&We||(Xe=new OffscreenCanvas(I,P),We=Xe.getContext("2d",{willReadFrequently:!0})),Xe.width=I,Xe.height=P,We.drawImage(y,0,0,I,P);const L=We.getImageData(v,x,T,M);return We.clearRect(0,0,I,P),L.data}(r,t,s,l,f)})},_.bx=Py,_.by=A,_.bz=O,_.c=Nt,_.d=r=>c(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),_.e=de,_.f=r=>new Promise((t,s)=>{const l=new Image;l.onload=()=>{t(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame(()=>{l.src=Ge})},l.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(r)],{type:"image/png"});l.src=r.byteLength?URL.createObjectURL(f):Ge}),_.g=Xt,_.h=(r,t)=>qt(de(r,{type:"json"}),t),_.i=Ce,_.j=hi,_.k=Qi,_.l=(r,t)=>qt(de(r,{type:"arrayBuffer"}),t),_.m=qt,_.n=function(r){return new Rp(r).readFields(i2,[])},_.o=wu,_.p=uy,_.q=gr,_.r=id,_.s=bi,_.t=uu,_.u=ia,_.v=Me,_.w=fe,_.x=function([r,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(s),y:r*Math.sin(t)*Math.sin(s),z:r*Math.cos(s)}},_.y=fr,_.z=Pi}),p("worker",["./shared"],function(_){class c{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,N){for(const Q of F){this._layerConfigs[Q.id]=Q;const he=this._layers[Q.id]=_.aA(Q);he._featureFilter=_.a7(he.filter),this.keyCache[Q.id]&&delete this.keyCache[Q.id]}for(const Q of N)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};const W=_.bk(Object.values(this._layerConfigs),this.keyCache);for(const Q of W){const he=Q.map(Ie=>this._layers[Ie.id]),me=he[0];if(me.visibility==="none")continue;const be=me.source||"";let le=this.familiesBySource[be];le||(le=this.familiesBySource[be]={});const Pe=me.sourceLayer||"_geojsonTileLayer";let je=le[Pe];je||(je=le[Pe]=[]),je.push(he)}}}class A{constructor(F){const N={},W=[];for(const be in F){const le=F[be],Pe=N[be]={};for(const je in le){const Ie=le[+je];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const Ke={x:0,y:0,w:Ie.bitmap.width+2,h:Ie.bitmap.height+2};W.push(Ke),Pe[je]={rect:Ke,metrics:Ie.metrics}}}const{w:Q,h:he}=_.p(W),me=new _.o({width:Q||1,height:he||1});for(const be in F){const le=F[be];for(const Pe in le){const je=le[+Pe];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const Ie=N[be][Pe].rect;_.o.copy(je.bitmap,me,{x:0,y:0},{x:Ie.x+1,y:Ie.y+1},je.bitmap)}}this.image=me,this.positions=N}}_.bl("GlyphAtlas",A);class O{constructor(F){this.tileID=new _.S(F.tileID.overscaledZ,F.tileID.wrap,F.tileID.canonical.z,F.tileID.canonical.x,F.tileID.canonical.y),this.uid=F.uid,this.zoom=F.zoom,this.pixelRatio=F.pixelRatio,this.tileSize=F.tileSize,this.source=F.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=F.showCollisionBoxes,this.collectResourceTiming=!!F.collectResourceTiming,this.returnDependencies=!!F.returnDependencies,this.promoteId=F.promoteId,this.inFlightDependencies=[]}parse(F,N,W,Q){return _._(this,void 0,void 0,function*(){this.status="parsing",this.data=F,this.collisionBoxArray=new _.a5;const he=new _.bm(Object.keys(F.layers).sort()),me=new _.bn(this.tileID,this.promoteId);me.bucketLayerIDs=[];const be={},le={featureIndex:me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W},Pe=N.familiesBySource[this.source];for(const ti in Pe){const Li=F.layers[ti];if(!Li)continue;Li.version===1&&_.w(`Vector tile source "${this.source}" layer "${ti}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const en=he.encode(ti),Cn=[];for(let Nn=0;Nn<Li.length;Nn++){const er=Li.feature(Nn),Sa=me.getId(er,ti);Cn.push({feature:er,id:Sa,index:Nn,sourceLayerIndex:en})}for(const Nn of Pe[ti]){const er=Nn[0];er.source!==this.source&&_.w(`layer.source = ${er.source} does not equal this.source = ${this.source}`),er.minzoom&&this.zoom<Math.floor(er.minzoom)||er.maxzoom&&this.zoom>=er.maxzoom||er.visibility!=="none"&&(B(Nn,this.zoom,W),(be[er.id]=er.createBucket({index:me.bucketLayerIDs.length,layers:Nn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:en,sourceID:this.source})).populate(Cn,le,this.tileID.canonical),me.bucketLayerIDs.push(Nn.map(Sa=>Sa.id)))}}const je=_.aF(le.glyphDependencies,ti=>Object.keys(ti).map(Number));this.inFlightDependencies.forEach(ti=>ti==null?void 0:ti.abort()),this.inFlightDependencies=[];let Ie=Promise.resolve({});if(Object.keys(je).length){const ti=new AbortController;this.inFlightDependencies.push(ti),Ie=Q.sendAsync({type:"GG",data:{stacks:je,source:this.source,tileID:this.tileID,type:"glyphs"}},ti)}const Ke=Object.keys(le.iconDependencies);let At=Promise.resolve({});if(Ke.length){const ti=new AbortController;this.inFlightDependencies.push(ti),At=Q.sendAsync({type:"GI",data:{icons:Ke,source:this.source,tileID:this.tileID,type:"icons"}},ti)}const Pt=Object.keys(le.patternDependencies);let mi=Promise.resolve({});if(Pt.length){const ti=new AbortController;this.inFlightDependencies.push(ti),mi=Q.sendAsync({type:"GI",data:{icons:Pt,source:this.source,tileID:this.tileID,type:"patterns"}},ti)}const[Zt,gi,oi]=yield Promise.all([Ie,At,mi]),xn=new A(Zt),nn=new _.bo(gi,oi);for(const ti in be){const Li=be[ti];Li instanceof _.a6?(B(Li.layers,this.zoom,W),_.bp({bucket:Li,glyphMap:Zt,glyphPositions:xn.positions,imageMap:gi,imagePositions:nn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Li.hasPattern&&(Li instanceof _.bq||Li instanceof _.br||Li instanceof _.bs)&&(B(Li.layers,this.zoom,W),Li.addFeatures(le,this.tileID.canonical,nn.patternPositions))}return this.status="done",{buckets:Object.values(be).filter(ti=>!ti.isEmpty()),featureIndex:me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xn.image,imageAtlas:nn,glyphMap:this.returnDependencies?Zt:null,iconMap:this.returnDependencies?gi:null,glyphPositions:this.returnDependencies?xn.positions:null}})}}function B(ie,F,N){const W=new _.z(F);for(const Q of ie)Q.recalculate(W,N)}class R{constructor(F,N,W){this.actor=F,this.layerIndex=N,this.availableImages=W,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(F,N){return _._(this,void 0,void 0,function*(){const W=yield _.l(F.request,N);try{return{vectorTile:new _.bt.VectorTile(new _.bu(W.data)),rawData:W.data,cacheControl:W.cacheControl,expires:W.expires}}catch(Q){const he=new Uint8Array(W.data);let me=`Unable to parse the tile at ${F.request.url}, `;throw me+=he[0]===31&&he[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Q.message}`,new Error(me)}})}loadTile(F){return _._(this,void 0,void 0,function*(){const N=F.uid,W=!!(F&&F.request&&F.request.collectResourceTiming)&&new _.bv(F.request),Q=new O(F);this.loading[N]=Q;const he=new AbortController;Q.abort=he;try{const me=yield this.loadVectorTile(F,he);if(delete this.loading[N],!me)return null;const be=me.rawData,le={};me.expires&&(le.expires=me.expires),me.cacheControl&&(le.cacheControl=me.cacheControl);const Pe={};if(W){const Ie=W.finish();Ie&&(Pe.resourceTiming=JSON.parse(JSON.stringify(Ie)))}Q.vectorTile=me.vectorTile;const je=Q.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[N]=Q,this.fetching[N]={rawTileData:be,cacheControl:le,resourceTiming:Pe};try{const Ie=yield je;return _.e({rawTileData:be.slice(0)},Ie,le,Pe)}finally{delete this.fetching[N]}}catch(me){throw delete this.loading[N],Q.status="done",this.loaded[N]=Q,me}})}reloadTile(F){return _._(this,void 0,void 0,function*(){const N=F.uid;if(!this.loaded||!this.loaded[N])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const W=this.loaded[N];if(W.showCollisionBoxes=F.showCollisionBoxes,W.status==="parsing"){const Q=yield W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor);let he;if(this.fetching[N]){const{rawTileData:me,cacheControl:be,resourceTiming:le}=this.fetching[N];delete this.fetching[N],he=_.e({rawTileData:me.slice(0)},Q,be,le)}else he=Q;return he}if(W.status==="done"&&W.vectorTile)return W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(F){return _._(this,void 0,void 0,function*(){const N=this.loading,W=F.uid;N&&N[W]&&N[W].abort&&(N[W].abort.abort(),delete N[W])})}removeTile(F){return _._(this,void 0,void 0,function*(){this.loaded&&this.loaded[F.uid]&&delete this.loaded[F.uid]})}}class C{constructor(){this.loaded={}}loadTile(F){return _._(this,void 0,void 0,function*(){const{uid:N,encoding:W,rawImageData:Q,redFactor:he,greenFactor:me,blueFactor:be,baseShift:le}=F,Pe=Q.width+2,je=Q.height+2,Ie=_.b(Q)?new _.R({width:Pe,height:je},yield _.bw(Q,-1,-1,Pe,je)):Q,Ke=new _.bx(N,Ie,W,he,me,be,le);return this.loaded=this.loaded||{},this.loaded[N]=Ke,Ke})}removeTile(F){const N=this.loaded,W=F.uid;N&&N[W]&&delete N[W]}}function Y(ie,F){if(ie.length!==0){X(ie[0],F);for(var N=1;N<ie.length;N++)X(ie[N],!F)}}function X(ie,F){for(var N=0,W=0,Q=0,he=ie.length,me=he-1;Q<he;me=Q++){var be=(ie[Q][0]-ie[me][0])*(ie[me][1]+ie[Q][1]),le=N+be;W+=Math.abs(N)>=Math.abs(be)?N-le+be:be-le+N,N=le}N+W>=0!=!!F&&ie.reverse()}var H=_.by(function ie(F,N){var W,Q=F&&F.type;if(Q==="FeatureCollection")for(W=0;W<F.features.length;W++)ie(F.features[W],N);else if(Q==="GeometryCollection")for(W=0;W<F.geometries.length;W++)ie(F.geometries[W],N);else if(Q==="Feature")ie(F.geometry,N);else if(Q==="Polygon")Y(F.coordinates,N);else if(Q==="MultiPolygon")for(W=0;W<F.coordinates.length;W++)Y(F.coordinates[W],N);return F});const ae=_.bt.VectorTileFeature.prototype.toGeoJSON;var Z={exports:{}},te=_.bz,ne=_.bt.VectorTileFeature,_e=ve;function ve(ie,F){this.options=F||{},this.features=ie,this.length=ie.length}function Se(ie,F){this.id=typeof ie.id=="number"?ie.id:void 0,this.type=ie.type,this.rawGeometry=ie.type===1?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=F||4096}ve.prototype.feature=function(ie){return new Se(this.features[ie],this.options.extent)},Se.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var F=0;F<ie.length;F++){for(var N=ie[F],W=[],Q=0;Q<N.length;Q++)W.push(new te(N[Q][0],N[Q][1]));this.geometry.push(W)}return this.geometry},Se.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,F=1/0,N=-1/0,W=1/0,Q=-1/0,he=0;he<ie.length;he++)for(var me=ie[he],be=0;be<me.length;be++){var le=me[be];F=Math.min(F,le.x),N=Math.max(N,le.x),W=Math.min(W,le.y),Q=Math.max(Q,le.y)}return[F,W,N,Q]},Se.prototype.toGeoJSON=ne.prototype.toGeoJSON;var de=_.bA,Fe=_e;function Re(ie){var F=new de;return function(N,W){for(var Q in N.layers)W.writeMessage(3,Le,N.layers[Q])}(ie,F),F.finish()}function Le(ie,F){var N;F.writeVarintField(15,ie.version||1),F.writeStringField(1,ie.name||""),F.writeVarintField(5,ie.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<ie.length;N++)W.feature=ie.feature(N),F.writeMessage(2,Te,W);var Q=W.keys;for(N=0;N<Q.length;N++)F.writeStringField(3,Q[N]);var he=W.values;for(N=0;N<he.length;N++)F.writeMessage(4,Ve,he[N])}function Te(ie,F){var N=ie.feature;N.id!==void 0&&F.writeVarintField(1,N.id),F.writeMessage(2,we,ie),F.writeVarintField(3,N.type),F.writeMessage(4,Ce,N)}function we(ie,F){var N=ie.feature,W=ie.keys,Q=ie.values,he=ie.keycache,me=ie.valuecache;for(var be in N.properties){var le=N.properties[be],Pe=he[be];if(le!==null){Pe===void 0&&(W.push(be),he[be]=Pe=W.length-1),F.writeVarint(Pe);var je=typeof le;je!=="string"&&je!=="boolean"&&je!=="number"&&(le=JSON.stringify(le));var Ie=je+":"+le,Ke=me[Ie];Ke===void 0&&(Q.push(le),me[Ie]=Ke=Q.length-1),F.writeVarint(Ke)}}}function fe(ie,F){return(F<<3)+(7&ie)}function Ae(ie){return ie<<1^ie>>31}function Ce(ie,F){for(var N=ie.loadGeometry(),W=ie.type,Q=0,he=0,me=N.length,be=0;be<me;be++){var le=N[be],Pe=1;W===1&&(Pe=le.length),F.writeVarint(fe(1,Pe));for(var je=W===3?le.length-1:le.length,Ie=0;Ie<je;Ie++){Ie===1&&W!==1&&F.writeVarint(fe(2,je-1));var Ke=le[Ie].x-Q,At=le[Ie].y-he;F.writeVarint(Ae(Ke)),F.writeVarint(Ae(At)),Q+=Ke,he+=At}W===3&&F.writeVarint(fe(7,1))}}function Ve(ie,F){var N=typeof ie;N==="string"?F.writeStringField(1,ie):N==="boolean"?F.writeBooleanField(7,ie):N==="number"&&(ie%1!=0?F.writeDoubleField(3,ie):ie<0?F.writeSVarintField(6,ie):F.writeVarintField(5,ie))}Z.exports=Re,Z.exports.fromVectorTileJs=Re,Z.exports.fromGeojsonVt=function(ie,F){F=F||{};var N={};for(var W in ie)N[W]=new Fe(ie[W].features,F),N[W].name=W,N[W].version=F.version,N[W].extent=F.extent;return Re({layers:N})},Z.exports.GeoJSONWrapper=Fe;var Ue=_.by(Z.exports);const Ge={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},Oe=Math.fround||(Xe=new Float32Array(1),ie=>(Xe[0]=+ie,Xe[0]));var Xe;const We=3,Et=5,Nt=6;class _t{constructor(F){this.options=Object.assign(Object.create(Ge),F),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(F){const{log:N,minZoom:W,maxZoom:Q}=this.options;N&&console.time("total time");const he=`prepare ${F.length} points`;N&&console.time(he),this.points=F;const me=[];for(let le=0;le<F.length;le++){const Pe=F[le];if(!Pe.geometry)continue;const[je,Ie]=Pe.geometry.coordinates,Ke=Oe(ai(je)),At=Oe(fi(Ie));me.push(Ke,At,1/0,le,-1,1),this.options.reduce&&me.push(0)}let be=this.trees[Q+1]=this._createTree(me);N&&console.timeEnd(he);for(let le=Q;le>=W;le--){const Pe=+Date.now();be=this.trees[le]=this._createTree(this._cluster(be,le)),N&&console.log("z%d: %d clusters in %dms",le,be.numItems,+Date.now()-Pe)}return N&&console.timeEnd("total time"),this}getClusters(F,N){let W=((F[0]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,F[1]));let he=F[2]===180?180:((F[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)W=-180,he=180;else if(W>he){const Ie=this.getClusters([W,Q,180,me],N),Ke=this.getClusters([-180,Q,he,me],N);return Ie.concat(Ke)}const be=this.trees[this._limitZoom(N)],le=be.range(ai(W),fi(me),ai(he),fi(Q)),Pe=be.data,je=[];for(const Ie of le){const Ke=this.stride*Ie;je.push(Pe[Ke+Et]>1?Xt(Pe,Ke,this.clusterProps):this.points[Pe[Ke+We]])}return je}getChildren(F){const N=this._getOriginId(F),W=this._getOriginZoom(F),Q="No cluster with the specified id.",he=this.trees[W];if(!he)throw new Error(Q);const me=he.data;if(N*this.stride>=me.length)throw new Error(Q);const be=this.options.radius/(this.options.extent*Math.pow(2,W-1)),le=he.within(me[N*this.stride],me[N*this.stride+1],be),Pe=[];for(const je of le){const Ie=je*this.stride;me[Ie+4]===F&&Pe.push(me[Ie+Et]>1?Xt(me,Ie,this.clusterProps):this.points[me[Ie+We]])}if(Pe.length===0)throw new Error(Q);return Pe}getLeaves(F,N,W){const Q=[];return this._appendLeaves(Q,F,N=N||10,W=W||0,0),Q}getTile(F,N,W){const Q=this.trees[this._limitZoom(F)],he=Math.pow(2,F),{extent:me,radius:be}=this.options,le=be/me,Pe=(W-le)/he,je=(W+1+le)/he,Ie={features:[]};return this._addTileFeatures(Q.range((N-le)/he,Pe,(N+1+le)/he,je),Q.data,N,W,he,Ie),N===0&&this._addTileFeatures(Q.range(1-le/he,Pe,1,je),Q.data,he,W,he,Ie),N===he-1&&this._addTileFeatures(Q.range(0,Pe,le/he,je),Q.data,-1,W,he,Ie),Ie.features.length?Ie:null}getClusterExpansionZoom(F){let N=this._getOriginZoom(F)-1;for(;N<=this.options.maxZoom;){const W=this.getChildren(F);if(N++,W.length!==1)break;F=W[0].properties.cluster_id}return N}_appendLeaves(F,N,W,Q,he){const me=this.getChildren(N);for(const be of me){const le=be.properties;if(le&&le.cluster?he+le.point_count<=Q?he+=le.point_count:he=this._appendLeaves(F,le.cluster_id,W,Q,he):he<Q?he++:F.push(be),F.length===W)break}return he}_createTree(F){const N=new _.av(F.length/this.stride|0,this.options.nodeSize,Float32Array);for(let W=0;W<F.length;W+=this.stride)N.add(F[W],F[W+1]);return N.finish(),N.data=F,N}_addTileFeatures(F,N,W,Q,he,me){for(const be of F){const le=be*this.stride,Pe=N[le+Et]>1;let je,Ie,Ke;if(Pe)je=$t(N,le,this.clusterProps),Ie=N[le],Ke=N[le+1];else{const mi=this.points[N[le+We]];je=mi.properties;const[Zt,gi]=mi.geometry.coordinates;Ie=ai(Zt),Ke=fi(gi)}const At={type:1,geometry:[[Math.round(this.options.extent*(Ie*he-W)),Math.round(this.options.extent*(Ke*he-Q))]],tags:je};let Pt;Pt=Pe||this.options.generateId?N[le+We]:this.points[N[le+We]].id,Pt!==void 0&&(At.id=Pt),me.features.push(At)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,N){const{radius:W,extent:Q,reduce:he,minPoints:me}=this.options,be=W/(Q*Math.pow(2,N)),le=F.data,Pe=[],je=this.stride;for(let Ie=0;Ie<le.length;Ie+=je){if(le[Ie+2]<=N)continue;le[Ie+2]=N;const Ke=le[Ie],At=le[Ie+1],Pt=F.within(le[Ie],le[Ie+1],be),mi=le[Ie+Et];let Zt=mi;for(const gi of Pt){const oi=gi*je;le[oi+2]>N&&(Zt+=le[oi+Et])}if(Zt>mi&&Zt>=me){let gi,oi=Ke*mi,xn=At*mi,nn=-1;const ti=((Ie/je|0)<<5)+(N+1)+this.points.length;for(const Li of Pt){const en=Li*je;if(le[en+2]<=N)continue;le[en+2]=N;const Cn=le[en+Et];oi+=le[en]*Cn,xn+=le[en+1]*Cn,le[en+4]=ti,he&&(gi||(gi=this._map(le,Ie,!0),nn=this.clusterProps.length,this.clusterProps.push(gi)),he(gi,this._map(le,en)))}le[Ie+4]=ti,Pe.push(oi/Zt,xn/Zt,1/0,ti,-1,Zt),he&&Pe.push(nn)}else{for(let gi=0;gi<je;gi++)Pe.push(le[Ie+gi]);if(Zt>1)for(const gi of Pt){const oi=gi*je;if(!(le[oi+2]<=N)){le[oi+2]=N;for(let xn=0;xn<je;xn++)Pe.push(le[oi+xn])}}}}return Pe}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,N,W){if(F[N+Et]>1){const me=this.clusterProps[F[N+Nt]];return W?Object.assign({},me):me}const Q=this.points[F[N+We]].properties,he=this.options.map(Q);return W&&he===Q?Object.assign({},he):he}}function Xt(ie,F,N){return{type:"Feature",id:ie[F+We],properties:$t(ie,F,N),geometry:{type:"Point",coordinates:[(W=ie[F],360*(W-.5)),qt(ie[F+1])]}};var W}function $t(ie,F,N){const W=ie[F+Et],Q=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W,he=ie[F+Nt],me=he===-1?{}:Object.assign({},N[he]);return Object.assign(me,{cluster:!0,cluster_id:ie[F+We],point_count:W,point_count_abbreviated:Q})}function ai(ie){return ie/360+.5}function fi(ie){const F=Math.sin(ie*Math.PI/180),N=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return N<0?0:N>1?1:N}function qt(ie){const F=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function bi(ie,F,N,W){let Q=W;const he=F+(N-F>>1);let me,be=N-F;const le=ie[F],Pe=ie[F+1],je=ie[N],Ie=ie[N+1];for(let Ke=F+3;Ke<N;Ke+=3){const At=Yt(ie[Ke],ie[Ke+1],le,Pe,je,Ie);if(At>Q)me=Ke,Q=At;else if(At===Q){const Pt=Math.abs(Ke-he);Pt<be&&(me=Ke,be=Pt)}}Q>W&&(me-F>3&&bi(ie,F,me,W),ie[me+2]=Q,N-me>3&&bi(ie,me,N,W))}function Yt(ie,F,N,W,Q,he){let me=Q-N,be=he-W;if(me!==0||be!==0){const le=((ie-N)*me+(F-W)*be)/(me*me+be*be);le>1?(N=Q,W=he):le>0&&(N+=me*le,W+=be*le)}return me=ie-N,be=F-W,me*me+be*be}function Oi(ie,F,N,W){const Q={id:ie??null,type:F,geometry:N,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(F==="Point"||F==="MultiPoint"||F==="LineString")Qi(Q,N);else if(F==="Polygon")Qi(Q,N[0]);else if(F==="MultiLineString")for(const he of N)Qi(Q,he);else if(F==="MultiPolygon")for(const he of N)Qi(Q,he[0]);return Q}function Qi(ie,F){for(let N=0;N<F.length;N+=3)ie.minX=Math.min(ie.minX,F[N]),ie.minY=Math.min(ie.minY,F[N+1]),ie.maxX=Math.max(ie.maxX,F[N]),ie.maxY=Math.max(ie.maxY,F[N+1])}function hi(ie,F,N,W){if(!F.geometry)return;const Q=F.geometry.coordinates;if(Q&&Q.length===0)return;const he=F.geometry.type,me=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2);let be=[],le=F.id;if(N.promoteId?le=F.properties[N.promoteId]:N.generateId&&(le=W||0),he==="Point")xi(Q,be);else if(he==="MultiPoint")for(const Pe of Q)xi(Pe,be);else if(he==="LineString")Me(Q,be,me,!1);else if(he==="MultiLineString"){if(N.lineMetrics){for(const Pe of Q)be=[],Me(Pe,be,me,!1),ie.push(Oi(le,"LineString",be,F.properties));return}dn(Q,be,me,!1)}else if(he==="Polygon")dn(Q,be,me,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(const Pe of F.geometry.geometries)hi(ie,{id:le,geometry:Pe,properties:F.properties},N,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Pe of Q){const je=[];dn(Pe,je,me,!0),be.push(je)}}ie.push(Oi(le,he,be,F.properties))}function xi(ie,F){F.push(Ii(ie[0]),Kt(ie[1]),0)}function Me(ie,F,N,W){let Q,he,me=0;for(let le=0;le<ie.length;le++){const Pe=Ii(ie[le][0]),je=Kt(ie[le][1]);F.push(Pe,je,0),le>0&&(me+=W?(Q*je-Pe*he)/2:Math.sqrt(Math.pow(Pe-Q,2)+Math.pow(je-he,2))),Q=Pe,he=je}const be=F.length-3;F[2]=1,bi(F,0,be,N),F[be+2]=1,F.size=Math.abs(me),F.start=0,F.end=F.size}function dn(ie,F,N,W){for(let Q=0;Q<ie.length;Q++){const he=[];Me(ie[Q],he,N,W),F.push(he)}}function Ii(ie){return ie/360+.5}function Kt(ie){const F=Math.sin(ie*Math.PI/180),N=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return N<0?0:N>1?1:N}function Ei(ie,F,N,W,Q,he,me,be){if(W/=F,he>=(N/=F)&&me<W)return ie;if(me<N||he>=W)return null;const le=[];for(const Pe of ie){const je=Pe.geometry;let Ie=Pe.type;const Ke=Q===0?Pe.minX:Pe.minY,At=Q===0?Pe.maxX:Pe.maxY;if(Ke>=N&&At<W){le.push(Pe);continue}if(At<N||Ke>=W)continue;let Pt=[];if(Ie==="Point"||Ie==="MultiPoint")dr(je,Pt,N,W,Q);else if(Ie==="LineString")bn(je,Pt,N,W,Q,!1,be.lineMetrics);else if(Ie==="MultiLineString")Is(je,Pt,N,W,Q,!1);else if(Ie==="Polygon")Is(je,Pt,N,W,Q,!0);else if(Ie==="MultiPolygon")for(const mi of je){const Zt=[];Is(mi,Zt,N,W,Q,!0),Zt.length&&Pt.push(Zt)}if(Pt.length){if(be.lineMetrics&&Ie==="LineString"){for(const mi of Pt)le.push(Oi(Pe.id,Ie,mi,Pe.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(Pt.length===1?(Ie="LineString",Pt=Pt[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=Pt.length===3?"Point":"MultiPoint"),le.push(Oi(Pe.id,Ie,Pt,Pe.tags))}}return le.length?le:null}function dr(ie,F,N,W,Q){for(let he=0;he<ie.length;he+=3){const me=ie[he+Q];me>=N&&me<=W&&Qn(F,ie[he],ie[he+1],ie[he+2])}}function bn(ie,F,N,W,Q,he,me){let be=Jn(ie);const le=Q===0?xt:Tt;let Pe,je,Ie=ie.start;for(let Zt=0;Zt<ie.length-3;Zt+=3){const gi=ie[Zt],oi=ie[Zt+1],xn=ie[Zt+2],nn=ie[Zt+3],ti=ie[Zt+4],Li=Q===0?gi:oi,en=Q===0?nn:ti;let Cn=!1;me&&(Pe=Math.sqrt(Math.pow(gi-nn,2)+Math.pow(oi-ti,2))),Li<N?en>N&&(je=le(be,gi,oi,nn,ti,N),me&&(be.start=Ie+Pe*je)):Li>W?en<W&&(je=le(be,gi,oi,nn,ti,W),me&&(be.start=Ie+Pe*je)):Qn(be,gi,oi,xn),en<N&&Li>=N&&(je=le(be,gi,oi,nn,ti,N),Cn=!0),en>W&&Li<=W&&(je=le(be,gi,oi,nn,ti,W),Cn=!0),!he&&Cn&&(me&&(be.end=Ie+Pe*je),F.push(be),be=Jn(ie)),me&&(Ie+=Pe)}let Ke=ie.length-3;const At=ie[Ke],Pt=ie[Ke+1],mi=Q===0?At:Pt;mi>=N&&mi<=W&&Qn(be,At,Pt,ie[Ke+2]),Ke=be.length-3,he&&Ke>=3&&(be[Ke]!==be[0]||be[Ke+1]!==be[1])&&Qn(be,be[0],be[1],be[2]),be.length&&F.push(be)}function Jn(ie){const F=[];return F.size=ie.size,F.start=ie.start,F.end=ie.end,F}function Is(ie,F,N,W,Q,he){for(const me of ie)bn(me,F,N,W,Q,he,!1)}function Qn(ie,F,N,W){ie.push(F,N,W)}function xt(ie,F,N,W,Q,he){const me=(he-F)/(W-F);return Qn(ie,he,N+(Q-N)*me,1),me}function Tt(ie,F,N,W,Q,he){const me=(he-N)/(Q-N);return Qn(ie,F+(W-F)*me,he,1),me}function ze(ie,F){const N=[];for(let W=0;W<ie.length;W++){const Q=ie[W],he=Q.type;let me;if(he==="Point"||he==="MultiPoint"||he==="LineString")me=jt(Q.geometry,F);else if(he==="MultiLineString"||he==="Polygon"){me=[];for(const be of Q.geometry)me.push(jt(be,F))}else if(he==="MultiPolygon"){me=[];for(const be of Q.geometry){const le=[];for(const Pe of be)le.push(jt(Pe,F));me.push(le)}}N.push(Oi(Q.id,he,me,Q.tags))}return N}function jt(ie,F){const N=[];N.size=ie.size,ie.start!==void 0&&(N.start=ie.start,N.end=ie.end);for(let W=0;W<ie.length;W+=3)N.push(ie[W]+F,ie[W+1],ie[W+2]);return N}function Ut(ie,F){if(ie.transformed)return ie;const N=1<<ie.z,W=ie.x,Q=ie.y;for(const he of ie.features){const me=he.geometry,be=he.type;if(he.geometry=[],be===1)for(let le=0;le<me.length;le+=2)he.geometry.push(Qt(me[le],me[le+1],F,N,W,Q));else for(let le=0;le<me.length;le++){const Pe=[];for(let je=0;je<me[le].length;je+=2)Pe.push(Qt(me[le][je],me[le][je+1],F,N,W,Q));he.geometry.push(Pe)}}return ie.transformed=!0,ie}function Qt(ie,F,N,W,Q,he){return[Math.round(N*(ie*W-Q)),Math.round(N*(F*W-he))]}function Bi(ie,F,N,W,Q){const he=F===Q.maxZoom?0:Q.tolerance/((1<<F)*Q.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:ie.length,source:null,x:N,y:W,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const be of ie)Ze(me,be,he,Q);return me}function Ze(ie,F,N,W){const Q=F.geometry,he=F.type,me=[];if(ie.minX=Math.min(ie.minX,F.minX),ie.minY=Math.min(ie.minY,F.minY),ie.maxX=Math.max(ie.maxX,F.maxX),ie.maxY=Math.max(ie.maxY,F.maxY),he==="Point"||he==="MultiPoint")for(let be=0;be<Q.length;be+=3)me.push(Q[be],Q[be+1]),ie.numPoints++,ie.numSimplified++;else if(he==="LineString")Dt(me,Q,ie,N,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(let be=0;be<Q.length;be++)Dt(me,Q[be],ie,N,he==="Polygon",be===0);else if(he==="MultiPolygon")for(let be=0;be<Q.length;be++){const le=Q[be];for(let Pe=0;Pe<le.length;Pe++)Dt(me,le[Pe],ie,N,!0,Pe===0)}if(me.length){let be=F.tags||null;if(he==="LineString"&&W.lineMetrics){be={};for(const Pe in F.tags)be[Pe]=F.tags[Pe];be.mapbox_clip_start=Q.start/Q.size,be.mapbox_clip_end=Q.end/Q.size}const le={geometry:me,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:be};F.id!==null&&(le.id=F.id),ie.features.push(le)}}function Dt(ie,F,N,W,Q,he){const me=W*W;if(W>0&&F.size<(Q?me:W))return void(N.numPoints+=F.length/3);const be=[];for(let le=0;le<F.length;le+=3)(W===0||F[le+2]>me)&&(N.numSimplified++,be.push(F[le],F[le+1])),N.numPoints++;Q&&function(le,Pe){let je=0;for(let Ie=0,Ke=le.length,At=Ke-2;Ie<Ke;At=Ie,Ie+=2)je+=(le[Ie]-le[At])*(le[Ie+1]+le[At+1]);if(je>0===Pe)for(let Ie=0,Ke=le.length;Ie<Ke/2;Ie+=2){const At=le[Ie],Pt=le[Ie+1];le[Ie]=le[Ke-2-Ie],le[Ie+1]=le[Ke-1-Ie],le[Ke-2-Ie]=At,le[Ke-1-Ie]=Pt}}(be,he),ie.push(be)}const kt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Di{constructor(F,N){const W=(N=this.options=function(he,me){for(const be in me)he[be]=me[be];return he}(Object.create(kt),N)).debug;if(W&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");let Q=function(he,me){const be=[];if(he.type==="FeatureCollection")for(let le=0;le<he.features.length;le++)hi(be,he.features[le],me,le);else hi(be,he.type==="Feature"?he:{geometry:he},me);return be}(F,N);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Q=function(he,me){const be=me.buffer/me.extent;let le=he;const Pe=Ei(he,1,-1-be,be,0,-1,2,me),je=Ei(he,1,1-be,2+be,0,-1,2,me);return(Pe||je)&&(le=Ei(he,1,-be,1+be,0,-1,2,me)||[],Pe&&(le=ze(Pe,1).concat(le)),je&&(le=le.concat(ze(je,-1)))),le}(Q,N),Q.length&&this.splitTile(Q,0,0,0),W&&(Q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(F,N,W,Q,he,me,be){const le=[F,N,W,Q],Pe=this.options,je=Pe.debug;for(;le.length;){Q=le.pop(),W=le.pop(),N=le.pop(),F=le.pop();const Ie=1<<N,Ke=Fn(N,W,Q);let At=this.tiles[Ke];if(!At&&(je>1&&console.time("creation"),At=this.tiles[Ke]=Bi(F,N,W,Q,Pe),this.tileCoords.push({z:N,x:W,y:Q}),je)){je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,W,Q,At.numFeatures,At.numPoints,At.numSimplified),console.timeEnd("creation"));const Cn=`z${N}`;this.stats[Cn]=(this.stats[Cn]||0)+1,this.total++}if(At.source=F,he==null){if(N===Pe.indexMaxZoom||At.numPoints<=Pe.indexMaxPoints)continue}else{if(N===Pe.maxZoom||N===he)continue;if(he!=null){const Cn=he-N;if(W!==me>>Cn||Q!==be>>Cn)continue}}if(At.source=null,F.length===0)continue;je>1&&console.time("clipping");const Pt=.5*Pe.buffer/Pe.extent,mi=.5-Pt,Zt=.5+Pt,gi=1+Pt;let oi=null,xn=null,nn=null,ti=null,Li=Ei(F,Ie,W-Pt,W+Zt,0,At.minX,At.maxX,Pe),en=Ei(F,Ie,W+mi,W+gi,0,At.minX,At.maxX,Pe);F=null,Li&&(oi=Ei(Li,Ie,Q-Pt,Q+Zt,1,At.minY,At.maxY,Pe),xn=Ei(Li,Ie,Q+mi,Q+gi,1,At.minY,At.maxY,Pe),Li=null),en&&(nn=Ei(en,Ie,Q-Pt,Q+Zt,1,At.minY,At.maxY,Pe),ti=Ei(en,Ie,Q+mi,Q+gi,1,At.minY,At.maxY,Pe),en=null),je>1&&console.timeEnd("clipping"),le.push(oi||[],N+1,2*W,2*Q),le.push(xn||[],N+1,2*W,2*Q+1),le.push(nn||[],N+1,2*W+1,2*Q),le.push(ti||[],N+1,2*W+1,2*Q+1)}}getTile(F,N,W){F=+F,N=+N,W=+W;const Q=this.options,{extent:he,debug:me}=Q;if(F<0||F>24)return null;const be=1<<F,le=Fn(F,N=N+be&be-1,W);if(this.tiles[le])return Ut(this.tiles[le],he);me>1&&console.log("drilling down to z%d-%d-%d",F,N,W);let Pe,je=F,Ie=N,Ke=W;for(;!Pe&&je>0;)je--,Ie>>=1,Ke>>=1,Pe=this.tiles[Fn(je,Ie,Ke)];return Pe&&Pe.source?(me>1&&(console.log("found parent tile z%d-%d-%d",je,Ie,Ke),console.time("drilling down")),this.splitTile(Pe.source,je,Ie,Ke,F,N,W),me>1&&console.timeEnd("drilling down"),this.tiles[le]?Ut(this.tiles[le],he):null):null}}function Fn(ie,F,N){return 32*((1<<ie)*N+F)+ie}function Rt(ie,F){return F?ie.properties[F]:ie.id}function Mn(ie,F){if(ie==null)return!0;if(ie.type==="Feature")return Rt(ie,F)!=null;if(ie.type==="FeatureCollection"){const N=new Set;for(const W of ie.features){const Q=Rt(W,F);if(Q==null||N.has(Q))return!1;N.add(Q)}return!0}return!1}function Mr(ie,F){const N=new Map;if(ie!=null)if(ie.type==="Feature")N.set(Rt(ie,F),ie);else for(const W of ie.features)N.set(Rt(W,F),W);return N}class Ur extends R{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(F,N){return _._(this,void 0,void 0,function*(){const W=F.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Q=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!Q)return null;const he=new class{constructor(be){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=_.X,this.length=be.length,this._features=be}feature(be){return new class{constructor(le){this._feature=le,this.extent=_.X,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(this._feature.type===1){const le=[];for(const Pe of this._feature.geometry)le.push([new _.P(Pe[0],Pe[1])]);return le}{const le=[];for(const Pe of this._feature.geometry){const je=[];for(const Ie of Pe)je.push(new _.P(Ie[0],Ie[1]));le.push(je)}return le}}toGeoJSON(le,Pe,je){return ae.call(this,le,Pe,je)}}(this._features[be])}}(Q.features);let me=Ue(he);return me.byteOffset===0&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),{vectorTile:he,rawData:me.buffer}})}loadData(F){return _._(this,void 0,void 0,function*(){var N;(N=this._pendingRequest)===null||N===void 0||N.abort();const W=!!(F&&F.request&&F.request.collectResourceTiming)&&new _.bv(F.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(F,this._pendingRequest),this._geoJSONIndex=F.cluster?new _t(function({superclusterOptions:me,clusterProperties:be}){if(!be||!me)return me;const le={},Pe={},je={accumulated:null,zoom:0},Ie={properties:null},Ke=Object.keys(be);for(const At of Ke){const[Pt,mi]=be[At],Zt=_.bC(mi),gi=_.bC(typeof Pt=="string"?[Pt,["accumulated"],["get",At]]:Pt);le[At]=Zt.value,Pe[At]=gi.value}return me.map=At=>{Ie.properties=At;const Pt={};for(const mi of Ke)Pt[mi]=le[mi].evaluate(je,Ie);return Pt},me.reduce=(At,Pt)=>{Ie.properties=Pt;for(const mi of Ke)je.accumulated=At[mi],At[mi]=Pe[mi].evaluate(je,Ie)},me}(F)).load((yield this._pendingData).features):(Q=yield this._pendingData,new Di(Q,F.geojsonVtOptions)),this.loaded={};const he={};if(W){const me=W.finish();me&&(he.resourceTiming={},he.resourceTiming[F.source]=JSON.parse(JSON.stringify(me)))}return he}catch(he){if(delete this._pendingRequest,_.bB(he))return{abandoned:!0};throw he}var Q})}getData(){return _._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(F){const N=this.loaded;return N&&N[F.uid]?super.reloadTile(F):this.loadTile(F)}loadAndProcessGeoJSON(F,N){return _._(this,void 0,void 0,function*(){let W=yield this.loadGeoJSON(F,N);if(delete this._pendingRequest,typeof W!="object")throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(H(W,!0),F.filter){const Q=_.bC(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map(me=>`${me.key}: ${me.message}`).join(", "));W={type:"FeatureCollection",features:W.features.filter(me=>Q.value.evaluate({zoom:0},me))}}return W})}loadGeoJSON(F,N){return _._(this,void 0,void 0,function*(){const{promoteId:W}=F;if(F.request){const Q=yield _.h(F.request,N);return this._dataUpdateable=Mn(Q.data,W)?Mr(Q.data,W):void 0,Q.data}if(typeof F.data=="string")try{const Q=JSON.parse(F.data);return this._dataUpdateable=Mn(Q,W)?Mr(Q,W):void 0,Q}catch{throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`)}if(!F.dataDiff)throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${F.source}`);return function(Q,he,me){var be,le,Pe,je;if(he.removeAll&&Q.clear(),he.remove)for(const Ie of he.remove)Q.delete(Ie);if(he.add)for(const Ie of he.add){const Ke=Rt(Ie,me);Ke!=null&&Q.set(Ke,Ie)}if(he.update)for(const Ie of he.update){let Ke=Q.get(Ie.id);if(Ke==null)continue;const At=!Ie.removeAllProperties&&(((be=Ie.removeProperties)===null||be===void 0?void 0:be.length)>0||((le=Ie.addOrUpdateProperties)===null||le===void 0?void 0:le.length)>0);if((Ie.newGeometry||Ie.removeAllProperties||At)&&(Ke=Object.assign({},Ke),Q.set(Ie.id,Ke),At&&(Ke.properties=Object.assign({},Ke.properties))),Ie.newGeometry&&(Ke.geometry=Ie.newGeometry),Ie.removeAllProperties)Ke.properties={};else if(((Pe=Ie.removeProperties)===null||Pe===void 0?void 0:Pe.length)>0)for(const Pt of Ie.removeProperties)Object.prototype.hasOwnProperty.call(Ke.properties,Pt)&&delete Ke.properties[Pt];if(((je=Ie.addOrUpdateProperties)===null||je===void 0?void 0:je.length)>0)for(const{key:Pt,value:mi}of Ie.addOrUpdateProperties)Ke.properties[Pt]=mi}}(this._dataUpdateable,F.dataDiff,W),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(F){return _._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(F){return this._geoJSONIndex.getClusterExpansionZoom(F.clusterId)}getClusterChildren(F){return this._geoJSONIndex.getChildren(F.clusterId)}getClusterLeaves(F){return this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset)}}class En{constructor(F){this.self=F,this.actor=new _.F(F),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(N,W)=>{if(this.externalWorkerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.externalWorkerSourceTypes[N]=W},this.self.addProtocol=_.bi,this.self.removeProtocol=_.bj,this.self.registerRTLTextPlugin=N=>{if(_.bD.isParsed())throw new Error("RTL text plugin already registered.");_.bD.setMethods(N)},this.actor.registerMessageHandler("LDT",(N,W)=>this._getDEMWorkerSource(N,W.source).loadTile(W)),this.actor.registerMessageHandler("RDT",(N,W)=>_._(this,void 0,void 0,function*(){this._getDEMWorkerSource(N,W.source).removeTile(W)})),this.actor.registerMessageHandler("GCEZ",(N,W)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(N,W.type,W.source).getClusterExpansionZoom(W)})),this.actor.registerMessageHandler("GCC",(N,W)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(N,W.type,W.source).getClusterChildren(W)})),this.actor.registerMessageHandler("GCL",(N,W)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(N,W.type,W.source).getClusterLeaves(W)})),this.actor.registerMessageHandler("LD",(N,W)=>this._getWorkerSource(N,W.type,W.source).loadData(W)),this.actor.registerMessageHandler("GD",(N,W)=>this._getWorkerSource(N,W.type,W.source).getData()),this.actor.registerMessageHandler("LT",(N,W)=>this._getWorkerSource(N,W.type,W.source).loadTile(W)),this.actor.registerMessageHandler("RT",(N,W)=>this._getWorkerSource(N,W.type,W.source).reloadTile(W)),this.actor.registerMessageHandler("AT",(N,W)=>this._getWorkerSource(N,W.type,W.source).abortTile(W)),this.actor.registerMessageHandler("RMT",(N,W)=>this._getWorkerSource(N,W.type,W.source).removeTile(W)),this.actor.registerMessageHandler("RS",(N,W)=>_._(this,void 0,void 0,function*(){if(!this.workerSources[N]||!this.workerSources[N][W.type]||!this.workerSources[N][W.type][W.source])return;const Q=this.workerSources[N][W.type][W.source];delete this.workerSources[N][W.type][W.source],Q.removeSource!==void 0&&Q.removeSource(W)})),this.actor.registerMessageHandler("RM",N=>_._(this,void 0,void 0,function*(){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N]})),this.actor.registerMessageHandler("SR",(N,W)=>_._(this,void 0,void 0,function*(){this.referrer=W})),this.actor.registerMessageHandler("SRPS",(N,W)=>this._syncRTLPluginState(N,W)),this.actor.registerMessageHandler("IS",(N,W)=>_._(this,void 0,void 0,function*(){this.self.importScripts(W)})),this.actor.registerMessageHandler("SI",(N,W)=>this._setImages(N,W)),this.actor.registerMessageHandler("UL",(N,W)=>_._(this,void 0,void 0,function*(){this._getLayerIndex(N).update(W.layers,W.removedIds)})),this.actor.registerMessageHandler("SL",(N,W)=>_._(this,void 0,void 0,function*(){this._getLayerIndex(N).replace(W)}))}_setImages(F,N){return _._(this,void 0,void 0,function*(){this.availableImages[F]=N;for(const W in this.workerSources[F]){const Q=this.workerSources[F][W];for(const he in Q)Q[he].availableImages=N}})}_syncRTLPluginState(F,N){return _._(this,void 0,void 0,function*(){if(_.bD.isParsed())return _.bD.getState();if(N.pluginStatus!=="loading")return _.bD.setState(N),N;const W=N.pluginURL;if(this.self.importScripts(W),_.bD.isParsed()){const Q={pluginStatus:"loaded",pluginURL:W};return _.bD.setState(Q),Q}throw _.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${W}`)})}_getAvailableImages(F){let N=this.availableImages[F];return N||(N=[]),N}_getLayerIndex(F){let N=this.layerIndexes[F];return N||(N=this.layerIndexes[F]=new c),N}_getWorkerSource(F,N,W){if(this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][N]||(this.workerSources[F][N]={}),!this.workerSources[F][N][W]){const Q={sendAsync:(he,me)=>(he.targetMapId=F,this.actor.sendAsync(he,me))};switch(N){case"vector":this.workerSources[F][N][W]=new R(Q,this._getLayerIndex(F),this._getAvailableImages(F));break;case"geojson":this.workerSources[F][N][W]=new Ur(Q,this._getLayerIndex(F),this._getAvailableImages(F));break;default:this.workerSources[F][N][W]=new this.externalWorkerSourceTypes[N](Q,this._getLayerIndex(F),this._getAvailableImages(F))}}return this.workerSources[F][N][W]}_getDEMWorkerSource(F,N){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][N]||(this.demWorkerSources[F][N]=new C),this.demWorkerSources[F][N]}}return _.i(self)&&(self.worker=new En(self)),En}),p("index",["exports","./shared"],function(_,c){var A="4.7.1";let O,B;const R={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:g=>new Promise((e,a)=>{const u=requestAnimationFrame(e);g.signal.addEventListener("abort",()=>{cancelAnimationFrame(u),a(c.c())})}),getImageData(g,e=0){return this.getImageCanvasContext(g).getImageData(-e,-e,g.width+2*e,g.height+2*e)},getImageCanvasContext(g){const e=window.document.createElement("canvas"),a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return e.width=g.width,e.height=g.height,a.drawImage(g,0,0,g.width,g.height),a},resolveURL:g=>(O||(O=document.createElement("a")),O.href=g,O.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(B==null&&(B=matchMedia("(prefers-reduced-motion: reduce)")),B.matches)}};class C{static testProp(e){if(!C.docStyle)return e[0];for(let a=0;a<e.length;a++)if(e[a]in C.docStyle)return e[a];return e[0]}static create(e,a,u){const d=window.document.createElement(e);return a!==void 0&&(d.className=a),u&&u.appendChild(d),d}static createNS(e,a){return window.document.createElementNS(e,a)}static disableDrag(){C.docStyle&&C.selectProp&&(C.userSelect=C.docStyle[C.selectProp],C.docStyle[C.selectProp]="none")}static enableDrag(){C.docStyle&&C.selectProp&&(C.docStyle[C.selectProp]=C.userSelect)}static setTransform(e,a){e.style[C.transformProp]=a}static addEventListener(e,a,u,d={}){e.addEventListener(a,u,"passive"in d?d:d.capture)}static removeEventListener(e,a,u,d={}){e.removeEventListener(a,u,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",C.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",C.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",C.suppressClickInternal,!0)},0)}static getScale(e){const a=e.getBoundingClientRect();return{x:a.width/e.offsetWidth||1,y:a.height/e.offsetHeight||1,boundingClientRect:a}}static getPoint(e,a,u){const d=a.boundingClientRect;return new c.P((u.clientX-d.left)/a.x-e.clientLeft,(u.clientY-d.top)/a.y-e.clientTop)}static mousePos(e,a){const u=C.getScale(e);return C.getPoint(e,u,a)}static touchPos(e,a){const u=[],d=C.getScale(e);for(let m=0;m<a.length;m++)u.push(C.getPoint(e,d,a[m]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}C.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,C.selectProp=C.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),C.transformProp=C.testProp(["transform","WebkitTransform"]);const Y={supported:!1,testSupport:function(g){!ae&&H&&(Z?te(g):X=g)}};let X,H,ae=!1,Z=!1;function te(g){const e=g.createTexture();g.bindTexture(g.TEXTURE_2D,e);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,H),g.isContextLost())return;Y.supported=!0}catch{}g.deleteTexture(e),ae=!0}var ne;typeof document<"u"&&(H=document.createElement("img"),H.onload=()=>{X&&te(X),X=null,Z=!0},H.onerror=()=>{ae=!0,X=null},H.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let e,a,u,d;g.resetRequestQueue=()=>{e=[],a=0,u=0,d={}},g.addThrottleControl=k=>{const E=u++;return d[E]=k,E},g.removeThrottleControl=k=>{delete d[k],w()},g.getImage=(k,E,z=!0)=>new Promise((D,j)=>{Y.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),c.e(k,{type:"image"}),e.push({abortController:E,requestParameters:k,supportImageRefresh:z,state:"queued",onError:q=>{j(q)},onSuccess:q=>{D(q)}}),w()});const m=k=>c._(this,void 0,void 0,function*(){k.state="running";const{requestParameters:E,supportImageRefresh:z,onError:D,onSuccess:j,abortController:q}=k,G=z===!1&&!c.i(self)&&!c.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce((oe,ce)=>oe&&ce==="accept",!0));a++;const ee=G?S(E,q):c.m(E,q);try{const oe=yield ee;delete k.abortController,k.state="completed",oe.data instanceof HTMLImageElement||c.b(oe.data)?j(oe):oe.data&&j({data:yield(se=oe.data,typeof createImageBitmap=="function"?c.d(se):c.f(se)),cacheControl:oe.cacheControl,expires:oe.expires})}catch(oe){delete k.abortController,D(oe)}finally{a--,w()}var se}),w=()=>{const k=(()=>{for(const E of Object.keys(d))if(d[E]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=a;E<k&&e.length>0;E++){const z=e.shift();z.abortController.signal.aborted?E--:m(z)}},S=(k,E)=>new Promise((z,D)=>{const j=new Image,q=k.url,G=k.credentials;G&&G==="include"?j.crossOrigin="use-credentials":(G&&G==="same-origin"||!c.s(q))&&(j.crossOrigin="anonymous"),E.signal.addEventListener("abort",()=>{j.src="",D(c.c())}),j.fetchPriority="high",j.onload=()=>{j.onerror=j.onload=null,z({data:j})},j.onerror=()=>{j.onerror=j.onload=null,E.signal.aborted||D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},j.src=q})}(ne||(ne={})),ne.resetRequestQueue();class _e{constructor(e){this._transformRequestFn=e}transformRequest(e,a){return this._transformRequestFn&&this._transformRequestFn(e,a)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ve(g){var e=new c.A(3);return e[0]=g[0],e[1]=g[1],e[2]=g[2],e}var Se,de=function(g,e,a){return g[0]=e[0]-a[0],g[1]=e[1]-a[1],g[2]=e[2]-a[2],g};Se=new c.A(3),c.A!=Float32Array&&(Se[0]=0,Se[1]=0,Se[2]=0);var Fe=function(g){var e=g[0],a=g[1];return e*e+a*a};function Re(g){const e=[];if(typeof g=="string")e.push({id:"default",url:g});else if(g&&g.length>0){const a=[];for(const{id:u,url:d}of g){const m=`${u}${d}`;a.indexOf(m)===-1&&(a.push(m),e.push({id:u,url:d}))}}return e}function Le(g,e,a){const u=g.split("?");return u[0]+=`${e}${a}`,u.join("?")}(function(){var g=new c.A(2);c.A!=Float32Array&&(g[0]=0,g[1]=0)})();class Te{constructor(e,a,u,d){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(a,d)}update(e,a,u){const{width:d,height:m}=e,w=!(this.size&&this.size[0]===d&&this.size[1]===m||u),{context:S}=this,{gl:k}=S;if(this.useMipmap=!!(a&&a.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!a||a.premultiply!==!1)),w)this.size=[d,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,e):k.texImage2D(k.TEXTURE_2D,0,this.format,d,m,0,this.format,k.UNSIGNED_BYTE,e.data);else{const{x:E,y:z}=u||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?k.texSubImage2D(k.TEXTURE_2D,0,E,z,k.RGBA,k.UNSIGNED_BYTE,e):k.texSubImage2D(k.TEXTURE_2D,0,E,z,d,m,k.RGBA,k.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)}bind(e,a,u){const{context:d}=this,{gl:m}=d;m.bindTexture(m.TEXTURE_2D,this.texture),u!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,u||e),this.filter=e),a!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function we(g){const{userImage:e}=g;return!!(e&&e.render&&e.render())&&(g.data.replace(new Uint8Array(e.data.buffer)),!0)}class fe extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:a,promiseResolve:u}of this.requestors)u(this._getImagesForIds(a));this.requestors=[]}}getImage(e){const a=this.images[e];if(a&&!a.data&&a.spriteData){const u=a.spriteData;a.data=new c.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),a.spriteData=null}return a}addImage(e,a){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,a)&&(this.images[e]=a)}_validate(e,a){let u=!0;const d=a.data||a.spriteData;return this._validateStretch(a.stretchX,d&&d.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(a.stretchY,d&&d.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(a.content,a)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,a){if(!e)return!0;let u=0;for(const d of e){if(d[0]<u||d[1]<d[0]||a<d[1])return!1;u=d[1]}return!0}_validateContent(e,a){if(!e)return!0;if(e.length!==4)return!1;const u=a.spriteData,d=u&&u.width||a.data.width,m=u&&u.height||a.data.height;return!(e[0]<0||d<e[0]||e[1]<0||m<e[1]||e[2]<0||d<e[2]||e[3]<0||m<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,a,u=!0){const d=this.getImage(e);if(u&&(d.data.width!==a.data.width||d.data.height!==a.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=d.version+1,this.images[e]=a,this.updatedImages[e]=!0}removeImage(e){const a=this.images[e];delete this.images[e],delete this.patterns[e],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((a,u)=>{let d=!0;if(!this.isLoaded())for(const m of e)this.images[m]||(d=!1);this.isLoaded()||d?a(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:a})})}_getImagesForIds(e){const a={};for(const u of e){let d=this.getImage(u);d||(this.fire(new c.k("styleimagemissing",{id:u})),d=this.getImage(u)),d?a[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:c.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:e,height:a}=this.atlasImage;return{width:e,height:a}}getPattern(e){const a=this.patterns[e],u=this.getImage(e);if(!u)return null;if(a&&a.position.version===u.version)return a.position;if(a)a.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},m=new c.I(d,u);this.patterns[e]={bin:d,position:m}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const a=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Te(e,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const m in this.patterns)e.push(this.patterns[m].bin);const{w:a,h:u}=c.p(e),d=this.atlasImage;d.resize({width:a||1,height:u||1});for(const m in this.patterns){const{bin:w}=this.patterns[m],S=w.x+1,k=w.y+1,E=this.getImage(m).data,z=E.width,D=E.height;c.R.copy(E,d,{x:0,y:0},{x:S,y:k},{width:z,height:D}),c.R.copy(E,d,{x:0,y:D-1},{x:S,y:k-1},{width:z,height:1}),c.R.copy(E,d,{x:0,y:0},{x:S,y:k+D},{width:z,height:1}),c.R.copy(E,d,{x:z-1,y:0},{x:S-1,y:k},{width:1,height:D}),c.R.copy(E,d,{x:0,y:0},{x:S+z,y:k},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const a of e){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const u=this.getImage(a);u||c.w(`Image with ID: "${a}" was not found`),we(u)&&this.updateImage(a,u)}}}const Ae=1e20;function Ce(g,e,a,u,d,m,w,S,k){for(let E=e;E<e+u;E++)Ve(g,a*m+E,m,d,w,S,k);for(let E=a;E<a+d;E++)Ve(g,E*m+e,1,u,w,S,k)}function Ve(g,e,a,u,d,m,w){m[0]=0,w[0]=-Ae,w[1]=Ae,d[0]=g[e];for(let S=1,k=0,E=0;S<u;S++){d[S]=g[e+S*a];const z=S*S;do{const D=m[k];E=(d[S]-d[D]+z-D*D)/(S-D)/2}while(E<=w[k]&&--k>-1);k++,m[k]=S,w[k]=E,w[k+1]=Ae}for(let S=0,k=0;S<u;S++){for(;w[k+1]<S;)k++;const E=m[k],z=S-E;g[e+S*a]=d[E]+z*z}}class Ue{constructor(e,a){this.requestManager=e,this.localIdeographFontFamily=a,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const a=[];for(const m in e)for(const w of e[m])a.push(this._getAndCacheGlyphsPromise(m,w));const u=yield Promise.all(a),d={};for(const{stack:m,id:w,glyph:S}of u)d[m]||(d[m]={}),d[m][w]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return d})}_getAndCacheGlyphsPromise(e,a){return c._(this,void 0,void 0,function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=u.glyphs[a];if(d!==void 0)return{stack:e,id:a,glyph:d};if(d=this._tinySDF(u,e,a),d)return u.glyphs[a]=d,{stack:e,id:a,glyph:d};const m=Math.floor(a/256);if(256*m>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[m])return{stack:e,id:a,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[m]){const S=Ue.loadGlyphRange(e,m,this.url,this.requestManager);u.requests[m]=S}const w=yield u.requests[m];for(const S in w)this._doesCharSupportLocalGlyph(+S)||(u.glyphs[+S]=w[+S]);return u.ranges[m]=!0,{stack:e,id:a,glyph:w[a]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,a,u){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let m=e.tinySDF;if(!m){let S="400";/bold/i.test(a)?S="900":/medium/i.test(a)?S="500":/light/i.test(a)&&(S="200"),m=e.tinySDF=new Ue.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:S})}const w=m.draw(String.fromCharCode(u));return{id:u,bitmap:new c.o({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ue.loadGlyphRange=function(g,e,a,u){return c._(this,void 0,void 0,function*(){const d=256*e,m=d+255,w=u.transformRequest(a.replace("{fontstack}",g).replace("{range}",`${d}-${m}`),"Glyphs"),S=yield c.l(w,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${m}`);const k={};for(const E of c.n(S.data))k[E.id]=E;return k})},Ue.TinySDF=class{constructor({fontSize:g=24,buffer:e=3,radius:a=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:m="normal",fontStyle:w="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=a;const S=this.size=g+4*e,k=this._createCanvas(S),E=this.ctx=k.getContext("2d",{willReadFrequently:!0});E.font=`${w} ${m} ${g}px ${d}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(g){const e=document.createElement("canvas");return e.width=e.height=g,e}draw(g){const{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:m}=this.ctx.measureText(g),w=Math.ceil(a),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-d))),k=Math.min(this.size-this.buffer,w+Math.ceil(u)),E=S+2*this.buffer,z=k+2*this.buffer,D=Math.max(E*z,0),j=new Uint8ClampedArray(D),q={data:j,width:E,height:z,glyphWidth:S,glyphHeight:k,glyphTop:w,glyphLeft:0,glyphAdvance:e};if(S===0||k===0)return q;const{ctx:G,buffer:ee,gridInner:se,gridOuter:oe}=this;G.clearRect(ee,ee,S,k),G.fillText(g,ee,ee+w);const ce=G.getImageData(ee,ee,S,k);oe.fill(Ae,0,D),se.fill(0,0,D);for(let K=0;K<k;K++)for(let pe=0;pe<S;pe++){const ge=ce.data[4*(K*S+pe)+3]/255;if(ge===0)continue;const ke=(K+ee)*E+pe+ee;if(ge===1)oe[ke]=0,se[ke]=Ae;else{const $e=.5-ge;oe[ke]=$e>0?$e*$e:0,se[ke]=$e<0?$e*$e:0}}Ce(oe,0,0,E,z,E,this.f,this.v,this.z),Ce(se,ee,ee,S,k,E,this.f,this.v,this.z);for(let K=0;K<D;K++){const pe=Math.sqrt(oe[K])-Math.sqrt(se[K]);j[K]=Math.round(255-255*(pe/this.radius+this.cutoff))}return q}};class Ge{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,a){return c.x(e.expression.evaluate(a))}interpolate(e,a,u){return{x:c.y.number(e.x,a.x,u),y:c.y.number(e.y,a.y,u),z:c.y.number(e.z,a.z,u)}}}let Oe;class Xe extends c.E{constructor(e){super(),Oe=Oe||new c.q({anchor:new c.D(c.v.light.anchor),position:new Ge,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(Oe),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,a={}){if(!this._validate(c.r,e,a))for(const u in e){const d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,u){return(!u||u.validate!==!1)&&c.t(this,e.call(c.u,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const We=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class Et extends c.E{constructor(e){super(),this._transitionable=new c.T(We),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,a={}){if(!this._validate(c.B,e,a)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,u={}){return(u==null?void 0:u.validate)!==!1&&c.t(this,e.call(c.u,c.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Nt{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,a){const u=e.join(",")+String(a);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,a)),this.dashEntry[u]}getDashRanges(e,a,u){const d=[];let m=e.length%2==1?-e[e.length-1]*u:0,w=e[0]*u,S=!0;d.push({left:m,right:w,isDash:S,zeroLength:e[0]===0});let k=e[0];for(let E=1;E<e.length;E++){S=!S;const z=e[E];m=k*u,k+=z,w=k*u,d.push({left:m,right:w,isDash:S,zeroLength:z===0})}return d}addRoundDash(e,a,u){const d=a/2;for(let m=-u;m<=u;m++){const w=this.width*(this.nextRow+u+m);let S=0,k=e[S];for(let E=0;E<this.width;E++){E/k.right>1&&(k=e[++S]);const z=Math.abs(E-k.left),D=Math.abs(E-k.right),j=Math.min(z,D);let q;const G=m/u*(d+1);if(k.isDash){const ee=d-Math.abs(G);q=Math.sqrt(j*j+ee*ee)}else q=d-Math.sqrt(j*j+G*G);this.data[w+E]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){const k=e[S],E=e[S+1];k.zeroLength?e.splice(S,1):E&&E.isDash===k.isDash&&(E.left=k.left,e.splice(S,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const d=this.width*this.nextRow;let m=0,w=e[m];for(let S=0;S<this.width;S++){S/w.right>1&&(w=e[++m]);const k=Math.abs(S-w.left),E=Math.abs(S-w.right),z=Math.min(k,E);this.data[d+S]=Math.max(0,Math.min(255,(w.isDash?z:-z)+128))}}addDash(e,a){const u=a?7:0,d=2*u+1;if(this.nextRow+d>this.height)return c.w("LineAtlas out of space"),null;let m=0;for(let S=0;S<e.length;S++)m+=e[S];if(m!==0){const S=this.width/m,k=this.getDashRanges(e,this.width,S);a?this.addRoundDash(k,S,u):this.addRegularDash(k)}const w={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:m};return this.nextRow+=d,this.dirty=!0,w}bind(e){const a=e.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const _t="maplibre_preloaded_worker_pool";class Xt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Xt.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_t]}numActive(){return Object.keys(this.active).length}}const $t=Math.floor(R.hardwareConcurrency/2);let ai,fi;function qt(){return ai||(ai=new Xt),ai}Xt.workerCount=c.C(globalThis)?Math.max(Math.min($t,3),1):1;class bi{constructor(e,a){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a;const u=this.workerPool.acquire(a);for(let d=0;d<u.length;d++){const m=new c.F(u[d],a);m.name=`Worker ${d}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,a){const u=[];for(const d of this.actors)u.push(d.sendAsync({type:e,data:a}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,a){for(const u of this.actors)u.registerMessageHandler(e,a)}}function Yt(){return fi||(fi=new bi(qt(),c.G),fi.registerMessageHandler("GR",(g,e,a)=>c.m(e,a))),fi}function Oi(g,e){const a=c.H();return c.J(a,a,[1,1,0]),c.K(a,a,[.5*g.width,.5*g.height,1]),c.L(a,a,g.calculatePosMatrix(e.toUnwrapped()))}function Qi(g,e,a,u,d,m){const w=function(D,j,q){if(D)for(const G of D){const ee=j[G];if(ee&&ee.source===q&&ee.type==="fill-extrusion")return!0}else for(const G in j){const ee=j[G];if(ee.source===q&&ee.type==="fill-extrusion")return!0}return!1}(d&&d.layers,e,g.id),S=m.maxPitchScaleFactor(),k=g.tilesIn(u,S,w);k.sort(hi);const E=[];for(const D of k)E.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(e,a,g._state,D.queryGeometry,D.cameraQueryGeometry,D.scale,d,m,S,Oi(g.transform,D.tileID))});const z=function(D){const j={},q={};for(const G of D){const ee=G.queryResults,se=G.wrappedTileID,oe=q[se]=q[se]||{};for(const ce in ee){const K=ee[ce],pe=oe[ce]=oe[ce]||{},ge=j[ce]=j[ce]||[];for(const ke of K)pe[ke.featureIndex]||(pe[ke.featureIndex]=!0,ge.push(ke))}}return j}(E);for(const D in z)z[D].forEach(j=>{const q=j.feature,G=g.getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=G});return z}function hi(g,e){const a=g.tileID,u=e.tileID;return a.overscaledZ-u.overscaledZ||a.canonical.y-u.canonical.y||a.wrap-u.wrap||a.canonical.x-u.canonical.x}function xi(g,e,a){return c._(this,void 0,void 0,function*(){let u=g;if(g.url?u=(yield c.h(e.transformRequest(g.url,"Source"),a)).data:yield R.frameAsync(a),!u)return null;const d=c.M(c.e(u,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(d.vectorLayerIds=u.vector_layers.map(m=>m.id)),d})}class Me{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){const a=this._sw,u=this._ne;let d,m;if(e instanceof c.N)d=e,m=e;else{if(!(e instanceof Me))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Me.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(d=e._sw,m=e._ne,!d||!m)return this}return a||u?(a.lng=Math.min(d.lng,a.lng),a.lat=Math.min(d.lat,a.lat),u.lng=Math.max(m.lng,u.lng),u.lat=Math.max(m.lat,u.lat)):(this._sw=new c.N(d.lng,d.lat),this._ne=new c.N(m.lng,m.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:a,lat:u}=c.N.convert(e);let d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(e){return e instanceof Me?e:e&&new Me(e)}static fromLngLat(e,a=0){const u=360*a/40075017,d=u/Math.cos(Math.PI/180*e.lat);return new Me(new c.N(e.lng-d,e.lat-u),new c.N(e.lng+d,e.lat+u))}adjustAntiMeridian(){const e=new c.N(this._sw.lng,this._sw.lat),a=new c.N(this._ne.lng,this._ne.lat);return new Me(e,e.lng>a.lng?new c.N(a.lng+360,a.lat):a)}}class dn{constructor(e,a,u){this.bounds=Me.convert(this.validateBounds(e)),this.minzoom=a||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const a=Math.pow(2,e.z),u=Math.floor(c.O(this.bounds.getWest())*a),d=Math.floor(c.Q(this.bounds.getNorth())*a),m=Math.ceil(c.O(this.bounds.getEast())*a),w=Math.ceil(c.Q(this.bounds.getSouth())*a);return e.x>=u&&e.x<m&&e.y>=d&&e.y<w}}class Ii extends c.E{constructor(e,a,u,d){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(a,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield xi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new dn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(a,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((m,w)=>{e.reloadPromise={resolve:m,reject:w}})}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{const m=yield e.actor.sendAsync({type:d,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,m)}catch(m){if(delete e.abortController,e.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,a){if(a&&a.resourceTiming&&(e.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&e.setExpiryData(a),e.loadVectorData(a,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Kt extends c.E{constructor(e,a,u,d){super(),this.id=e,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},a),c.e(this,c.M(a,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield xi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(c.e(this,e),e.bounds&&(this.tileBounds=new dn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield ne.getImage(this.map._requestManager.transformRequest(a,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const d=this.map.painter.context,m=d.gl,w=u.data;e.texture=this.map.painter.getTileTexture(w.width),e.texture?e.texture.update(w,{useMipmap:!0}):(e.texture=new Te(d,w,m.RGBA,{useMipmap:!0}),e.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Ei extends Kt{constructor(e,a,u,d){super(e,a,u,d),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(a,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const d=yield ne.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){const m=d.data;this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const w=c.b(m)&&c.U()?m:yield this.readImageNow(m),S={type:this.type,uid:e.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const k=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=k,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){const a=e.width+2,u=e.height+2;try{return new c.R({width:a,height:u},yield c.W(e,-1,-1,a,u))}catch{}}return R.getImageData(e,1)})}_getNeighboringTiles(e){const a=e.canonical,u=Math.pow(2,a.z),d=(a.x-1+u)%u,m=a.x===0?e.wrap-1:e.wrap,w=(a.x+1+u)%u,S=a.x+1===u?e.wrap+1:e.wrap,k={};return k[new c.S(e.overscaledZ,m,a.z,d,a.y).key]={backfilled:!1},k[new c.S(e.overscaledZ,S,a.z,w,a.y).key]={backfilled:!1},a.y>0&&(k[new c.S(e.overscaledZ,m,a.z,d,a.y-1).key]={backfilled:!1},k[new c.S(e.overscaledZ,e.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},k[new c.S(e.overscaledZ,S,a.z,w,a.y-1).key]={backfilled:!1}),a.y+1<u&&(k[new c.S(e.overscaledZ,m,a.z,d,a.y+1).key]={backfilled:!1},k[new c.S(e.overscaledZ,e.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},k[new c.S(e.overscaledZ,S,a.z,w,a.y+1).key]={backfilled:!1}),k}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class dr extends c.E{constructor(e,a,u,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(d),this._data=a.data,this._options=c.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const m=c.X/this.tileSize;a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*m,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*m,extent:c.X,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:c.X,radius:(a.clusterRadius||50)*m,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,a,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:a,offset:u}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const a=c.e({type:this.type},this.workerOptions);e?a.dataDiff=e:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(R.resolveURL(this._data),"Source"),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:a});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let d=null;u.resourceTiming&&u.resourceTiming[this.id]&&(d=u.resourceTiming[this.id].slice(0));const m={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&c.e(m,{resourceTiming:d}),this.fire(new c.k("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(u))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const a=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const d=yield this.actor.sendAsync({type:a,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,a==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var bn=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Jn extends c.E{constructor(e,a,u,d){super(),this.id=e,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=a}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield ne.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,e&&(this.coordinates=e),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new c.j(a))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const a=e.map(c.Z.fromLngLat);this.tileID=function(d){let m=1/0,w=1/0,S=-1/0,k=-1/0;for(const j of d)m=Math.min(m,j.x),w=Math.min(w,j.y),S=Math.max(S,j.x),k=Math.max(k,j.y);const E=Math.max(S-m,k-w),z=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),D=Math.pow(2,z);return new c.a1(z,Math.floor((m+S)/2*D),Math.floor((w+k)/2*D))}(a),this.minzoom=this.maxzoom=this.tileID.z;const u=a.map(d=>this.tileID.getTilePoint(d)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,c.X,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,c.X),this._boundsArray.emplaceBack(u[2].x,u[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,a=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,bn.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Te(e,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const m=this.tiles[d];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,u=!0)}u&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Is extends Jn{constructor(e,a,u,d){super(e,a,u,d),this.roundZoom=!0,this.type="video",this.options=a}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const a of e.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield c.a3(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new c.j(a))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const a=this.video.seekable;e<a.start(0)||e>a.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,a=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,bn.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new Te(e,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const m=this.tiles[d];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,u=!0)}u&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Qn extends Jn{constructor(e,a,u,d){super(e,a,u,d),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(w=>typeof w!="number"))||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,u=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,bn.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Te(a,this.canvas,u.RGBA,{premultiply:!0});let d=!1;for(const m in this.tiles){const w=this.tiles[m];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,d=!0)}d&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const xt={},Tt=g=>{switch(g){case"geojson":return dr;case"image":return Jn;case"raster":return Kt;case"raster-dem":return Ei;case"vector":return Ii;case"video":return Is;case"canvas":return Qn}return xt[g]},ze="RTLPluginLoaded";class jt extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Yt()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(a=>{throw this.status="error",a})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(a,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=R.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(ze))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ut=null;function Qt(){return Ut||(Ut=new jt),Ut}class Bi{constructor(e,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const a=e+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,a,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(d,m){const w={};if(!m)return w;for(const S of d){const k=S.layerIds.map(E=>m.getLayer(E)).filter(Boolean);if(k.length!==0){S.layers=k,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(E=>k.filter(z=>z.id===E)[0]));for(const E of k)w[E.id]=S}}return w}(e.buckets,a.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const m=this.buckets[d];if(m instanceof c.a6){if(this.hasSymbolBuckets=!0,!u)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const m=this.buckets[d];if(m instanceof c.a6&&m.hasRTLText){this.hasRTLText=!0,Qt().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const m=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(d).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(e)}const a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Te(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Te(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,a,u,d,m,w,S,k,E,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:m,scale:w,tileSize:this.tileSize,pixelPosMatrix:z,transform:k,params:S,queryPadding:this.queryPadding*E},e,a,u):{}}querySourceFeatures(e,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),m=a&&a.sourceLayer?a.sourceLayer:"",w=d._geojsonTileLayer||d[m];if(!w)return;const S=c.a7(a&&a.filter),{z:k,x:E,y:z}=this.tileID.canonical,D={z:k,x:E,y:z};for(let j=0;j<w.length;j++){const q=w.feature(j);if(S.needGeometry){const se=c.a8(q,!0);if(!S.filter(new c.z(this.tileID.overscaledZ),se,this.tileID.canonical))continue}else if(!S.filter(new c.z(this.tileID.overscaledZ),q))continue;const G=u.getId(q,m),ee=new c.a9(q,k,E,z,G);ee.tile=D,e.push(ee)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const a=this.expirationTime;if(e.cacheControl){const u=c.aa(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(a)if(this.expirationTime<a)d=!0;else{const m=this.expirationTime-a;m?this.expirationTime=u+Math.max(m,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!a.style.hasLayer(d))continue;const m=this.buckets[d],w=m.layers[0].sourceLayer||"_geojsonTileLayer",S=u[w],k=e[w];if(!S||!k||Object.keys(k).length===0)continue;m.update(k,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const E=a&&a.style&&a.style.getLayer(d);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<R.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=R.now()+e}setDependencies(e,a){const u={};for(const d of a)u[d]=!0;this.dependencies[e]=u}hasDependency(e,a){for(const u of e){const d=this.dependencies[u];if(d){for(const m of a)if(d[m])return!0}}return!1}}class Ze{constructor(e,a){this.max=e,this.onRemove=a,this.reset()}reset(){for(const e in this.data)for(const a of this.data[e])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(e,a,u){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const m={value:a,timeout:void 0};if(u!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},u)),this.data[d].push(m),this.order.push(d),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const a=this.data[e].shift();return a.timeout&&clearTimeout(a.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),a.value}getByKey(e){const a=this.data[e];return a?a[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,a){if(!this.has(e))return this;const u=e.wrapped().key,d=a===void 0?0:this.data[u].indexOf(a),m=this.data[u][d];return this.data[u].splice(d,1),m.timeout&&clearTimeout(m.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(m.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(e){const a=[];for(const u in this.data)for(const d of this.data[u])e(d.value)||a.push(d);for(const u of a)this.remove(u.value.tileID,u)}}class Dt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,a,u){const d=String(a);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},c.e(this.stateChanges[e][d],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const m in this.state[e])m!==d&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const m in this.state[e][d])u[m]||(this.deletedStates[e][d][m]=null)}else for(const m in u)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][m]===null&&delete this.deletedStates[e][d][m]}removeFeatureState(e,a,u){if(this.deletedStates[e]===null)return;const d=String(a);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&a!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][u]=null);else if(a!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(u in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][u]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,a){const u=String(a),d=c.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const m=this.deletedStates[e][a];if(m===null)return{};for(const w in m)delete d[w]}return d}initializeTileState(e,a){e.setFeatureState(this.state,a)}coalesceChanges(e,a){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const m={};for(const w in this.stateChanges[d])this.state[d][w]||(this.state[d][w]={}),c.e(this.state[d][w],this.stateChanges[d][w]),m[w]=this.state[d][w];u[d]=m}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const m={};if(this.deletedStates[d]===null)for(const w in this.state[d])m[w]={},this.state[d][w]={};else for(const w in this.deletedStates[d]){if(this.deletedStates[d][w]===null)this.state[d][w]={};else for(const S of Object.keys(this.deletedStates[d][w]))delete this.state[d][w][S];m[w]=this.state[d][w]}u[d]=u[d]||{},c.e(u[d],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const d in e)e[d].setFeatureState(u,a)}}class kt extends c.E{constructor(e,a,u){super(),this.id=e,this.dispatcher=u,this.on("data",d=>this._dataHandler(d)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,m,w,S)=>{const k=new(Tt(m.type))(d,m,w,S);if(k.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${k.id}`);return k})(e,a,u,this),this._tiles={},this._cache=new Ze(0,d=>this._unloadTile(d)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Dt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const a=this._tiles[e];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,a,u){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,a,u)}catch(d){e.state="errored",d.status!==404?this._source.fire(new c.j(d,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const u=this._tiles[a];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Di).map(e=>e.key)}getRenderableIds(e){const a=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&a.push(this._tiles[u]);return e?a.sort((u,d)=>{const m=u.tileID,w=d.tileID,S=new c.P(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),k=new c.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-w.overscaledZ||k.y-S.y||k.x-S.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(Di).map(u=>u.key)}hasRenderableParent(e){const a=this.findLoadedParent(e,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(e,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(a||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,a){return c._(this,void 0,void 0,function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=a),yield this._loadTile(u,e,a))})}_tileLoaded(e,a,u){e.timeAdded=R.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(a,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const a=this.getRenderableIds();for(let d=0;d<a.length;d++){const m=a[d];if(e.neighboringTiles&&e.neighboringTiles[m]){const w=this.getTileByID(m);u(e,w),u(w,e)}}function u(d,m){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let w=m.tileID.canonical.x-d.tileID.canonical.x;const S=m.tileID.canonical.y-d.tileID.canonical.y,k=Math.pow(2,d.tileID.canonical.z),E=m.tileID.key;w===0&&S===0||Math.abs(S)>1||(Math.abs(w)>1&&(Math.abs(w+k)===1?w+=k:Math.abs(w-k)===1&&(w-=k)),m.dem&&d.dem&&(d.dem.backfillBorder(m.dem,w,S),d.neighboringTiles&&d.neighboringTiles[E]&&(d.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,a,u,d){for(const m in this._tiles){let w=this._tiles[m];if(d[m]||!w.hasData()||w.tileID.overscaledZ<=a||w.tileID.overscaledZ>u)continue;let S=w.tileID;for(;w&&w.tileID.overscaledZ>a+1;){const E=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[E.key],w&&w.hasData()&&(S=E)}let k=S;for(;k.overscaledZ>a;)if(k=k.scaledTo(k.overscaledZ-1),e[k.key]){d[S.key]=S;break}}}findLoadedParent(e,a){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=a?u:null}for(let u=e.overscaledZ-1;u>=a;u--){const d=e.scaledTo(u),m=this._getLoadedTile(d);if(m)return m}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const a=this._tiles[e.key];return a&&a.hasData()?a:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const a=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(a*u*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(m)}handleWrapJump(e){const a=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,a){const u={};for(const d in this._tiles){const m=this._tiles[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+a),u[m.tileID.key]=m}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}_updateCoveredAndRetainedTiles(e,a,u,d,m,w){const S={},k={},E=Object.keys(e),z=R.now();for(const D of E){const j=e[D],q=this._tiles[D];if(!q||q.fadeEndTime!==0&&q.fadeEndTime<=z)continue;const G=this.findLoadedParent(j,a),ee=this.findLoadedSibling(j),se=G||ee||null;se&&(this._addTile(se.tileID),S[se.tileID.key]=se.tileID),k[D]=j}this._retainLoadedChildren(k,d,u,e);for(const D in S)e[D]||(this._coveredTiles[D]=!0,e[D]=S[D]);if(w){const D={},j={};for(const q of m)this._tiles[q.key].hasData()?D[q.key]=q:j[q.key]=q;for(const q in j){const G=j[q].children(this._source.maxzoom);this._tiles[G[0].key]&&this._tiles[G[1].key]&&this._tiles[G[2].key]&&this._tiles[G[3].key]&&(D[G[0].key]=e[G[0].key]=G[0],D[G[1].key]=e[G[1].key]=G[1],D[G[2].key]=e[G[2].key]=G[2],D[G[3].key]=e[G[3].key]=G[3],delete j[q])}for(const q in j){const G=j[q],ee=this.findLoadedParent(G,this._source.minzoom),se=this.findLoadedSibling(G),oe=ee||se||null;if(oe){D[oe.tileID.key]=e[oe.tileID.key]=oe.tileID;for(const ce in D)D[ce].isChildOf(oe.tileID)&&delete D[ce]}}for(const q in this._tiles)D[q]||(this._coveredTiles[q]=!0)}}update(e,a){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=a,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new c.S(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(u=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(u=u.filter(z=>this._source.hasTile(z)))):u=[];const d=e.coveringZoomLevel(this._source),m=Math.max(d-kt.maxOverzooming,this._source.minzoom),w=Math.max(d+kt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const D of u)if(D.canonical.z>this._source.minzoom){const j=D.scaledTo(D.canonical.z-1);z[j.key]=j;const q=D.scaledTo(Math.max(this._source.minzoom,Math.min(D.canonical.z,5)));z[q.key]=q}u=u.concat(Object.values(z))}const S=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(u,d);Fn(this._source.type)&&this._updateCoveredAndRetainedTiles(k,m,w,d,u,a);for(const z in k)this._tiles[z].clearFadeHold();const E=c.ab(this._tiles,k);for(const z of E){const D=this._tiles[z];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,a){var u;const d={},m={},w=Math.max(a-kt.maxOverzooming,this._source.minzoom),S=Math.max(a+kt.maxUnderzooming,this._source.minzoom),k={};for(const E of e){const z=this._addTile(E);d[E.key]=E,z.hasData()||a<this._source.maxzoom&&(k[E.key]=E)}this._retainLoadedChildren(k,a,S,d);for(const E of e){let z=this._tiles[E.key];if(z.hasData())continue;if(a+1>this._source.maxzoom){const j=E.children(this._source.maxzoom)[0],q=this.getTile(j);if(q&&q.hasData()){d[j.key]=j;continue}}else{const j=E.children(this._source.maxzoom);if(d[j[0].key]&&d[j[1].key]&&d[j[2].key]&&d[j[3].key])continue}let D=z.wasRequested();for(let j=E.overscaledZ-1;j>=w;--j){const q=E.scaledTo(j);if(m[q.key])break;if(m[q.key]=!0,z=this.getTile(q),!z&&D&&(z=this._addTile(q)),z){const G=z.hasData();if((G||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||D)&&(d[q.key]=q),D=z.wasRequested(),G)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const a=[];let u,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}a.push(d.key);const m=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(m),u)break;d=m}for(const m of a)this._loadedParentTiles[m]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const a=this._tiles[e].tileID,u=this._getLoadedTile(a);this._loadedSiblingTiles[a.key]=u}}_addTile(e){let a=this._tiles[e.key];if(a)return a;a=this._cache.getAndRemove(e),a&&(this._setTileReloadTimer(e.key,a),a.tileID=e,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,a)));const u=a;return a||(a=new Bi(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(a,e.key,a.state)),a.uses++,this._tiles[e.key]=a,u||this._source.fire(new c.k("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(e,a){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=a.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){const a=this._tiles[e];a&&(a.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(e){const a=e.sourceDataType;e.dataType==="source"&&a==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&a==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,a,u){const d=[],m=this.transform;if(!m)return d;const w=u?m.getCameraQueryGeometry(e):e,S=e.map(G=>m.pointCoordinate(G,this.terrain)),k=w.map(G=>m.pointCoordinate(G,this.terrain)),E=this.getIds();let z=1/0,D=1/0,j=-1/0,q=-1/0;for(const G of k)z=Math.min(z,G.x),D=Math.min(D,G.y),j=Math.max(j,G.x),q=Math.max(q,G.y);for(let G=0;G<E.length;G++){const ee=this._tiles[E[G]];if(ee.holdingForFade())continue;const se=ee.tileID,oe=Math.pow(2,m.zoom-ee.tileID.overscaledZ),ce=a*ee.queryPadding*c.X/ee.tileSize/oe,K=[se.getTilePoint(new c.Z(z,D)),se.getTilePoint(new c.Z(j,q))];if(K[0].x-ce<c.X&&K[0].y-ce<c.X&&K[1].x+ce>=0&&K[1].y+ce>=0){const pe=S.map(ke=>se.getTilePoint(ke)),ge=k.map(ke=>se.getTilePoint(ke));d.push({tile:ee,tileID:se,queryGeometry:pe,cameraQueryGeometry:ge,scale:oe})}}return d}getVisibleCoordinates(e){const a=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(const u of a)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Fn(this._source.type)){const e=R.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=e)return!0}return!1}setFeatureState(e,a,u){this._state.updateState(e=e||"_geojsonTileLayer",a,u)}removeFeatureState(e,a,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",a,u)}getFeatureState(e,a){return this._state.getState(e=e||"_geojsonTileLayer",a)}setDependencies(e,a,u){const d=this._tiles[e];d&&d.setDependencies(a,u)}reloadTilesForDependencies(e,a){for(const u in this._tiles)this._tiles[u].hasDependency(e,a)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,a))}}function Di(g,e){const a=Math.abs(2*g.wrap)-+(g.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return g.overscaledZ-e.overscaledZ||u-a||e.canonical.y-g.canonical.y||e.canonical.x-g.canonical.x}function Fn(g){return g==="raster"||g==="image"||g==="video"}kt.maxOverzooming=10,kt.maxUnderzooming=3;class Rt{constructor(e,a){this.reset(e,a)}reset(e,a){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ac(e,0,1);let a=1,u=this._distances[a];const d=e*this.paddedLength+this.padding;for(;u<d&&a<this._distances.length;)u=this._distances[++a];const m=a-1,w=this._distances[m],S=u-w,k=S>0?(d-w)/S:0;return this.points[m].mult(1-k).add(this.points[a].mult(k))}}function Mn(g,e){let a=!0;return g==="always"||g!=="never"&&e!=="never"||(a=!1),a}class Mr{constructor(e,a,u){const d=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(a/u);for(let w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=a,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,u,d,m){this._forEachCell(a,u,d,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(m)}insertCircle(e,a,u,d){this._forEachCell(a-d,u-d,a+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(a),this.circles.push(u),this.circles.push(d)}_insertBoxCell(e,a,u,d,m,w){this.boxCells[m].push(w)}_insertCircleCell(e,a,u,d,m,w){this.circleCells[m].push(w)}_query(e,a,u,d,m,w,S){if(u<0||e>this.width||d<0||a>this.height)return[];const k=[];if(e<=0&&a<=0&&this.width<=u&&this.height<=d){if(m)return[{key:null,x1:e,y1:a,x2:u,y2:d}];for(let E=0;E<this.boxKeys.length;E++)k.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const z=this.circles[3*E],D=this.circles[3*E+1],j=this.circles[3*E+2];k.push({key:this.circleKeys[E],x1:z-j,y1:D-j,x2:z+j,y2:D+j})}}else this._forEachCell(e,a,u,d,this._queryCell,k,{hitTest:m,overlapMode:w,seenUids:{box:{},circle:{}}},S);return k}query(e,a,u,d){return this._query(e,a,u,d,!1,null)}hitTest(e,a,u,d,m,w){return this._query(e,a,u,d,!0,m,w).length>0}hitTestCircle(e,a,u,d,m){const w=e-u,S=e+u,k=a-u,E=a+u;if(S<0||w>this.width||E<0||k>this.height)return!1;const z=[];return this._forEachCell(w,k,S,E,this._queryCellCircle,z,{hitTest:!0,overlapMode:d,circle:{x:e,y:a,radius:u},seenUids:{box:{},circle:{}}},m),z.length>0}_queryCell(e,a,u,d,m,w,S,k){const{seenUids:E,hitTest:z,overlapMode:D}=S,j=this.boxCells[m];if(j!==null){const G=this.bboxes;for(const ee of j)if(!E.box[ee]){E.box[ee]=!0;const se=4*ee,oe=this.boxKeys[ee];if(e<=G[se+2]&&a<=G[se+3]&&u>=G[se+0]&&d>=G[se+1]&&(!k||k(oe))&&(!z||!Mn(D,oe.overlapMode))&&(w.push({key:oe,x1:G[se],y1:G[se+1],x2:G[se+2],y2:G[se+3]}),z))return!0}}const q=this.circleCells[m];if(q!==null){const G=this.circles;for(const ee of q)if(!E.circle[ee]){E.circle[ee]=!0;const se=3*ee,oe=this.circleKeys[ee];if(this._circleAndRectCollide(G[se],G[se+1],G[se+2],e,a,u,d)&&(!k||k(oe))&&(!z||!Mn(D,oe.overlapMode))){const ce=G[se],K=G[se+1],pe=G[se+2];if(w.push({key:oe,x1:ce-pe,y1:K-pe,x2:ce+pe,y2:K+pe}),z)return!0}}}return!1}_queryCellCircle(e,a,u,d,m,w,S,k){const{circle:E,seenUids:z,overlapMode:D}=S,j=this.boxCells[m];if(j!==null){const G=this.bboxes;for(const ee of j)if(!z.box[ee]){z.box[ee]=!0;const se=4*ee,oe=this.boxKeys[ee];if(this._circleAndRectCollide(E.x,E.y,E.radius,G[se+0],G[se+1],G[se+2],G[se+3])&&(!k||k(oe))&&!Mn(D,oe.overlapMode))return w.push(!0),!0}}const q=this.circleCells[m];if(q!==null){const G=this.circles;for(const ee of q)if(!z.circle[ee]){z.circle[ee]=!0;const se=3*ee,oe=this.circleKeys[ee];if(this._circlesCollide(G[se],G[se+1],G[se+2],E.x,E.y,E.radius)&&(!k||k(oe))&&!Mn(D,oe.overlapMode))return w.push(!0),!0}}}_forEachCell(e,a,u,d,m,w,S,k){const E=this._convertToXCellCoord(e),z=this._convertToYCellCoord(a),D=this._convertToXCellCoord(u),j=this._convertToYCellCoord(d);for(let q=E;q<=D;q++)for(let G=z;G<=j;G++)if(m.call(this,e,a,u,d,this.xCellCount*G+q,w,S,k))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,a,u,d,m,w){const S=d-e,k=m-a,E=u+w;return E*E>S*S+k*k}_circleAndRectCollide(e,a,u,d,m,w,S){const k=(w-d)/2,E=Math.abs(e-(d+k));if(E>k+u)return!1;const z=(S-m)/2,D=Math.abs(a-(m+z));if(D>z+u)return!1;if(E<=k||D<=z)return!0;const j=E-k,q=D-z;return j*j+q*q<=u*u}}function Ur(g,e,a,u,d){const m=c.H();return e?(c.K(m,m,[1/d,1/d,1]),a||c.ad(m,m,u.angle)):c.L(m,u.labelPlaneMatrix,g),m}function En(g,e,a,u,d){if(e){const m=c.ae(g);return c.K(m,m,[d,d,1]),a||c.ad(m,m,-u.angle),m}return u.glCoordMatrix}function ie(g,e,a,u){let d;u?(d=[g,e,u(g,e),1],c.af(d,d,a)):(d=[g,e,0,1],mi(d,d,a));const m=d[3];return{point:new c.P(d[0]/m,d[1]/m),signedDistanceFromCamera:m,isOccluded:!1}}function F(g,e){return .5+g/e*.5}function N(g,e){return g.x>=-e[0]&&g.x<=e[0]&&g.y>=-e[1]&&g.y<=e[1]}function W(g,e,a,u,d,m,w,S,k,E,z,D,j,q,G){const ee=u?g.textSizeData:g.iconSizeData,se=c.ag(ee,a.transform.zoom),oe=[256/a.width*2+1,256/a.height*2+1],ce=u?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;ce.clear();const K=g.lineVertexArray,pe=u?g.text.placedSymbolArray:g.icon.placedSymbolArray,ge=a.transform.width/a.transform.height;let ke=!1;for(let $e=0;$e<pe.length;$e++){const He=pe.get($e);if(He.hidden||He.writingMode===c.ah.vertical&&!ke){Pt(He.numGlyphs,ce);continue}ke=!1;const st=ie(He.anchorX,He.anchorY,e,G);if(!N(st.point,oe)){Pt(He.numGlyphs,ce);continue}const dt=F(a.transform.cameraToCenterDistance,st.signedDistanceFromCamera),Qe=c.ai(ee,se,He),Je=w?Qe/dt:Qe*dt,vt={getElevation:G,labelPlaneMatrix:d,lineVertexArray:K,pitchWithMap:w,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:E,tileAnchorPoint:new c.P(He.anchorX,He.anchorY),unwrappedTileID:z,width:D,height:j,translation:q},Vt=me(vt,He,Je,!1,S,e,m,g.glyphOffsetArray,ce,ge,k);ke=Vt.useVertical,(Vt.notEnoughRoom||ke||Vt.needsFlipping&&me(vt,He,Je,!0,S,e,m,g.glyphOffsetArray,ce,ge,k).notEnoughRoom)&&Pt(He.numGlyphs,ce)}u?g.text.dynamicLayoutVertexBuffer.updateData(ce):g.icon.dynamicLayoutVertexBuffer.updateData(ce)}function Q(g,e,a,u,d,m,w,S){const k=m.glyphStartIndex+m.numGlyphs,E=m.lineStartIndex,z=m.lineStartIndex+m.lineLength,D=e.getoffsetX(m.glyphStartIndex),j=e.getoffsetX(k-1),q=Ke(g*D,a,u,d,m.segment,E,z,S,w);if(!q)return null;const G=Ke(g*j,a,u,d,m.segment,E,z,S,w);return G?S.projectionCache.anyProjectionOccluded?null:{first:q,last:G}:null}function he(g,e,a,u){return g===c.ah.horizontal&&Math.abs(a.y-e.y)>Math.abs(a.x-e.x)*u?{useVertical:!0}:(g===c.ah.vertical?e.y<a.y:e.x>a.x)?{needsFlipping:!0}:null}function me(g,e,a,u,d,m,w,S,k,E,z){const D=a/24,j=e.lineOffsetX*D,q=e.lineOffsetY*D;let G;if(e.numGlyphs>1){const ee=e.glyphStartIndex+e.numGlyphs,se=e.lineStartIndex,oe=e.lineStartIndex+e.lineLength,ce=Q(D,S,j,q,u,e,z,g);if(!ce)return{notEnoughRoom:!0};const K=ie(ce.first.point.x,ce.first.point.y,w,g.getElevation).point,pe=ie(ce.last.point.x,ce.last.point.y,w,g.getElevation).point;if(d&&!u){const ge=he(e.writingMode,K,pe,E);if(ge)return ge}G=[ce.first];for(let ge=e.glyphStartIndex+1;ge<ee-1;ge++)G.push(Ke(D*S.getoffsetX(ge),j,q,u,e.segment,se,oe,g,z));G.push(ce.last)}else{if(d&&!u){const se=ie(g.tileAnchorPoint.x,g.tileAnchorPoint.y,m,g.getElevation).point,oe=e.lineStartIndex+e.segment+1,ce=new c.P(g.lineVertexArray.getx(oe),g.lineVertexArray.gety(oe)),K=ie(ce.x,ce.y,m,g.getElevation),pe=K.signedDistanceFromCamera>0?K.point:function(ke,$e,He,st,dt,Qe){return be(ke,$e,He,1,dt,Qe)}(g.tileAnchorPoint,ce,se,0,m,g),ge=he(e.writingMode,se,pe,E);if(ge)return ge}const ee=Ke(D*S.getoffsetX(e.glyphStartIndex),j,q,u,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,g,z);if(!ee||g.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};G=[ee]}for(const ee of G)c.aj(k,ee.point,ee.angle);return{}}function be(g,e,a,u,d,m){const w=g.add(g.sub(e)._unit()),S=d!==void 0?ie(w.x,w.y,d,m.getElevation).point:Pe(w.x,w.y,m).point,k=a.sub(S);return a.add(k._mult(u/k.mag()))}function le(g,e,a){const u=e.projectionCache;if(u.projections[g])return u.projections[g];const d=new c.P(e.lineVertexArray.getx(g),e.lineVertexArray.gety(g)),m=Pe(d.x,d.y,e);if(m.signedDistanceFromCamera>0)return u.projections[g]=m.point,u.anyProjectionOccluded=u.anyProjectionOccluded||m.isOccluded,m.point;const w=g-a.direction;return function(S,k,E,z,D){return be(S,k,E,z,void 0,D)}(a.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(w),e.lineVertexArray.gety(w)),d,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,e)}function Pe(g,e,a){const u=g+a.translation[0],d=e+a.translation[1];let m;return!a.pitchWithMap&&a.projection.useSpecialProjectionForSymbols?(m=a.projection.projectTileCoordinates(u,d,a.unwrappedTileID,a.getElevation),m.point.x=(.5*m.point.x+.5)*a.width,m.point.y=(.5*-m.point.y+.5)*a.height):(m=ie(u,d,a.labelPlaneMatrix,a.getElevation),m.isOccluded=!1),m}function je(g,e,a){return g._unit()._perp()._mult(e*a)}function Ie(g,e,a,u,d,m,w,S,k){if(S.projectionCache.offsets[g])return S.projectionCache.offsets[g];const E=a.add(e);if(g+k.direction<u||g+k.direction>=d)return S.projectionCache.offsets[g]=E,E;const z=le(g+k.direction,S,k),D=je(z.sub(a),w,k.direction),j=a.add(D),q=z.add(D);return S.projectionCache.offsets[g]=c.ak(m,E,j,q)||E,S.projectionCache.offsets[g]}function Ke(g,e,a,u,d,m,w,S,k){const E=u?g-e:g+e;let z=E>0?1:-1,D=0;u&&(z*=-1,D=Math.PI),z<0&&(D+=Math.PI);let j,q=z>0?m+d:m+d+1;S.projectionCache.cachedAnchorPoint?j=S.projectionCache.cachedAnchorPoint:(j=Pe(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=j);let G,ee,se=j,oe=j,ce=0,K=0;const pe=Math.abs(E),ge=[];let ke;for(;ce+K<=pe;){if(q+=z,q<m||q>=w)return null;ce+=K,oe=se,ee=G;const st={absOffsetX:pe,direction:z,distanceFromAnchor:ce,previousVertex:oe};if(se=le(q,S,st),a===0)ge.push(oe),ke=se.sub(oe);else{let dt;const Qe=se.sub(oe);dt=Qe.mag()===0?je(le(q+z,S,st).sub(se),a,z):je(Qe,a,z),ee||(ee=oe.add(dt)),G=Ie(q,dt,se,m,w,ee,a,S,st),ge.push(ee),ke=G.sub(ee)}K=ke.mag()}const $e=ke._mult((pe-ce)/K)._add(ee||oe),He=D+Math.atan2(se.y-oe.y,se.x-oe.x);return ge.push($e),{point:$e,angle:k?He:0,path:ge}}const At=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Pt(g,e){for(let a=0;a<g;a++){const u=e.length;e.resize(u+4),e.float32.set(At,3*u)}}function mi(g,e,a){const u=e[0],d=e[1];return g[0]=a[0]*u+a[4]*d+a[12],g[1]=a[1]*u+a[5]*d+a[13],g[3]=a[3]*u+a[7]*d+a[15],g}const Zt=100;class gi{constructor(e,a,u=new Mr(e.width+200,e.height+200,25),d=new Mr(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=a,this.grid=u,this.ignoredGrid=d,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Zt,this.screenBottomBoundary=e.height+Zt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,a,u,d,m,w,S,k,E,z,D){const j=e.anchorPointX+k[0],q=e.anchorPointY+k[1],G=this.projectAndGetPerspectiveRatio(d,j,q,m,z),ee=u*G.perspectiveRatio;let se;if(w||S)se=this._projectCollisionBox(e,ee,d,m,w,S,k,G,z,D);else{const ge=G.point.x+(D?D.x*ee:0),ke=G.point.y+(D?D.y*ee:0);se={allPointsOccluded:!1,box:[ge+e.x1*ee,ke+e.y1*ee,ge+e.x2*ee,ke+e.y2*ee]}}const[oe,ce,K,pe]=se.box;return this.mapProjection.useSpecialProjectionForSymbols&&(w?se.allPointsOccluded:this.mapProjection.isOccluded(j,q,m))||G.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(oe,ce,K,pe)||a!=="always"&&this.grid.hitTest(oe,ce,K,pe,a,E)?{box:[oe,ce,K,pe],placeable:!1,offscreen:!1}:{box:[oe,ce,K,pe],placeable:!0,offscreen:this.isOffscreen(oe,ce,K,pe)}}placeCollisionCircles(e,a,u,d,m,w,S,k,E,z,D,j,q,G,ee,se){const oe=[],ce=new c.P(a.anchorX,a.anchorY),K=this.getPerspectiveRatio(w,ce.x,ce.y,S,se),pe=(D?m/K:m*K)/c.ap,ge={getElevation:se,labelPlaneMatrix:k,lineVertexArray:u,pitchWithMap:D,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ce,unwrappedTileID:S,width:this.transform.width,height:this.transform.height,translation:ee},ke=Q(pe,d,a.lineOffsetX*pe,a.lineOffsetY*pe,!1,a,!1,ge);let $e=!1,He=!1,st=!0;if(ke){const dt=.5*q*K+G,Qe=new c.P(-100,-100),Je=new c.P(this.screenRightBoundary,this.screenBottomBoundary),vt=new Rt,Vt=ke.first,it=ke.last;let lt=[];for(let Jt=Vt.path.length-1;Jt>=1;Jt--)lt.push(Vt.path[Jt]);for(let Jt=1;Jt<it.path.length;Jt++)lt.push(it.path[Jt]);const Ot=2.5*dt;if(E){const Jt=this.projectPathToScreenSpace(lt,ge,E);lt=Jt.some(ci=>ci.signedDistanceFromCamera<=0)?[]:Jt.map(ci=>ci.point)}let Hi=[];if(lt.length>0){const Jt=lt[0].clone(),ci=lt[0].clone();for(let Xi=1;Xi<lt.length;Xi++)Jt.x=Math.min(Jt.x,lt[Xi].x),Jt.y=Math.min(Jt.y,lt[Xi].y),ci.x=Math.max(ci.x,lt[Xi].x),ci.y=Math.max(ci.y,lt[Xi].y);Hi=Jt.x>=Qe.x&&ci.x<=Je.x&&Jt.y>=Qe.y&&ci.y<=Je.y?[lt]:ci.x<Qe.x||Jt.x>Je.x||ci.y<Qe.y||Jt.y>Je.y?[]:c.al([lt],Qe.x,Qe.y,Je.x,Je.y)}for(const Jt of Hi){vt.reset(Jt,.25*dt);let ci=0;ci=vt.length<=.5*dt?1:Math.ceil(vt.paddedLength/Ot)+1;for(let Xi=0;Xi<ci;Xi++){const qn=Xi/Math.max(ci-1,1),Yr=vt.lerp(qn),Yi=Yr.x+Zt,yr=Yr.y+Zt;oe.push(Yi,yr,dt,0);const ir=Yi-dt,nr=yr-dt,rr=Yi+dt,us=yr+dt;if(st=st&&this.isOffscreen(ir,nr,rr,us),He=He||this.isInsideGrid(ir,nr,rr,us),e!=="always"&&this.grid.hitTestCircle(Yi,yr,dt,e,j)&&($e=!0,!z))return{circles:[],offscreen:!1,collisionDetected:$e}}}}return{circles:!z&&$e||!He||K<this.perspectiveRatioCutoff?[]:oe,offscreen:st,collisionDetected:$e}}projectPathToScreenSpace(e,a,u){return e.map(d=>ie(d.x,d.y,u,a.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let u=1/0,d=1/0,m=-1/0,w=-1/0;for(const z of e){const D=new c.P(z.x+Zt,z.y+Zt);u=Math.min(u,D.x),d=Math.min(d,D.y),m=Math.max(m,D.x),w=Math.max(w,D.y),a.push(D)}const S=this.grid.query(u,d,m,w).concat(this.ignoredGrid.query(u,d,m,w)),k={},E={};for(const z of S){const D=z.key;if(k[D.bucketInstanceId]===void 0&&(k[D.bucketInstanceId]={}),k[D.bucketInstanceId][D.featureIndex])continue;const j=[new c.P(z.x1,z.y1),new c.P(z.x2,z.y1),new c.P(z.x2,z.y2),new c.P(z.x1,z.y2)];c.am(a,j)&&(k[D.bucketInstanceId][D.featureIndex]=!0,E[D.bucketInstanceId]===void 0&&(E[D.bucketInstanceId]=[]),E[D.bucketInstanceId].push(D.featureIndex))}return E}insertCollisionBox(e,a,u,d,m,w){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:m,collisionGroupID:w,overlapMode:a},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,a,u,d,m,w){const S=u?this.ignoredGrid:this.grid,k={bucketInstanceId:d,featureIndex:m,collisionGroupID:w,overlapMode:a};for(let E=0;E<e.length;E+=4)S.insertCircle(k,e[E],e[E+1],e[E+2])}projectAndGetPerspectiveRatio(e,a,u,d,m){let w;m?(w=[a,u,m(a,u),1],c.af(w,w,e)):(w=[a,u,0,1],mi(w,w,e));const S=w[3];return{point:new c.P((w[0]/S+1)/2*this.transform.width+Zt,(-w[1]/S+1)/2*this.transform.height+Zt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}getPerspectiveRatio(e,a,u,d,m){const w=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(a,u,d,m):ie(a,u,e,m);return .5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5}isOffscreen(e,a,u,d){return u<Zt||e>=this.screenRightBoundary||d<Zt||a>this.screenBottomBoundary}isInsideGrid(e,a,u,d){return u>=0&&e<this.gridRightBoundary&&d>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const e=c.an([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,a,u,d,m,w,S,k,E,z){let D=new c.P(1,0),j=new c.P(0,1);const q=new c.P(e.anchorPointX+S[0],e.anchorPointY+S[1]);if(w&&!m){const st=this.projectAndGetPerspectiveRatio(u,q.x+1,q.y,d,E).point.sub(k.point).unit(),dt=Math.atan(st.y/st.x)+(st.x<0?Math.PI:0),Qe=Math.sin(dt),Je=Math.cos(dt);D=new c.P(Je,Qe),j=new c.P(-Qe,Je)}else if(!w&&m){const st=-this.transform.angle,dt=Math.sin(st),Qe=Math.cos(st);D=new c.P(Qe,dt),j=new c.P(-dt,Qe)}let G=k.point,ee=a;if(m){G=q;const st=this.transform.zoom-Math.floor(this.transform.zoom);ee=Math.pow(2,-st),ee*=this.mapProjection.getPitchedTextCorrection(this.transform,q,d),z||(ee*=c.ac(.5+k.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}z&&(G=G.add(D.mult(z.x*ee)).add(j.mult(z.y*ee)));const se=e.x1*ee,oe=e.x2*ee,ce=(se+oe)/2,K=e.y1*ee,pe=e.y2*ee,ge=(K+pe)/2,ke=[{offsetX:se,offsetY:K},{offsetX:ce,offsetY:K},{offsetX:oe,offsetY:K},{offsetX:oe,offsetY:ge},{offsetX:oe,offsetY:pe},{offsetX:ce,offsetY:pe},{offsetX:se,offsetY:pe},{offsetX:se,offsetY:ge}];let $e=[];for(const{offsetX:st,offsetY:dt}of ke)$e.push(new c.P(G.x+D.x*st+j.x*dt,G.y+D.y*st+j.y*dt));let He=!1;if(m){const st=$e.map(dt=>this.projectAndGetPerspectiveRatio(u,dt.x,dt.y,d,E));He=st.some(dt=>!dt.isOccluded),$e=st.map(dt=>dt.point)}else He=!0;return{box:c.ao($e),allPointsOccluded:!He}}}function oi(g,e,a){return e*(c.X/(g.tileSize*Math.pow(2,a-g.tileID.overscaledZ)))}class xn{constructor(e,a,u,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?a:-a))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class nn{constructor(e,a,u,d,m){this.text=new xn(e?e.text:null,a,u,m),this.icon=new xn(e?e.icon:null,a,d,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ti{constructor(e,a,u){this.text=e,this.icon=a,this.skipFade=u}}class Li{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class en{constructor(e,a,u,d,m){this.bucketInstanceId=e,this.featureIndex=a,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=m}}class Cn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const a=++this.maxGroupID;this.collisionGroups[e]={ID:a,predicate:u=>u.collisionGroupID===a}}return this.collisionGroups[e]}}function Nn(g,e,a,u,d){const{horizontalAlign:m,verticalAlign:w}=c.au(g);return new c.P(-(m-.5)*e+u[0]*d,-(w-.5)*a+u[1]*d)}class er{constructor(e,a,u,d,m,w){this.transform=e.clone(),this.terrain=u,this.collisionIndex=new gi(this.transform,a),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Cn(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const a=this.terrain;return a?(u,d)=>a.getElevation(e,u,d):null}getBucketParts(e,a,u,d){const m=u.getBucket(a),w=u.latestFeatureIndex;if(!m||!w||a.id!==m.layerIds[0])return;const S=u.collisionBoxArray,k=m.layers[0].layout,E=m.layers[0].paint,z=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),D=u.tileSize/c.X,j=u.tileID.toUnwrapped(),q=this.transform.calculatePosMatrix(j),G=k.get("text-pitch-alignment")==="map",ee=k.get("text-rotation-alignment")==="map",se=oi(u,1,this.transform.zoom),oe=this.collisionIndex.mapProjection.translatePosition(this.transform,u,E.get("text-translate"),E.get("text-translate-anchor")),ce=this.collisionIndex.mapProjection.translatePosition(this.transform,u,E.get("icon-translate"),E.get("icon-translate-anchor")),K=Ur(q,G,ee,this.transform,se);let pe=null;if(G){const ke=En(q,G,ee,this.transform,se);pe=c.L([],this.transform.labelPlaneMatrix,ke)}this.retainedQueryData[m.bucketInstanceId]=new en(m.bucketInstanceId,w,m.sourceLayerIndex,m.index,u.tileID);const ge={bucket:m,layout:k,translationText:oe,translationIcon:ce,posMatrix:q,unwrappedTileID:j,textLabelPlaneMatrix:K,labelToScreenMatrix:pe,scale:z,textPixelRatio:D,holdingForFade:u.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:c.ag(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(d)for(const ke of m.sortKeyRanges){const{sortKey:$e,symbolInstanceStart:He,symbolInstanceEnd:st}=ke;e.push({sortKey:$e,symbolInstanceStart:He,symbolInstanceEnd:st,parameters:ge})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(e,a,u,d,m,w,S,k,E,z,D,j,q,G,ee,se,oe,ce,K){const pe=c.aq[e.textAnchor],ge=[e.textOffset0,e.textOffset1],ke=Nn(pe,u,d,ge,m),$e=this.collisionIndex.placeCollisionBox(a,j,k,E,z,S,w,se,D.predicate,K,ke);if((!ce||this.collisionIndex.placeCollisionBox(ce,j,k,E,z,S,w,oe,D.predicate,K,ke).placeable)&&$e.placeable){let He;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(He=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:ge,width:u,height:d,anchor:pe,textBoxScale:m,prevAnchor:He},this.markUsedJustification(G,pe,q,ee),G.allowVerticalPlacement&&(this.markUsedOrientation(G,ee,q),this.placedOrientations[q.crossTileID]=ee),{shift:ke,placedGlyphBoxes:$e}}}placeLayerBucketPart(e,a,u){const{bucket:d,layout:m,translationText:w,translationIcon:S,posMatrix:k,unwrappedTileID:E,textLabelPlaneMatrix:z,labelToScreenMatrix:D,textPixelRatio:j,holdingForFade:q,collisionBoxArray:G,partiallyEvaluatedTextSize:ee,collisionGroup:se}=e.parameters,oe=m.get("text-optional"),ce=m.get("icon-optional"),K=c.ar(m,"text-overlap","text-allow-overlap"),pe=K==="always",ge=c.ar(m,"icon-overlap","icon-allow-overlap"),ke=ge==="always",$e=m.get("text-rotation-alignment")==="map",He=m.get("text-pitch-alignment")==="map",st=m.get("icon-text-fit")!=="none",dt=m.get("symbol-z-order")==="viewport-y",Qe=pe&&(ke||!d.hasIconData()||ce),Je=ke&&(pe||!d.hasTextData()||oe);!d.collisionArrays&&G&&d.deserializeCollisionBoxes(G);const vt=this._getTerrainElevationFunc(this.retainedQueryData[d.bucketInstanceId].tileID),Vt=(it,lt,Ot)=>{var Hi,Jt;if(a[it.crossTileID])return;if(q)return void(this.placements[it.crossTileID]=new ti(!1,!1,!1));let ci=!1,Xi=!1,qn=!0,Yr=null,Yi={box:null,placeable:!1,offscreen:null},yr={box:null,placeable:!1,offscreen:null},ir=null,nr=null,rr=null,us=0,Fa=0,$l=0;lt.textFeatureIndex?us=lt.textFeatureIndex:it.useRuntimeCollisionCircles&&(us=it.featureIndex),lt.verticalTextFeatureIndex&&(Fa=lt.verticalTextFeatureIndex);const Kr=lt.textBox;if(Kr){const Cr=sr=>{let Zn=c.ah.horizontal;if(d.allowVerticalPlacement&&!sr&&this.prevPlacement){const Fi=this.prevPlacement.placedOrientations[it.crossTileID];Fi&&(this.placedOrientations[it.crossTileID]=Fi,Zn=Fi,this.markUsedOrientation(d,Zn,it))}return Zn},Jr=(sr,Zn)=>{if(d.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&lt.verticalTextBox){for(const Fi of d.writingModes)if(Fi===c.ah.vertical?(Yi=Zn(),yr=Yi):Yi=sr(),Yi&&Yi.placeable)break}else Yi=sr()},Pr=it.textAnchorOffsetStartIndex,Ls=it.textAnchorOffsetEndIndex;if(Ls===Pr){const sr=(Zn,Fi)=>{const rn=this.collisionIndex.placeCollisionBox(Zn,K,j,k,E,He,$e,w,se.predicate,vt);return rn&&rn.placeable&&(this.markUsedOrientation(d,Fi,it),this.placedOrientations[it.crossTileID]=Fi),rn};Jr(()=>sr(Kr,c.ah.horizontal),()=>{const Zn=lt.verticalTextBox;return d.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&Zn?sr(Zn,c.ah.vertical):{box:null,offscreen:null}}),Cr(Yi&&Yi.placeable)}else{let sr=c.aq[(Jt=(Hi=this.prevPlacement)===null||Hi===void 0?void 0:Hi.variableOffsets[it.crossTileID])===null||Jt===void 0?void 0:Jt.anchor];const Zn=(rn,ys,Na)=>{const Vl=rn.x2-rn.x1,gp=rn.y2-rn.y1,ud=it.textBoxScale,hd=st&&ge==="never"?ys:null;let aa=null,Ul=K==="never"?1:2,$o="never";sr&&Ul++;for(let _u=0;_u<Ul;_u++){for(let jo=Pr;jo<Ls;jo++){const Vo=d.textAnchorOffsets.get(jo);if(sr&&Vo.textAnchor!==sr)continue;const _s=this.attemptAnchorPlacement(Vo,rn,Vl,gp,ud,$e,He,j,k,E,se,$o,it,d,Na,w,S,hd,vt);if(_s&&(aa=_s.placedGlyphBoxes,aa&&aa.placeable))return ci=!0,Yr=_s.shift,aa}sr?sr=null:$o=K}return u&&!aa&&(aa={box:this.collisionIndex.placeCollisionBox(Kr,"always",j,k,E,He,$e,w,se.predicate,vt,new c.P(0,0)).box,offscreen:!1,placeable:!1}),aa};Jr(()=>Zn(Kr,lt.iconBox,c.ah.horizontal),()=>{const rn=lt.verticalTextBox;return d.allowVerticalPlacement&&(!Yi||!Yi.placeable)&&it.numVerticalGlyphVertices>0&&rn?Zn(rn,lt.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Yi&&(ci=Yi.placeable,qn=Yi.offscreen);const Fi=Cr(Yi&&Yi.placeable);if(!ci&&this.prevPlacement){const rn=this.prevPlacement.variableOffsets[it.crossTileID];rn&&(this.variableOffsets[it.crossTileID]=rn,this.markUsedJustification(d,rn.anchor,it,Fi))}}}if(ir=Yi,ci=ir&&ir.placeable,qn=ir&&ir.offscreen,it.useRuntimeCollisionCircles){const Cr=d.text.placedSymbolArray.get(it.centerJustifiedTextSymbolIndex),Jr=c.ai(d.textSizeData,ee,Cr),Pr=m.get("text-padding");nr=this.collisionIndex.placeCollisionCircles(K,Cr,d.lineVertexArray,d.glyphOffsetArray,Jr,k,E,z,D,u,He,se.predicate,it.collisionCircleDiameter,Pr,w,vt),nr.circles.length&&nr.collisionDetected&&!u&&c.w("Collisions detected, but collision boxes are not shown"),ci=pe||nr.circles.length>0&&!nr.collisionDetected,qn=qn&&nr.offscreen}if(lt.iconFeatureIndex&&($l=lt.iconFeatureIndex),lt.iconBox){const Cr=Jr=>this.collisionIndex.placeCollisionBox(Jr,ge,j,k,E,He,$e,S,se.predicate,vt,st&&Yr?Yr:void 0);yr&&yr.placeable&&lt.verticalIconBox?(rr=Cr(lt.verticalIconBox),Xi=rr.placeable):(rr=Cr(lt.iconBox),Xi=rr.placeable),qn=qn&&rr.offscreen}const sa=oe||it.numHorizontalGlyphVertices===0&&it.numVerticalGlyphVertices===0,jl=ce||it.numIconVertices===0;sa||jl?jl?sa||(Xi=Xi&&ci):ci=Xi&&ci:Xi=ci=Xi&&ci;const yu=Xi&&rr.placeable;if(ci&&ir.placeable&&this.collisionIndex.insertCollisionBox(ir.box,K,m.get("text-ignore-placement"),d.bucketInstanceId,yr&&yr.placeable&&Fa?Fa:us,se.ID),yu&&this.collisionIndex.insertCollisionBox(rr.box,ge,m.get("icon-ignore-placement"),d.bucketInstanceId,$l,se.ID),nr&&ci&&this.collisionIndex.insertCollisionCircles(nr.circles,K,m.get("text-ignore-placement"),d.bucketInstanceId,us,se.ID),u&&this.storeCollisionData(d.bucketInstanceId,Ot,lt,ir,rr,nr),it.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[it.crossTileID]=new ti(ci||Qe,Xi||Je,qn||d.justReloaded),a[it.crossTileID]=!0};if(dt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const it=d.getSortedSymbolIndexes(this.transform.angle);for(let lt=it.length-1;lt>=0;--lt){const Ot=it[lt];Vt(d.symbolInstances.get(Ot),d.collisionArrays[Ot],Ot)}}else for(let it=e.symbolInstanceStart;it<e.symbolInstanceEnd;it++)Vt(d.symbolInstances.get(it),d.collisionArrays[it],it);if(u&&d.bucketInstanceId in this.collisionCircleArrays){const it=this.collisionCircleArrays[d.bucketInstanceId];c.as(it.invProjMatrix,k),it.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}storeCollisionData(e,a,u,d,m,w){if(u.textBox||u.iconBox){let S,k;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(a)?k=S.get(a):(k={text:null,icon:null},S.set(a,k)),u.textBox&&(k.text=d.box),u.iconBox&&(k.icon=m.box)}if(w){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=new Li);for(let k=0;k<w.circles.length;k+=4)S.circles.push(w.circles[k+0]),S.circles.push(w.circles[k+1]),S.circles.push(w.circles[k+2]),S.circles.push(w.collisionDetected?1:0)}}markUsedJustification(e,a,u,d){let m;m=d===c.ah.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[c.at(a)];const w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const S of w)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=m>=0&&S!==m?0:u.crossTileID)}markUsedOrientation(e,a,u){const d=a===c.ah.horizontal||a===c.ah.horizontalOnly?a:0,m=a===c.ah.vertical?a:0,w=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const S of w)e.text.placedSymbolArray.get(S).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let u=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const d=a?a.symbolFadeChange(e):1,m=a?a.opacities:{},w=a?a.variableOffsets:{},S=a?a.placedOrientations:{};for(const k in this.placements){const E=this.placements[k],z=m[k];z?(this.opacities[k]=new nn(z,d,E.text,E.icon),u=u||E.text!==z.text.placed||E.icon!==z.icon.placed):(this.opacities[k]=new nn(null,d,E.text,E.icon,E.skipFade),u=u||E.text||E.icon)}for(const k in m){const E=m[k];if(!this.opacities[k]){const z=new nn(E,d,!1,!1);z.isHidden()||(this.opacities[k]=z,u=u||E.text.placed||E.icon.placed)}}for(const k in w)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=w[k]);for(const k in S)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=S[k]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:e)}updateLayerOpacities(e,a){const u={};for(const d of a){const m=d.getBucket(e);m&&d.latestFeatureIndex&&e.id===m.layerIds[0]&&this.updateBucketOpacities(m,d.tileID,u,d.collisionBoxArray)}}updateBucketOpacities(e,a,u,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const m=e.layers[0],w=m.layout,S=new nn(null,0,!1,!1,!0),k=w.get("text-allow-overlap"),E=w.get("icon-allow-overlap"),z=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),D=w.get("text-rotation-alignment")==="map",j=w.get("text-pitch-alignment")==="map",q=w.get("icon-text-fit")!=="none",G=new nn(null,0,k&&(E||!e.hasIconData()||w.get("icon-optional")),E&&(k||!e.hasTextData()||w.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);const ee=(oe,ce,K)=>{for(let pe=0;pe<ce/4;pe++)oe.opacityVertexArray.emplaceBack(K);oe.hasVisibleVertices=oe.hasVisibleVertices||K!==ka},se=this.collisionBoxArrays.get(e.bucketInstanceId);for(let oe=0;oe<e.symbolInstances.length;oe++){const ce=e.symbolInstances.get(oe),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:pe,crossTileID:ge}=ce;let ke=this.opacities[ge];u[ge]?ke=S:ke||(ke=G,this.opacities[ge]=ke),u[ge]=!0;const $e=ce.numIconVertices>0,He=this.placedOrientations[ce.crossTileID],st=He===c.ah.vertical,dt=He===c.ah.horizontal||He===c.ah.horizontalOnly;if(K>0||pe>0){const Je=Er(ke.text);ee(e.text,K,st?ka:Je),ee(e.text,pe,dt?ka:Je);const vt=ke.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach(lt=>{lt>=0&&(e.text.placedSymbolArray.get(lt).hidden=vt||st?1:0)}),ce.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=vt||dt?1:0);const Vt=this.variableOffsets[ce.crossTileID];Vt&&this.markUsedJustification(e,Vt.anchor,ce,He);const it=this.placedOrientations[ce.crossTileID];it&&(this.markUsedJustification(e,"left",ce,it),this.markUsedOrientation(e,it,ce))}if($e){const Je=Er(ke.icon),vt=!(q&&ce.verticalPlacedIconSymbolIndex&&st);ce.placedIconSymbolIndex>=0&&(ee(e.icon,ce.numIconVertices,vt?Je:ka),e.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=ke.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(ee(e.icon,ce.numVerticalIconVertices,vt?ka:Je),e.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=ke.icon.isHidden())}const Qe=se&&se.has(oe)?se.get(oe):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Je=e.collisionArrays[oe];if(Je){let vt=new c.P(0,0);if(Je.textBox||Je.verticalTextBox){let Vt=!0;if(z){const it=this.variableOffsets[ge];it?(vt=Nn(it.anchor,it.width,it.height,it.textOffset,it.textBoxScale),D&&vt._rotate(j?this.transform.angle:-this.transform.angle)):Vt=!1}if(Je.textBox||Je.verticalTextBox){let it;Je.textBox&&(it=st),Je.verticalTextBox&&(it=dt),Sa(e.textCollisionBox.collisionVertexArray,ke.text.placed,!Vt||it,Qe.text,vt.x,vt.y)}}if(Je.iconBox||Je.verticalIconBox){const Vt=!!(!dt&&Je.verticalIconBox);let it;Je.iconBox&&(it=Vt),Je.verticalIconBox&&(it=!Vt),Sa(e.iconCollisionBox.collisionVertexArray,ke.icon.placed,it,Qe.icon,q?vt.x:0,q?vt.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const oe=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=oe.invProjMatrix,e.placementViewportMatrix=oe.viewportMatrix,e.collisionCircleArray=oe.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,a){const u=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function Sa(g,e,a,u,d,m){u&&u.length!==0||(u=[0,0,0,0]);const w=u[0]-Zt,S=u[1]-Zt,k=u[2]-Zt,E=u[3]-Zt;g.emplaceBack(e?1:0,a?1:0,d||0,m||0,w,S),g.emplaceBack(e?1:0,a?1:0,d||0,m||0,k,S),g.emplaceBack(e?1:0,a?1:0,d||0,m||0,k,E),g.emplaceBack(e?1:0,a?1:0,d||0,m||0,w,E)}const Ri=Math.pow(2,25),Rc=Math.pow(2,24),Oc=Math.pow(2,17),Ar=Math.pow(2,16),Ir=Math.pow(2,9),Uf=Math.pow(2,8),Fr=Math.pow(2,1);function Er(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const e=g.placed?1:0,a=Math.floor(127*g.opacity);return a*Ri+e*Rc+a*Oc+e*Ar+a*Ir+e*Uf+a*Fr+e}const ka=0;function Us(){return{isOccluded:(g,e,a)=>!1,getPitchedTextCorrection:(g,e,a)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(g,e,a,u){throw new Error("Not implemented.")},translatePosition:(g,e,a,u)=>function(d,m,w,S,k=!1){if(!w[0]&&!w[1])return[0,0];const E=k?S==="map"?d.angle:0:S==="viewport"?-d.angle:0;if(E){const z=Math.sin(E),D=Math.cos(E);w=[w[0]*D-w[1]*z,w[0]*z+w[1]*D]}return[k?w[0]:oi(m,w[0],d.zoom),k?w[1]:oi(m,w[1],d.zoom)]}(g,e,a,u),getCircleRadiusCorrection:g=>1}}class wn{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,a,u,d,m){const w=this._bucketParts;for(;this._currentTileIndex<e.length;)if(a.getBucketParts(w,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,k)=>S.sortKey-k.sortKey));this._currentPartIndex<w.length;)if(a.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,m())return!0;return!1}}class go{constructor(e,a,u,d,m,w,S,k){this.placement=new er(e,Us(),a,w,S,k),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(e,a,u){const d=R.now(),m=()=>!this._forceFullPlacement&&R.now()-d>2;for(;this._currentPlacementIndex>=0;){const w=a[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=S)&&(!w.maxzoom||w.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new wn(w)),this._inProgressLayer.continuePlacement(u[w.source],this.placement,this._showCollisionBoxes,w,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Wr=512/c.X/2;class yn{constructor(e,a,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const d=new Map;for(let m=0;m<a.length;m++){const w=a.get(m),S=w.key,k=d.get(S);k?k.push(w):d.set(S,[w])}for(const[m,w]of d){const S={positions:w.map(k=>({x:Math.floor(k.anchorX*Wr),y:Math.floor(k.anchorY*Wr)})),crossTileIDs:w.map(k=>k.crossTileID)};if(S.positions.length>128){const k=new c.av(S.positions.length,16,Uint16Array);for(const{x:E,y:z}of S.positions)k.add(E,z);k.finish(),delete S.positions,S.index=k}this._symbolsByKey[m]=S}}getScaledCoordinates(e,a){const{x:u,y:d,z:m}=this.tileID.canonical,{x:w,y:S,z:k}=a.canonical,E=Wr/Math.pow(2,k-m),z=(S*c.X+e.anchorY)*E,D=d*c.X*Wr;return{x:Math.floor((w*c.X+e.anchorX)*E-u*c.X*Wr),y:Math.floor(z-D)}}findMatches(e,a,u){const d=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let m=0;m<e.length;m++){const w=e.get(m);if(w.crossTileID)continue;const S=this._symbolsByKey[w.key];if(!S)continue;const k=this.getScaledCoordinates(w,a);if(S.index){const E=S.index.range(k.x-d,k.y-d,k.x+d,k.y+d).sort();for(const z of E){const D=S.crossTileIDs[z];if(!u[D]){u[D]=!0,w.crossTileID=D;break}}}else if(S.positions)for(let E=0;E<S.positions.length;E++){const z=S.positions[E],D=S.crossTileIDs[E];if(Math.abs(z.x-k.x)<=d&&Math.abs(z.y-k.y)<=d&&!u[D]){u[D]=!0,w.crossTileID=D;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class dl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const a=Math.round((e-this.lng)/360);if(a!==0)for(const u in this.indexes){const d=this.indexes[u],m={};for(const w in d){const S=d[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+a),m[S.tileID.key]=S}this.indexes[u]=m}this.lng=e}addBucket(e,a,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let m=0;m<a.symbolInstances.length;m++)a.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const m in this.indexes){const w=this.indexes[m];if(Number(m)>e.overscaledZ)for(const S in w){const k=w[S];k.tileID.isChildOf(e)&&k.findMatches(a.symbolInstances,e,d)}else{const S=w[e.scaledTo(Number(m)).key];S&&S.findMatches(a.symbolInstances,e,d)}}for(let m=0;m<a.symbolInstances.length;m++){const w=a.symbolInstances.get(m);w.crossTileID||(w.crossTileID=u.generate(),d[w.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new yn(e,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(e,a){for(const u of a.getCrossTileIDsLists())for(const d of u)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let a=!1;for(const u in this.indexes){const d=this.indexes[u];for(const m in d)e[d[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[m]),delete d[m],a=!0)}return a}}class Bc{constructor(){this.layerIndexes={},this.crossTileIDs=new dl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,a,u){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new qr);let m=!1;const w={};d.handleWrapJump(u);for(const S of a){const k=S.getBucket(e);k&&e.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(S.tileID,k,this.crossTileIDs)&&(m=!0),w[k.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(m=!0),m}pruneUnusedLayers(e){const a={};e.forEach(u=>{a[u]=!0});for(const u in this.layerIndexes)a[u]||delete this.layerIndexes[u]}}const Zr=(g,e)=>c.t(g,e&&e.filter(a=>a.identifier!=="source.canvas")),Wf=c.aw();class fl extends c.E{constructor(e,a={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const d=this.sourceCaches[u].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new bi(qt(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,d)=>this.getGlyphs(u,d)),this.dispatcher.registerMessageHandler("GI",(u,d)=>this.getImages(u,d)),this.imageManager=new fe,this.imageManager.setEventedParent(this),this.glyphManager=new Ue(e._requestManager,a.localIdeographFontFamily),this.lineAtlas=new Nt(256,512),this.crossTileSymbolIndex=new Bc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),Qt().on(ze,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const d=this.sourceCaches[u.sourceId];if(!d)return;const m=d.getSource();if(m&&m.vectorLayerIds)for(const w in this._layers){const S=this._layers[w];S.source===m.id&&this._validateLayer(S)}})}loadURL(e,a={},u){this.fire(new c.k("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const m=this._loadStyleRequest;c.h(d,this._loadStyleRequest).then(w=>{this._loadStyleRequest=null,this._load(w.data,a,u)}).catch(w=>{this._loadStyleRequest=null,w&&!m.signal.aborted&&this.fire(new c.j(w))})}loadJSON(e,a={},u){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,R.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(e,a,u)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(Wf,{validate:!1})}_load(e,a,u){var d;const m=a.transformStyle?a.transformStyle(u,e):e;if(!a.validate||!Zr(this,c.u(m))){this._loaded=!0,this.stylesheet=m;for(const w in m.sources)this.addSource(w,m.sources[w],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new Xe(this.stylesheet.light),this.sky=new Et(this.stylesheet.sky),this.map.setTerrain((d=this.stylesheet.terrain)!==null&&d!==void 0?d:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const e=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(a=>a.id),this._layers={},this._serializedLayers=null;for(const a of e){const u=c.aA(a);u.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=u}}_loadSprite(e,a=!1,u=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(m,w,S,k){return c._(this,void 0,void 0,function*(){const E=Re(m),z=S>1?"@2x":"",D={},j={};for(const{id:q,url:G}of E){const ee=w.transformRequest(Le(G,z,".json"),"SpriteJSON");D[q]=c.h(ee,k);const se=w.transformRequest(Le(G,z,".png"),"SpriteImage");j[q]=ne.getImage(se,k)}return yield Promise.all([...Object.values(D),...Object.values(j)]),function(q,G){return c._(this,void 0,void 0,function*(){const ee={};for(const se in q){ee[se]={};const oe=R.getImageCanvasContext((yield G[se]).data),ce=(yield q[se]).data;for(const K in ce){const{width:pe,height:ge,x:ke,y:$e,sdf:He,pixelRatio:st,stretchX:dt,stretchY:Qe,content:Je,textFitWidth:vt,textFitHeight:Vt}=ce[K];ee[se][K]={data:null,pixelRatio:st,sdf:He,stretchX:dt,stretchY:Qe,content:Je,textFitWidth:vt,textFitHeight:Vt,spriteData:{width:pe,height:ge,x:ke,y:$e,context:oe}}}}return ee})}(D,j)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(m=>{if(this._spriteRequest=null,m)for(const w in m){this._spritesImagesIds[w]=[];const S=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter(k=>!(k in m)):[];for(const k of S)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in m[w]){const E=w==="default"?k:`${w}:${k}`;this._spritesImagesIds[w].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,m[w][k],!1):this.imageManager.addImage(E,m[w][k]),a&&(this._changedImages[E]=!0)}}}).catch(m=>{this._spriteRequest=null,d=m,this.fire(new c.j(d))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),u&&u(d)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){const a=this.sourceCaches[e.source];if(!a)return;const u=e.sourceLayer;if(!u)return;const d=a.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(u)===-1)&&this.fire(new c.j(new Error(`Source layer "${u}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,a=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(a?c.aB(u):u);const d=[];for(const m of e)if(u[m]){const w=a?c.aB(u[m]):u[m];d.push(w)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const a=Object.keys(this._layers);for(const u of a){const d=this._layers[u];d.type!=="custom"&&(e[u]=d.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const a=this._changed;if(a){const d=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(d.length||m.length)&&this._updateWorkerLayers(d,m);for(const w in this._updatedSources){const S=this._updatedSources[w];if(S==="reload")this._reloadSource(w);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const d in this.sourceCaches){const m=this.sourceCaches[d];u[d]=m.used,m.used=!1}for(const d of this._order){const m=this._layers[d];m.recalculate(e,this._availableImages),!m.isHidden(e.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const d in u){const m=this.sourceCaches[d];!!u[d]!=!!m.used&&m.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,a&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,a={}){var u;this._checkLoaded();const d=this.serialize();if(e=a.transformStyle?a.transformStyle(d,e):e,((u=a.validate)===null||u===void 0||u)&&Zr(this,c.u(e)))return!1;(e=c.aB(e)).layers=c.az(e.layers);const m=c.aC(d,e),w=this._getOperationsToPerform(m);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const S of w.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const a=[],u=[];for(const d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":a.push(()=>this.addLayer.apply(this,d.args));break;case"removeLayer":a.push(()=>this.removeLayer.apply(this,d.args));break;case"setPaintProperty":a.push(()=>this.setPaintProperty.apply(this,d.args));break;case"setLayoutProperty":a.push(()=>this.setLayoutProperty.apply(this,d.args));break;case"setFilter":a.push(()=>this.setFilter.apply(this,d.args));break;case"addSource":a.push(()=>this.addSource.apply(this,d.args));break;case"removeSource":a.push(()=>this.removeSource.apply(this,d.args));break;case"setLayerZoomRange":a.push(()=>this.setLayerZoomRange.apply(this,d.args));break;case"setLight":a.push(()=>this.setLight.apply(this,d.args));break;case"setGeoJSONSourceData":a.push(()=>this.setGeoJSONSourceData.apply(this,d.args));break;case"setGlyphs":a.push(()=>this.setGlyphs.apply(this,d.args));break;case"setSprite":a.push(()=>this.setSprite.apply(this,d.args));break;case"setSky":a.push(()=>this.setSky.apply(this,d.args));break;case"setTerrain":a.push(()=>this.map.setTerrain.apply(this,d.args));break;case"setTransition":a.push(()=>{});break;default:u.push(d.command)}return{operations:a,unimplemented:u}}addImage(e,a){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,a),this._afterImageUpdated(e)}updateImage(e,a){this.imageManager.updateImage(e,a)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,a,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(c.u.source,`sources.${e}`,a,null,u))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const d=this.sourceCaches[e]=new kt(e,a,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e})),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const a=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],a.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,a){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(a),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,a,u={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new c.j(new Error(`Layer "${d}" already exists on this map.`)));let m;if(e.type==="custom"){if(Zr(this,c.aD(e)))return;m=c.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=c.aB(e),e=c.e(e,{source:d})),this._validate(c.u.layer,`layers.${d}`,e,{arrayIndex:-1},u))return;m=c.aA(e),this._validateLayer(m),m.setEventedParent(this,{layer:{id:d}})}const w=a?this._order.indexOf(a):this._order.length;if(a&&w===-1)this.fire(new c.j(new Error(`Cannot add layer "${d}" before non-existing layer "${a}".`)));else{if(this._order.splice(w,0,d),this._layerOrderChanged=!0,this._layers[d]=m,this._removedLayers[d]&&m.source&&m.type!=="custom"){const S=this._removedLayers[d];delete this._removedLayers[d],S.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(e,a){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===a)return;const u=this._order.indexOf(e);this._order.splice(u,1);const d=a?this._order.indexOf(a):this._order.length;a&&d===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${a}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const a=this._layers[e];if(!a)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));a.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=a,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],a.onRemove&&a.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,a,u){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===a&&d.maxzoom===u||(a!=null&&(d.minzoom=a),u!=null&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,a,u={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!c.aE(d.filter,a))return a==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(c.u.filter,`layers.${d.id}.filter`,a,null,u)||(d.filter=c.aB(a),this._updateLayer(d)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aB(this.getLayer(e).filter)}setLayoutProperty(e,a,u,d={}){this._checkLoaded();const m=this.getLayer(e);m?c.aE(m.getLayoutProperty(a),u)||(m.setLayoutProperty(a,u,d),this._updateLayer(m)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,a){const u=this.getLayer(e);if(u)return u.getLayoutProperty(a);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,a,u,d={}){this._checkLoaded();const m=this.getLayer(e);m?c.aE(m.getPaintProperty(a),u)||(m.setPaintProperty(a,u,d)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,a){return this.getLayer(e).getPaintProperty(a)}setFeatureState(e,a){this._checkLoaded();const u=e.source,d=e.sourceLayer,m=this.sourceCaches[u];if(m===void 0)return void this.fire(new c.j(new Error(`The source '${u}' does not exist in the map's style.`)));const w=m.getSource().type;w==="geojson"&&d?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||d?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),m.setFeatureState(d,e.id,a)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,a){this._checkLoaded();const u=e.source,d=this.sourceCaches[u];if(d===void 0)return void this.fire(new c.j(new Error(`The source '${u}' does not exist in the map's style.`)));const m=d.getSource().type,w=m==="vector"?e.sourceLayer:void 0;m!=="vector"||w?a&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(w,e.id,a):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const a=e.source,u=e.sourceLayer,d=this.sourceCaches[a];if(d!==void 0)return d.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),d.getFeatureState(u,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.aF(this.sourceCaches,m=>m.serialize()),a=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,d=this.stylesheet;return c.aG({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,sources:e,layers:a,terrain:u},m=>m!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const a=w=>this._layers[w].type==="fill-extrusion",u={},d=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(a(S)){u[S]=w;for(const k of e){const E=k[S];if(E)for(const z of E)d.push(z)}}}d.sort((w,S)=>S.intersectionZ-w.intersectionZ);const m=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(a(S))for(let k=d.length-1;k>=0;k--){const E=d[k].feature;if(u[E.layer.id]<w)break;m.push(E),d.pop()}else for(const k of e){const E=k[S];if(E)for(const z of E)m.push(z.feature)}}return m}queryRenderedFeatures(e,a,u){a&&a.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",a.filter,null,a);const d={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const S of a.layers){const k=this._layers[S];if(!k)return this.fire(new c.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];d[k.source]=!0}}const m=[];a.availableImages=this._availableImages;const w=this._serializedAllLayers();for(const S in this.sourceCaches)a.layers&&!d[S]||m.push(Qi(this.sourceCaches[S],this._layers,w,e,a,u));return this.placement&&m.push(function(S,k,E,z,D,j,q){const G={},ee=j.queryRenderedSymbols(z),se=[];for(const oe of Object.keys(ee).map(Number))se.push(q[oe]);se.sort(hi);for(const oe of se){const ce=oe.featureIndex.lookupSymbolFeatures(ee[oe.bucketInstanceId],k,oe.bucketIndex,oe.sourceLayerIndex,D.filter,D.layers,D.availableImages,S);for(const K in ce){const pe=G[K]=G[K]||[],ge=ce[K];ge.sort((ke,$e)=>{const He=oe.featureSortOrder;if(He){const st=He.indexOf(ke.featureIndex);return He.indexOf($e.featureIndex)-st}return $e.featureIndex-ke.featureIndex});for(const ke of ge)pe.push(ke)}}for(const oe in G)G[oe].forEach(ce=>{const K=ce.feature,pe=E[S[oe].source].getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=pe});return G}(this._layers,w,this.sourceCaches,e,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(e,a){a&&a.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",a.filter,null,a);const u=this.sourceCaches[e];return u?function(d,m){const w=d.getRenderableIds().map(E=>d.getTileByID(E)),S=[],k={};for(let E=0;E<w.length;E++){const z=w[E],D=z.tileID.canonical.key;k[D]||(k[D]=!0,z.querySourceFeatures(S,m))}return S}(u,a):[]}getLight(){return this.light.getLight()}setLight(e,a={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const w in e)if(!c.aE(e[w],u[w])){d=!0;break}if(!d)return;const m={now:R.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,a),this.light.updateTransitions(m)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,a={}){const u=this.getSky();let d=!1;if(!e&&!u)return;if(e&&!u)d=!0;else if(!e&&u)d=!0;else for(const w in e)if(!c.aE(e[w],u[w])){d=!0;break}if(!d)return;const m={now:R.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,a),this.sky.updateTransitions(m)}_validate(e,a,u,d,m={}){return(!m||m.validate!==!1)&&Zr(this,e.call(c.u,c.e({key:a,style:this.serialize(),value:u,styleSpec:c.v},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Qt().off(ze,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const u=this.sourceCaches[a];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const a in this.sourceCaches)this.sourceCaches[a].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,a,u,d,m=!1){let w=!1,S=!1;const k={};for(const E of this._order){const z=this._layers[E];if(z.type!=="symbol")continue;if(!k[z.source]){const j=this.sourceCaches[z.source];k[z.source]=j.getRenderableIds(!0).map(q=>j.getTileByID(q)).sort((q,G)=>G.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(G.tileID)?-1:1))}const D=this.crossTileSymbolIndex.addLayer(z,k[z.source],e.center.lng);w=w||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(R.now(),e.zoom))&&(this.pauseablePlacement=new go(e,this.map.terrain,this._order,m,a,u,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(R.now()),S=!0),w&&this.pauseablePlacement.placement.setStale()),S||w)for(const E of this._order){const z=this._layers[E];z.type==="symbol"&&this.placement.updateLayerOpacities(z,k[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(R.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,a){return c._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[a.source];return d&&d.setDependencies(a.tileID.key,a.type,a.icons),u})}getGlyphs(e,a){return c._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(a.stacks),d=this.sourceCaches[a.source];return d&&d.setDependencies(a.tileID.key,a.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,a={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,a,u={},d){this._checkLoaded();const m=[{id:e,url:a}],w=[...Re(this.stylesheet.sprite),...m];this._validate(c.u.sprite,"sprite",w,null,u)||(this.stylesheet.sprite=w,this._loadSprite(m,!0,d))}removeSprite(e){this._checkLoaded();const a=Re(this.stylesheet.sprite);if(a.find(u=>u.id===e)){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;a.splice(a.findIndex(u=>u.id===e),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Re(this.stylesheet.sprite)}setSprite(e,a={},u){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,a)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var Ws=c.Y([{name:"a_pos",type:"Int16",components:2}]);const Es={prelude:wi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:wi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:wi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:wi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:wi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:wi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:wi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:wi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:wi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:wi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:wi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:wi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:wi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:wi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:wi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:wi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:wi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:wi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:wi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:wi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:wi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:wi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:wi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:wi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:wi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:wi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:wi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:wi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function wi(g,e){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/attribute ([\w]+) ([\w]+)/g),d=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=m?m.concat(d):d,S={};return{fragmentSource:g=g.replace(a,(k,E,z,D,j)=>(S[j]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${z} ${D} ${j};
#else
uniform ${z} ${D} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${z} ${D} ${j} = u_${j};
#endif
`)),vertexSource:e=e.replace(a,(k,E,z,D,j)=>{const q=D==="float"?"vec2":"vec4",G=j.match(/color/)?"color":q;return S[j]?E==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${z} ${q} a_${j};
varying ${z} ${D} ${j};
#else
uniform ${z} ${D} u_${j};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${z} ${D} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${G}(a_${j}, u_${j}_t);
#else
    ${z} ${D} ${j} = u_${j};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${z} ${q} a_${j};
#else
uniform ${z} ${D} u_${j};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${z} ${D} ${j} = a_${j};
#else
    ${z} ${D} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${z} ${D} ${j} = unpack_mix_${G}(a_${j}, u_${j}_t);
#else
    ${z} ${D} ${j} = u_${j};
#endif
`}),staticAttributes:u,staticUniforms:w}}class Fc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,a,u,d,m,w,S,k,E){this.context=e;let z=this.boundPaintVertexBuffers.length!==d.length;for(let D=0;!z&&D<d.length;D++)this.boundPaintVertexBuffers[D]!==d[D]&&(z=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==u||z||this.boundIndexBuffer!==m||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==E?this.freshBind(a,u,d,m,w,S,k,E):(e.bindVertexArray.set(this.vao),S&&S.bind(),m&&m.dynamicDraw&&m.bind(),k&&k.bind(),E&&E.bind())}freshBind(e,a,u,d,m,w,S,k){const E=e.numAttributes,z=this.context,D=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=k,a.enableAttributes(D,e);for(const j of u)j.enableAttributes(D,e);w&&w.enableAttributes(D,e),S&&S.enableAttributes(D,e),k&&k.enableAttributes(D,e),a.bind(),a.setVertexAttribPointers(D,e,m);for(const j of u)j.bind(),j.setVertexAttribPointers(D,e,m);w&&(w.bind(),w.setVertexAttribPointers(D,e,m)),d&&d.bind(),S&&(S.bind(),S.setVertexAttribPointers(D,e,m)),k&&(k.bind(),k.setVertexAttribPointers(D,e,m)),z.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Nc=(g,e,a,u,d)=>({u_matrix:g,u_texture:0,u_ele_delta:e,u_fog_matrix:a,u_fog_color:u?u.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:u?u.calculateFogBlendOpacity(d):0,u_horizon_color:u?u.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1});function Ma(g){const e=[];for(let a=0;a<g.length;a++){if(g[a]===null)continue;const u=g[a].split(" ");e.push(u.pop())}return e}class $c{constructor(e,a,u,d,m,w){const S=e.gl;this.program=S.createProgram();const k=Ma(a.staticAttributes),E=u?u.getBinderAttributes():[],z=k.concat(E),D=Es.prelude.staticUniforms?Ma(Es.prelude.staticUniforms):[],j=a.staticUniforms?Ma(a.staticUniforms):[],q=u?u.getBinderUniforms():[],G=D.concat(j).concat(q),ee=[];for(const ke of G)ee.indexOf(ke)<0&&ee.push(ke);const se=u?u.defines():[];m&&se.push("#define OVERDRAW_INSPECTOR;"),w&&se.push("#define TERRAIN3D;");const oe=se.concat(Es.prelude.fragmentSource,a.fragmentSource).join(`
`),ce=se.concat(Es.prelude.vertexSource,a.vertexSource).join(`
`),K=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(K,oe),S.compileShader(K),!S.getShaderParameter(K,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(K)}`);S.attachShader(this.program,K);const pe=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(pe,ce),S.compileShader(pe),!S.getShaderParameter(pe,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(pe)}`);S.attachShader(this.program,pe),this.attributes={};const ge={};this.numAttributes=z.length;for(let ke=0;ke<this.numAttributes;ke++)z[ke]&&(S.bindAttribLocation(this.program,ke,z[ke]),this.attributes[z[ke]]=ke);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(pe),S.deleteShader(K);for(let ke=0;ke<ee.length;ke++){const $e=ee[ke];if($e&&!ge[$e]){const He=S.getUniformLocation(this.program,$e);He&&(ge[$e]=He)}}this.fixedUniforms=d(e,ge),this.terrainUniforms=((ke,$e)=>({u_depth:new c.aH(ke,$e.u_depth),u_terrain:new c.aH(ke,$e.u_terrain),u_terrain_dim:new c.aI(ke,$e.u_terrain_dim),u_terrain_matrix:new c.aJ(ke,$e.u_terrain_matrix),u_terrain_unpack:new c.aK(ke,$e.u_terrain_unpack),u_terrain_exaggeration:new c.aI(ke,$e.u_terrain_exaggeration)}))(e,ge),this.binderUniforms=u?u.getUniforms(e,ge):[]}draw(e,a,u,d,m,w,S,k,E,z,D,j,q,G,ee,se,oe,ce){const K=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(d),e.setColorMode(m),e.setCullFace(w),k){e.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,k.depthTexture),e.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,k.texture);for(const ge in this.terrainUniforms)this.terrainUniforms[ge].set(k[ge])}for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(S[ge]);ee&&ee.setUniforms(e,this.binderUniforms,q,{zoom:G});let pe=0;switch(a){case K.LINES:pe=2;break;case K.TRIANGLES:pe=3;break;case K.LINE_STRIP:pe=1}for(const ge of j.get()){const ke=ge.vaos||(ge.vaos={});(ke[E]||(ke[E]=new Fc)).bind(e,this,z,ee?ee.getPaintVertexBuffers():[],D,ge.vertexOffset,se,oe,ce),K.drawElements(a,ge.primitiveLength*pe,K.UNSIGNED_SHORT,ge.primitiveOffset*pe*2)}}}function pl(g,e,a){const u=1/oi(a,1,e.transform.tileZoom),d=Math.pow(2,a.tileID.overscaledZ),m=a.tileSize*Math.pow(2,e.transform.tileZoom)/d,w=m*(a.tileID.canonical.x+a.tileID.wrap*d),S=m*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[u,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const yo=(g,e,a,u)=>{const d=e.style.light,m=d.properties.get("position"),w=[m.x,m.y,m.z],S=function(){var E=new c.A(9);return c.A!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[5]=0,E[6]=0,E[7]=0),E[0]=1,E[4]=1,E[8]=1,E}();d.properties.get("anchor")==="viewport"&&function(E,z){var D=Math.sin(z),j=Math.cos(z);E[0]=j,E[1]=D,E[2]=0,E[3]=-D,E[4]=j,E[5]=0,E[6]=0,E[7]=0,E[8]=1}(S,-e.transform.angle),function(E,z,D){var j=z[0],q=z[1],G=z[2];E[0]=j*D[0]+q*D[3]+G*D[6],E[1]=j*D[1]+q*D[4]+G*D[7],E[2]=j*D[2]+q*D[5]+G*D[8]}(w,w,S);const k=d.properties.get("color");return{u_matrix:g,u_lightpos:w,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+a,u_opacity:u}},ml=(g,e,a,u,d,m,w)=>c.e(yo(g,e,a,u),pl(m,e,w),{u_height_factor:-Math.pow(2,d.overscaledZ)/w.tileSize/8}),Aa=g=>({u_matrix:g}),kh=(g,e,a,u)=>c.e(Aa(g),pl(a,e,u)),qf=(g,e)=>({u_matrix:g,u_world:e}),Mh=(g,e,a,u,d)=>c.e(kh(g,e,a,u),{u_world:d}),Zf=(g,e,a,u)=>{const d=g.transform;let m,w;if(u.paint.get("circle-pitch-alignment")==="map"){const S=oi(a,1,d.zoom);m=!0,w=[S,S]}else m=!1,w=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:g.translatePosMatrix(e.posMatrix,a,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+m,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:w}},qs=(g,e,a)=>({u_matrix:g,u_inv_matrix:e,u_camera_to_center_distance:a.cameraToCenterDistance,u_viewport_size:[a.width,a.height]}),_o=(g,e,a=1)=>({u_matrix:g,u_color:e,u_overlay:0,u_overlay_scale:a}),fr=g=>({u_matrix:g}),pr=(g,e,a,u)=>({u_matrix:g,u_extrude_scale:oi(e,1,a),u_intensity:u}),gl=(g,e,a,u)=>{const d=c.H();c.aP(d,0,g.width,g.height,0,0,1);const m=g.context.gl;return{u_matrix:d,u_world:[m.drawingBufferWidth,m.drawingBufferHeight],u_image:a,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}};function yl(g,e){const a=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new c.Z(0,u/a).toLngLat().lat,new c.Z(0,(u+1)/a).toLngLat().lat]}const _l=(g,e,a,u)=>{const d=g.transform;return{u_matrix:Eh(g,e,a,u),u_ratio:1/oi(e,1,d.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Ah=(g,e,a,u,d)=>c.e(_l(g,e,a,d),{u_image:0,u_image_height:u}),Ia=(g,e,a,u,d)=>{const m=g.transform,w=Ih(e,m);return{u_matrix:Eh(g,e,a,d),u_texsize:e.imageAtlasTexture.size,u_ratio:1/oi(e,1,m.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[w,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Gf=(g,e,a,u,d,m)=>{const w=g.lineAtlas,S=Ih(e,g.transform),k=a.layout.get("line-cap")==="round",E=w.getDash(u.from,k),z=w.getDash(u.to,k),D=E.width*d.fromScale,j=z.width*d.toScale;return c.e(_l(g,e,a,m),{u_patternscale_a:[S/D,-E.height/2],u_patternscale_b:[S/j,-z.height/2],u_sdfgamma:w.width/(256*Math.min(D,j)*g.pixelRatio)/2,u_image:0,u_tex_y_a:E.y,u_tex_y_b:z.y,u_mix:d.t})};function Ih(g,e){return 1/oi(g,1,e.tileZoom)}function Eh(g,e,a,u){return g.translatePosMatrix(u?u.posMatrix:e.tileID.posMatrix,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Hf=(g,e,a,u,d)=>{return{u_matrix:g,u_tl_parent:e,u_scale_parent:a,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(w=d.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(m=d.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:Xf(d.paint.get("raster-hue-rotate"))};var m,w};function Xf(g){g*=Math.PI/180;const e=Math.sin(g),a=Math.cos(g);return[(2*a+1)/3,(-Math.sqrt(3)*e-a+1)/3,(Math.sqrt(3)*e-a+1)/3]}const Ch=(g,e,a,u,d,m,w,S,k,E,z,D,j,q)=>{const G=w.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:G.width/G.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:k,u_coord_matrix:E,u_is_text:+D,u_pitch_with_map:+u,u_is_along_line:d,u_is_variable_anchor:m,u_texsize:j,u_texture:0,u_translation:z,u_pitched_scale:q}},vo=(g,e,a,u,d,m,w,S,k,E,z,D,j,q,G)=>{const ee=w.transform;return c.e(Ch(g,e,a,u,d,m,w,S,k,E,z,D,j,G),{u_gamma_scale:u?Math.cos(ee._pitch)*ee.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:+q})},jc=(g,e,a,u,d,m,w,S,k,E,z,D,j,q)=>c.e(vo(g,e,a,u,d,m,w,S,k,E,z,!0,D,!0,q),{u_texsize_icon:j,u_texture_icon:1}),vl=(g,e,a)=>({u_matrix:g,u_opacity:e,u_color:a}),Vc=(g,e,a,u,d,m)=>c.e(function(w,S,k,E){const z=k.imageManager.getPattern(w.from.toString()),D=k.imageManager.getPattern(w.to.toString()),{width:j,height:q}=k.imageManager.getPixelSize(),G=Math.pow(2,E.tileID.overscaledZ),ee=E.tileSize*Math.pow(2,k.transform.tileZoom)/G,se=ee*(E.tileID.canonical.x+E.tileID.wrap*G),oe=ee*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[j,q],u_mix:S.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/oi(E,1,k.transform.tileZoom),u_pixel_coord_upper:[se>>16,oe>>16],u_pixel_coord_lower:[65535&se,65535&oe]}}(u,m,a,d),{u_matrix:g,u_opacity:e}),Uc={fillExtrusion:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_lightpos:new c.aN(g,e.u_lightpos),u_lightintensity:new c.aI(g,e.u_lightintensity),u_lightcolor:new c.aN(g,e.u_lightcolor),u_vertical_gradient:new c.aI(g,e.u_vertical_gradient),u_opacity:new c.aI(g,e.u_opacity)}),fillExtrusionPattern:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_lightpos:new c.aN(g,e.u_lightpos),u_lightintensity:new c.aI(g,e.u_lightintensity),u_lightcolor:new c.aN(g,e.u_lightcolor),u_vertical_gradient:new c.aI(g,e.u_vertical_gradient),u_height_factor:new c.aI(g,e.u_height_factor),u_image:new c.aH(g,e.u_image),u_texsize:new c.aO(g,e.u_texsize),u_pixel_coord_upper:new c.aO(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(g,e.u_pixel_coord_lower),u_scale:new c.aN(g,e.u_scale),u_fade:new c.aI(g,e.u_fade),u_opacity:new c.aI(g,e.u_opacity)}),fill:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix)}),fillPattern:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_image:new c.aH(g,e.u_image),u_texsize:new c.aO(g,e.u_texsize),u_pixel_coord_upper:new c.aO(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(g,e.u_pixel_coord_lower),u_scale:new c.aN(g,e.u_scale),u_fade:new c.aI(g,e.u_fade)}),fillOutline:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_world:new c.aO(g,e.u_world)}),fillOutlinePattern:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_world:new c.aO(g,e.u_world),u_image:new c.aH(g,e.u_image),u_texsize:new c.aO(g,e.u_texsize),u_pixel_coord_upper:new c.aO(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(g,e.u_pixel_coord_lower),u_scale:new c.aN(g,e.u_scale),u_fade:new c.aI(g,e.u_fade)}),circle:(g,e)=>({u_camera_to_center_distance:new c.aI(g,e.u_camera_to_center_distance),u_scale_with_map:new c.aH(g,e.u_scale_with_map),u_pitch_with_map:new c.aH(g,e.u_pitch_with_map),u_extrude_scale:new c.aO(g,e.u_extrude_scale),u_device_pixel_ratio:new c.aI(g,e.u_device_pixel_ratio),u_matrix:new c.aJ(g,e.u_matrix)}),collisionBox:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_pixel_extrude_scale:new c.aO(g,e.u_pixel_extrude_scale)}),collisionCircle:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_inv_matrix:new c.aJ(g,e.u_inv_matrix),u_camera_to_center_distance:new c.aI(g,e.u_camera_to_center_distance),u_viewport_size:new c.aO(g,e.u_viewport_size)}),debug:(g,e)=>({u_color:new c.aL(g,e.u_color),u_matrix:new c.aJ(g,e.u_matrix),u_overlay:new c.aH(g,e.u_overlay),u_overlay_scale:new c.aI(g,e.u_overlay_scale)}),clippingMask:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix)}),heatmap:(g,e)=>({u_extrude_scale:new c.aI(g,e.u_extrude_scale),u_intensity:new c.aI(g,e.u_intensity),u_matrix:new c.aJ(g,e.u_matrix)}),heatmapTexture:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_world:new c.aO(g,e.u_world),u_image:new c.aH(g,e.u_image),u_color_ramp:new c.aH(g,e.u_color_ramp),u_opacity:new c.aI(g,e.u_opacity)}),hillshade:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_image:new c.aH(g,e.u_image),u_latrange:new c.aO(g,e.u_latrange),u_light:new c.aO(g,e.u_light),u_shadow:new c.aL(g,e.u_shadow),u_highlight:new c.aL(g,e.u_highlight),u_accent:new c.aL(g,e.u_accent)}),hillshadePrepare:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_image:new c.aH(g,e.u_image),u_dimension:new c.aO(g,e.u_dimension),u_zoom:new c.aI(g,e.u_zoom),u_unpack:new c.aK(g,e.u_unpack)}),line:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_ratio:new c.aI(g,e.u_ratio),u_device_pixel_ratio:new c.aI(g,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(g,e.u_units_to_pixels)}),lineGradient:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_ratio:new c.aI(g,e.u_ratio),u_device_pixel_ratio:new c.aI(g,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(g,e.u_units_to_pixels),u_image:new c.aH(g,e.u_image),u_image_height:new c.aI(g,e.u_image_height)}),linePattern:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_texsize:new c.aO(g,e.u_texsize),u_ratio:new c.aI(g,e.u_ratio),u_device_pixel_ratio:new c.aI(g,e.u_device_pixel_ratio),u_image:new c.aH(g,e.u_image),u_units_to_pixels:new c.aO(g,e.u_units_to_pixels),u_scale:new c.aN(g,e.u_scale),u_fade:new c.aI(g,e.u_fade)}),lineSDF:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_ratio:new c.aI(g,e.u_ratio),u_device_pixel_ratio:new c.aI(g,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(g,e.u_units_to_pixels),u_patternscale_a:new c.aO(g,e.u_patternscale_a),u_patternscale_b:new c.aO(g,e.u_patternscale_b),u_sdfgamma:new c.aI(g,e.u_sdfgamma),u_image:new c.aH(g,e.u_image),u_tex_y_a:new c.aI(g,e.u_tex_y_a),u_tex_y_b:new c.aI(g,e.u_tex_y_b),u_mix:new c.aI(g,e.u_mix)}),raster:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_tl_parent:new c.aO(g,e.u_tl_parent),u_scale_parent:new c.aI(g,e.u_scale_parent),u_buffer_scale:new c.aI(g,e.u_buffer_scale),u_fade_t:new c.aI(g,e.u_fade_t),u_opacity:new c.aI(g,e.u_opacity),u_image0:new c.aH(g,e.u_image0),u_image1:new c.aH(g,e.u_image1),u_brightness_low:new c.aI(g,e.u_brightness_low),u_brightness_high:new c.aI(g,e.u_brightness_high),u_saturation_factor:new c.aI(g,e.u_saturation_factor),u_contrast_factor:new c.aI(g,e.u_contrast_factor),u_spin_weights:new c.aN(g,e.u_spin_weights)}),symbolIcon:(g,e)=>({u_is_size_zoom_constant:new c.aH(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(g,e.u_is_size_feature_constant),u_size_t:new c.aI(g,e.u_size_t),u_size:new c.aI(g,e.u_size),u_camera_to_center_distance:new c.aI(g,e.u_camera_to_center_distance),u_pitch:new c.aI(g,e.u_pitch),u_rotate_symbol:new c.aH(g,e.u_rotate_symbol),u_aspect_ratio:new c.aI(g,e.u_aspect_ratio),u_fade_change:new c.aI(g,e.u_fade_change),u_matrix:new c.aJ(g,e.u_matrix),u_label_plane_matrix:new c.aJ(g,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(g,e.u_coord_matrix),u_is_text:new c.aH(g,e.u_is_text),u_pitch_with_map:new c.aH(g,e.u_pitch_with_map),u_is_along_line:new c.aH(g,e.u_is_along_line),u_is_variable_anchor:new c.aH(g,e.u_is_variable_anchor),u_texsize:new c.aO(g,e.u_texsize),u_texture:new c.aH(g,e.u_texture),u_translation:new c.aO(g,e.u_translation),u_pitched_scale:new c.aI(g,e.u_pitched_scale)}),symbolSDF:(g,e)=>({u_is_size_zoom_constant:new c.aH(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(g,e.u_is_size_feature_constant),u_size_t:new c.aI(g,e.u_size_t),u_size:new c.aI(g,e.u_size),u_camera_to_center_distance:new c.aI(g,e.u_camera_to_center_distance),u_pitch:new c.aI(g,e.u_pitch),u_rotate_symbol:new c.aH(g,e.u_rotate_symbol),u_aspect_ratio:new c.aI(g,e.u_aspect_ratio),u_fade_change:new c.aI(g,e.u_fade_change),u_matrix:new c.aJ(g,e.u_matrix),u_label_plane_matrix:new c.aJ(g,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(g,e.u_coord_matrix),u_is_text:new c.aH(g,e.u_is_text),u_pitch_with_map:new c.aH(g,e.u_pitch_with_map),u_is_along_line:new c.aH(g,e.u_is_along_line),u_is_variable_anchor:new c.aH(g,e.u_is_variable_anchor),u_texsize:new c.aO(g,e.u_texsize),u_texture:new c.aH(g,e.u_texture),u_gamma_scale:new c.aI(g,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(g,e.u_device_pixel_ratio),u_is_halo:new c.aH(g,e.u_is_halo),u_translation:new c.aO(g,e.u_translation),u_pitched_scale:new c.aI(g,e.u_pitched_scale)}),symbolTextAndIcon:(g,e)=>({u_is_size_zoom_constant:new c.aH(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(g,e.u_is_size_feature_constant),u_size_t:new c.aI(g,e.u_size_t),u_size:new c.aI(g,e.u_size),u_camera_to_center_distance:new c.aI(g,e.u_camera_to_center_distance),u_pitch:new c.aI(g,e.u_pitch),u_rotate_symbol:new c.aH(g,e.u_rotate_symbol),u_aspect_ratio:new c.aI(g,e.u_aspect_ratio),u_fade_change:new c.aI(g,e.u_fade_change),u_matrix:new c.aJ(g,e.u_matrix),u_label_plane_matrix:new c.aJ(g,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(g,e.u_coord_matrix),u_is_text:new c.aH(g,e.u_is_text),u_pitch_with_map:new c.aH(g,e.u_pitch_with_map),u_is_along_line:new c.aH(g,e.u_is_along_line),u_is_variable_anchor:new c.aH(g,e.u_is_variable_anchor),u_texsize:new c.aO(g,e.u_texsize),u_texsize_icon:new c.aO(g,e.u_texsize_icon),u_texture:new c.aH(g,e.u_texture),u_texture_icon:new c.aH(g,e.u_texture_icon),u_gamma_scale:new c.aI(g,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(g,e.u_device_pixel_ratio),u_is_halo:new c.aH(g,e.u_is_halo),u_translation:new c.aO(g,e.u_translation),u_pitched_scale:new c.aI(g,e.u_pitched_scale)}),background:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_opacity:new c.aI(g,e.u_opacity),u_color:new c.aL(g,e.u_color)}),backgroundPattern:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_opacity:new c.aI(g,e.u_opacity),u_image:new c.aH(g,e.u_image),u_pattern_tl_a:new c.aO(g,e.u_pattern_tl_a),u_pattern_br_a:new c.aO(g,e.u_pattern_br_a),u_pattern_tl_b:new c.aO(g,e.u_pattern_tl_b),u_pattern_br_b:new c.aO(g,e.u_pattern_br_b),u_texsize:new c.aO(g,e.u_texsize),u_mix:new c.aI(g,e.u_mix),u_pattern_size_a:new c.aO(g,e.u_pattern_size_a),u_pattern_size_b:new c.aO(g,e.u_pattern_size_b),u_scale_a:new c.aI(g,e.u_scale_a),u_scale_b:new c.aI(g,e.u_scale_b),u_pixel_coord_upper:new c.aO(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(g,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(g,e.u_tile_units_to_pixels)}),terrain:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_texture:new c.aH(g,e.u_texture),u_ele_delta:new c.aI(g,e.u_ele_delta),u_fog_matrix:new c.aJ(g,e.u_fog_matrix),u_fog_color:new c.aL(g,e.u_fog_color),u_fog_ground_blend:new c.aI(g,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(g,e.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(g,e.u_horizon_color),u_horizon_fog_blend:new c.aI(g,e.u_horizon_fog_blend)}),terrainDepth:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_ele_delta:new c.aI(g,e.u_ele_delta)}),terrainCoords:(g,e)=>({u_matrix:new c.aJ(g,e.u_matrix),u_texture:new c.aH(g,e.u_texture),u_terrain_coords_id:new c.aI(g,e.u_terrain_coords_id),u_ele_delta:new c.aI(g,e.u_ele_delta)}),sky:(g,e)=>({u_sky_color:new c.aL(g,e.u_sky_color),u_horizon_color:new c.aL(g,e.u_horizon_color),u_horizon:new c.aI(g,e.u_horizon),u_sky_horizon_blend:new c.aI(g,e.u_sky_horizon_blend)})};class ls{constructor(e,a,u){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yf={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Wc{constructor(e,a,u,d){this.length=a.length,this.attributes=u,this.itemSize=a.bytesPerElement,this.dynamicDraw=d,this.context=e;const m=e.gl;this.buffer=m.createBuffer(),e.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,a){for(let u=0;u<this.attributes.length;u++){const d=a.attributes[this.attributes[u].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,a,u){for(let d=0;d<this.attributes.length;d++){const m=this.attributes[d],w=a.attributes[m.name];w!==void 0&&e.vertexAttribPointer(w,m.components,e[Yf[m.type]],!1,this.itemSize,m.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Zs=new WeakMap;function Cs(g){var e;if(Zs.has(g))return Zs.get(g);{const a=(e=g.getParameter(g.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Zs.set(g,a),a}}class Si{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class bl extends Si{getDefault(){return c.aM.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Kf extends Si{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ea extends Si{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Jf extends Si{getDefault(){return[!0,!0,!0,!0]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ph extends Si{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Qf extends Si{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class zh extends Si{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const a=this.current;(e.func!==a.func||e.ref!==a.ref||e.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class qc extends Si{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Dh extends Si{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=e,this.dirty=!1}}class Lh extends Si{getDefault(){return[0,1]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Rh extends Si{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=e,this.dirty=!1}}class Oh extends Si{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Gs extends Si{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.BLEND):a.disable(a.BLEND),this.current=e,this.dirty=!1}}class Bh extends Si{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ep extends Si{getDefault(){return c.aM.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Fh extends Si{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class bo extends Si{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=e,this.dirty=!1}}class xl extends Si{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class tp extends Si{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ip extends Si{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Nh extends Si{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class $h extends Si{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class jh extends Si{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Zc extends Si{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Vh extends Si{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class wl extends Si{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class gs extends Si{getDefault(){return null}set(e){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Gc extends Si{getDefault(){return null}set(e){var a;if(e===this.current&&!this.dirty)return;const u=this.gl;Cs(u)?u.bindVertexArray(e):(a=u.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Hc extends Si{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Xc extends Si{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Uh extends Si{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class xo extends Si{constructor(e,a){super(e),this.context=e,this.parent=a}getDefault(){return null}}class Hs extends xo{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Yc extends xo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class np extends xo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class rp{constructor(e,a,u,d,m){this.context=e,this.width=a,this.height=u;const w=e.gl,S=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Hs(e,S),d)this.depthAttachment=m?new np(e,S):new Yc(e,S);else if(m)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,a=this.colorAttachment.get();if(a&&e.deleteTexture(a),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class fn{constructor(e,a,u){this.blendFunction=e,this.blendColor=a,this.mask=u}}fn.Replace=[1,0],fn.disabled=new fn(fn.Replace,c.aM.transparent,[!1,!1,!1,!1]),fn.unblended=new fn(fn.Replace,c.aM.transparent,[!0,!0,!0,!0]),fn.alphaBlended=new fn([1,771],c.aM.transparent,[!0,!0,!0,!0]);class sp{constructor(e){var a,u;if(this.gl=e,this.clearColor=new bl(this),this.clearDepth=new Kf(this),this.clearStencil=new Ea(this),this.colorMask=new Jf(this),this.depthMask=new Ph(this),this.stencilMask=new Qf(this),this.stencilFunc=new zh(this),this.stencilOp=new qc(this),this.stencilTest=new Dh(this),this.depthRange=new Lh(this),this.depthTest=new Rh(this),this.depthFunc=new Oh(this),this.blend=new Gs(this),this.blendFunc=new Bh(this),this.blendColor=new ep(this),this.blendEquation=new Fh(this),this.cullFace=new bo(this),this.cullFaceSide=new xl(this),this.frontFace=new tp(this),this.program=new ip(this),this.activeTexture=new Nh(this),this.viewport=new $h(this),this.bindFramebuffer=new jh(this),this.bindRenderbuffer=new Zc(this),this.bindTexture=new Vh(this),this.bindVertexBuffer=new wl(this),this.bindElementBuffer=new gs(this),this.bindVertexArray=new Gc(this),this.pixelStoreUnpack=new Hc(this),this.pixelStoreUnpackPremultiplyAlpha=new Xc(this),this.pixelStoreUnpackFlipY=new Uh(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Cs(e)){this.HALF_FLOAT=e.HALF_FLOAT;const d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=e.RGBA16F)!==null&&a!==void 0?a:d==null?void 0:d.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:d==null?void 0:d.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d==null?void 0:d.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,a){return new ls(this,e,a)}createVertexBuffer(e,a,u){return new Wc(this,e,a,u)}createRenderbuffer(e,a,u){const d=this.gl,m=d.createRenderbuffer();return this.bindRenderbuffer.set(m),d.renderbufferStorage(d.RENDERBUFFER,e,a,u),this.bindRenderbuffer.set(null),m}createFramebuffer(e,a,u,d){return new rp(this,e,a,u,d)}clear({color:e,depth:a,stencil:u}){const d=this.gl;let m=0;e&&(m|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(m|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),u!==void 0&&(m|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(m)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aE(e.blendFunction,fn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Cs(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var a;return Cs(this.gl)?this.gl.deleteVertexArray(e):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class ii{constructor(e,a,u){this.func=e,this.mask=a,this.range=u}}ii.ReadOnly=!1,ii.ReadWrite=!0,ii.disabled=new ii(519,ii.ReadOnly,[0,1]);const Kc=7680;class Ui{constructor(e,a,u,d,m,w){this.test=e,this.ref=a,this.mask=u,this.fail=d,this.depthFail=m,this.pass=w}}Ui.disabled=new Ui({func:519,mask:0},0,0,Kc,Kc,Kc);class Ci{constructor(e,a,u){this.enable=e,this.mode=a,this.frontFace=u}}let Xs;function wo(g,e,a,u,d){const m=g.context,w=m.gl,S=g.useProgram("collisionBox"),k=[];let E=0,z=0;for(let oe=0;oe<u.length;oe++){const ce=u[oe],K=e.getTile(ce).getBucket(a);if(!K)continue;const pe=d?K.textCollisionBox:K.iconCollisionBox,ge=K.collisionCircleArray;if(ge.length>0){const ke=c.H();c.aQ(ke,K.placementInvProjMatrix,g.transform.glCoordMatrix),c.aQ(ke,ke,K.placementViewportMatrix),k.push({circleArray:ge,circleOffset:z,transform:ce.posMatrix,invTransform:ke,coord:ce}),E+=ge.length/4,z=E}pe&&S.draw(m,w.LINES,ii.disabled,Ui.disabled,g.colorModeForRenderPass(),Ci.disabled,{u_matrix:ce.posMatrix,u_pixel_extrude_scale:[1/(D=g.transform).width,1/D.height]},g.style.map.terrain&&g.style.map.terrain.getTerrainData(ce),a.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,null,g.transform.zoom,null,null,pe.collisionVertexBuffer)}var D;if(!d||!k.length)return;const j=g.useProgram("collisionCircle"),q=new c.aR;q.resize(4*E),q._trim();let G=0;for(const oe of k)for(let ce=0;ce<oe.circleArray.length/4;ce++){const K=4*ce,pe=oe.circleArray[K+0],ge=oe.circleArray[K+1],ke=oe.circleArray[K+2],$e=oe.circleArray[K+3];q.emplace(G++,pe,ge,ke,$e,0),q.emplace(G++,pe,ge,ke,$e,1),q.emplace(G++,pe,ge,ke,$e,2),q.emplace(G++,pe,ge,ke,$e,3)}(!Xs||Xs.length<2*E)&&(Xs=function(oe){const ce=2*oe,K=new c.aT;K.resize(ce),K._trim();for(let pe=0;pe<ce;pe++){const ge=6*pe;K.uint16[ge+0]=4*pe+0,K.uint16[ge+1]=4*pe+1,K.uint16[ge+2]=4*pe+2,K.uint16[ge+3]=4*pe+2,K.uint16[ge+4]=4*pe+3,K.uint16[ge+5]=4*pe+0}return K}(E));const ee=m.createIndexBuffer(Xs,!0),se=m.createVertexBuffer(q,c.aS.members,!0);for(const oe of k){const ce=qs(oe.transform,oe.invTransform,g.transform);j.draw(m,w.TRIANGLES,ii.disabled,Ui.disabled,g.colorModeForRenderPass(),Ci.disabled,ce,g.style.map.terrain&&g.style.map.terrain.getTerrainData(oe.coord),a.id,se,ee,c.a0.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,g.transform.zoom,null,null,null)}se.destroy(),ee.destroy()}Ci.disabled=new Ci(!1,1029,2305),Ci.backCCW=new Ci(!0,1029,2305);const Tl=c.an(new Float32Array(16));function Ys(g,e,a,u,d,m){const{horizontalAlign:w,verticalAlign:S}=c.au(g);return new c.P((-(w-.5)*e/d+u[0])*m,(-(S-.5)*a/d+u[1])*m)}function Ca(g,e,a,u,d,m){const w=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=u.mult(m);a||(S=S.rotate(-d));const k=w.add(S);return ie(k.x,k.y,e.labelPlaneMatrix,e.getElevation).point}if(a){const S=Pe(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(g),k=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return g.add(u.rotate(k))}return g.add(u)}function Nr(g,e,a,u,d,m,w,S,k,E,z,D,j,q){const G=g.text.placedSymbolArray,ee=g.text.dynamicLayoutVertexArray,se=g.icon.dynamicLayoutVertexArray,oe={};ee.clear();for(let ce=0;ce<G.length;ce++){const K=G.get(ce),pe=K.hidden||!K.crossTileID||g.allowVerticalPlacement&&!K.placedOrientation?null:u[K.crossTileID];if(pe){const ge=new c.P(K.anchorX,K.anchorY),ke={getElevation:q,width:d.width,height:d.height,labelPlaneMatrix:m,lineVertexArray:null,pitchWithMap:a,projection:z,projectionCache:null,tileAnchorPoint:ge,translation:D,unwrappedTileID:j},$e=a?ie(ge.x,ge.y,w,q):Pe(ge.x,ge.y,ke),He=F(d.cameraToCenterDistance,$e.signedDistanceFromCamera);let st=c.ai(g.textSizeData,k,K)*He/c.ap;a&&(st*=g.tilePixelRatio/S);const{width:dt,height:Qe,anchor:Je,textOffset:vt,textBoxScale:Vt}=pe,it=Ys(Je,dt,Qe,vt,Vt,st),lt=z.getPitchedTextCorrection(d,ge.add(new c.P(D[0],D[1])),j),Ot=Ca($e.point,ke,e,it,d.angle,lt),Hi=g.allowVerticalPlacement&&K.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let Jt=0;Jt<K.numGlyphs;Jt++)c.aj(ee,Ot,Hi);E&&K.associatedIconIndex>=0&&(oe[K.associatedIconIndex]={shiftedAnchor:Ot,angle:Hi})}else Pt(K.numGlyphs,ee)}if(E){se.clear();const ce=g.icon.placedSymbolArray;for(let K=0;K<ce.length;K++){const pe=ce.get(K);if(pe.hidden)Pt(pe.numGlyphs,se);else{const ge=oe[K];if(ge)for(let ke=0;ke<pe.numGlyphs;ke++)c.aj(se,ge.shiftedAnchor,ge.angle);else Pt(pe.numGlyphs,se)}}g.icon.dynamicLayoutVertexBuffer.updateData(se)}g.text.dynamicLayoutVertexBuffer.updateData(ee)}function Wh(g,e,a){return a.iconsInText&&e?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Jc(g,e,a,u,d,m,w,S,k,E,z,D){const j=g.context,q=j.gl,G=g.transform,ee=Us(),se=S==="map",oe=k==="map",ce=S!=="viewport"&&a.layout.get("symbol-placement")!=="point",K=se&&!oe&&!ce,pe=!oe&&ce,ge=!a.layout.get("symbol-sort-key").isConstant();let ke=!1;const $e=g.depthModeForSublayer(0,ii.ReadOnly),He=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),st=[],dt=ee.getCircleRadiusCorrection(G);for(const Qe of u){const Je=e.getTile(Qe),vt=Je.getBucket(a);if(!vt)continue;const Vt=d?vt.text:vt.icon;if(!Vt||!Vt.segments.get().length||!Vt.hasVisibleVertices)continue;const it=Vt.programConfigurations.get(a.id),lt=d||vt.sdfIcons,Ot=d?vt.textSizeData:vt.iconSizeData,Hi=oe||G.pitch!==0,Jt=g.useProgram(Wh(lt,d,vt),it),ci=c.ag(Ot,G.zoom),Xi=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Qe);let qn,Yr,Yi,yr,ir=[0,0],nr=null;if(d)Yr=Je.glyphAtlasTexture,Yi=q.LINEAR,qn=Je.glyphAtlasTexture.size,vt.iconsInText&&(ir=Je.imageAtlasTexture.size,nr=Je.imageAtlasTexture,yr=Hi||g.options.rotating||g.options.zooming||Ot.kind==="composite"||Ot.kind==="camera"?q.LINEAR:q.NEAREST);else{const rn=a.layout.get("icon-size").constantOr(0)!==1||vt.iconsNeedLinear;Yr=Je.imageAtlasTexture,Yi=lt||g.options.rotating||g.options.zooming||rn||Hi?q.LINEAR:q.NEAREST,qn=Je.imageAtlasTexture.size}const rr=oi(Je,1,g.transform.zoom),us=pe?Qe.posMatrix:Tl,Fa=Ur(us,oe,se,g.transform,rr),$l=En(us,oe,se,g.transform,rr),Kr=En(Qe.posMatrix,oe,se,g.transform,rr),sa=ee.translatePosition(g.transform,Je,m,w),jl=He&&vt.hasTextData(),yu=a.layout.get("icon-text-fit")!=="none"&&jl&&vt.hasIconData();if(ce){const rn=g.style.map.terrain?(Na,Vl)=>g.style.map.terrain.getElevation(Qe,Na,Vl):null,ys=a.layout.get("text-rotation-alignment")==="map";W(vt,Qe.posMatrix,g,d,Fa,Kr,oe,E,ys,ee,Qe.toUnwrapped(),G.width,G.height,sa,rn)}const Cr=Qe.posMatrix,Jr=d&&He||yu,Pr=ce||Jr?Tl:Fa,Ls=$l,sr=lt&&a.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Zn;Zn=lt?vt.iconsInText?jc(Ot.kind,ci,K,oe,ce,Jr,g,Cr,Pr,Ls,sa,qn,ir,dt):vo(Ot.kind,ci,K,oe,ce,Jr,g,Cr,Pr,Ls,sa,d,qn,!0,dt):Ch(Ot.kind,ci,K,oe,ce,Jr,g,Cr,Pr,Ls,sa,d,qn,dt);const Fi={program:Jt,buffers:Vt,uniformValues:Zn,atlasTexture:Yr,atlasTextureIcon:nr,atlasInterpolation:Yi,atlasInterpolationIcon:yr,isSDF:lt,hasHalo:sr};if(ge&&vt.canOverlap){ke=!0;const rn=Vt.segments.get();for(const ys of rn)st.push({segments:new c.a0([ys]),sortKey:ys.sortKey,state:Fi,terrainData:Xi})}else st.push({segments:Vt.segments,sortKey:0,state:Fi,terrainData:Xi})}ke&&st.sort((Qe,Je)=>Qe.sortKey-Je.sortKey);for(const Qe of st){const Je=Qe.state;if(j.activeTexture.set(q.TEXTURE0),Je.atlasTexture.bind(Je.atlasInterpolation,q.CLAMP_TO_EDGE),Je.atlasTextureIcon&&(j.activeTexture.set(q.TEXTURE1),Je.atlasTextureIcon&&Je.atlasTextureIcon.bind(Je.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),Je.isSDF){const vt=Je.uniformValues;Je.hasHalo&&(vt.u_is_halo=1,Sl(Je.buffers,Qe.segments,a,g,Je.program,$e,z,D,vt,Qe.terrainData)),vt.u_is_halo=0}Sl(Je.buffers,Qe.segments,a,g,Je.program,$e,z,D,Je.uniformValues,Qe.terrainData)}}function Sl(g,e,a,u,d,m,w,S,k,E){const z=u.context;d.draw(z,z.gl.TRIANGLES,m,w,S,Ci.disabled,k,E,a.id,g.layoutVertexBuffer,g.indexBuffer,e,a.paint,u.transform.zoom,g.programConfigurations.get(a.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Ks(g,e,a,u){const d=g.context,m=d.gl,w=Ui.disabled,S=new fn([m.ONE,m.ONE],c.aM.transparent,[!0,!0,!0,!0]),k=e.getBucket(a);if(!k)return;const E=u.key;let z=a.heatmapFbos.get(E);z||(z=To(d,e.tileSize,e.tileSize),a.heatmapFbos.set(E,z)),d.bindFramebuffer.set(z.framebuffer),d.viewport.set([0,0,e.tileSize,e.tileSize]),d.clear({color:c.aM.transparent});const D=k.programConfigurations.get(a.id),j=g.useProgram("heatmap",D),q=g.style.map.terrain.getTerrainData(u);j.draw(d,m.TRIANGLES,ii.disabled,w,S,Ci.disabled,pr(u.posMatrix,e,g.transform.zoom,a.paint.get("heatmap-intensity")),q,a.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,a.paint,g.transform.zoom,D)}function kl(g,e,a){const u=g.context,d=u.gl;u.setColorMode(g.colorModeForRenderPass());const m=Pa(u,e),w=a.key,S=e.heatmapFbos.get(w);S&&(u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,S.colorAttachment.get()),u.activeTexture.set(d.TEXTURE1),m.bind(d.LINEAR,d.CLAMP_TO_EDGE),g.useProgram("heatmapTexture").draw(u,d.TRIANGLES,ii.disabled,Ui.disabled,g.colorModeForRenderPass(),Ci.disabled,gl(g,e,0,1),null,e.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,e.paint,g.transform.zoom),S.destroy(),e.heatmapFbos.delete(w))}function To(g,e,a){var u,d;const m=g.gl,w=m.createTexture();m.bindTexture(m.TEXTURE_2D,w),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR);const S=(u=g.HALF_FLOAT)!==null&&u!==void 0?u:m.UNSIGNED_BYTE,k=(d=g.RGBA16F)!==null&&d!==void 0?d:m.RGBA;m.texImage2D(m.TEXTURE_2D,0,k,e,a,0,m.RGBA,S,null);const E=g.createFramebuffer(e,a,!1,!1);return E.colorAttachment.set(w),E}function Pa(g,e){return e.colorRampTexture||(e.colorRampTexture=new Te(g,e.colorRamp,g.gl.RGBA)),e.colorRampTexture}function So(g,e,a,u,d){if(!a||!u||!u.imageAtlas)return;const m=u.imageAtlas.patternPositions;let w=m[a.to.toString()],S=m[a.from.toString()];if(!w&&S&&(w=S),!S&&w&&(S=w),!w||!S){const k=d.getPaintProperty(e);w=m[k],S=m[k]}w&&S&&g.setConstantPatternPositions(w,S)}function Qc(g,e,a,u,d,m,w){const S=g.context.gl,k="fill-pattern",E=a.paint.get(k),z=E&&E.constantOr(1),D=a.getCrossfadeParameters();let j,q,G,ee,se;w?(q=z&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=S.LINES):(q=z?"fillPattern":"fill",j=S.TRIANGLES);const oe=E.constantOr(null);for(const ce of u){const K=e.getTile(ce);if(z&&!K.patternsLoaded())continue;const pe=K.getBucket(a);if(!pe)continue;const ge=pe.programConfigurations.get(a.id),ke=g.useProgram(q,ge),$e=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ce);z&&(g.context.activeTexture.set(S.TEXTURE0),K.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ge.updatePaintBuffers(D)),So(ge,k,oe,K,a);const He=$e?ce:null,st=g.translatePosMatrix(He?He.posMatrix:ce.posMatrix,K,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(w){ee=pe.indexBuffer2,se=pe.segments2;const dt=[S.drawingBufferWidth,S.drawingBufferHeight];G=q==="fillOutlinePattern"&&z?Mh(st,g,D,K,dt):qf(st,dt)}else ee=pe.indexBuffer,se=pe.segments,G=z?kh(st,g,D,K):Aa(st);ke.draw(g.context,j,d,g.stencilModeForClipping(ce),m,Ci.disabled,G,$e,a.id,pe.layoutVertexBuffer,ee,se,a.paint,g.transform.zoom,ge)}}function Ps(g,e,a,u,d,m,w){const S=g.context,k=S.gl,E="fill-extrusion-pattern",z=a.paint.get(E),D=z.constantOr(1),j=a.getCrossfadeParameters(),q=a.paint.get("fill-extrusion-opacity"),G=z.constantOr(null);for(const ee of u){const se=e.getTile(ee),oe=se.getBucket(a);if(!oe)continue;const ce=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ee),K=oe.programConfigurations.get(a.id),pe=g.useProgram(D?"fillExtrusionPattern":"fillExtrusion",K);D&&(g.context.activeTexture.set(k.TEXTURE0),se.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),K.updatePaintBuffers(j)),So(K,E,G,se,a);const ge=g.translatePosMatrix(ee.posMatrix,se,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ke=a.paint.get("fill-extrusion-vertical-gradient"),$e=D?ml(ge,g,ke,q,ee,j,se):yo(ge,g,ke,q);pe.draw(S,S.gl.TRIANGLES,d,m,w,Ci.backCCW,$e,ce,a.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,a.paint,g.transform.zoom,K,g.style.map.terrain&&oe.centroidVertexBuffer)}}function za(g,e,a,u,d,m,w){const S=g.context,k=S.gl,E=a.fbo;if(!E)return;const z=g.useProgram("hillshade"),D=g.style.map.terrain&&g.style.map.terrain.getTerrainData(e);S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,E.colorAttachment.get()),z.draw(S,k.TRIANGLES,d,m,w,Ci.disabled,((j,q,G,ee)=>{const se=G.paint.get("hillshade-shadow-color"),oe=G.paint.get("hillshade-highlight-color"),ce=G.paint.get("hillshade-accent-color");let K=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(K-=j.transform.angle);const pe=!j.options.moving;return{u_matrix:ee?ee.posMatrix:j.transform.calculatePosMatrix(q.tileID.toUnwrapped(),pe),u_image:0,u_latrange:yl(0,q.tileID),u_light:[G.paint.get("hillshade-exaggeration"),K],u_shadow:se,u_highlight:oe,u_accent:ce}})(g,a,u,D?e:null),D,u.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function qh(g,e,a,u,d,m){const w=g.context,S=w.gl,k=e.dem;if(k&&k.data){const E=k.dim,z=k.stride,D=k.getPixels();if(w.activeTexture.set(S.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||g.getTileTexture(z),e.demTexture){const q=e.demTexture;q.update(D,{premultiply:!1}),q.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else e.demTexture=new Te(w,D,S.RGBA,{premultiply:!1}),e.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);w.activeTexture.set(S.TEXTURE0);let j=e.fbo;if(!j){const q=new Te(w,{width:E,height:E,data:null},S.RGBA);q.bind(S.LINEAR,S.CLAMP_TO_EDGE),j=e.fbo=w.createFramebuffer(E,E,!0,!1),j.colorAttachment.set(q.texture)}w.bindFramebuffer.set(j.framebuffer),w.viewport.set([0,0,E,E]),g.useProgram("hillshadePrepare").draw(w,S.TRIANGLES,u,d,m,Ci.disabled,((q,G)=>{const ee=G.stride,se=c.H();return c.aP(se,0,c.X,-c.X,0,0,1),c.J(se,se,[0,-c.X,0]),{u_matrix:se,u_image:1,u_dimension:[ee,ee],u_zoom:q.overscaledZ,u_unpack:G.getUnpackVector()}})(e.tileID,k),null,a.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function eu(g,e,a,u,d,m){const w=u.paint.get("raster-fade-duration");if(!m&&w>0){const S=R.now(),k=(S-g.timeAdded)/w,E=e?(S-e.timeAdded)/w:-1,z=a.getSource(),D=d.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),j=!e||Math.abs(e.tileID.overscaledZ-D)>Math.abs(g.tileID.overscaledZ-D),q=j&&g.refreshedUponExpiration?1:c.ac(j?k:1-E,0,1);return g.refreshedUponExpiration&&k>=1&&(g.refreshedUponExpiration=!1),e?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}const yi=new c.aM(1,0,0,1),Ml=new c.aM(0,1,0,1),ap=new c.aM(0,0,1,1),Zh=new c.aM(1,0,1,1),ko=new c.aM(0,1,1,1);function Gh(g,e,a,u){Mo(g,0,e+a/2,g.transform.width,a,u)}function Hh(g,e,a,u){Mo(g,e-a/2,0,a,g.transform.height,u)}function Mo(g,e,a,u,d,m){const w=g.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*g.pixelRatio,a*g.pixelRatio,u*g.pixelRatio,d*g.pixelRatio),w.clear({color:m}),S.disable(S.SCISSOR_TEST)}function op(g,e,a){const u=g.context,d=u.gl,m=a.posMatrix,w=g.useProgram("debug"),S=ii.disabled,k=Ui.disabled,E=g.colorModeForRenderPass(),z="$debug",D=g.style.map.terrain&&g.style.map.terrain.getTerrainData(a);u.activeTexture.set(d.TEXTURE0);const j=e.getTileByID(a.key).latestRawTileData,q=Math.floor((j&&j.byteLength||0)/1024),G=e.getTile(a).tileSize,ee=512/Math.min(G,512)*(a.overscaledZ/g.transform.zoom)*.5;let se=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(se+=` => ${a.overscaledZ}`),function(oe,ce){oe.initDebugOverlayCanvas();const K=oe.debugOverlayCanvas,pe=oe.context.gl,ge=oe.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,K.width,K.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(ce,5,5),ge.strokeText(ce,5,5),oe.debugOverlayTexture.update(K),oe.debugOverlayTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE)}(g,`${se} ${q}kB`),w.draw(u,d.TRIANGLES,S,k,fn.alphaBlended,Ci.disabled,_o(m,c.aM.transparent,ee),null,z,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),w.draw(u,d.LINE_STRIP,S,k,E,Ci.disabled,_o(m,c.aM.red),D,z,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Al(g,e,a){const u=g.context,d=u.gl,m=g.colorModeForRenderPass(),w=new ii(d.LEQUAL,ii.ReadWrite,g.depthRangeFor3D),S=g.useProgram("terrain"),k=e.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,g.width,g.height]);for(const E of a){const z=g.renderToTexture.getTexture(E),D=e.getTerrainData(E.tileID);u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,z.texture);const j=g.transform.calculatePosMatrix(E.tileID.toUnwrapped()),q=e.getMeshFrameDelta(g.transform.zoom),G=g.transform.calculateFogMatrix(E.tileID.toUnwrapped()),ee=Nc(j,q,G,g.style.sky,g.transform.pitch);S.draw(u,d.TRIANGLES,w,Ui.disabled,m,Ci.backCCW,ee,D,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}class Ao{constructor(e,a,u){this.vertexBuffer=e,this.indexBuffer=a,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Il{constructor(e,a){this.context=new sp(e),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=kt.maxUnderzooming+kt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Bc}resize(e,a,u){if(this.width=Math.floor(e*u),this.height=Math.floor(a*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,a=new c.aX;a.emplaceBack(0,0),a.emplaceBack(c.X,0),a.emplaceBack(0,c.X),a.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(a,Ws.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);const u=new c.aX;u.emplaceBack(0,0),u.emplaceBack(c.X,0),u.emplaceBack(0,c.X),u.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(u,Ws.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);const d=new c.$;d.emplaceBack(0,0,0,0),d.emplaceBack(c.X,0,c.X,0),d.emplaceBack(0,c.X,0,c.X),d.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(d,bn.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);const m=new c.aX;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(m,Ws.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);const w=new c.aZ;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);const S=new c.aY;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(S);const k=this.context.gl;this.stencilClearMode=new Ui({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)}clearStencil(){const e=this.context,a=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=c.H();c.aP(u,0,this.width,this.height,0,0,1),c.K(u,u,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,a.TRIANGLES,ii.disabled,this.stencilClearMode,fn.disabled,Ci.disabled,fr(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,a){if(this.currentStencilSource===e.source||!e.isTileClipped()||!a||!a.length)return;this.currentStencilSource=e.source;const u=this.context,d=u.gl;this.nextStencilID+a.length>256&&this.clearStencil(),u.setColorMode(fn.disabled),u.setDepthMode(ii.disabled);const m=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of a){const S=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(w);m.draw(u,d.TRIANGLES,ii.disabled,new Ui({func:d.ALWAYS,mask:0},S,255,d.KEEP,d.KEEP,d.REPLACE),fn.disabled,Ci.disabled,fr(w.posMatrix),k,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,a=this.context.gl;return new Ui({func:a.NOTEQUAL,mask:255},e,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(e){const a=this.context.gl;return new Ui({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(e){const a=this.context.gl,u=e.sort((w,S)=>S.overscaledZ-w.overscaledZ),d=u[u.length-1].overscaledZ,m=u[0].overscaledZ-d+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const w={};for(let S=0;S<m;S++)w[S+d]=new Ui({func:a.GEQUAL,mask:255},S+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=m,[w,u]}return[{[d]:Ui.disabled},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new fn([e.CONSTANT_COLOR,e.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?fn.unblended:fn.alphaBlended}depthModeForSublayer(e,a,u){if(!this.opaquePassEnabledForLayer())return ii.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ii(u||this.context.gl.LEQUAL,a,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,a){this.style=e,this.options=a,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(R.now()),this.imageManager.beginFrame();const u=this.style._order,d=this.style.sourceCaches,m={},w={},S={};for(const k in d){const E=d[k];E.used&&E.prepare(this.context),m[k]=E.getVisibleCoordinates(),w[k]=m[k].slice().reverse(),S[k]=E.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<u.length;k++)if(this.style._layers[u[k]].is3D()){this.opaquePassCutoff=k;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const k of u){const E=this.style._layers[k];if(!E.hasOffscreenPass()||E.isHidden(this.transform.zoom))continue;const z=w[E.source];(E.type==="custom"||z.length)&&this.renderLayer(this,d[E.source],E,z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(k,E){const z=k.context,D=z.gl,j=((oe,ce,K)=>({u_sky_color:oe.properties.get("sky-color"),u_horizon_color:oe.properties.get("horizon-color"),u_horizon:(ce.height/2+ce.getHorizon())*K,u_sky_horizon_blend:oe.properties.get("sky-horizon-blend")*ce.height/2*K}))(E,k.style.map.transform,k.pixelRatio),q=new ii(D.LEQUAL,ii.ReadWrite,[0,1]),G=Ui.disabled,ee=k.colorModeForRenderPass(),se=k.useProgram("sky");if(!E.mesh){const oe=new c.aX;oe.emplaceBack(-1,-1),oe.emplaceBack(1,-1),oe.emplaceBack(1,1),oe.emplaceBack(-1,1);const ce=new c.aY;ce.emplaceBack(0,1,2),ce.emplaceBack(0,2,3),E.mesh=new Ao(z.createVertexBuffer(oe,Ws.members),z.createIndexBuffer(ce),c.a0.simpleSegment(0,0,oe.length,ce.length))}se.draw(z,D.TRIANGLES,q,G,ee,Ci.disabled,j,void 0,"sky",E.mesh.vertexBuffer,E.mesh.indexBuffer,E.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[u[this.currentLayer]],E=d[k.source],z=m[k.source];this._renderTileClippingMasks(k,z),this.renderLayer(this,E,k,z)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const k=this.style._layers[u[this.currentLayer]],E=d[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k))continue;const z=(k.type==="symbol"?S:w)[k.source];this._renderTileClippingMasks(k,m[k.source]),this.renderLayer(this,E,k,z)}if(this.options.showTileBoundaries){const k=function(E,z){let D=null;const j=Object.values(E._layers).flatMap(se=>se.source&&!se.isHidden(z)?[E.sourceCaches[se.source]]:[]),q=j.filter(se=>se.getSource().type==="vector"),G=j.filter(se=>se.getSource().type!=="vector"),ee=se=>{(!D||D.getSource().maxzoom<se.getSource().maxzoom)&&(D=se)};return q.forEach(se=>ee(se)),D||G.forEach(se=>ee(se)),D}(this.style,this.transform.zoom);k&&function(E,z,D){for(let j=0;j<D.length;j++)op(E,z,D[j])}(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const E=k.transform.padding;Gh(k,k.transform.height-(E.top||0),3,yi),Gh(k,E.bottom||0,3,Ml),Hh(k,E.left||0,3,ap),Hh(k,k.transform.width-(E.right||0),3,Zh);const z=k.transform.centerPoint;(function(D,j,q,G){Mo(D,j-1,q-10,2,20,G),Mo(D,j-10,q-1,20,2,G)})(k,z.x,k.transform.height-z.y,ko)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=e?!c.a_(a,u):!c.a$(a,u)),d||(d=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),d&&(c.b0(a,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(m,w){const S=m.context,k=S.gl,E=fn.unblended,z=new ii(k.LEQUAL,ii.ReadWrite,[0,1]),D=w.getTerrainMesh(),j=w.sourceCache.getRenderableTiles(),q=m.useProgram("terrainDepth");S.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),S.clear({color:c.aM.transparent,depth:1});for(const G of j){const ee=w.getTerrainData(G.tileID),se={u_matrix:m.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_ele_delta:w.getMeshFrameDelta(m.transform.zoom)};q.draw(S,k.TRIANGLES,z,Ui.disabled,E,Ci.backCCW,se,ee,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain),function(m,w){const S=m.context,k=S.gl,E=fn.unblended,z=new ii(k.LEQUAL,ii.ReadWrite,[0,1]),D=w.getTerrainMesh(),j=w.getCoordsTexture(),q=w.sourceCache.getRenderableTiles(),G=m.useProgram("terrainCoords");S.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),S.clear({color:c.aM.transparent,depth:1}),w.coordsIndex=[];for(const ee of q){const se=w.getTerrainData(ee.tileID);S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,j.texture);const oe={u_matrix:m.transform.calculatePosMatrix(ee.tileID.toUnwrapped()),u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(m.transform.zoom)};G.draw(S,k.TRIANGLES,z,Ui.disabled,E,Ci.backCCW,oe,se,"terrain",D.vertexBuffer,D.indexBuffer,D.segments),w.coordsIndex.push(ee.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain))}renderLayer(e,a,u,d){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(d||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(m,w,S,k,E){if(m.renderPass!=="translucent")return;const z=Ui.disabled,D=m.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(j,q,G,ee,se,oe,ce,K,pe){const ge=q.transform,ke=Us(),$e=se==="map",He=oe==="map";for(const st of j){const dt=ee.getTile(st),Qe=dt.getBucket(G);if(!Qe||!Qe.text||!Qe.text.segments.get().length)continue;const Je=c.ag(Qe.textSizeData,ge.zoom),vt=oi(dt,1,q.transform.zoom),Vt=Ur(st.posMatrix,He,$e,q.transform,vt),it=G.layout.get("icon-text-fit")!=="none"&&Qe.hasIconData();if(Je){const lt=Math.pow(2,ge.zoom-dt.tileID.overscaledZ),Ot=q.style.map.terrain?(Jt,ci)=>q.style.map.terrain.getElevation(st,Jt,ci):null,Hi=ke.translatePosition(ge,dt,ce,K);Nr(Qe,$e,He,pe,ge,Vt,st.posMatrix,lt,Je,it,ke,Hi,st.toUnwrapped(),Ot)}}}(k,m,S,w,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),E),S.paint.get("icon-opacity").constantOr(1)!==0&&Jc(m,w,S,k,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),z,D),S.paint.get("text-opacity").constantOr(1)!==0&&Jc(m,w,S,k,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),z,D),w.map.showCollisionBoxes&&(wo(m,w,S,k,!0),wo(m,w,S,k,!1))})(e,a,u,d,this.style.placement.variableOffsets);break;case"circle":(function(m,w,S,k){if(m.renderPass!=="translucent")return;const E=S.paint.get("circle-opacity"),z=S.paint.get("circle-stroke-width"),D=S.paint.get("circle-stroke-opacity"),j=!S.layout.get("circle-sort-key").isConstant();if(E.constantOr(1)===0&&(z.constantOr(1)===0||D.constantOr(1)===0))return;const q=m.context,G=q.gl,ee=m.depthModeForSublayer(0,ii.ReadOnly),se=Ui.disabled,oe=m.colorModeForRenderPass(),ce=[];for(let K=0;K<k.length;K++){const pe=k[K],ge=w.getTile(pe),ke=ge.getBucket(S);if(!ke)continue;const $e=ke.programConfigurations.get(S.id),He=m.useProgram("circle",$e),st=ke.layoutVertexBuffer,dt=ke.indexBuffer,Qe=m.style.map.terrain&&m.style.map.terrain.getTerrainData(pe),Je={programConfiguration:$e,program:He,layoutVertexBuffer:st,indexBuffer:dt,uniformValues:Zf(m,pe,ge,S),terrainData:Qe};if(j){const vt=ke.segments.get();for(const Vt of vt)ce.push({segments:new c.a0([Vt]),sortKey:Vt.sortKey,state:Je})}else ce.push({segments:ke.segments,sortKey:0,state:Je})}j&&ce.sort((K,pe)=>K.sortKey-pe.sortKey);for(const K of ce){const{programConfiguration:pe,program:ge,layoutVertexBuffer:ke,indexBuffer:$e,uniformValues:He,terrainData:st}=K.state;ge.draw(q,G.TRIANGLES,ee,se,oe,Ci.disabled,He,st,S.id,ke,$e,K.segments,S.paint,m.transform.zoom,pe)}})(e,a,u,d);break;case"heatmap":(function(m,w,S,k){if(S.paint.get("heatmap-opacity")===0)return;const E=m.context;if(m.style.map.terrain){for(const z of k){const D=w.getTile(z);w.hasRenderableParent(z)||(m.renderPass==="offscreen"?Ks(m,D,S,z):m.renderPass==="translucent"&&kl(m,S,z))}E.viewport.set([0,0,m.width,m.height])}else m.renderPass==="offscreen"?function(z,D,j,q){const G=z.context,ee=G.gl,se=Ui.disabled,oe=new fn([ee.ONE,ee.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(ce,K,pe){const ge=ce.gl;ce.activeTexture.set(ge.TEXTURE1),ce.viewport.set([0,0,K.width/4,K.height/4]);let ke=pe.heatmapFbos.get(c.aU);ke?(ge.bindTexture(ge.TEXTURE_2D,ke.colorAttachment.get()),ce.bindFramebuffer.set(ke.framebuffer)):(ke=To(ce,K.width/4,K.height/4),pe.heatmapFbos.set(c.aU,ke))})(G,z,j),G.clear({color:c.aM.transparent});for(let ce=0;ce<q.length;ce++){const K=q[ce];if(D.hasRenderableParent(K))continue;const pe=D.getTile(K),ge=pe.getBucket(j);if(!ge)continue;const ke=ge.programConfigurations.get(j.id),$e=z.useProgram("heatmap",ke),{zoom:He}=z.transform;$e.draw(G,ee.TRIANGLES,ii.disabled,se,oe,Ci.disabled,pr(K.posMatrix,pe,He,j.paint.get("heatmap-intensity")),null,j.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,j.paint,z.transform.zoom,ke)}G.viewport.set([0,0,z.width,z.height])}(m,w,S,k):m.renderPass==="translucent"&&function(z,D){const j=z.context,q=j.gl;j.setColorMode(z.colorModeForRenderPass());const G=D.heatmapFbos.get(c.aU);G&&(j.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,G.colorAttachment.get()),j.activeTexture.set(q.TEXTURE1),Pa(j,D).bind(q.LINEAR,q.CLAMP_TO_EDGE),z.useProgram("heatmapTexture").draw(j,q.TRIANGLES,ii.disabled,Ui.disabled,z.colorModeForRenderPass(),Ci.disabled,gl(z,D,0,1),null,D.id,z.viewportBuffer,z.quadTriangleIndexBuffer,z.viewportSegments,D.paint,z.transform.zoom))}(m,S)})(e,a,u,d);break;case"line":(function(m,w,S,k){if(m.renderPass!=="translucent")return;const E=S.paint.get("line-opacity"),z=S.paint.get("line-width");if(E.constantOr(1)===0||z.constantOr(1)===0)return;const D=m.depthModeForSublayer(0,ii.ReadOnly),j=m.colorModeForRenderPass(),q=S.paint.get("line-dasharray"),G=S.paint.get("line-pattern"),ee=G.constantOr(1),se=S.paint.get("line-gradient"),oe=S.getCrossfadeParameters(),ce=ee?"linePattern":q?"lineSDF":se?"lineGradient":"line",K=m.context,pe=K.gl;let ge=!0;for(const ke of k){const $e=w.getTile(ke);if(ee&&!$e.patternsLoaded())continue;const He=$e.getBucket(S);if(!He)continue;const st=He.programConfigurations.get(S.id),dt=m.context.program.get(),Qe=m.useProgram(ce,st),Je=ge||Qe.program!==dt,vt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ke),Vt=G.constantOr(null);if(Vt&&$e.imageAtlas){const Ot=$e.imageAtlas,Hi=Ot.patternPositions[Vt.to.toString()],Jt=Ot.patternPositions[Vt.from.toString()];Hi&&Jt&&st.setConstantPatternPositions(Hi,Jt)}const it=vt?ke:null,lt=ee?Ia(m,$e,S,oe,it):q?Gf(m,$e,S,q,oe,it):se?Ah(m,$e,S,He.lineClipsArray.length,it):_l(m,$e,S,it);if(ee)K.activeTexture.set(pe.TEXTURE0),$e.imageAtlasTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),st.updatePaintBuffers(oe);else if(q&&(Je||m.lineAtlas.dirty))K.activeTexture.set(pe.TEXTURE0),m.lineAtlas.bind(K);else if(se){const Ot=He.gradients[S.id];let Hi=Ot.texture;if(S.gradientVersion!==Ot.version){let Jt=256;if(S.stepInterpolant){const ci=w.getSource().maxzoom,Xi=ke.canonical.z===ci?Math.ceil(1<<m.transform.maxZoom-ke.canonical.z):1;Jt=c.ac(c.aV(He.maxLineLength/c.X*1024*Xi),256,K.maxTextureSize)}Ot.gradient=c.aW({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:Jt,image:Ot.gradient||void 0,clips:He.lineClipsArray}),Ot.texture?Ot.texture.update(Ot.gradient):Ot.texture=new Te(K,Ot.gradient,pe.RGBA),Ot.version=S.gradientVersion,Hi=Ot.texture}K.activeTexture.set(pe.TEXTURE0),Hi.bind(S.stepInterpolant?pe.NEAREST:pe.LINEAR,pe.CLAMP_TO_EDGE)}Qe.draw(K,pe.TRIANGLES,D,m.stencilModeForClipping(ke),j,Ci.disabled,lt,vt,S.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,S.paint,m.transform.zoom,st,He.layoutVertexBuffer2),ge=!1}})(e,a,u,d);break;case"fill":(function(m,w,S,k){const E=S.paint.get("fill-color"),z=S.paint.get("fill-opacity");if(z.constantOr(1)===0)return;const D=m.colorModeForRenderPass(),j=S.paint.get("fill-pattern"),q=m.opaquePassEnabledForLayer()&&!j.constantOr(1)&&E.constantOr(c.aM.transparent).a===1&&z.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===q){const G=m.depthModeForSublayer(1,m.renderPass==="opaque"?ii.ReadWrite:ii.ReadOnly);Qc(m,w,S,k,G,D,!1)}if(m.renderPass==="translucent"&&S.paint.get("fill-antialias")){const G=m.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,ii.ReadOnly);Qc(m,w,S,k,G,D,!0)}})(e,a,u,d);break;case"fill-extrusion":(function(m,w,S,k){const E=S.paint.get("fill-extrusion-opacity");if(E!==0&&m.renderPass==="translucent"){const z=new ii(m.context.gl.LEQUAL,ii.ReadWrite,m.depthRangeFor3D);if(E!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))Ps(m,w,S,k,z,Ui.disabled,fn.disabled),Ps(m,w,S,k,z,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const D=m.colorModeForRenderPass();Ps(m,w,S,k,z,Ui.disabled,D)}}})(e,a,u,d);break;case"hillshade":(function(m,w,S,k){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const E=m.context,z=m.depthModeForSublayer(0,ii.ReadOnly),D=m.colorModeForRenderPass(),[j,q]=m.renderPass==="translucent"?m.stencilConfigForOverlap(k):[{},k];for(const G of q){const ee=w.getTile(G);ee.needsHillshadePrepare!==void 0&&ee.needsHillshadePrepare&&m.renderPass==="offscreen"?qh(m,ee,S,z,Ui.disabled,D):m.renderPass==="translucent"&&za(m,G,ee,S,z,j[G.overscaledZ],D)}E.viewport.set([0,0,m.width,m.height])})(e,a,u,d);break;case"raster":(function(m,w,S,k){if(m.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!k.length)return;const E=m.context,z=E.gl,D=w.getSource(),j=m.useProgram("raster"),q=m.colorModeForRenderPass(),[G,ee]=D instanceof Jn?[{},k]:m.stencilConfigForOverlap(k),se=ee[ee.length-1].overscaledZ,oe=!m.options.moving;for(const ce of ee){const K=m.depthModeForSublayer(ce.overscaledZ-se,S.paint.get("raster-opacity")===1?ii.ReadWrite:ii.ReadOnly,z.LESS),pe=w.getTile(ce);pe.registerFadeDuration(S.paint.get("raster-fade-duration"));const ge=w.findLoadedParent(ce,0),ke=w.findLoadedSibling(ce),$e=eu(pe,ge||ke||null,w,S,m.transform,m.style.map.terrain);let He,st;const dt=S.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;E.activeTexture.set(z.TEXTURE0),pe.texture.bind(dt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(z.TEXTURE1),ge?(ge.texture.bind(dt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),He=Math.pow(2,ge.tileID.overscaledZ-pe.tileID.overscaledZ),st=[pe.tileID.canonical.x*He%1,pe.tileID.canonical.y*He%1]):pe.texture.bind(dt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),pe.texture.useMipmap&&E.extTextureFilterAnisotropic&&m.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);const Qe=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ce),Je=Qe?ce:null,vt=Je?Je.posMatrix:m.transform.calculatePosMatrix(ce.toUnwrapped(),oe),Vt=Hf(vt,st||[0,0],He||1,$e,S);D instanceof Jn?j.draw(E,z.TRIANGLES,K,Ui.disabled,q,Ci.disabled,Vt,Qe,S.id,D.boundsBuffer,m.quadTriangleIndexBuffer,D.boundsSegments):j.draw(E,z.TRIANGLES,K,G[ce.overscaledZ],q,Ci.disabled,Vt,Qe,S.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}})(e,a,u,d);break;case"background":(function(m,w,S,k){const E=S.paint.get("background-color"),z=S.paint.get("background-opacity");if(z===0)return;const D=m.context,j=D.gl,q=m.transform,G=q.tileSize,ee=S.paint.get("background-pattern");if(m.isPatternMissing(ee))return;const se=!ee&&E.a===1&&z===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==se)return;const oe=Ui.disabled,ce=m.depthModeForSublayer(0,se==="opaque"?ii.ReadWrite:ii.ReadOnly),K=m.colorModeForRenderPass(),pe=m.useProgram(ee?"backgroundPattern":"background"),ge=k||q.coveringTiles({tileSize:G,terrain:m.style.map.terrain});ee&&(D.activeTexture.set(j.TEXTURE0),m.imageManager.bind(m.context));const ke=S.getCrossfadeParameters();for(const $e of ge){const He=k?$e.posMatrix:m.transform.calculatePosMatrix($e.toUnwrapped()),st=ee?Vc(He,z,m,ee,{tileID:$e,tileSize:G},ke):vl(He,z,E),dt=m.style.map.terrain&&m.style.map.terrain.getTerrainData($e);pe.draw(D,j.TRIANGLES,ce,oe,K,Ci.disabled,st,dt,S.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}})(e,0,u,d);break;case"custom":(function(m,w,S){const k=m.context,E=S.implementation;if(m.renderPass==="offscreen"){const z=E.prerender;z&&(m.setCustomLayerDefaults(),k.setColorMode(m.colorModeForRenderPass()),z.call(E,k.gl,m.transform.customLayerMatrix()),k.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),k.setColorMode(m.colorModeForRenderPass()),k.setStencilMode(Ui.disabled);const z=E.renderingMode==="3d"?new ii(m.context.gl.LEQUAL,ii.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,ii.ReadOnly);k.setDepthMode(z),E.render(k.gl,m.transform.customLayerMatrix(),{farZ:m.transform.farZ,nearZ:m.transform.nearZ,fov:m.transform._fov,modelViewProjectionMatrix:m.transform.modelViewProjectionMatrix,projectionMatrix:m.transform.projectionMatrix}),k.setDirty(),m.setBaseState(),k.bindFramebuffer.set(null)}})(e,0,u)}}translatePosMatrix(e,a,u,d,m){if(!u[0]&&!u[1])return e;const w=m?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){const E=Math.sin(w),z=Math.cos(w);u=[u[0]*z-u[1]*E,u[0]*E+u[1]*z]}const S=[m?u[0]:oi(a,u[0],this.transform.zoom),m?u[1]:oi(a,u[1],this.transform.zoom),0],k=new Float32Array(16);return c.J(k,e,S),k}saveTileTexture(e){const a=this._tileTextures[e.size[0]];a?a.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const a=this._tileTextures[e];return a&&a.length>0?a.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const a=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!a||!u}useProgram(e,a){this.cache=this.cache||{};const u=e+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new $c(this.context,Es[e],a,Uc[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Te(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:a}=this.context.gl;return this.width!==e||this.height!==a}}class Io{constructor(e,a){this.points=e,this.planes=a}static fromInvProjectionMatrix(e,a,u){const d=Math.pow(2,u),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const k=1/(S=c.af([],S,e))[3]/a*d;return c.b1(S,S,[k,k,1/S[3],k])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const k=function(j,q){var G=q[0],ee=q[1],se=q[2],oe=G*G+ee*ee+se*se;return oe>0&&(oe=1/Math.sqrt(oe)),j[0]=q[0]*oe,j[1]=q[1]*oe,j[2]=q[2]*oe,j}([],function(j,q,G){var ee=q[0],se=q[1],oe=q[2],ce=G[0],K=G[1],pe=G[2];return j[0]=se*pe-oe*K,j[1]=oe*ce-ee*pe,j[2]=ee*K-se*ce,j}([],de([],m[S[0]],m[S[1]]),de([],m[S[2]],m[S[1]]))),E=-((z=k)[0]*(D=m[S[1]])[0]+z[1]*D[1]+z[2]*D[2]);var z,D;return k.concat(E)});return new Io(m,w)}}class Da{constructor(e,a){this.min=e,this.max=a,this.center=function(u,d,m){return u[0]=.5*d[0],u[1]=.5*d[1],u[2]=.5*d[2],u}([],function(u,d,m){return u[0]=d[0]+m[0],u[1]=d[1]+m[1],u[2]=d[2]+m[2],u}([],this.min,this.max))}quadrant(e){const a=[e%2==0,e<2],u=ve(this.min),d=ve(this.max);for(let m=0;m<a.length;m++)u[m]=a[m]?this.min[m]:this.center[m],d[m]=a[m]?this.center[m]:this.max[m];return d[2]=this.max[2],new Da(u,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let d=0;d<e.planes.length;d++){const m=e.planes[d];let w=0;for(let S=0;S<a.length;S++)c.b2(m,a[S])>=0&&w++;if(w===0)return 0;w!==a.length&&(u=!1)}if(u)return 2;for(let d=0;d<3;d++){let m=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let S=0;S<e.points.length;S++){const k=e.points[S][d]-this.min[d];m=Math.min(m,k),w=Math.max(w,k)}if(w<0||m>this.max[d]-this.min[d])return 0}return 1}}class Eo{constructor(e=0,a=0,u=0,d=0){if(isNaN(e)||e<0||isNaN(a)||a<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=a,this.left=u,this.right=d}interpolate(e,a,u){return a.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,a.top,u)),a.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,a.bottom,u)),a.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,a.left,u)),a.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,a.right,u)),this}getCenter(e,a){const u=c.ac((this.left+e-this.right)/2,0,e),d=c.ac((this.top+a-this.bottom)/2,0,a);return new c.P(u,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Eo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Co=85.051129;class La{constructor(e,a,u,d,m){this.tileSize=512,this._renderWorldCopies=m===void 0||!!m,this._minZoom=e||0,this._maxZoom=a||22,this._minPitch=u??0,this._maxPitch=d??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Eo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new La(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const a=-c.b3(e,-180,180)*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=function(){var u=new c.A(4);return c.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,d,m){var w=d[0],S=d[1],k=d[2],E=d[3],z=Math.sin(m),D=Math.cos(m);u[0]=w*D+k*z,u[1]=S*D+E*z,u[2]=w*-z+k*D,u[3]=S*-z+E*D}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const a=c.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const a=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.tileZoom=Math.max(0,Math.floor(a)),this.scale=this.zoomScale(a),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,a,u){this._unmodified=!1,this._edgeInsets.interpolate(e,a,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const a=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(e){const a=[new c.b4(0,e)];if(this._renderWorldCopies){const u=this.pointCoordinate(new c.P(0,0)),d=this.pointCoordinate(new c.P(this.width,0)),m=this.pointCoordinate(new c.P(this.width,this.height)),w=this.pointCoordinate(new c.P(0,this.height)),S=Math.floor(Math.min(u.x,d.x,m.x,w.x)),k=Math.floor(Math.max(u.x,d.x,m.x,w.x)),E=1;for(let z=S-E;z<=k+E;z++)z!==0&&a.push(new c.b4(z,e))}return a}coveringTiles(e){var a,u;let d=this.coveringZoomLevel(e);const m=d;if(e.minzoom!==void 0&&d<e.minzoom)return[];e.maxzoom!==void 0&&d>e.maxzoom&&(d=e.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),S=c.Z.fromLngLat(this.center),k=Math.pow(2,d),E=[k*w.x,k*w.y,0],z=[k*S.x,k*S.y,0],D=Io.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,d);let j=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(j=d);const q=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,G=K=>({aabb:new Da([K*k,0,0],[(K+1)*k,k,0]),zoom:0,x:0,y:0,wrap:K,fullyVisible:!1}),ee=[],se=[],oe=d,ce=e.reparseOverscaled?m:d;if(this._renderWorldCopies)for(let K=1;K<=3;K++)ee.push(G(-K)),ee.push(G(K));for(ee.push(G(0));ee.length>0;){const K=ee.pop(),pe=K.x,ge=K.y;let ke=K.fullyVisible;if(!ke){const Qe=K.aabb.intersects(D);if(Qe===0)continue;ke=Qe===2}const $e=e.terrain?E:z,He=K.aabb.distanceX($e),st=K.aabb.distanceY($e),dt=Math.max(Math.abs(He),Math.abs(st));if(K.zoom===oe||dt>q+(1<<oe-K.zoom)-2&&K.zoom>=j){const Qe=oe-K.zoom,Je=E[0]-.5-(pe<<Qe),vt=E[1]-.5-(ge<<Qe);se.push({tileID:new c.S(K.zoom===oe?ce:K.zoom,K.wrap,K.zoom,pe,ge),distanceSq:Fe([z[0]-.5-pe,z[1]-.5-ge]),tileDistanceToCamera:Math.sqrt(Je*Je+vt*vt)})}else for(let Qe=0;Qe<4;Qe++){const Je=(pe<<1)+Qe%2,vt=(ge<<1)+(Qe>>1),Vt=K.zoom+1;let it=K.aabb.quadrant(Qe);if(e.terrain){const lt=new c.S(Vt,K.wrap,Vt,Je,vt),Ot=e.terrain.getMinMaxElevation(lt),Hi=(a=Ot.minElevation)!==null&&a!==void 0?a:this.elevation,Jt=(u=Ot.maxElevation)!==null&&u!==void 0?u:this.elevation;it=new Da([it.min[0],it.min[1],Hi],[it.max[0],it.max[1],Jt])}ee.push({aabb:it,zoom:Vt,x:Je,y:vt,wrap:K.wrap,fullyVisible:ke})}}return se.sort((K,pe)=>K.distanceSq-pe.distanceSq).map(K=>K.tileID)}resize(e,a){this.width=e,this.height=a,this.pixelsToGLUnits=[2/e,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const a=c.ac(e.lat,-85.051129,Co);return new c.P(c.O(e.lng)*this.worldSize,c.Q(a)*this.worldSize)}unproject(e){return new c.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const a=this.elevation,u=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,d=this.pointLocation(this.centerPoint,e),m=e.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-m))return;const w=u+a-m,S=Math.cos(this._pitch)*this.cameraToCenterDistance/w/c.b5(1,d.lat),k=this.scaleZoom(S/this.tileSize);this._elevation=m,this._center=d,this.zoom=k}setLocationAtPoint(e,a){const u=this.pointCoordinate(a),d=this.pointCoordinate(this.centerPoint),m=this.locationCoordinate(e),w=new c.Z(m.x-(u.x-d.x),m.y-(u.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,a){return a?this.coordinatePoint(this.locationCoordinate(e),a.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,a){return this.coordinateLocation(this.pointCoordinate(e,a))}locationCoordinate(e){return c.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,a){if(a){const j=a.pointCoordinate(e);if(j!=null)return j}const u=[e.x,e.y,0,1],d=[e.x,e.y,1,1];c.af(u,u,this.pixelMatrixInverse),c.af(d,d,this.pixelMatrixInverse);const m=u[3],w=d[3],S=u[1]/m,k=d[1]/w,E=u[2]/m,z=d[2]/w,D=E===z?0:(0-E)/(z-E);return new c.Z(c.y.number(u[0]/m,d[0]/w,D)/this.worldSize,c.y.number(S,k,D)/this.worldSize)}coordinatePoint(e,a=0,u=this.pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,a,1];return c.af(d,d,u),new c.P(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new Me().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Me([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Co])}calculateTileMatrix(e){const a=e.canonical,u=this.worldSize/this.zoomScale(a.z),d=a.x+Math.pow(2,a.z)*e.wrap,m=c.an(new Float64Array(16));return c.J(m,m,[d*u,a.y*u,0]),c.K(m,m,[u/c.X,u/c.X,1]),m}calculatePosMatrix(e,a=!1){const u=e.key,d=a?this._alignedPosMatrixCache:this._posMatrixCache;if(d[u])return d[u];const m=this.calculateTileMatrix(e);return c.L(m,a?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,m),d[u]=new Float32Array(m),d[u]}calculateFogMatrix(e){const a=e.key,u=this._fogMatrixCache;if(u[a])return u[a];const d=this.calculateTileMatrix(e);return c.L(d,this.fogMatrix,d),u[a]=new Float32Array(d),u[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,a){a=c.ac(+a,this.minZoom,this.maxZoom);const u={center:new c.N(e.lng,e.lat),zoom:a};let d=this.lngRange;if(!this._renderWorldCopies&&d===null){const K=179.9999999999;d=[-K,K]}const m=this.tileSize*this.zoomScale(u.zoom);let w=0,S=m,k=0,E=m,z=0,D=0;const{x:j,y:q}=this.size;if(this.latRange){const K=this.latRange;w=c.Q(K[1])*m,S=c.Q(K[0])*m,S-w<q&&(z=q/(S-w))}d&&(k=c.b3(c.O(d[0])*m,0,m),E=c.b3(c.O(d[1])*m,0,m),E<k&&(E+=m),E-k<j&&(D=j/(E-k)));const{x:G,y:ee}=this.project.call({worldSize:m},e);let se,oe;const ce=Math.max(D||0,z||0);if(ce){const K=new c.P(D?(E+k)/2:G,z?(S+w)/2:ee);return u.center=this.unproject.call({worldSize:m},K).wrap(),u.zoom+=this.scaleZoom(ce),u}if(this.latRange){const K=q/2;ee-K<w&&(oe=w+K),ee+K>S&&(oe=S-K)}if(d){const K=(k+E)/2;let pe=G;this._renderWorldCopies&&(pe=c.b3(G,K-m/2,K+m/2));const ge=j/2;pe-ge<k&&(se=k+ge),pe+ge>E&&(se=E-ge)}if(se!==void 0||oe!==void 0){const K=new c.P(se??G,oe??ee);u.center=this.unproject.call({worldSize:m},K).wrap()}return u}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:a,zoom:u}=this.getConstrained(this.center,this.zoom);this.center=a,this.zoom=u,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,a=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let d=c.an(new Float64Array(16));c.K(d,d,[this.width/2,-this.height/2,1]),c.J(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=c.an(new Float64Array(16)),c.K(d,d,[1,-1,1]),c.J(d,d,[-1,-1,0]),c.K(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d;const m=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),w=Math.min(this.elevation,this.minElevationForCurrentTile),S=m-w*this._pixelPerMeter/Math.cos(this._pitch),k=w<0?S:m,E=Math.PI/2+this._pitch,z=this._fov*(.5+e.y/this.height),D=Math.sin(z)*k/Math.sin(c.ac(Math.PI-E-z,.01,Math.PI-.01)),j=this.getHorizon(),q=2*Math.atan(j/this.cameraToCenterDistance)*(.5+e.y/(2*j)),G=Math.sin(q)*k/Math.sin(c.ac(Math.PI-E-q,.01,Math.PI-.01)),ee=Math.min(D,G);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*ee+k),this.nearZ=this.height/50,d=new Float64Array(16),c.b6(d,this._fov,this.width/this.height,this.nearZ,this.farZ),d[8]=2*-e.x/this.width,d[9]=2*e.y/this.height,this.projectionMatrix=c.ae(d),c.K(d,d,[1,-1,1]),c.J(d,d,[0,0,-this.cameraToCenterDistance]),c.b7(d,d,this._pitch),c.ad(d,d,this.angle),c.J(d,d,[-a,-u,0]),this.mercatorMatrix=c.K([],d,[this.worldSize,this.worldSize,this.worldSize]),c.K(d,d,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,d),c.J(d,d,[0,0,-this.elevation]),this.modelViewProjectionMatrix=d,this.invModelViewProjectionMatrix=c.as([],d),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,m,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-a,-u,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,d);const se=this.width%2/2,oe=this.height%2/2,ce=Math.cos(this.angle),K=Math.sin(this.angle),pe=a-Math.round(a)+ce*se+K*oe,ge=u-Math.round(u)+ce*oe+K*se,ke=new Float64Array(d);if(c.J(ke,ke,[pe>.5?pe-1:pe,ge>.5?ge-1:ge,0]),this.alignedModelViewProjectionMatrix=ke,d=c.as(new Float64Array(16),this.pixelMatrix),!d)throw new Error("failed to invert matrix");this.pixelMatrixInverse=d,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new c.P(0,0)),a=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.af(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){const a=this.getCameraPoint();if(e.length===1)return[e[0],a];{let u=a.x,d=a.y,m=a.x,w=a.y;for(const S of e)u=Math.min(u,S.x),d=Math.min(d,S.y),m=Math.max(m,S.x),w=Math.max(w,S.y);return[new c.P(u,d),new c.P(m,d),new c.P(m,w),new c.P(u,w),new c.P(u,d)]}}lngLatToCameraDepth(e,a){const u=this.locationCoordinate(e),d=[u.x*this.worldSize,u.y*this.worldSize,a,1];return c.af(d,d,this.modelViewProjectionMatrix),d[2]/d[3]}}function El(g,e){let a,u=!1,d=null,m=null;const w=()=>{d=null,u&&(g.apply(m,a),d=setTimeout(w,e),u=!1)};return(...S)=>(u=!0,m=this,a=S,d||w(),d)}class Xh{constructor(e){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let u;return a.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(u=d)}),(u&&u[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(a.length>=3&&!a.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:u,pitch:+(a[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const u=a.join("/");let d=u;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${u}`);let m=window.location.hash.replace(d,"");m.startsWith("#&")?m=m.slice(0,1)+m.slice(2):m==="#"&&(m="");let w=window.location.href.replace(/(#.+)?$/,m);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=El(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const a=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,d),w=Math.round(a.lng*m)/m,S=Math.round(a.lat*m)/m,k=this._map.getBearing(),E=this._map.getPitch();let z="";if(z+=e?`/${w}/${S}/${u}`:`${u}/${S}/${w}`,(k||E)&&(z+="/"+Math.round(10*k)/10),E&&(z+=`/${Math.round(E)}`),this._hashName){const D=this._hashName;let j=!1;const q=window.location.hash.slice(1).split("&").map(G=>{const ee=G.split("=")[0];return ee===D?(j=!0,`${ee}=${z}`):G}).filter(G=>G);return j||q.push(`${D}=${z}`),`#${q.join("&")}`}return`#${z}`}}const Ra={linearity:.3,easing:c.b8(0,0,.3,1)},lp=c.e({deceleration:2500,maxSpeed:1400},Ra),Yh=c.e({deceleration:20,maxSpeed:1400},Ra),Cl=c.e({deceleration:1e3,maxSpeed:360},Ra),tu=c.e({deceleration:1e3,maxSpeed:90},Ra);class Kh{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:R.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,a=R.now();for(;e.length>0&&a-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)a.zoom+=m.zoomDelta||0,a.bearing+=m.bearingDelta||0,a.pitch+=m.pitchDelta||0,m.panDelta&&a.pan._add(m.panDelta),m.around&&(a.around=m.around),m.pinchAround&&(a.pinchAround=m.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(a.pan.mag()){const m=Js(a.pan.mag(),u,c.e({},lp,e||{}));d.offset=a.pan.mult(m.amount/a.pan.mag()),d.center=this._map.transform.center,Po(d,m)}if(a.zoom){const m=Js(a.zoom,u,Yh);d.zoom=this._map.transform.zoom+m.amount,Po(d,m)}if(a.bearing){const m=Js(a.bearing,u,Cl);d.bearing=this._map.transform.bearing+c.ac(m.amount,-179,179),Po(d,m)}if(a.pitch){const m=Js(a.pitch,u,tu);d.pitch=this._map.transform.pitch+m.amount,Po(d,m)}if(d.zoom||d.bearing){const m=a.pinchAround===void 0?a.around:a.pinchAround;d.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),c.e(d,{noMoveStart:!0})}}function Po(g,e){(!g.duration||g.duration<e.duration)&&(g.duration=e.duration,g.easing=e.easing)}function Js(g,e,a){const{maxSpeed:u,linearity:d,deceleration:m}=a,w=c.ac(g*d/(e/1e3),-u,u),S=Math.abs(w)/(m*d);return{easing:a.easing,duration:1e3*S,amount:w*(S/2)}}class tr extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,u,d={}){const m=C.mousePos(a.getCanvas(),u),w=a.unproject(m);super(e,c.e({point:m,lngLat:w,originalEvent:u},d)),this._defaultPrevented=!1,this.target=a}}class zo extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,u){const d=e==="touchend"?u.changedTouches:u.touches,m=C.touchPos(a.getCanvasContainer(),d),w=m.map(k=>a.unproject(k)),S=m.reduce((k,E,z,D)=>k.add(E.div(D.length)),new c.P(0,0));super(e,{points:m,point:S,lngLats:w,lngLat:a.unproject(S),originalEvent:u}),this._defaultPrevented=!1}}class iu extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class pn{constructor(e,a){this._map=e,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new iu(e.type,this._map,e))}mousedown(e,a){return this._mousedownPos=a,this._firePreventable(new tr(e.type,this._map,e))}mouseup(e){this._map.fire(new tr(e.type,this._map,e))}click(e,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new tr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new tr(e.type,this._map,e))}mouseover(e){this._map.fire(new tr(e.type,this._map,e))}mouseout(e){this._map.fire(new tr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new zo(e.type,this._map,e))}touchmove(e){this._map.fire(new zo(e.type,this._map,e))}touchend(e){this._map.fire(new zo(e.type,this._map,e))}touchcancel(e){this._map.fire(new zo(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qs{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new tr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new tr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class Pl{constructor(e,a){this._map=e,this._tr=new Wn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,a){this.isEnabled()&&e.shiftKey&&e.button===0&&(C.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(e,a){if(!this._active)return;const u=a;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=u,this._box||(this._box=C.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const m=Math.min(d.x,u.x),w=Math.max(d.x,u.x),S=Math.min(d.y,u.y),k=Math.max(d.y,u.y);C.setTransform(this._box,`translate(${m}px,${S}px)`),this._box.style.width=w-m+"px",this._box.style.height=k-S+"px"}mouseupWindow(e,a){if(!this._active||e.button!==0)return;const u=this._startPos,d=a;if(this.reset(),C.suppressClick(),u.x!==d.x||u.y!==d.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:m=>m.fitScreenCoordinates(u,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(C.remove(this._box),this._box=null),C.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,a){return this._map.fire(new c.k(e,{originalEvent:a}))}}function Do(g,e){if(g.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${e.length}`);const a={};for(let u=0;u<g.length;u++)a[g[u].identifier]=e[u];return a}class Jh{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,a,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(d){const m=new c.P(0,0);for(const w of d)m._add(w);return m.div(d.length)}(a),this.touches=Do(u,a)))}touchmove(e,a,u){if(this.aborted||!this.centroid)return;const d=Do(u,a);for(const m in this.touches){const w=d[m];(!w||w.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(e,a,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class zs{constructor(e){this.singleTap=new Jh(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,a,u){this.singleTap.touchstart(e,a,u)}touchmove(e,a,u){this.singleTap.touchmove(e,a,u)}touchend(e,a,u){const d=this.singleTap.touchend(e,a,u);if(d){const m=e.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(m&&w||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Lo{constructor(e){this._tr=new Wn(e),this._zoomIn=new zs({numTouches:1,numTaps:2}),this._zoomOut=new zs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,a,u){this._zoomIn.touchstart(e,a,u),this._zoomOut.touchstart(e,a,u)}touchmove(e,a,u){this._zoomIn.touchmove(e,a,u),this._zoomOut.touchmove(e,a,u)}touchend(e,a,u){const d=this._zoomIn.touchend(e,a,u),m=this._zoomOut.touchend(e,a,u),w=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(d)},{originalEvent:e})}):m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(m)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ea{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const a=this._moveFunction(...e);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(e,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=a.length?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,a){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const d=a.length?a[0]:a;return!this._moved&&d.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(u,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&C.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Qh={0:1,2:2};class zl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const a=C.mouseButton(e);this._eventButton=a}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(a,u){const d=Qh[u];return a.buttons===void 0||(a.buttons&d)!==d}(e,this._eventButton)}isValidEndEvent(e){return C.mouseButton(e)===this._eventButton}}class nu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const Dl=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=e=>{e.preventDefault()}},ru=({enable:g,clickTolerance:e,bearingDegreesPerPixelMoved:a=.8})=>{const u=new zl({checkCorrectEvent:d=>C.mouseButton(d)===0&&d.ctrlKey||C.mouseButton(d)===2});return new ea({clickTolerance:e,move:(d,m)=>({bearingDelta:(m.x-d.x)*a}),moveStateManager:u,enable:g,assignEvents:Dl})},Ds=({enable:g,clickTolerance:e,pitchDegreesPerPixelMoved:a=-.5})=>{const u=new zl({checkCorrectEvent:d=>C.mouseButton(d)===0&&d.ctrlKey||C.mouseButton(d)===2});return new ea({clickTolerance:e,move:(d,m)=>({pitchDelta:(m.y-d.y)*a}),moveStateManager:u,enable:g,assignEvents:Dl})};class ed{constructor(e,a){this._clickTolerance=e.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,a,u){return this._calculateTransform(e,a,u)}touchmove(e,a,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,a,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,a,u){this._calculateTransform(e,a,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,a,u){u.length>0&&(this._active=!0);const d=Do(u,a),m=new c.P(0,0),w=new c.P(0,0);let S=0;for(const E in d){const z=d[E],D=this._touches[E];D&&(m._add(z),w._add(z.sub(D)),S++,d[E]=z)}if(this._touches=d,this._shouldBePrevented(S)||!w.mag())return;const k=w.div(S);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(S),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ll{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,a,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([a[0],a[1]]))}touchmove(e,a,u){if(!this._firstTwoTouches)return;e.preventDefault();const[d,m]=this._firstTwoTouches,w=Ro(u,a,d),S=Ro(u,a,m);if(!w||!S)return;const k=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],k,e)}touchend(e,a,u){if(!this._firstTwoTouches)return;const[d,m]=this._firstTwoTouches,w=Ro(u,a,d),S=Ro(u,a,m);w&&S||(this._active&&C.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ro(g,e,a){for(let u=0;u<g.length;u++)if(g[u].identifier===a)return e[u]}function su(g,e){return Math.log(g/e)/Math.LN2}class au extends Ll{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,a){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(su(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:su(this._distance,u),pinchAround:a}}}function ou(g,e){return 180*g.angleWith(e)/Math.PI}class lu extends Ll{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,a,u){const d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ou(this._vector,d),pinchAround:a}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const a=25/(Math.PI*this._minDiameter)*360,u=ou(e,this._startVector);return Math.abs(u)<a}}function ta(g){return Math.abs(g.y)>Math.abs(g.x)}class cu extends Ll{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,a,u){super.touchstart(e,a,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,ta(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,a,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),m=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,m,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(e,a,u){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,m=a.mag()>=2;if(!d&&!m)return;if(!d||!m)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const w=e.y>0==a.y>0;return ta(e)&&ta(a)&&w}}const Gr={panStep:100,bearingStep:15,pitchStep:10};class Hr{constructor(e){this._tr=new Wn(e);const a=Gr;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let a=0,u=0,d=0,m=0,w=0;switch(e.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),m=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),m=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),w=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:S=>{const k=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:td,zoom:a?Math.round(k.zoom)+a*(e.shiftKey?2:1):k.zoom,bearing:k.bearing+u*this._bearingStep,pitch:k.pitch+d*this._pitchStep,offset:[-m*this._panStep,-w*this._panStep],center:k.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function td(g){return g*(2-g)}const Xr=4.000244140625;class ia{constructor(e,a){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new Wn(e),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let a=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=R.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,a!==0&&a%Xr==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),e.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=e,this._delta-=a,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=C.mousePos(this._map.getCanvas(),e),u=this._tr;this._around=a.y>u.transform.height/2-u.transform.getHorizon()?c.N.convert(this._aroundCenter?u.center:u.unproject(a)):c.N.convert(u.center),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>Xr?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&E!==0&&(E=1/E);const z=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(z*E))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,u=this._startZoom,d=this._easing;let m,w=!1;const S=R.now()-this._lastWheelEventTime;if(this._type==="wheel"&&u&&d&&S){const k=Math.min(S/200,1),E=d(k);m=c.y.number(u,a,E),k<1?this._frameId||(this._frameId=!0):w=!0}else m=a,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:m-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let a=c.b9;if(this._prevEase){const u=this._prevEase,d=(R.now()-u.start)/u.duration,m=u.easing(d+.01)-u.easing(d),w=.27/Math.sqrt(m*m+1e-4)*.01,S=Math.sqrt(.0729-w*w);a=c.b8(w,S,.25,1)}return this._prevEase={start:R.now(),duration:e,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class id{constructor(e,a){this._clickZoom=e,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class cp{constructor(e){this._tr=new Wn(e),this.reset()}reset(){this._active=!1}dblclick(e,a){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class up{constructor(){this._tap=new zs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,a,u){if(!this._swipePoint)if(this._tapTime){const d=a[0],m=e.timeStamp-this._tapTime<500,w=this._tapPoint.dist(d)<30;m&&w?u.length>0&&(this._swipePoint=d,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,a,u)}touchmove(e,a,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=a[0],m=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(e,a,u)}touchend(e,a,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const d=this._tap.touchend(e,a,u);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nd{constructor(e,a,u){this._el=e,this._mousePan=a,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class uu{constructor(e,a,u){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=a,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Oa{constructor(e,a,u,d){this._el=e,this._touchZoom=a,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class cs{constructor(e,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=C.create("div","maplibregl-cooperative-gesture-screen",e);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=a,this._container.appendChild(d);const m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=u,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(C.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,a){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ht=g=>g.zoom||g.drag||g.pitch||g.rotate;class rd extends c.k{}function Oo(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class sd{constructor(e,a){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,m)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=d.type==="renderFrame"?void 0:d,S={needsRenderFrame:!1},k={},E={},z=d.touches,D=z?this._getMapTouches(z):void 0,j=D?C.touchPos(this._map.getCanvas(),D):C.mousePos(this._map.getCanvas(),d);for(const{handlerName:ee,handler:se,allowed:oe}of this._handlers){if(!se.isEnabled())continue;let ce;this._blockedByActive(E,oe,ee)?se.reset():se[m||d.type]&&(ce=se[m||d.type](d,j,D),this.mergeHandlerResult(S,k,ce,ee,w),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||se.isActive())&&(E[ee]=se)}const q={};for(const ee in this._previousActiveHandlers)E[ee]||(q[ee]=w);this._previousActiveHandlers=E,(Object.keys(q).length||Oo(S))&&(this._changes.push([S,k,q]),this._triggerRenderFrame()),(Object.keys(E).length||Oo(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=S;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Kh(e),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,m,w]of this._listeners)C.addEventListener(d,m,d===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[e,a,u]of this._listeners)C.removeEventListener(e,a,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const a=this._map,u=a.getCanvasContainer();this._add("mapEvent",new pn(a,e));const d=a.boxZoom=new Pl(a,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();const m=a.cooperativeGestures=new cs(a,e.cooperativeGestures);this._add("cooperativeGestures",m),e.cooperativeGestures&&m.enable();const w=new Lo(a),S=new cp(a);a.doubleClickZoom=new id(S,w),this._add("tapZoom",w),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&a.doubleClickZoom.enable();const k=new up;this._add("tapDragZoom",k);const E=a.touchPitch=new cu(a);this._add("touchPitch",E),e.interactive&&e.touchPitch&&a.touchPitch.enable(e.touchPitch);const z=ru(e),D=Ds(e);a.dragRotate=new uu(e,z,D),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]),e.interactive&&e.dragRotate&&a.dragRotate.enable();const j=(({enable:ce,clickTolerance:K})=>{const pe=new zl({checkCorrectEvent:ge=>C.mouseButton(ge)===0&&!ge.ctrlKey});return new ea({clickTolerance:K,move:(ge,ke)=>({around:ke,panDelta:ke.sub(ge)}),activateOnStart:!0,moveStateManager:pe,enable:ce,assignEvents:Dl})})(e),q=new ed(e,a);a.dragPan=new nd(u,j,q),this._add("mousePan",j),this._add("touchPan",q,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&a.dragPan.enable(e.dragPan);const G=new lu,ee=new au;a.touchZoomRotate=new Oa(u,ee,G,k),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&a.touchZoomRotate.enable(e.touchZoomRotate);const se=a.scrollZoom=new ia(a,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),e.interactive&&e.scrollZoom&&a.scrollZoom.enable(e.scrollZoom);const oe=a.keyboard=new Hr(a);this._add("keyboard",oe),e.interactive&&e.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new Qs(a))}_add(e,a,u){this._handlers.push({handlerName:e,handler:a,allowed:u}),this._handlersById[e]=a}stop(e){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ht(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,a,u){for(const d in e)if(d!==u&&(!a||a.indexOf(d)<0))return!0;return!1}_getMapTouches(e){const a=[];for(const u of e)this._el.contains(u.target)&&a.push(u);return a}mergeHandlerResult(e,a,u,d,m){if(!u)return;c.e(e,u);const w={handlerName:d,originalEvent:u.originalEvent||m};u.zoomDelta!==void 0&&(a.zoom=w),u.panDelta!==void 0&&(a.drag=w),u.pitchDelta!==void 0&&(a.pitch=w),u.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const e={},a={},u={};for(const[d,m,w]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),c.e(a,m),c.e(u,w);this._updateMapTransform(e,a,u),this._changes=[]}_updateMapTransform(e,a,u){const d=this._map,m=d._getTransformForUpdate(),w=d.terrain;if(!(Oo(e)||w&&this._terrainMovement))return this._fireEvents(a,u,!0);let{panDelta:S,zoomDelta:k,bearingDelta:E,pitchDelta:z,around:D,pinchAround:j}=e;j!==void 0&&(D=j),d._stop(!0),D=D||d.transform.centerPoint;const q=m.pointLocation(S?D.sub(S):D);E&&(m.bearing+=E),z&&(m.pitch+=z),k&&(m.zoom+=k),w?this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?m.center=m.pointLocation(m.centerPoint.sub(S)):m.setLocationAtPoint(q,D):(this._terrainMovement=!0,this._map._elevationFreeze=!0,m.setLocationAtPoint(q,D)):m.setLocationAtPoint(q,D),d._applyUpdatedTransform(m),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(a,u,!0)}_fireEvents(e,a,u){const d=ht(this._eventsInProgress),m=ht(e),w={};for(const D in e){const{originalEvent:j}=e[D];this._eventsInProgress[D]||(w[`${D}start`]=j),this._eventsInProgress[D]=e[D]}!d&&m&&this._fireEvent("movestart",m.originalEvent);for(const D in w)this._fireEvent(D,w[D]);m&&this._fireEvent("move",m.originalEvent);for(const D in e){const{originalEvent:j}=e[D];this._fireEvent(D,j)}const S={};let k;for(const D in this._eventsInProgress){const{handlerName:j,originalEvent:q}=this._eventsInProgress[D];this._handlersById[j].isActive()||(delete this._eventsInProgress[D],k=a[j]||q,S[`${D}end`]=k)}for(const D in S)this._fireEvent(D,S[D]);const E=ht(this._eventsInProgress),z=(d||m)&&!E;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const D=this._map._getTransformForUpdate();D.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(D)}if(u&&z){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;!D||!D.essential&&R.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:k})),j(this._map.getBearing())&&this._map.resetNorth()):(j(D.bearing||this._map.getBearing())&&(D.bearing=0),D.freezeElevation=!0,this._map.easeTo(D,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(e,a){this._map.fire(new c.k(e,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new rd("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Bo extends c.E{constructor(e,a){super(),this._renderFrameCallback=()=>{const u=Math.min((R.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=a.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,a){return this.jumpTo({center:e},a)}panBy(e,a,u){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},a),u)}panTo(e,a,u){return this.easeTo(c.e({center:e},a),u)}getZoom(){return this.transform.zoom}setZoom(e,a){return this.jumpTo({zoom:e},a),this}zoomTo(e,a,u){return this.easeTo(c.e({zoom:e},a),u)}zoomIn(e,a){return this.zoomTo(this.getZoom()+1,e,a),this}zoomOut(e,a){return this.zoomTo(this.getZoom()-1,e,a),this}getBearing(){return this.transform.bearing}setBearing(e,a){return this.jumpTo({bearing:e},a),this}getPadding(){return this.transform.padding}setPadding(e,a){return this.jumpTo({padding:e},a),this}rotateTo(e,a,u){return this.easeTo(c.e({bearing:e},a),u)}resetNorth(e,a){return this.rotateTo(0,c.e({duration:1e3},e),a),this}resetNorthPitch(e,a){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),a),this}snapToNorth(e,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,a):this}getPitch(){return this.transform.pitch}setPitch(e,a){return this.jumpTo({pitch:e},a),this}cameraForBounds(e,a){e=Me.convert(e).adjustAntiMeridian();const u=a&&a.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,a)}_cameraForBoxAndBearing(e,a,u,d){const m={top:0,bottom:0,right:0,left:0};if(typeof(d=c.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const Qe=d.padding;d.padding={top:Qe,bottom:Qe,right:Qe,left:Qe}}d.padding=c.e(m,d.padding);const w=this.transform,S=w.padding,k=new Me(e,a),E=w.project(k.getNorthWest()),z=w.project(k.getNorthEast()),D=w.project(k.getSouthEast()),j=w.project(k.getSouthWest()),q=c.ba(-u),G=E.rotate(q),ee=z.rotate(q),se=D.rotate(q),oe=j.rotate(q),ce=new c.P(Math.max(G.x,ee.x,oe.x,se.x),Math.max(G.y,ee.y,oe.y,se.y)),K=new c.P(Math.min(G.x,ee.x,oe.x,se.x),Math.min(G.y,ee.y,oe.y,se.y)),pe=ce.sub(K),ge=(w.width-(S.left+S.right+d.padding.left+d.padding.right))/pe.x,ke=(w.height-(S.top+S.bottom+d.padding.top+d.padding.bottom))/pe.y;if(ke<0||ge<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const $e=Math.min(w.scaleZoom(w.scale*Math.min(ge,ke)),d.maxZoom),He=c.P.convert(d.offset),st=new c.P((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(c.ba(u)),dt=He.add(st).mult(w.scale/w.zoomScale($e));return{center:w.unproject(E.add(D).div(2).sub(dt)),zoom:$e,bearing:u}}fitBounds(e,a,u){return this._fitInternal(this.cameraForBounds(e,a),a,u)}fitScreenCoordinates(e,a,u,d,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(a)),u,d),d,m)}_fitInternal(e,a,u){return e?(delete(a=c.e(e,a)).padding,a.linear?this.easeTo(a,u):this.flyTo(a,u)):this}jumpTo(e,a){this.stop();const u=this._getTransformForUpdate();let d=!1,m=!1,w=!1;return"zoom"in e&&u.zoom!==+e.zoom&&(d=!0,u.zoom=+e.zoom),e.center!==void 0&&(u.center=c.N.convert(e.center)),"bearing"in e&&u.bearing!==+e.bearing&&(m=!0,u.bearing=+e.bearing),"pitch"in e&&u.pitch!==+e.pitch&&(w=!0,u.pitch=+e.pitch),e.padding==null||u.isPaddingEqual(e.padding)||(u.padding=e.padding),this._applyUpdatedTransform(u),this.fire(new c.k("movestart",a)).fire(new c.k("move",a)),d&&this.fire(new c.k("zoomstart",a)).fire(new c.k("zoom",a)).fire(new c.k("zoomend",a)),m&&this.fire(new c.k("rotatestart",a)).fire(new c.k("rotate",a)).fire(new c.k("rotateend",a)),w&&this.fire(new c.k("pitchstart",a)).fire(new c.k("pitch",a)).fire(new c.k("pitchend",a)),this.fire(new c.k("moveend",a))}calculateCameraOptionsFromTo(e,a,u,d=0){const m=c.Z.fromLngLat(e,a),w=c.Z.fromLngLat(u,d),S=w.x-m.x,k=w.y-m.y,E=w.z-m.z,z=Math.hypot(S,k,E);if(z===0)throw new Error("Can't calculate camera options with same From and To");const D=Math.hypot(S,k),j=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),q=180*Math.atan2(S,-k)/Math.PI;let G=180*Math.acos(D/z)/Math.PI;return G=E<0?90-G:90+G,{center:w.toLngLat(),zoom:j,pitch:G,bearing:q}}easeTo(e,a){var u;this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.b9},e)).animate===!1||!e.essential&&R.prefersReducedMotion)&&(e.duration=0);const d=this._getTransformForUpdate(),m=d.zoom,w=d.bearing,S=d.pitch,k=d.padding,E="bearing"in e?this._normalizeBearing(e.bearing,w):w,z="pitch"in e?+e.pitch:S,D="padding"in e?e.padding:d.padding,j=c.P.convert(e.offset);let q=d.centerPoint.add(j);const G=d.pointLocation(q),{center:ee,zoom:se}=d.getConstrained(c.N.convert(e.center||G),(u=e.zoom)!==null&&u!==void 0?u:m);this._normalizeCenter(ee,d);const oe=d.project(G),ce=d.project(ee).sub(oe),K=d.zoomScale(se-m);let pe,ge;e.around&&(pe=c.N.convert(e.around),ge=d.locationPoint(pe));const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||se!==m,this._rotating=this._rotating||w!==E,this._pitching=this._pitching||z!==S,this._padding=!d.isPaddingEqual(D),this._easeId=e.easeId,this._prepareEase(a,e.noMoveStart,ke),this.terrain&&this._prepareElevation(ee),this._ease($e=>{if(this._zooming&&(d.zoom=c.y.number(m,se,$e)),this._rotating&&(d.bearing=c.y.number(w,E,$e)),this._pitching&&(d.pitch=c.y.number(S,z,$e)),this._padding&&(d.interpolatePadding(k,D,$e),q=d.centerPoint.add(j)),this.terrain&&!e.freezeElevation&&this._updateElevation($e),pe)d.setLocationAtPoint(pe,ge);else{const He=d.zoomScale(d.zoom-m),st=se>m?Math.min(2,K):Math.max(.5,K),dt=Math.pow(st,1-$e),Qe=d.unproject(oe.add(ce.mult($e*dt)).mult(He));d.setLocationAtPoint(d.renderWorldCopies?Qe.wrap():Qe,q)}this._applyUpdatedTransform(d),this._fireMoveEvents(a)},$e=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a,$e)},e),this}_prepareEase(e,a,u={}){this._moving=!0,a||u.moving||this.fire(new c.k("movestart",e)),this._zooming&&!u.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&a!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(a-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=a}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const a=e.getCameraPosition(),u=this.terrain.getElevationForLngLatZoom(a.lngLat,e.zoom);if(a.altitude<u){const d=this.calculateCameraOptionsFromTo(a.lngLat,u,e.center,e.elevation);return{pitch:d.pitch,zoom:d.zoom}}return{}}_applyUpdatedTransform(e){const a=[];if(this.terrain&&a.push(d=>this._elevateCameraIfInsideTerrain(d)),this.transformCameraUpdate&&a.push(d=>this.transformCameraUpdate(d)),!a.length)return;const u=e.clone();for(const d of a){const m=u.clone(),{center:w,zoom:S,pitch:k,bearing:E,elevation:z}=d(m);w&&(m.center=w),S!==void 0&&(m.zoom=S),k!==void 0&&(m.pitch=k),E!==void 0&&(m.bearing=E),z!==void 0&&(m.elevation=z),u.apply(m)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const u=this._zooming,d=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new c.k("zoomend",e)),d&&this.fire(new c.k("rotateend",e)),m&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,a){var u;if(!e.essential&&R.prefersReducedMotion){const lt=c.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(lt,a)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},e);const d=this._getTransformForUpdate(),m=d.zoom,w=d.bearing,S=d.pitch,k=d.padding,E="bearing"in e?this._normalizeBearing(e.bearing,w):w,z="pitch"in e?+e.pitch:S,D="padding"in e?e.padding:d.padding,j=c.P.convert(e.offset);let q=d.centerPoint.add(j);const G=d.pointLocation(q),{center:ee,zoom:se}=d.getConstrained(c.N.convert(e.center||G),(u=e.zoom)!==null&&u!==void 0?u:m);this._normalizeCenter(ee,d);const oe=d.zoomScale(se-m),ce=d.project(G),K=d.project(ee).sub(ce);let pe=e.curve;const ge=Math.max(d.width,d.height),ke=ge/oe,$e=K.mag();if("minZoom"in e){const lt=c.ac(Math.min(e.minZoom,m,se),d.minZoom,d.maxZoom),Ot=ge/d.zoomScale(lt-m);pe=Math.sqrt(Ot/$e*2)}const He=pe*pe;function st(lt){const Ot=(ke*ke-ge*ge+(lt?-1:1)*He*He*$e*$e)/(2*(lt?ke:ge)*He*$e);return Math.log(Math.sqrt(Ot*Ot+1)-Ot)}function dt(lt){return(Math.exp(lt)-Math.exp(-lt))/2}function Qe(lt){return(Math.exp(lt)+Math.exp(-lt))/2}const Je=st(!1);let vt=function(lt){return Qe(Je)/Qe(Je+pe*lt)},Vt=function(lt){return ge*((Qe(Je)*(dt(Ot=Je+pe*lt)/Qe(Ot))-dt(Je))/He)/$e;var Ot},it=(st(!0)-Je)/pe;if(Math.abs($e)<1e-6||!isFinite(it)){if(Math.abs(ge-ke)<1e-6)return this.easeTo(e,a);const lt=ke<ge?-1:1;it=Math.abs(Math.log(ke/ge))/pe,Vt=()=>0,vt=Ot=>Math.exp(lt*pe*Ot)}return e.duration="duration"in e?+e.duration:1e3*it/("screenSpeed"in e?+e.screenSpeed/pe:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=w!==E,this._pitching=z!==S,this._padding=!d.isPaddingEqual(D),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(ee),this._ease(lt=>{const Ot=lt*it,Hi=1/vt(Ot);d.zoom=lt===1?se:m+d.scaleZoom(Hi),this._rotating&&(d.bearing=c.y.number(w,E,lt)),this._pitching&&(d.pitch=c.y.number(S,z,lt)),this._padding&&(d.interpolatePadding(k,D,lt),q=d.centerPoint.add(j)),this.terrain&&!e.freezeElevation&&this._updateElevation(lt);const Jt=lt===1?ee:d.unproject(ce.add(K.mult(Vt(Ot))).mult(Hi));d.setLocationAtPoint(d.renderWorldCopies?Jt.wrap():Jt,q),this._applyUpdatedTransform(d),this._fireMoveEvents(a)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,a){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,a)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,a,u){u.animate===!1||u.duration===0?(e(1),a()):(this._easeStart=R.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,a){e=c.b3(e,-180,180);const u=Math.abs(e-a);return Math.abs(e-360-a)<u&&(e-=360),Math.abs(e+360-a)<u&&(e+=360),e}_normalizeCenter(e,a){if(!a.renderWorldCopies||a.lngRange)return;const u=e.lng-a.center.lng;e.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Ba={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class hu{constructor(e=Ba){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=C.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=C.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=C.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){C.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,a){const u=this._map._getUIString(`AttributionControl.${a}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const a=this._map.style.sourceCaches;for(const d in a){const m=a[d];if(m.used||m.usedForTerrain){const w=m.getSource();w.attribution&&e.indexOf(w.attribution)<0&&e.push(w.attribution)}}e=e.filter(d=>String(d).trim()),e.sort((d,m)=>d.length-m.length),e=e.filter((d,m)=>{for(let w=m+1;w<e.length;w++)if(e[w].indexOf(d)>=0)return!1;return!0});const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class li{constructor(e={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const u=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=C.create("div","maplibregl-ctrl");const a=C.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){C.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class du{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const a=++this._id;return this._queue.push({callback:e,id:a,cancelled:!1}),a}remove(e){const a=this._currentlyRunning,u=a?this._queue.concat(a):this._queue;for(const d of u)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const u of a)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var hp=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class fu extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,a){this.sourceCache.update(e,a),this._renderableTilesKeys=[];const u={};for(const d of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))u[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.posMatrix=new Float64Array(16),c.aP(d.posMatrix,0,c.X,0,c.X,0,1),this._tiles[d.key]=new Bi(d,this.tileSize));for(const d in this._tiles)u[d]||delete this._tiles[d]}freeRtt(e){for(const a in this._tiles){const u=this._tiles[a];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const a={};for(const u of this._renderableTilesKeys){const d=this._tiles[u].tileID;if(d.canonical.equals(e.canonical)){const m=e.clone();m.posMatrix=new Float64Array(16),c.aP(m.posMatrix,0,c.X,0,c.X,0,1),a[u]=m}else if(d.canonical.isChildOf(e.canonical)){const m=e.clone();m.posMatrix=new Float64Array(16);const w=d.canonical.z-e.canonical.z,S=d.canonical.x-(d.canonical.x>>w<<w),k=d.canonical.y-(d.canonical.y>>w<<w),E=c.X>>w;c.aP(m.posMatrix,0,E,0,E,0,1),c.J(m.posMatrix,m.posMatrix,[-S*E,-k*E,0]),a[u]=m}else if(e.canonical.isChildOf(d.canonical)){const m=e.clone();m.posMatrix=new Float64Array(16);const w=e.canonical.z-d.canonical.z,S=e.canonical.x-(e.canonical.x>>w<<w),k=e.canonical.y-(e.canonical.y>>w<<w),E=c.X>>w;c.aP(m.posMatrix,0,c.X,0,c.X,0,1),c.J(m.posMatrix,m.posMatrix,[S*E,k*E,0]),c.K(m.posMatrix,m.posMatrix,[1/2**w,1/2**w,0]),a[u]=m}}return a}getSourceTile(e,a){const u=this.sourceCache._source;let d=e.overscaledZ-this.deltaZoom;if(d>u.maxzoom&&(d=u.maxzoom),d<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!m||!m.dem)&&a)for(;d>=u.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(e.scaledTo(d--).key);return m}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(a=>a.timeAdded>=e)}}class dp{constructor(e,a,u){this.painter=e,this.sourceCache=new fu(a),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,a,u,d=c.X){var m;if(!(a>=0&&a<d&&u>=0&&u<d))return 0;const w=this.getTerrainData(e),S=(m=w.tile)===null||m===void 0?void 0:m.dem;if(!S)return 0;const k=function(G,ee,se){var oe=ee[0],ce=ee[1];return G[0]=se[0]*oe+se[4]*ce+se[12],G[1]=se[1]*oe+se[5]*ce+se[13],G}([],[a/d*c.X,u/d*c.X],w.u_terrain_matrix),E=[k[0]*S.dim,k[1]*S.dim],z=Math.floor(E[0]),D=Math.floor(E[1]),j=E[0]-z,q=E[1]-D;return S.get(z,D)*(1-j)*(1-q)+S.get(z+1,D)*j*(1-q)+S.get(z,D+1)*(1-j)*q+S.get(z+1,D+1)*j*q}getElevationForLngLatZoom(e,a){if(!c.bb(a,e.wrap()))return 0;const{tileID:u,mercatorX:d,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(e,a);return this.getElevation(u,d%c.X,m%c.X,c.X)}getElevation(e,a,u,d=c.X){return this.getDEMElevation(e,a,u,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.painter.context,m=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Te(d,m,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Te(d,new c.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}const a=this.sourceCache.getSourceTile(e,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const d=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new Te(d,a.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),a.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const u=a&&a+a.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const d=this.sourceCache.sourceCache._source.maxzoom;let m=e.canonical.z-a.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?m=e.canonical.z-d:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=e.canonical.x-(e.canonical.x>>m<<m),S=e.canonical.y-(e.canonical.y>>m<<m),k=c.bc(new Float64Array(16),[1/(c.X<<m),1/(c.X<<m),0]);c.J(k,k,[w*c.X,S*c.X,0]),this._demMatrixCache[e.key]={matrix:k,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(e){const a=this.painter,u=a.width/devicePixelRatio,d=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Te(a.context,{width:u,height:d,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Te(a.context,{width:u,height:d,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(u,d,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,u,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,w=0;m<this._coordsTextureSize;m++)for(let S=0;S<this._coordsTextureSize;S++,w+=4)a[w+0]=255&S,a[w+1]=255&m,a[w+2]=S>>8<<4|m>>8,a[w+3]=0;const u=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),d=new Te(e,u,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),u=this.painter.context,d=u.gl,m=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(m,S-w-1,1,1,d.RGBA,d.UNSIGNED_BYTE,a),u.bindFramebuffer.set(null);const k=a[0]+(a[2]>>4<<8),E=a[1]+((15&a[2])<<8),z=this.coordsIndex[255-a[3]],D=z&&this.sourceCache.getTileByID(z);if(!D)return null;const j=this._coordsTextureSize,q=(1<<D.tileID.canonical.z)*j;return new c.Z((D.tileID.canonical.x*j+k)/q+D.tileID.wrap,(D.tileID.canonical.y*j+E)/q,this.getElevation(D.tileID,k,E,j))}depthAtPoint(e){const a=new Uint8Array(4),u=this.painter.context,d=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,a),u.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,a=new c.bd,u=new c.aY,d=this.meshSize,m=c.X/d,w=d*d;for(let D=0;D<=d;D++)for(let j=0;j<=d;j++)a.emplaceBack(j*m,D*m,0);for(let D=0;D<w;D+=d+1)for(let j=0;j<d;j++)u.emplaceBack(j+D,d+j+D+1,d+j+D+2),u.emplaceBack(j+D,d+j+D+2,j+D+1);const S=a.length,k=S+2*(d+1);for(const D of[0,1])for(let j=0;j<=d;j++)for(const q of[0,1])a.emplaceBack(j*m,D*c.X,q);for(let D=0;D<2*d;D+=2)u.emplaceBack(k+D,k+D+1,k+D+3),u.emplaceBack(k+D,k+D+3,k+D+2),u.emplaceBack(S+D,S+D+3,S+D+1),u.emplaceBack(S+D,S+D+2,S+D+3);const E=a.length,z=E+2*(d+1);for(const D of[0,1])for(let j=0;j<=d;j++)for(const q of[0,1])a.emplaceBack(D*c.X,j*m,q);for(let D=0;D<2*d;D+=2)u.emplaceBack(E+D,E+D+1,E+D+3),u.emplaceBack(E+D,E+D+3,E+D+2),u.emplaceBack(z+D,z+D+3,z+D+1),u.emplaceBack(z+D,z+D+2,z+D+3);return this._mesh=new Ao(e.createVertexBuffer(a,hp.members),e.createIndexBuffer(u),c.a0.simpleSegment(0,0,a.length,u.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,a){var u;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,a);return(u=this.getMinMaxElevation(d).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const a=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return a&&a.dem&&(u.minElevation=a.dem.min*this.exaggeration,u.maxElevation=a.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,a){const u=c.Z.fromLngLat(e.wrap()),d=(1<<a)*c.X,m=u.x*d,w=u.y*d,S=Math.floor(m/c.X),k=Math.floor(w/c.X);return{tileID:new c.S(a,0,a,S,k),mercatorX:m,mercatorY:w}}}class fp{constructor(e,a,u){this._context=e,this._size=a,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new Te(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(u.texture),{id:e,fbo:a,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>e.id!==a),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const na={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class pu{constructor(e,a){this.painter=e,this.terrain=a,this.pool=new fp(e.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(u=>!e._layers[u].isHidden(a)),this._coordsDescendingInv={};for(const u in e.sourceCaches){this._coordsDescendingInv[u]={};const d=e.sourceCaches[u].getVisibleCoordinates();for(const m of d){const w=this.terrain.sourceCache.getTerrainCoords(m);for(const S in w)this._coordsDescendingInv[u][S]||(this._coordsDescendingInv[u][S]=[]),this._coordsDescendingInv[u][S].push(w[S])}}this._coordsDescendingInvStr={};for(const u of e._order){const d=e._layers[u],m=d.source;if(na[d.type]&&!this._coordsDescendingInvStr[m]){this._coordsDescendingInvStr[m]={};for(const w in this._coordsDescendingInv[m])this._coordsDescendingInvStr[m][w]=this._coordsDescendingInv[m][w].map(S=>S.key).sort().join()}}for(const u of this._renderableTiles)for(const d in this._coordsDescendingInvStr){const m=this._coordsDescendingInvStr[d][u.tileID.key];m&&m!==u.rttCoords[d]&&(u.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const a=e.type,u=this.painter,d=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(na[a]&&(this._prevType&&na[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(e.id),!d))return!0;if(na[this._prevType]||na[a]&&d){this._prevType=a;const m=this._stacks.length-1,w=this._stacks[m]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(Al(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[m]){const E=this.pool.getObjectForId(S.rtt[m].id);if(E.stamp===S.rtt[m].stamp){this.pool.useObject(E);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),S.rtt[m]={id:k.id,stamp:k.stamp},u.context.bindFramebuffer.set(k.fbo.framebuffer),u.context.clear({color:c.aM.transparent,stencil:0}),u.currentStencilSource=void 0;for(let E=0;E<w.length;E++){const z=u.style._layers[w[E]],D=z.source?this._coordsDescendingInv[z.source][S.tileID.key]:[S.tileID];u.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),u._renderTileClippingMasks(z,D),u.renderLayer(u,u.style.sourceCaches[z.source],z,D),z.source&&(S.rttCoords[z.source]=this._coordsDescendingInvStr[z.source][S.tileID.key])}}return Al(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),na[a]}return!1}}const ad={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},pp=A,od={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ba,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},ld=g=>{g.touchstart=g.dragStart,g.touchmoveWindow=g.dragMove,g.touchend=g.dragEnd},mp={showCompass:!0,showZoom:!0,visualizePitch:!1};class ra{constructor(e,a,u=!1){this.mousedown=w=>{this.startMouse(c.e({},w,{ctrlKey:!0,preventDefault:()=>w.preventDefault()}),C.mousePos(this.element,w)),C.addEventListener(window,"mousemove",this.mousemove),C.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.moveMouse(w,C.mousePos(this.element,w))},this.mouseup=w=>{this.mouseRotate.dragEnd(w),this.mousePitch&&this.mousePitch.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=C.touchPos(this.element,w.targetTouches)[0],this.startTouch(w,this._startPos),C.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=C.touchPos(this.element,w.targetTouches)[0],this.moveTouch(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const d=e.dragRotate._mouseRotate.getClickTolerance(),m=e.dragRotate._mousePitch.getClickTolerance();this.element=a,this.mouseRotate=ru({clickTolerance:d,enable:!0}),this.touchRotate=(({enable:w,clickTolerance:S,bearingDegreesPerPixelMoved:k=.8})=>{const E=new nu;return new ea({clickTolerance:S,move:(z,D)=>({bearingDelta:(D.x-z.x)*k}),moveStateManager:E,enable:w,assignEvents:ld})})({clickTolerance:d,enable:!0}),this.map=e,u&&(this.mousePitch=Ds({clickTolerance:m,enable:!0}),this.touchPitch=(({enable:w,clickTolerance:S,pitchDegreesPerPixelMoved:k=-.5})=>{const E=new nu;return new ea({clickTolerance:S,move:(z,D)=>({pitchDelta:(D.y-z.y)*k}),moveStateManager:E,enable:w,assignEvents:ld})})({clickTolerance:m,enable:!0})),C.addEventListener(a,"mousedown",this.mousedown),C.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),C.addEventListener(a,"touchcancel",this.reset)}startMouse(e,a){this.mouseRotate.dragStart(e,a),this.mousePitch&&this.mousePitch.dragStart(e,a),C.disableDrag()}startTouch(e,a){this.touchRotate.dragStart(e,a),this.touchPitch&&this.touchPitch.dragStart(e,a),C.disableDrag()}moveMouse(e,a){const u=this.map,{bearingDelta:d}=this.mouseRotate.dragMove(e,a)||{};if(d&&u.setBearing(u.getBearing()+d),this.mousePitch){const{pitchDelta:m}=this.mousePitch.dragMove(e,a)||{};m&&u.setPitch(u.getPitch()+m)}}moveTouch(e,a){const u=this.map,{bearingDelta:d}=this.touchRotate.dragMove(e,a)||{};if(d&&u.setBearing(u.getBearing()+d),this.touchPitch){const{pitchDelta:m}=this.touchPitch.dragMove(e,a)||{};m&&u.setPitch(u.getPitch()+m)}}off(){const e=this.element;C.removeEventListener(e,"mousedown",this.mousedown),C.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend),C.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){C.enableDrag(),C.removeEventListener(window,"mousemove",this.mousemove),C.removeEventListener(window,"mouseup",this.mouseup),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend)}}let Pi;function Fo(g,e,a){const u=new c.N(g.lng,g.lat);if(g=new c.N(g.lng,g.lat),e){const d=new c.N(g.lng-360,g.lat),m=new c.N(g.lng+360,g.lat),w=a.locationPoint(g).distSqr(e);a.locationPoint(d).distSqr(e)<w?g=d:a.locationPoint(m).distSqr(e)<w&&(g=m)}for(;Math.abs(g.lng-a.center.lng)>180;){const d=a.locationPoint(g);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;g.lng>a.center.lng?g.lng-=360:g.lng+=360}return g.lng!==u.lng&&a.locationPoint(g).y>a.height/2-a.getHorizon()?g:u}const No={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function mu(g,e,a){const u=g.classList;for(const d in No)u.remove(`maplibregl-${a}-anchor-${d}`);u.add(`maplibregl-${a}-anchor-${e}`)}class Rl extends c.E{constructor(e){if(super(),this._onKeyPress=a=>{const u=a.code,d=a.charCode||a.keyCode;u!=="Space"&&u!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=a=>{const u=a.originalEvent.target,d=this._element;this._popup&&(u===d||d.contains(u))&&this.togglePopup()},this._update=a=>{var u;if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((a==null?void 0:a.type)==="terrain"||(a==null?void 0:a.type)==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Fo(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),C.setTransform(this._element,`${No[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${m}`),R.frameAsync(new AbortController).then(()=>{this._updateOpacity(a&&a.type==="moveend")}).catch(()=>{})},this._onMove=a=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=C.create("div");const a=C.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${u}px`),a.setAttributeNS(null,"width",`${d}px`),a.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);const m=C.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const w=C.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const S=C.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of k){const ce=C.createNS("http://www.w3.org/2000/svg","ellipse");ce.setAttributeNS(null,"opacity","0.04"),ce.setAttributeNS(null,"cx","10.5"),ce.setAttributeNS(null,"cy","5.80029008"),ce.setAttributeNS(null,"rx",oe.rx),ce.setAttributeNS(null,"ry",oe.ry),S.appendChild(ce)}const E=C.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const z=C.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(z);const D=C.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"opacity","0.25"),D.setAttributeNS(null,"fill","#000000");const j=C.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),D.appendChild(j);const q=C.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const G=C.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ee=C.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#000000"),ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962");const se=C.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#FFFFFF"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962"),G.appendChild(ee),G.appendChild(se),w.appendChild(S),w.appendChild(E),w.appendChild(D),w.appendChild(q),w.appendChild(G),a.appendChild(w),a.setAttributeNS(null,"height",u*this._scale+"px"),a.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(a),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),mu(this._element,this._anchor,"marker"),e&&e.className)for(const a of e.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),C.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var a,u;if(!(!((a=this._map)===null||a===void 0)&&a.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const d=this._map,m=d.terrain.depthAtPoint(this._pos),w=d.terrain.getElevationForLngLatZoom(this._lngLat,d.transform.tileZoom);if(d.transform.lngLatToCameraDepth(this._lngLat,w)-m<.006)return void(this._element.style.opacity=this._opacity);const S=-this._offset.y/d.transform._pixelPerMeter,k=Math.sin(d.getPitch()*Math.PI/180)*S,E=d.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),z=d.transform.lngLatToCameraDepth(this._lngLat,w+k)-E>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&z&&this._popup.remove(),this._element.style.opacity=z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,a){return e===void 0&&a===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const cd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ol=0,mr=!1;const Bl={maxWidth:100,unit:"metric"};function St(g,e,a){const u=a&&a.maxWidth||100,d=g._container.clientHeight/2,m=g.unproject([0,d]),w=g.unproject([u,d]),S=m.distanceTo(w);if(a&&a.unit==="imperial"){const k=3.2808*S;k>5280?It(e,u,k/5280,g._getUIString("ScaleControl.Miles")):It(e,u,k,g._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?It(e,u,S/1852,g._getUIString("ScaleControl.NauticalMiles")):S>=1e3?It(e,u,S/1e3,g._getUIString("ScaleControl.Kilometers")):It(e,u,S,g._getUIString("ScaleControl.Meters"))}function It(g,e,a,u){const d=function(m){const w=Math.pow(10,`${Math.floor(m)}`.length-1);let S=m/w;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(k){const E=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*E)/E}(S),w*S}(a);g.style.width=e*(d/a)+"px",g.innerHTML=`${d}&nbsp;${u}`}const Fl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},gu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nl(g){if(g){if(typeof g=="number"){const e=Math.round(Math.abs(g)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,g),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-g),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(g,0),right:new c.P(-g,0)}}if(g instanceof c.P||Array.isArray(g)){const e=c.P.convert(g);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(g.center||[0,0]),top:c.P.convert(g.top||[0,0]),"top-left":c.P.convert(g["top-left"]||[0,0]),"top-right":c.P.convert(g["top-right"]||[0,0]),bottom:c.P.convert(g.bottom||[0,0]),"bottom-left":c.P.convert(g["bottom-left"]||[0,0]),"bottom-right":c.P.convert(g["bottom-right"]||[0,0]),left:c.P.convert(g.left||[0,0]),right:c.P.convert(g.right||[0,0])}}return Nl(new c.P(0,0))}const gr=A;_.AJAXError=c.bh,_.Evented=c.E,_.LngLat=c.N,_.MercatorCoordinate=c.Z,_.Point=c.P,_.addProtocol=c.bi,_.config=c.a,_.removeProtocol=c.bj,_.AttributionControl=hu,_.BoxZoomHandler=Pl,_.CanvasSource=Qn,_.CooperativeGesturesHandler=cs,_.DoubleClickZoomHandler=id,_.DragPanHandler=nd,_.DragRotateHandler=uu,_.EdgeInsets=Eo,_.FullscreenControl=class extends c.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var e;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=a==null?void 0:a.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){C.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=C.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);C.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},_.GeoJSONSource=dr,_.GeolocateControl=class extends c.E{constructor(g){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const a=new c.N(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,d=this._map.getBearing(),m=c.e({bearing:d},this.options.fitBoundsOptions),w=Me.fromLngLat(a,u);this._map.fitBounds(w,m,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const a=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&mr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=C.create("button","maplibregl-ctrl-geolocate",this._container),C.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Rl({element:this._dotElement}),this._circleElement=C.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Rl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},cd,g)}onAdd(g){return this._map=g,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(Pi!==void 0&&!e)return Pi;if(window.navigator.permissions===void 0)return Pi=!!window.navigator.geolocation,Pi;try{Pi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Pi=!!window.navigator.geolocation}return Pi})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),C.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ol=0,mr=!1}_isOutOfMapMaxBounds(g){const e=this._map.getMaxBounds(),a=g.coords;return e&&(a.longitude<e.getWest()||a.longitude>e.getEast()||a.latitude<e.getSouth()||a.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),e=g.getSouthEast(),a=g.getNorthEast(),u=e.distanceTo(a),d=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ol--,mr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ol++,Ol>1?(g={maximumAge:6e5,timeout:0},mr=!0):(g=this.options.positionOptions,mr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},_.Hash=Xh,_.ImageSource=Jn,_.KeyboardHandler=Hr,_.LngLatBounds=Me,_.LogoControl=li,_.Map=class extends Bo{constructor(g){c.bf.mark(c.bg.create);const e=Object.assign(Object.assign({},od),g);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new La(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new du,this._controls=[],this._mapId=c.a4(),this._contextLost=a=>{a.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:a}))},this._contextRestored=a=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:a}))},this._onMapScroll=a=>{if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ad),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ne.addThrottleControl(()=>this.isMoving()),this._requestManager=new _e(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let a=!1;const u=El(d=>{this._trackResize&&!this._removed&&(this.resize(d),this.redraw())},50);this._resizeObserver=new ResizeObserver(d=>{a?u(d):a=!0}),this._resizeObserver.observe(this._container)}this.handlers=new sd(this,e),this._hash=e.hash&&new Xh(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,c.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new hu(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new li,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new c.k(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new c.k(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new c.k("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(g,e){if(e===void 0&&(e=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=g.onAdd(this);this._controls.push(g);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(a,u.firstChild):u.appendChild(a),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(g);return e>-1&&this._controls.splice(e,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,e,a,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,e,a,u)}resize(g){var e;const a=this._containerDimensions(),u=a[0],d=a[1],m=this._getClampedPixelRatio(u,d);if(this._resizeCanvas(u,d,m),this.painter.resize(u,d,m),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const k=this._getClampedPixelRatio(u,d);this._resizeCanvas(u,d,k),this.painter.resize(u,d,k)}this.transform.resize(u,d),(e=this._requestedCameraState)===null||e===void 0||e.resize(u,d);const w=!this._moving;return w&&(this.stop(),this.fire(new c.k("movestart",g)).fire(new c.k("move",g))),this.fire(new c.k("resize",g)),w&&this.fire(new c.k("moveend",g)),this}_getClampedPixelRatio(g,e){const{0:a,1:u}=this._maxCanvasSize,d=this.getPixelRatio(),m=g*d,w=e*d;return Math.min(m>a?a/m:1,w>u?u/w:1)*d}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(Me.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}project(g){return this.transform.locationPoint(c.N.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.pointLocation(c.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,e,a){if(g==="mouseenter"||g==="mouseover"){let u=!1;return{layers:e,listener:a,delegates:{mousemove:m=>{const w=e.filter(k=>this.getLayer(k)),S=w.length!==0?this.queryRenderedFeatures(m.point,{layers:w}):[];S.length?u||(u=!0,a.call(this,new tr(g,this,m.originalEvent,{features:S}))):u=!1},mouseout:()=>{u=!1}}}}if(g==="mouseleave"||g==="mouseout"){let u=!1;return{layers:e,listener:a,delegates:{mousemove:w=>{const S=e.filter(k=>this.getLayer(k));(S.length!==0?this.queryRenderedFeatures(w.point,{layers:S}):[]).length?u=!0:u&&(u=!1,a.call(this,new tr(g,this,w.originalEvent)))},mouseout:w=>{u&&(u=!1,a.call(this,new tr(g,this,w.originalEvent)))}}}}{const u=d=>{const m=e.filter(S=>this.getLayer(S)),w=m.length!==0?this.queryRenderedFeatures(d.point,{layers:m}):[];w.length&&(d.features=w,a.call(this,d),delete d.features)};return{layers:e,listener:a,delegates:{[g]:u}}}}_saveDelegatedListener(g,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(e)}_removeDelegatedListener(g,e,a){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const u=this._delegatedListeners[g];for(let d=0;d<u.length;d++){const m=u[d];if(m.listener===a&&m.layers.length===e.length&&m.layers.every(w=>e.includes(w))){for(const w in m.delegates)this.off(w,m.delegates[w]);return void u.splice(d,1)}}}on(g,e,a){if(a===void 0)return super.on(g,e);const u=this._createDelegatedListener(g,typeof e=="string"?[e]:e,a);this._saveDelegatedListener(g,u);for(const d in u.delegates)this.on(d,u.delegates[d]);return this}once(g,e,a){if(a===void 0)return super.once(g,e);const u=typeof e=="string"?[e]:e,d=this._createDelegatedListener(g,u,a);for(const m in d.delegates){const w=d.delegates[m];d.delegates[m]=(...S)=>{this._removeDelegatedListener(g,u,a),w(...S)}}this._saveDelegatedListener(g,d);for(const m in d.delegates)this.once(m,d.delegates[m]);return this}off(g,e,a){return a===void 0?super.off(g,e):(this._removeDelegatedListener(g,typeof e=="string"?[e]:e,a),this)}queryRenderedFeatures(g,e){if(!this.style)return[];let a;const u=g instanceof c.P||Array.isArray(g),d=u?g:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:g)||{},d instanceof c.P||typeof d[0]=="number")a=[c.P.convert(d)];else{const m=c.P.convert(d[0]),w=c.P.convert(d[1]);a=[m,new c.P(w.x,m.y),w,new c.P(m.x,w.y),m]}return this.style.queryRenderedFeatures(a,e,this.transform)}querySourceFeatures(g,e){return this.style.querySourceFeatures(g,e)}setStyle(g,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(g,e))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const e=this._locale[g];if(e==null)throw new Error(`Missing UI string '${g}'`);return e}_updateStyle(g,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,e));const a=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new fl(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,e,a):this.style.loadJSON(g,e,a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new fl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,e){if(typeof g=="string"){const a=this._requestManager.transformRequest(g,"Style");c.h(a,new AbortController).then(u=>{this._updateDiff(u.data,e)}).catch(u=>{u&&this.fire(new c.j(u))})}else typeof g=="object"&&this._updateDiff(g,e)}_updateDiff(g,e){try{this.style.setState(g,e)&&this._update(!0)}catch(a){c.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(g,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(g,e){return this._lazyInitEmptyStyle(),this.style.addSource(g,e),this._update(!0)}isSourceLoaded(g){const e=this.style&&this.style.sourceCaches[g];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const e=this.style.sourceCaches[g.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&e.reload();for(const a in this.style._layers){const u=this.style._layers[a];u.type==="hillshade"&&u.source===g.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new dp(this.painter,e,g),this.painter.renderToTexture=new pu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=a=>{a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==g.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:g})),this}getTerrain(){var g,e;return(e=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const e in g){const a=g[e]._tiles;for(const u in a){const d=a[u];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,e,a={}){const{pixelRatio:u=1,sdf:d=!1,stretchX:m,stretchY:w,content:S,textFitWidth:k,textFitHeight:E}=a;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:D,data:j}=e,q=e;return this.style.addImage(g,{data:new c.R({width:z,height:D},new Uint8Array(j)),pixelRatio:u,stretchX:m,stretchY:w,content:S,textFitWidth:k,textFitHeight:E,sdf:d,version:0,userImage:q}),q.onAdd&&q.onAdd(this,g),this}}{const{width:z,height:D,data:j}=R.getImageData(e);this.style.addImage(g,{data:new c.R({width:z,height:D},j),pixelRatio:u,stretchX:m,stretchY:w,content:S,textFitWidth:k,textFitHeight:E,sdf:d,version:0})}}updateImage(g,e){const a=this.style.getImage(g);if(!a)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||c.b(e)?R.getImageData(e):e,{width:d,height:m,data:w}=u;if(d===void 0||m===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==a.data.width||m!==a.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(e instanceof HTMLImageElement||c.b(e));return a.data.replace(w,S),this.style.updateImage(g,a),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return ne.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,e){return this._lazyInitEmptyStyle(),this.style.addLayer(g,e),this._update(!0)}moveLayer(g,e){return this.style.moveLayer(g,e),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,e,a){return this.style.setLayerZoomRange(g,e,a),this._update(!0)}setFilter(g,e,a={}){return this.style.setFilter(g,e,a),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,e,a,u={}){return this.style.setPaintProperty(g,e,a,u),this._update(!0)}getPaintProperty(g,e){return this.style.getPaintProperty(g,e)}setLayoutProperty(g,e,a,u={}){return this.style.setLayoutProperty(g,e,a,u),this._update(!0)}getLayoutProperty(g,e){return this.style.getLayoutProperty(g,e)}setGlyphs(g,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,e,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,e,a,u=>{u||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,e,a=>{a||this._update(!0)}),this}setLight(g,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(g){return this._lazyInitEmptyStyle(),this.style.setSky(g),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,e){return this.style.setFeatureState(g,e),this._update()}removeFeatureState(g,e){return this.style.removeFeatureState(g,e),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,e=0;return this._container&&(g=this._container.clientWidth||400,e=this._container.clientHeight||300),[g,e]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const e=this._canvasContainer=C.create("div","maplibregl-canvas-container",g);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=C.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),u=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],u);const d=this._controlContainer=C.create("div","maplibregl-control-container",g),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{m[w]=C.create("div",`maplibregl-ctrl-${w} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,e,a){this._canvas.width=Math.floor(a*g),this._canvas.height=Math.floor(a*e),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const g={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{e={requestedAttributes:g},u&&(e.statusMessage=u.statusMessage,e.type=u.type)},{once:!0});const a=this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g);if(!a){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new Il(a,this.transform),Y.testSupport(a)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const d=this.transform.zoom,m=R.now();this.style.zoomHistory.update(d,m);const w=new c.z(d,{now:m,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=w.crossFadingFactor();S===1&&S===this._crossFadingFactor||(a=!0,this._crossFadingFactor=S),this.style.update(w)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ne.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),C.remove(this._canvasContainer),C.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,R.frameAsync(this._frameRequest).then(g=>{c.bf.frame(g),this._frameRequest=null,this._render(g)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return pp}getCameraTargetElevation(){return this.transform.elevation}},_.MapMouseEvent=tr,_.MapTouchEvent=zo,_.MapWheelEvent=iu,_.Marker=Rl,_.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const e=this._map.getZoom(),a=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,a)=>{const u=this._map._getUIString(`NavigationControl.${a}`);e.title=u,e.setAttribute("aria-label",u)},this.options=c.e({},mp,g),this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),C.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),C.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=C.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ra(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){C.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,e){const a=C.create("button",g,this._container);return a.type="button",a.addEventListener("click",e),a}},_.Popup=class extends c.E{constructor(g){super(),this.remove=()=>(this._content&&C.remove(this._content),this._container&&(C.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var a;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=C.create("div","maplibregl-popup",this._map.getContainer()),this._tip=C.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const S of this.options.className.split(" "))this._container.classList.add(S);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Fo(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._trackPointer&&!e)return;const u=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let d=this.options.anchor;const m=Nl(this.options.offset);if(!d){const S=this._container.offsetWidth,k=this._container.offsetHeight;let E;E=u.y+m.bottom.y<k?["top"]:u.y>this._map.transform.height-k?["bottom"]:[],u.x<S/2?E.push("left"):u.x>this._map.transform.width-S/2&&E.push("right"),d=E.length===0?"bottom":E.join("-")}let w=u.add(m[d]);this.options.subpixelPositioning||(w=w.round()),C.setTransform(this._container,`${No[d]} translate(${w.x}px,${w.y}px)`),mu(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Fl),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=c.N.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const e=document.createDocumentFragment(),a=document.createElement("body");let u;for(a.innerHTML=g;u=a.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=C.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=C.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(gu);g&&g.focus()}},_.RasterDEMTileSource=Ei,_.RasterTileSource=Kt,_.ScaleControl=class{constructor(g){this._onMove=()=>{St(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,St(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Bl),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){C.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},_.ScrollZoomHandler=ia,_.Style=fl,_.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=C.create("button","maplibregl-ctrl-terrain",this._container),C.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){C.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},_.TwoFingersTouchPitchHandler=cu,_.TwoFingersTouchRotateHandler=lu,_.TwoFingersTouchZoomHandler=au,_.TwoFingersTouchZoomRotateHandler=Oa,_.VectorTileSource=Ii,_.VideoSource=Is,_.addSourceType=(g,e)=>c._(void 0,void 0,void 0,function*(){if(Tt(g))throw new Error(`A source type called "${g}" already exists.`);((a,u)=>{xt[a]=u})(g,e)}),_.clearPrewarmedResources=function(){const g=ai;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(_t),ai=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},_.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},_.getRTLTextPluginStatus=function(){return Qt().getRTLTextPluginStatus()},_.getVersion=function(){return gr},_.getWorkerCount=function(){return Xt.workerCount},_.getWorkerUrl=function(){return c.a.WORKER_URL},_.importScriptInWorkers=function(g){return Yt().broadcast("IS",g)},_.prewarm=function(){qt().acquire(_t)},_.setMaxParallelImageRequests=function(g){c.a.MAX_PARALLEL_IMAGE_REQUESTS=g},_.setRTLTextPlugin=function(g,e){return Qt().setRTLTextPlugin(g,e)},_.setWorkerCount=function(g){Xt.workerCount=g},_.setWorkerUrl=function(g){c.a.WORKER_URL=g}});var b=o;return b})})(b1);var ZT=b1.exports;const Gd=qT(ZT),GT=8,HT="Basic",XT={"mapbox:autocomposite":!1,"mapbox:type":"template","maputnik:renderer":"mbgljs","openmaptiles:version":"3.x","openmaptiles:mapbox:owner":"openmaptiles","openmaptiles:mapbox:source:url":"mapbox://openmaptiles.4qljc88t"},YT={openmaptiles:{type:"vector",url:"pmtiles://basemap.pmtiles"}},KT="https://openmaptiles.github.io/maptiler-basic-gl-style/sprite",JT="https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=JICzlXTKRtx2xghzNelR",QT=[{id:"background",type:"background",paint:{"background-color":"rgba(255, 255, 255, 1)"}},{id:"landcover_grass",type:"fill",source:"openmaptiles","source-layer":"landcover",filter:["==","class","grass"],paint:{"fill-color":"rgba(160, 191, 128, 1)","fill-opacity":.45}},{id:"boundary",type:"line",source:"openmaptiles","source-layer":"boundary",paint:{"line-color":"rgba(0, 0, 0, 1)","line-opacity":.45,"line-width":4}},{id:"water",type:"fill",source:"openmaptiles","source-layer":"water",filter:["all",["==","$type","Polygon"],["!=","intermittent",1],["!=","brunnel","tunnel"]],layout:{visibility:"visible"},paint:{"fill-color":"#8EB5BA"}},{id:"water-outline",type:"line",source:"openmaptiles","source-layer":"water",paint:{"line-color":"rgba(95, 144, 150, 1)","line-width":{base:.2,stops:[[10,.5],[13,.5]]}}},{id:"waterway",type:"line",source:"openmaptiles","source-layer":"waterway",filter:["all",["==","$type","LineString"],["!in","brunnel","tunnel","bridge"],["!=","intermittent",1]],layout:{visibility:"visible"},paint:{"line-color":"#8EB5BA","line-opacity":1,"line-width":{base:1.4,stops:[[8,1],[20,8]]}}},{id:"road_minor",type:"line",source:"openmaptiles","source-layer":"transportation",minzoom:13,filter:["all",["==","$type","LineString"],["in","class","minor","service","secondary","tertiary"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"rgba(220, 217, 217, 1)","line-width":{base:1.55,stops:[[4,.25],[13,.5],[20,15]]}}},{id:"aeroway-area",type:"fill",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:4,filter:["all",["==","$type","Polygon"],["in","class","runway","taxiway"]],layout:{visibility:"visible"},paint:{"fill-color":"rgba(255, 255, 255, 1)","fill-opacity":{base:1,stops:[[13,0],[14,1]]}}},{id:"aeroway-taxiway",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:12,filter:["all",["in","class","taxiway"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"rgba(255, 255, 255, 1)","line-opacity":1,"line-width":{base:1.5,stops:[[12,1],[17,10]]}}},{id:"aeroway-runway",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:4,filter:["all",["in","class","runway"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"rgba(255, 255, 255, 1)","line-opacity":1,"line-width":{base:1.5,stops:[[11,4],[17,50]]}}},{id:"road_trunk_primary",type:"line",source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","LineString"],["in","class","trunk","primary"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgba(220, 217, 217, 1)","line-width":{base:1.4,stops:[[6,.5],[20,30]]}}},{id:"road_secondary_tertiary",type:"line",source:"openmaptiles","source-layer":"transportation",minzoom:12,filter:["all",["==","$type","LineString"],["in","class","secondary"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgba(220, 217, 217, 1)","line-width":{base:1.4,stops:[[6,.5],[20,12]]}}},{id:"road_major_motorway",type:"line",source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgba(220, 217, 217, 1)","line-offset":0,"line-width":{base:1.4,stops:[[8,1],[16,10]]}}},{id:"railway-transit",type:"line",source:"openmaptiles","source-layer":"transportation",filter:["all",["==","class","transit"],["!=","brunnel","tunnel"]],layout:{visibility:"visible"},paint:{"line-color":"hsl(34, 12%, 66%)","line-opacity":{base:1,stops:[[11,0],[16,1]]}}},{id:"railway",type:"line",source:"openmaptiles","source-layer":"transportation",filter:["==","class","rail"],layout:{visibility:"visible"},paint:{"line-color":"hsl(34, 12%, 66%)","line-opacity":{base:1,stops:[[11,0],[16,1]]}}},{id:"place-other",type:"symbol",metadata:{"mapbox:group":"1444849242106.713"},source:"openmaptiles","source-layer":"place",minzoom:12,filter:["all",["!in","class","city","town","village","state","country","continent"]],layout:{"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Noto Sans Bold"],"text-letter-spacing":.1,"text-max-width":9,"text-allow-overlap":!1,"symbol-placement":"point","symbol-spacing":{stops:[[12,500],[13.5,500],[14,250],[15,150]]},"text-padding":{stops:[[12,50],[13.5,50],[14,25],[15,15]]},"text-size":{base:1.2,stops:[[12,10],[15,14]]},"symbol-sort-key":["get","name:latin"],"text-transform":"uppercase",visibility:"visible","symbol-z-order":"viewport-y"},paint:{"text-color":"rgba(47, 44, 44, 1)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":1.2}},{id:"place-city",type:"symbol",source:"openmaptiles","source-layer":"place",filter:["all",["==","class","city"]],layout:{"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Noto Sans Bold"],"text-size":{base:1.2,stops:[[7,14],[11,20]]},"text-max-width":10,"symbol-placement":"point","text-padding":2,visibility:"visible","symbol-sort-key":["get","rank"],"text-transform":"uppercase"},paint:{"text-color":"rgba(47, 44, 44, 1)","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":1.5}},{id:"waterway_label",type:"symbol",source:"openmaptiles","source-layer":"waterway",minzoom:13,filter:["all",["==","$type","LineString"],["has","name:latin"]],layout:{"text-field":"{name:latin}","text-font":["Noto Sans Bold Italic"],"text-size":14,"text-max-width":5,"symbol-placement":"line","text-pitch-alignment":"viewport","text-rotation-alignment":"map","symbol-spacing":500,visibility:"visible"},paint:{"text-color":"#497578","text-halo-color":"rgba(255,255,255,0.9)","text-halo-width":1.5}},{id:"water_name",type:"symbol",source:"openmaptiles","source-layer":"water_name",filter:["all",["==","$type","Point"],["==","class","lake"]],layout:{"text-field":"{name:latin}","text-font":["Noto Sans Italic"],"text-size":14,"text-max-width":8,"symbol-placement":"point","text-padding":2,visibility:"visible"},paint:{"text-color":"#497578","text-halo-color":"rgba(255,255,255,0.9)","text-halo-width":1.5}}],eS="basic",tS={version:GT,name:HT,metadata:XT,sources:YT,sprite:KT,glyphs:JT,layers:QT,id:eS};var uc=Math.pow,cr=(i,n,o)=>new Promise((h,p)=>{var b=A=>{try{c(o.next(A))}catch(O){p(O)}},_=A=>{try{c(o.throw(A))}catch(O){p(O)}},c=A=>A.done?h(A.value):Promise.resolve(A.value).then(b,_);c((o=o.apply(i,n)).next())}),ss=Uint8Array,Ku=Uint16Array,iS=Int32Array,w1=new ss([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),T1=new ss([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),nS=new ss([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),S1=function(i,n){for(var o=new Ku(31),h=0;h<31;++h)o[h]=n+=1<<i[h-1];for(var p=new iS(o[30]),h=1;h<30;++h)for(var b=o[h];b<o[h+1];++b)p[b]=b-o[h]<<5|h;return{b:o,r:p}},k1=S1(w1,2),M1=k1.b,rS=k1.r;M1[28]=258,rS[258]=28;var sS=S1(T1,0),aS=sS.b,A1=new Ku(32768);for(Vi=0;Vi<32768;++Vi)da=(Vi&43690)>>1|(Vi&21845)<<1,da=(da&52428)>>2|(da&13107)<<2,da=(da&61680)>>4|(da&3855)<<4,A1[Vi]=((da&65280)>>8|(da&255)<<8)>>1;var da,Vi,Ju=function(i,n,o){for(var h=i.length,p=0,b=new Ku(n);p<h;++p)i[p]&&++b[i[p]-1];var _=new Ku(n);for(p=1;p<n;++p)_[p]=_[p-1]+b[p-1]<<1;var c;{c=new Ku(1<<n);var A=15-n;for(p=0;p<h;++p)if(i[p])for(var O=p<<4|i[p],B=n-i[p],R=_[i[p]-1]++<<B,C=R|(1<<B)-1;R<=C;++R)c[A1[R]>>A]=O}return c},mh=new ss(288);for(Vi=0;Vi<144;++Vi)mh[Vi]=8;var Vi;for(Vi=144;Vi<256;++Vi)mh[Vi]=9;var Vi;for(Vi=256;Vi<280;++Vi)mh[Vi]=7;var Vi;for(Vi=280;Vi<288;++Vi)mh[Vi]=8;var Vi,I1=new ss(32);for(Vi=0;Vi<32;++Vi)I1[Vi]=5;var Vi,oS=Ju(mh,9),lS=Ju(I1,5),um=function(i){for(var n=i[0],o=1;o<i.length;++o)i[o]>n&&(n=i[o]);return n},ws=function(i,n,o){var h=n/8|0;return(i[h]|i[h+1]<<8)>>(n&7)&o},hm=function(i,n){var o=n/8|0;return(i[o]|i[o+1]<<8|i[o+2]<<16)>>(n&7)},cS=function(i){return(i+7)/8|0},uS=function(i,n,o){(o==null||o>i.length)&&(o=i.length);var h=new ss(o-n);return h.set(i.subarray(n,o)),h},hS=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],rs=function(i,n,o){var h=new Error(n||hS[i]);if(h.code=i,Error.captureStackTrace&&Error.captureStackTrace(h,rs),!o)throw h;return h},qg=function(i,n,o,h){var p=i.length,b=0;if(!p||n.f&&!n.l)return o||new ss(0);var _=!o||n.i!=2,c=n.i;o||(o=new ss(p*3));var A=function(bi){var Yt=o.length;if(bi>Yt){var Oi=new ss(Math.max(Yt*2,bi));Oi.set(o),o=Oi}},O=n.f||0,B=n.p||0,R=n.b||0,C=n.l,Y=n.d,X=n.m,H=n.n,ae=p*8;do{if(!C){O=ws(i,B,1);var Z=ws(i,B+1,3);if(B+=3,Z)if(Z==1)C=oS,Y=lS,X=9,H=5;else if(Z==2){var ve=ws(i,B,31)+257,Se=ws(i,B+10,15)+4,de=ve+ws(i,B+5,31)+1;B+=14;for(var Fe=new ss(de),Re=new ss(19),Le=0;Le<Se;++Le)Re[nS[Le]]=ws(i,B+Le*3,7);B+=Se*3;for(var Te=um(Re),we=(1<<Te)-1,fe=Ju(Re,Te),Le=0;Le<de;){var Ae=fe[ws(i,B,we)];B+=Ae&15;var te=Ae>>4;if(te<16)Fe[Le++]=te;else{var Ce=0,Ve=0;for(te==16?(Ve=3+ws(i,B,3),B+=2,Ce=Fe[Le-1]):te==17?(Ve=3+ws(i,B,7),B+=3):te==18&&(Ve=11+ws(i,B,127),B+=7);Ve--;)Fe[Le++]=Ce}}var Ue=Fe.subarray(0,ve),Ge=Fe.subarray(ve);X=um(Ue),H=um(Ge),C=Ju(Ue,X),Y=Ju(Ge,H)}else rs(1);else{var te=cS(B)+4,ne=i[te-4]|i[te-3]<<8,_e=te+ne;if(_e>p){c&&rs(0);break}_&&A(R+ne),o.set(i.subarray(te,_e),R),n.b=R+=ne,n.p=B=_e*8,n.f=O;continue}if(B>ae){c&&rs(0);break}}_&&A(R+131072);for(var Oe=(1<<X)-1,Xe=(1<<H)-1,We=B;;We=B){var Ce=C[hm(i,B)&Oe],Et=Ce>>4;if(B+=Ce&15,B>ae){c&&rs(0);break}if(Ce||rs(2),Et<256)o[R++]=Et;else if(Et==256){We=B,C=null;break}else{var Nt=Et-254;if(Et>264){var Le=Et-257,_t=w1[Le];Nt=ws(i,B,(1<<_t)-1)+M1[Le],B+=_t}var Xt=Y[hm(i,B)&Xe],$t=Xt>>4;Xt||rs(3),B+=Xt&15;var Ge=aS[$t];if($t>3){var _t=T1[$t];Ge+=hm(i,B)&(1<<_t)-1,B+=_t}if(B>ae){c&&rs(0);break}_&&A(R+131072);var ai=R+Nt;if(R<Ge){var fi=b-Ge,qt=Math.min(Ge,ai);for(fi+R<0&&rs(3);R<qt;++R)o[R]=h[fi+R]}for(;R<ai;R+=4)o[R]=o[R-Ge],o[R+1]=o[R+1-Ge],o[R+2]=o[R+2-Ge],o[R+3]=o[R+3-Ge];R=ai}}n.l=C,n.p=We,n.b=R,n.f=O,C&&(O=1,n.m=X,n.d=Y,n.n=H)}while(!O);return R==o.length?o:uS(o,0,R)},dS=new ss(0),fS=function(i){(i[0]!=31||i[1]!=139||i[2]!=8)&&rs(6,"invalid gzip data");var n=i[3],o=10;n&4&&(o+=(i[10]|i[11]<<8)+2);for(var h=(n>>3&1)+(n>>4&1);h>0;h-=!i[o++]);return o+(n&2)},pS=function(i){var n=i.length;return(i[n-4]|i[n-3]<<8|i[n-2]<<16|i[n-1]<<24)>>>0},mS=function(i,n){return((i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31)&&rs(6,"invalid zlib data"),(i[1]>>5&1)==+!n&&rs(6,"invalid zlib data: "+(i[1]&32?"need":"unexpected")+" dictionary"),(i[1]>>3&4)+2};function gS(i,n){return qg(i,{i:2},n,n)}function yS(i,n){var o=fS(i);return o+8>i.length&&rs(6,"invalid gzip data"),qg(i.subarray(o,-8),{i:2},new ss(pS(i)),n)}function _S(i,n){return qg(i.subarray(mS(i,n),-4),{i:2},n,n)}function cg(i,n){return i[0]==31&&i[1]==139&&i[2]==8?yS(i,n):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?gS(i,n):_S(i,n)}var vS=typeof TextDecoder<"u"&&new TextDecoder,bS=0;try{vS.decode(dS,{stream:!0}),bS=1}catch{}var E1=(i,n)=>i*uc(2,n),Nu=(i,n)=>Math.floor(i/uc(2,n)),Hd=(i,n)=>E1(i.getUint16(n+1,!0),8)+i.getUint8(n),C1=(i,n)=>E1(i.getUint32(n+2,!0),16)+i.getUint16(n,!0),xS=(i,n,o,h,p)=>{if(i!==h.getUint8(p))return i-h.getUint8(p);const b=Hd(h,p+1);if(n!==b)return n-b;const _=Hd(h,p+4);return o!==_?o-_:0},wS=(i,n,o,h)=>{const p=P1(i,n|128,o,h);return p?{z:n,x:o,y:h,offset:p[0],length:p[1],isDir:!0}:null},m_=(i,n,o,h)=>{const p=P1(i,n,o,h);return p?{z:n,x:o,y:h,offset:p[0],length:p[1],isDir:!1}:null},P1=(i,n,o,h)=>{let p=0,b=i.byteLength/17-1;for(;p<=b;){const _=b+p>>1,c=xS(n,o,h,i,_*17);if(c>0)p=_+1;else if(c<0)b=_-1;else return[C1(i,_*17+7),i.getUint32(_*17+13,!0)]}return null},TS=(i,n)=>i.isDir&&!n.isDir?1:!i.isDir&&n.isDir?-1:i.z!==n.z?i.z-n.z:i.x!==n.x?i.x-n.x:i.y-n.y,z1=(i,n)=>{const o=i.getUint8(n*17);return{z:o&127,x:Hd(i,n*17+1),y:Hd(i,n*17+4),offset:C1(i,n*17+7),length:i.getUint32(n*17+13,!0),isDir:o>>7===1}},g_=i=>{const n=[],o=new DataView(i);for(let h=0;h<o.byteLength/17;h++)n.push(z1(o,h));return SS(n)},SS=i=>{i.sort(TS);const n=new ArrayBuffer(17*i.length),o=new Uint8Array(n);for(let h=0;h<i.length;h++){const p=i[h];let b=p.z;p.isDir&&(b=b|128),o[h*17]=b,o[h*17+1]=p.x&255,o[h*17+2]=p.x>>8&255,o[h*17+3]=p.x>>16&255,o[h*17+4]=p.y&255,o[h*17+5]=p.y>>8&255,o[h*17+6]=p.y>>16&255,o[h*17+7]=p.offset&255,o[h*17+8]=Nu(p.offset,8)&255,o[h*17+9]=Nu(p.offset,16)&255,o[h*17+10]=Nu(p.offset,24)&255,o[h*17+11]=Nu(p.offset,32)&255,o[h*17+12]=Nu(p.offset,48)&255,o[h*17+13]=p.length&255,o[h*17+14]=p.length>>8&255,o[h*17+15]=p.length>>16&255,o[h*17+16]=p.length>>24&255}return n},kS=(i,n)=>{if(i.byteLength<17)return null;const o=i.byteLength/17,h=z1(i,o-1);if(h.isDir){const p=h.z,b=n.z-p,_=Math.trunc(n.x/(1<<b)),c=Math.trunc(n.y/(1<<b));return{z:p,x:_,y:c}}return null};function MS(i){return cr(this,null,function*(){const n=yield i.getBytes(0,512e3),o=new DataView(n.data),h=o.getUint32(4,!0),p=o.getUint16(8,!0),b=new TextDecoder("utf-8"),_=JSON.parse(b.decode(new DataView(n.data,10,h)));let c=0;_.compression==="gzip"&&(c=2);let A=0;"minzoom"in _&&(A=+_.minzoom);let O=0;"maxzoom"in _&&(O=+_.maxzoom);let B=0,R=0,C=0,Y=-180,X=-85,H=180,ae=85;if(_.bounds){const te=_.bounds.split(",");Y=+te[0],X=+te[1],H=+te[2],ae=+te[3]}if(_.center){const te=_.center.split(",");B=+te[0],R=+te[1],C=+te[2]}return{specVersion:o.getUint16(2,!0),rootDirectoryOffset:10+h,rootDirectoryLength:p*17,jsonMetadataOffset:10,jsonMetadataLength:h,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:c,tileType:1,minZoom:A,maxZoom:O,minLon:Y,minLat:X,maxLon:H,maxLat:ae,centerZoom:C,centerLon:B,centerLat:R,etag:n.etag}})}function AS(i,n,o,h,p,b,_){return cr(this,null,function*(){let c=yield o.getArrayBuffer(n,i.rootDirectoryOffset,i.rootDirectoryLength,i);i.specVersion===1&&(c=g_(c));const A=m_(new DataView(c),h,p,b);if(A){let R=(yield n.getBytes(A.offset,A.length,_)).data;const C=new DataView(R);return C.getUint8(0)===31&&C.getUint8(1)===139&&(R=cg(new Uint8Array(R))),{data:R}}const O=kS(new DataView(c),{z:h,x:p,y:b});if(O){const B=wS(new DataView(c),O.z,O.x,O.y);if(B){let R=yield o.getArrayBuffer(n,B.offset,B.length,i);i.specVersion===1&&(R=g_(R));const C=m_(new DataView(R),h,p,b);if(C){let X=(yield n.getBytes(C.offset,C.length,_)).data;const H=new DataView(X);return H.getUint8(0)===31&&H.getUint8(1)===139&&(X=cg(new Uint8Array(X))),{data:X}}}}})}var D1={getHeader:MS,getZxy:AS},IS=i=>(n,o)=>{if(o instanceof AbortController)return i(n,o);const h=new AbortController;return i(n,h).then(p=>o(void 0,p.data,p.cacheControl||"",p.expires||""),p=>o(p)).catch(p=>o(p)),{cancel:()=>h.abort()}},ES=class{constructor(i){this.tilev4=(n,o)=>cr(this,null,function*(){if(n.type==="json"){const C=n.url.substr(10);let Y=this.tiles.get(C);if(Y||(Y=new hg(C),this.tiles.set(C,Y)),this.metadata)return{data:yield Y.getTileJson(n.url)};const X=yield Y.getHeader();return{data:{tiles:[`${n.url}/{z}/{x}/{y}`],minzoom:X.minZoom,maxzoom:X.maxZoom,bounds:[X.minLon,X.minLat,X.maxLon,X.maxLat]}}}const h=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),p=n.url.match(h);if(!p)throw new Error("Invalid PMTiles protocol URL");const b=p[1];let _=this.tiles.get(b);_||(_=new hg(b),this.tiles.set(b,_));const c=p[2],A=p[3],O=p[4],B=yield _.getHeader(),R=yield _==null?void 0:_.getZxy(+c,+A,+O,o.signal);return R?{data:new Uint8Array(R.data),cacheControl:R.cacheControl,expires:R.expires}:B.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=IS(this.tilev4),this.tiles=new Map,this.metadata=(i==null?void 0:i.metadata)||!1}add(i){this.tiles.set(i.source.getKey(),i)}get(i){return this.tiles.get(i)}};function ic(i,n){return(n>>>0)*4294967296+(i>>>0)}function CS(i,n){const o=n.buf;let h=o[n.pos++],p=(h&112)>>4;if(h<128||(h=o[n.pos++],p|=(h&127)<<3,h<128)||(h=o[n.pos++],p|=(h&127)<<10,h<128)||(h=o[n.pos++],p|=(h&127)<<17,h<128)||(h=o[n.pos++],p|=(h&127)<<24,h<128)||(h=o[n.pos++],p|=(h&1)<<31,h<128))return ic(i,p);throw new Error("Expected varint not more than 10 bytes")}function $u(i){const n=i.buf;let o=n[i.pos++],h=o&127;return o<128||(o=n[i.pos++],h|=(o&127)<<7,o<128)||(o=n[i.pos++],h|=(o&127)<<14,o<128)||(o=n[i.pos++],h|=(o&127)<<21,o<128)?h:(o=n[i.pos],h|=(o&15)<<28,CS(h,i))}function PS(i,n,o,h){if(h===0){o===1&&(n[0]=i-1-n[0],n[1]=i-1-n[1]);const p=n[0];n[0]=n[1],n[1]=p}}var zS=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function DS(i,n,o){if(i>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(n>uc(2,i)-1||o>uc(2,i)-1)throw Error("tile x/y outside zoom level bounds");const h=zS[i],p=uc(2,i);let b=0,_=0,c=0;const A=[n,o];let O=p/2;for(;O>0;)b=(A[0]&O)>0?1:0,_=(A[1]&O)>0?1:0,c+=O*O*(3*b^_),PS(O,A,b,_),O=O/2;return h+c}function L1(i,n){return cr(this,null,function*(){if(n===1||n===0)return i;if(n===2){if(typeof globalThis.DecompressionStream>"u")return cg(new Uint8Array(i));const o=new Response(i).body;if(!o)throw Error("Failed to read response stream");const h=o.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(h).arrayBuffer()}throw Error("Compression method not supported")})}function LS(i){return i===1?".mvt":i===2?".png":i===3?".jpg":i===4?".webp":i===5?".avif":""}var RS=127;function OS(i,n){let o=0,h=i.length-1;for(;o<=h;){const p=h+o>>1,b=n-i[p].tileId;if(b>0)o=p+1;else if(b<0)h=p-1;else return i[p]}return h>=0&&(i[h].runLength===0||n-i[h].tileId<i[h].runLength)?i[h]:null}var BS=class{constructor(i,n=new Headers){this.url=i,this.customHeaders=n,this.mustReload=!1;let o="";"navigator"in globalThis&&(o=globalThis.navigator.userAgent||"");const h=o.indexOf("Windows")>-1,p=/Chrome|Chromium|Edg|OPR|Brave/.test(o);this.chromeWindowsNoCache=!1,h&&p&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(i){this.customHeaders=i}getBytes(i,n,o,h){return cr(this,null,function*(){let p,b;o?b=o:(p=new AbortController,b=p.signal);const _=new Headers(this.customHeaders);_.set("range",`bytes=${i}-${i+n-1}`);let c;this.mustReload?c="reload":this.chromeWindowsNoCache&&(c="no-store");let A=yield fetch(this.url,{signal:b,cache:c,headers:_});if(i===0&&A.status===416){const C=A.headers.get("Content-Range");if(!C||!C.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const Y=+C.substr(8);A=yield fetch(this.url,{signal:b,cache:"reload",headers:{range:`bytes=0-${Y-1}`}})}let O=A.headers.get("Etag");if(O!=null&&O.startsWith("W/")&&(O=null),A.status===416||h&&O&&O!==h)throw this.mustReload=!0,new ug(`Server returned non-matching ETag ${h} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(A.status>=300)throw Error(`Bad response code: ${A.status}`);const B=A.headers.get("Content-Length");if(A.status===200&&(!B||+B>n))throw p&&p.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield A.arrayBuffer(),etag:O||void 0,cacheControl:A.headers.get("Cache-Control")||void 0,expires:A.headers.get("Expires")||void 0}})}};function Ts(i,n){const o=i.getUint32(n+4,!0),h=i.getUint32(n+0,!0);return o*uc(2,32)+h}function FS(i,n){const o=new DataView(i),h=o.getUint8(7);if(h>3)throw Error(`Archive is spec version ${h} but this library supports up to spec version 3`);return{specVersion:h,rootDirectoryOffset:Ts(o,8),rootDirectoryLength:Ts(o,16),jsonMetadataOffset:Ts(o,24),jsonMetadataLength:Ts(o,32),leafDirectoryOffset:Ts(o,40),leafDirectoryLength:Ts(o,48),tileDataOffset:Ts(o,56),tileDataLength:Ts(o,64),numAddressedTiles:Ts(o,72),numTileEntries:Ts(o,80),numTileContents:Ts(o,88),clustered:o.getUint8(96)===1,internalCompression:o.getUint8(97),tileCompression:o.getUint8(98),tileType:o.getUint8(99),minZoom:o.getUint8(100),maxZoom:o.getUint8(101),minLon:o.getInt32(102,!0)/1e7,minLat:o.getInt32(106,!0)/1e7,maxLon:o.getInt32(110,!0)/1e7,maxLat:o.getInt32(114,!0)/1e7,centerZoom:o.getUint8(118),centerLon:o.getInt32(119,!0)/1e7,centerLat:o.getInt32(123,!0)/1e7,etag:n}}function R1(i){const n={buf:new Uint8Array(i),pos:0},o=$u(n),h=[];let p=0;for(let b=0;b<o;b++){const _=$u(n);h.push({tileId:p+_,offset:0,length:0,runLength:1}),p+=_}for(let b=0;b<o;b++)h[b].runLength=$u(n);for(let b=0;b<o;b++)h[b].length=$u(n);for(let b=0;b<o;b++){const _=$u(n);_===0&&b>0?h[b].offset=h[b-1].offset+h[b-1].length:h[b].offset=_-1}return h}function NS(i){const n=new DataView(i);return n.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):n.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var ug=class extends Error{};function $S(i,n){return cr(this,null,function*(){const o=yield i.getBytes(0,16384);if(new DataView(o.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(NS(o.data)<3)return[yield D1.getHeader(i)];const p=o.data.slice(0,RS),b=FS(p,o.etag),_=o.data.slice(b.rootDirectoryOffset,b.rootDirectoryOffset+b.rootDirectoryLength),c=`${i.getKey()}|${b.etag||""}|${b.rootDirectoryOffset}|${b.rootDirectoryLength}`,A=R1(yield n(_,b.internalCompression));return[b,[c,A.length,A]]})}function jS(i,n,o,h,p){return cr(this,null,function*(){const b=yield i.getBytes(o,h,void 0,p.etag),_=yield n(b.data,p.internalCompression),c=R1(_);if(c.length===0)throw new Error("Empty directory is invalid");return c})}var VS=class{constructor(i=100,n=!0,o=L1){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=i,this.counter=1,this.decompress=o}getHeader(i){return cr(this,null,function*(){const n=i.getKey(),o=this.cache.get(n);if(o)return o.lastUsed=this.counter++,yield o.data;const h=new Promise((p,b)=>{$S(i,this.decompress).then(_=>{_[1]&&this.cache.set(_[1][0],{lastUsed:this.counter++,data:Promise.resolve(_[1][2])}),p(_[0]),this.prune()}).catch(_=>{b(_)})});return this.cache.set(n,{lastUsed:this.counter++,data:h}),h})}getDirectory(i,n,o,h){return cr(this,null,function*(){const p=`${i.getKey()}|${h.etag||""}|${n}|${o}`,b=this.cache.get(p);if(b)return b.lastUsed=this.counter++,yield b.data;const _=new Promise((c,A)=>{jS(i,this.decompress,n,o,h).then(O=>{c(O),this.prune()}).catch(O=>{A(O)})});return this.cache.set(p,{lastUsed:this.counter++,data:_}),_})}getArrayBuffer(i,n,o,h){return cr(this,null,function*(){const p=`${i.getKey()}|${h.etag||""}|${n}|${o}`,b=this.cache.get(p);if(b)return b.lastUsed=this.counter++,yield b.data;const _=new Promise((c,A)=>{i.getBytes(n,o,void 0,h.etag).then(O=>{c(O.data),this.cache.has(p),this.prune()}).catch(O=>{A(O)})});return this.cache.set(p,{lastUsed:this.counter++,data:_}),_})}prune(){if(this.cache.size>=this.maxCacheEntries){let i=1/0,n;this.cache.forEach((o,h)=>{o.lastUsed<i&&(i=o.lastUsed,n=h)}),n&&this.cache.delete(n)}}invalidate(i){return cr(this,null,function*(){const n=i.getKey();if(this.invalidations.get(n))return yield this.invalidations.get(n);this.cache.delete(i.getKey());const o=new Promise((h,p)=>{this.getHeader(i).then(b=>{h(),this.invalidations.delete(n)}).catch(b=>{p(b)})});this.invalidations.set(n,o)})}},hg=class{constructor(i,n,o){typeof i=="string"?this.source=new BS(i):this.source=i,o?this.decompress=o:this.decompress=L1,n?this.cache=n:this.cache=new VS}getHeader(){return cr(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(i,n,o,h){return cr(this,null,function*(){const p=DS(i,n,o),b=yield this.cache.getHeader(this.source);if(b.specVersion<3)return D1.getZxy(b,this.source,this.cache,i,n,o,h);if(i<b.minZoom||i>b.maxZoom)return;let _=b.rootDirectoryOffset,c=b.rootDirectoryLength;for(let A=0;A<=3;A++){const O=yield this.cache.getDirectory(this.source,_,c,b),B=OS(O,p);if(B){if(B.runLength>0){const R=yield this.source.getBytes(b.tileDataOffset+B.offset,B.length,h,b.etag);return{data:yield this.decompress(R.data,b.tileCompression),cacheControl:R.cacheControl,expires:R.expires}}_=b.leafDirectoryOffset+B.offset,c=B.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(i,n,o,h){return cr(this,null,function*(){try{return yield this.getZxyAttempt(i,n,o,h)}catch(p){if(p instanceof ug)return this.cache.invalidate(this.source),yield this.getZxyAttempt(i,n,o,h);throw p}})}getMetadataAttempt(){return cr(this,null,function*(){const i=yield this.cache.getHeader(this.source),n=yield this.source.getBytes(i.jsonMetadataOffset,i.jsonMetadataLength,void 0,i.etag),o=yield this.decompress(n.data,i.internalCompression),h=new TextDecoder("utf-8");return JSON.parse(h.decode(o))})}getMetadata(){return cr(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(i){if(i instanceof ug)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw i}})}getTileJson(i){return cr(this,null,function*(){const n=yield this.getHeader(),o=yield this.getMetadata(),h=LS(n.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${i}/{z}/{x}/{y}${h}`],vector_layers:o.vector_layers,attribution:o.attribution,description:o.description,name:o.name,version:o.version,bounds:[n.minLon,n.minLat,n.maxLon,n.maxLat],center:[n.centerLon,n.centerLat,n.centerZoom],minzoom:n.minZoom,maxzoom:n.maxZoom}})}};class US{constructor(n){lr(this,"canvas");lr(this,"width",200);lr(this,"height",24);lr(this,"data");lr(this,"context",null);lr(this,"map");lr(this,"currentText","$19");lr(this,"SHADOW_BLUR",6);lr(this,"SHADOW_OFFSET",3);lr(this,"PADDING",16);lr(this,"LINE_HEIGHT",16);this.map=n,this.canvas=document.createElement("canvas");const o=window.devicePixelRatio||1;this.canvas.width=this.width*o,this.canvas.height=this.height*o,this.canvas.style.width=`${this.width}px`,this.canvas.style.height=`${this.height}px`,this.data=new Uint8Array(this.width*this.height*4)}drawPill(){if(!this.context)return;this.context.clearRect(-this.SHADOW_BLUR,-this.SHADOW_BLUR,this.width+this.SHADOW_BLUR*2,this.height+this.SHADOW_BLUR*2+this.SHADOW_OFFSET),this.context.shadowColor="rgba(0, 0, 0, 0.35)",this.context.shadowBlur=this.SHADOW_BLUR,this.context.shadowOffsetY=this.SHADOW_OFFSET;const n=this.height/2;this.context.beginPath(),this.context.moveTo(n,0),this.context.lineTo(this.width-n,0),this.context.arcTo(this.width,0,this.width,n,n),this.context.arcTo(this.width,this.height,this.width-n,this.height,n),this.context.lineTo(n,this.height),this.context.arcTo(0,this.height,0,n,n),this.context.arcTo(0,0,n,0,n),this.context.closePath(),this.context.fillStyle="#417d77",this.context.fill(),this.context.shadowColor="transparent",this.context.strokeStyle="#313E40",this.context.lineWidth=1,this.context.stroke()}render(n="$19"){if(!this.context)return!1;this.currentText=n;const o=window.devicePixelRatio||1;this.context.font="bold 14px Supreme-Regular";const h=n.split(" "),p=this.calculateLines(h);this.height=24+(p.length-1)*this.LINE_HEIGHT;const b=Math.max(...p.map(c=>this.context.measureText(c).width));this.width=Math.max(100,b+this.PADDING*2),this.canvas.width=(this.width+this.SHADOW_BLUR*2)*o,this.canvas.height=(this.height+this.SHADOW_BLUR*2+this.SHADOW_OFFSET)*o,this.canvas.style.width=`${this.width+this.SHADOW_BLUR*2}px`,this.canvas.style.height=`${this.height+this.SHADOW_BLUR*2+this.SHADOW_OFFSET}px`,this.context.scale(o,o),this.context.translate(this.SHADOW_BLUR,this.SHADOW_BLUR),this.drawPill(),this.context.fillStyle="#ffffff",this.context.font="bold 14.5px Supreme-Regular",this.context.textAlign="center",this.context.textBaseline="middle";const _=(this.height-p.length*this.LINE_HEIGHT)/2+this.LINE_HEIGHT/2;return p.forEach((c,A)=>{this.context.fillText(c,this.width/2,_+A*this.LINE_HEIGHT)}),this.context.setTransform(1,0,0,1,0,0),this.data=new Uint8Array(this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data),this.map.triggerRepaint(),!0}calculateLines(n){if(!this.context)return[];const o=this.width-this.PADDING*2;let h="";const p=[];for(let b of n){const _=h+(h?" ":"")+b;this.context.measureText(_).width>o&&h!==""?(p.push(h),h=b):h=_}return p.push(h),p}onAdd(){this.context=this.canvas.getContext("2d",{alpha:!0});const n=window.devicePixelRatio||1;return this.context&&this.context.scale(n,n),this.canvas}}const{min:WS,max:qS}=Math,tl=(i,n=0,o=1)=>WS(qS(n,i),o),Zg=i=>{i._clipped=!1,i._unclipped=i.slice(0);for(let n=0;n<=3;n++)n<3?((i[n]<0||i[n]>255)&&(i._clipped=!0),i[n]=tl(i[n],0,255)):n===3&&(i[n]=tl(i[n],0,1));return i},O1={};for(let i of["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"])O1[`[object ${i}]`]=i.toLowerCase();function pi(i){return O1[Object.prototype.toString.call(i)]||"object"}const si=(i,n=null)=>i.length>=3?Array.prototype.slice.call(i):pi(i[0])=="object"&&n?n.split("").filter(o=>i[0][o]!==void 0).map(o=>i[0][o]):i[0].slice(0),Tc=i=>{if(i.length<2)return null;const n=i.length-1;return pi(i[n])=="string"?i[n].toLowerCase():null},{PI:wf,min:B1,max:F1}=Math,ps=i=>Math.round(i*100)/100,dg=i=>Math.round(i*100)/100,ga=wf*2,dm=wf/3,ZS=wf/180,GS=180/wf;function N1(i){return[...i.slice(0,3).reverse(),...i.slice(3)]}const ri={format:{},autodetect:[]};class Ye{constructor(...n){const o=this;if(pi(n[0])==="object"&&n[0].constructor&&n[0].constructor===this.constructor)return n[0];let h=Tc(n),p=!1;if(!h){p=!0,ri.sorted||(ri.autodetect=ri.autodetect.sort((b,_)=>_.p-b.p),ri.sorted=!0);for(let b of ri.autodetect)if(h=b.test(...n),h)break}if(ri.format[h]){const b=ri.format[h].apply(null,p?n:n.slice(0,-1));o._rgb=Zg(b)}else throw new Error("unknown format: "+n);o._rgb.length===3&&o._rgb.push(1)}toString(){return pi(this.hex)=="function"?this.hex():`[${this._rgb.join(",")}]`}}const HS="3.1.2",Ti=(...i)=>new Ye(...i);Ti.version=HS;const bc={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},XS=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,YS=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,$1=i=>{if(i.match(XS)){(i.length===4||i.length===7)&&(i=i.substr(1)),i.length===3&&(i=i.split(""),i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]);const n=parseInt(i,16),o=n>>16,h=n>>8&255,p=n&255;return[o,h,p,1]}if(i.match(YS)){(i.length===5||i.length===9)&&(i=i.substr(1)),i.length===4&&(i=i.split(""),i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]+i[3]+i[3]);const n=parseInt(i,16),o=n>>24&255,h=n>>16&255,p=n>>8&255,b=Math.round((n&255)/255*100)/100;return[o,h,p,b]}throw new Error(`unknown hex color: ${i}`)},{round:Dd}=Math,j1=(...i)=>{let[n,o,h,p]=si(i,"rgba"),b=Tc(i)||"auto";p===void 0&&(p=1),b==="auto"&&(b=p<1?"rgba":"rgb"),n=Dd(n),o=Dd(o),h=Dd(h);let c="000000"+(n<<16|o<<8|h).toString(16);c=c.substr(c.length-6);let A="0"+Dd(p*255).toString(16);switch(A=A.substr(A.length-2),b.toLowerCase()){case"rgba":return`#${c}${A}`;case"argb":return`#${A}${c}`;default:return`#${c}`}};Ye.prototype.name=function(){const i=j1(this._rgb,"rgb");for(let n of Object.keys(bc))if(bc[n]===i)return n.toLowerCase();return i};ri.format.named=i=>{if(i=i.toLowerCase(),bc[i])return $1(bc[i]);throw new Error("unknown color name: "+i)};ri.autodetect.push({p:5,test:(i,...n)=>{if(!n.length&&pi(i)==="string"&&bc[i.toLowerCase()])return"named"}});Ye.prototype.alpha=function(i,n=!1){return i!==void 0&&pi(i)==="number"?n?(this._rgb[3]=i,this):new Ye([this._rgb[0],this._rgb[1],this._rgb[2],i],"rgb"):this._rgb[3]};Ye.prototype.clipped=function(){return this._rgb._clipped||!1};const js={Kn:18,labWhitePoint:"d65",Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452,kE:216/24389,kKE:8,kK:24389/27,RefWhiteRGB:{X:.95047,Y:1,Z:1.08883},MtxRGB2XYZ:{m00:.4124564390896922,m01:.21267285140562253,m02:.0193338955823293,m10:.357576077643909,m11:.715152155287818,m12:.11919202588130297,m20:.18043748326639894,m21:.07217499330655958,m22:.9503040785363679},MtxXYZ2RGB:{m00:3.2404541621141045,m01:-.9692660305051868,m02:.055643430959114726,m10:-1.5371385127977166,m11:1.8760108454466942,m12:-.2040259135167538,m20:-.498531409556016,m21:.041556017530349834,m22:1.0572251882231791},As:.9414285350000001,Bs:1.040417467,Cs:1.089532651,MtxAdaptMa:{m00:.8951,m01:-.7502,m02:.0389,m10:.2664,m11:1.7135,m12:-.0685,m20:-.1614,m21:.0367,m22:1.0296},MtxAdaptMaI:{m00:.9869929054667123,m01:.43230526972339456,m02:-.008528664575177328,m10:-.14705425642099013,m11:.5183602715367776,m12:.04004282165408487,m20:.15996265166373125,m21:.0492912282128556,m22:.9684866957875502}},KS=new Map([["a",[1.0985,.35585]],["b",[1.0985,.35585]],["c",[.98074,1.18232]],["d50",[.96422,.82521]],["d55",[.95682,.92149]],["d65",[.95047,1.08883]],["e",[1,1,1]],["f2",[.99186,.67393]],["f7",[.95041,1.08747]],["f11",[1.00962,.6435]],["icc",[.96422,.82521]]]);function _a(i){const n=KS.get(String(i).toLowerCase());if(!n)throw new Error("unknown Lab illuminant "+i);js.labWhitePoint=i,js.Xn=n[0],js.Zn=n[1]}function sh(){return js.labWhitePoint}const Gg=(...i)=>{i=si(i,"lab");const[n,o,h]=i,[p,b,_]=JS(n,o,h),[c,A,O]=V1(p,b,_);return[c,A,O,i.length>3?i[3]:1]},JS=(i,n,o)=>{const{kE:h,kK:p,kKE:b,Xn:_,Yn:c,Zn:A}=js,O=(i+16)/116,B=.002*n+O,R=O-.005*o,C=B*B*B,Y=R*R*R,X=C>h?C:(116*B-16)/p,H=i>b?Math.pow((i+16)/116,3):i/p,ae=Y>h?Y:(116*R-16)/p,Z=X*_,te=H*c,ne=ae*A;return[Z,te,ne]},fm=i=>{const n=Math.sign(i);return i=Math.abs(i),(i<=.0031308?i*12.92:1.055*Math.pow(i,1/2.4)-.055)*n},V1=(i,n,o)=>{const{MtxAdaptMa:h,MtxAdaptMaI:p,MtxXYZ2RGB:b,RefWhiteRGB:_,Xn:c,Yn:A,Zn:O}=js,B=c*h.m00+A*h.m10+O*h.m20,R=c*h.m01+A*h.m11+O*h.m21,C=c*h.m02+A*h.m12+O*h.m22,Y=_.X*h.m00+_.Y*h.m10+_.Z*h.m20,X=_.X*h.m01+_.Y*h.m11+_.Z*h.m21,H=_.X*h.m02+_.Y*h.m12+_.Z*h.m22,ae=(i*h.m00+n*h.m10+o*h.m20)*(Y/B),Z=(i*h.m01+n*h.m11+o*h.m21)*(X/R),te=(i*h.m02+n*h.m12+o*h.m22)*(H/C),ne=ae*p.m00+Z*p.m10+te*p.m20,_e=ae*p.m01+Z*p.m11+te*p.m21,ve=ae*p.m02+Z*p.m12+te*p.m22,Se=fm(ne*b.m00+_e*b.m10+ve*b.m20),de=fm(ne*b.m01+_e*b.m11+ve*b.m21),Fe=fm(ne*b.m02+_e*b.m12+ve*b.m22);return[Se*255,de*255,Fe*255]},Hg=(...i)=>{const[n,o,h,...p]=si(i,"rgb"),[b,_,c]=U1(n,o,h),[A,O,B]=QS(b,_,c);return[A,O,B,...p.length>0&&p[0]<1?[p[0]]:[]]};function QS(i,n,o){const{Xn:h,Yn:p,Zn:b,kE:_,kK:c}=js,A=i/h,O=n/p,B=o/b,R=A>_?Math.pow(A,1/3):(c*A+16)/116,C=O>_?Math.pow(O,1/3):(c*O+16)/116,Y=B>_?Math.pow(B,1/3):(c*B+16)/116;return[116*C-16,500*(R-C),200*(C-Y)]}function pm(i){const n=Math.sign(i);return i=Math.abs(i),(i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4))*n}const U1=(i,n,o)=>{i=pm(i/255),n=pm(n/255),o=pm(o/255);const{MtxRGB2XYZ:h,MtxAdaptMa:p,MtxAdaptMaI:b,Xn:_,Yn:c,Zn:A,As:O,Bs:B,Cs:R}=js;let C=i*h.m00+n*h.m10+o*h.m20,Y=i*h.m01+n*h.m11+o*h.m21,X=i*h.m02+n*h.m12+o*h.m22;const H=_*p.m00+c*p.m10+A*p.m20,ae=_*p.m01+c*p.m11+A*p.m21,Z=_*p.m02+c*p.m12+A*p.m22;let te=C*p.m00+Y*p.m10+X*p.m20,ne=C*p.m01+Y*p.m11+X*p.m21,_e=C*p.m02+Y*p.m12+X*p.m22;return te*=H/O,ne*=ae/B,_e*=Z/R,C=te*b.m00+ne*b.m10+_e*b.m20,Y=te*b.m01+ne*b.m11+_e*b.m21,X=te*b.m02+ne*b.m12+_e*b.m22,[C,Y,X]};Ye.prototype.lab=function(){return Hg(this._rgb)};const e5=(...i)=>new Ye(...i,"lab");Object.assign(Ti,{lab:e5,getLabWhitePoint:sh,setLabWhitePoint:_a});ri.format.lab=Gg;ri.autodetect.push({p:2,test:(...i)=>{if(i=si(i,"lab"),pi(i)==="array"&&i.length===3)return"lab"}});Ye.prototype.darken=function(i=1){const n=this,o=n.lab();return o[0]-=js.Kn*i,new Ye(o,"lab").alpha(n.alpha(),!0)};Ye.prototype.brighten=function(i=1){return this.darken(-i)};Ye.prototype.darker=Ye.prototype.darken;Ye.prototype.brighter=Ye.prototype.brighten;Ye.prototype.get=function(i){const[n,o]=i.split("."),h=this[n]();if(o){const p=n.indexOf(o)-(n.substr(0,2)==="ok"?2:0);if(p>-1)return h[p];throw new Error(`unknown channel ${o} in mode ${n}`)}else return h};const{pow:t5}=Math,i5=1e-7,n5=20;Ye.prototype.luminance=function(i,n="rgb"){if(i!==void 0&&pi(i)==="number"){if(i===0)return new Ye([0,0,0,this._rgb[3]],"rgb");if(i===1)return new Ye([255,255,255,this._rgb[3]],"rgb");let o=this.luminance(),h=n5;const p=(_,c)=>{const A=_.interpolate(c,.5,n),O=A.luminance();return Math.abs(i-O)<i5||!h--?A:O>i?p(_,A):p(A,c)},b=(o>i?p(new Ye([0,0,0]),this):p(this,new Ye([255,255,255]))).rgb();return new Ye([...b,this._rgb[3]])}return r5(...this._rgb.slice(0,3))};const r5=(i,n,o)=>(i=mm(i),n=mm(n),o=mm(o),.2126*i+.7152*n+.0722*o),mm=i=>(i/=255,i<=.03928?i/12.92:t5((i+.055)/1.055,2.4)),kr={},xc=(i,n,o=.5,...h)=>{let p=h[0]||"lrgb";if(!kr[p]&&!h.length&&(p=Object.keys(kr)[0]),!kr[p])throw new Error(`interpolation mode ${p} is not defined`);return pi(i)!=="object"&&(i=new Ye(i)),pi(n)!=="object"&&(n=new Ye(n)),kr[p](i,n,o).alpha(i.alpha()+o*(n.alpha()-i.alpha()))};Ye.prototype.mix=Ye.prototype.interpolate=function(i,n=.5,...o){return xc(this,i,n,...o)};Ye.prototype.premultiply=function(i=!1){const n=this._rgb,o=n[3];return i?(this._rgb=[n[0]*o,n[1]*o,n[2]*o,o],this):new Ye([n[0]*o,n[1]*o,n[2]*o,o],"rgb")};const{sin:s5,cos:a5}=Math,W1=(...i)=>{let[n,o,h]=si(i,"lch");return isNaN(h)&&(h=0),h=h*ZS,[n,a5(h)*o,s5(h)*o]},Xg=(...i)=>{i=si(i,"lch");const[n,o,h]=i,[p,b,_]=W1(n,o,h),[c,A,O]=Gg(p,b,_);return[c,A,O,i.length>3?i[3]:1]},o5=(...i)=>{const n=N1(si(i,"hcl"));return Xg(...n)},{sqrt:l5,atan2:c5,round:u5}=Math,q1=(...i)=>{const[n,o,h]=si(i,"lab"),p=l5(o*o+h*h);let b=(c5(h,o)*GS+360)%360;return u5(p*1e4)===0&&(b=Number.NaN),[n,p,b]},Yg=(...i)=>{const[n,o,h,...p]=si(i,"rgb"),[b,_,c]=Hg(n,o,h),[A,O,B]=q1(b,_,c);return[A,O,B,...p.length>0&&p[0]<1?[p[0]]:[]]};Ye.prototype.lch=function(){return Yg(this._rgb)};Ye.prototype.hcl=function(){return N1(Yg(this._rgb))};const h5=(...i)=>new Ye(...i,"lch"),d5=(...i)=>new Ye(...i,"hcl");Object.assign(Ti,{lch:h5,hcl:d5});ri.format.lch=Xg;ri.format.hcl=o5;["lch","hcl"].forEach(i=>ri.autodetect.push({p:2,test:(...n)=>{if(n=si(n,i),pi(n)==="array"&&n.length===3)return i}}));Ye.prototype.saturate=function(i=1){const n=this,o=n.lch();return o[1]+=js.Kn*i,o[1]<0&&(o[1]=0),new Ye(o,"lch").alpha(n.alpha(),!0)};Ye.prototype.desaturate=function(i=1){return this.saturate(-i)};Ye.prototype.set=function(i,n,o=!1){const[h,p]=i.split("."),b=this[h]();if(p){const _=h.indexOf(p)-(h.substr(0,2)==="ok"?2:0);if(_>-1){if(pi(n)=="string")switch(n.charAt(0)){case"+":b[_]+=+n;break;case"-":b[_]+=+n;break;case"*":b[_]*=+n.substr(1);break;case"/":b[_]/=+n.substr(1);break;default:b[_]=+n}else if(pi(n)==="number")b[_]=n;else throw new Error("unsupported value for Color.set");const c=new Ye(b,h);return o?(this._rgb=c._rgb,this):c}throw new Error(`unknown channel ${p} in mode ${h}`)}else return b};Ye.prototype.tint=function(i=.5,...n){return xc(this,"white",i,...n)};Ye.prototype.shade=function(i=.5,...n){return xc(this,"black",i,...n)};const f5=(i,n,o)=>{const h=i._rgb,p=n._rgb;return new Ye(h[0]+o*(p[0]-h[0]),h[1]+o*(p[1]-h[1]),h[2]+o*(p[2]-h[2]),"rgb")};kr.rgb=f5;const{sqrt:gm,pow:nc}=Math,p5=(i,n,o)=>{const[h,p,b]=i._rgb,[_,c,A]=n._rgb;return new Ye(gm(nc(h,2)*(1-o)+nc(_,2)*o),gm(nc(p,2)*(1-o)+nc(c,2)*o),gm(nc(b,2)*(1-o)+nc(A,2)*o),"rgb")};kr.lrgb=p5;const m5=(i,n,o)=>{const h=i.lab(),p=n.lab();return new Ye(h[0]+o*(p[0]-h[0]),h[1]+o*(p[1]-h[1]),h[2]+o*(p[2]-h[2]),"lab")};kr.lab=m5;const Sc=(i,n,o,h)=>{let p,b;h==="hsl"?(p=i.hsl(),b=n.hsl()):h==="hsv"?(p=i.hsv(),b=n.hsv()):h==="hcg"?(p=i.hcg(),b=n.hcg()):h==="hsi"?(p=i.hsi(),b=n.hsi()):h==="lch"||h==="hcl"?(h="hcl",p=i.hcl(),b=n.hcl()):h==="oklch"&&(p=i.oklch().reverse(),b=n.oklch().reverse());let _,c,A,O,B,R;(h.substr(0,1)==="h"||h==="oklch")&&([_,A,B]=p,[c,O,R]=b);let C,Y,X,H;return!isNaN(_)&&!isNaN(c)?(c>_&&c-_>180?H=c-(_+360):c<_&&_-c>180?H=c+360-_:H=c-_,Y=_+o*H):isNaN(_)?isNaN(c)?Y=Number.NaN:(Y=c,(B==1||B==0)&&h!="hsv"&&(C=O)):(Y=_,(R==1||R==0)&&h!="hsv"&&(C=A)),C===void 0&&(C=A+o*(O-A)),X=B+o*(R-B),h==="oklch"?new Ye([X,C,Y],h):new Ye([Y,C,X],h)},Z1=(i,n,o)=>Sc(i,n,o,"lch");kr.lch=Z1;kr.hcl=Z1;const g5=i=>{if(pi(i)=="number"&&i>=0&&i<=16777215){const n=i>>16,o=i>>8&255,h=i&255;return[n,o,h,1]}throw new Error("unknown num color: "+i)},y5=(...i)=>{const[n,o,h]=si(i,"rgb");return(n<<16)+(o<<8)+h};Ye.prototype.num=function(){return y5(this._rgb)};const _5=(...i)=>new Ye(...i,"num");Object.assign(Ti,{num:_5});ri.format.num=g5;ri.autodetect.push({p:5,test:(...i)=>{if(i.length===1&&pi(i[0])==="number"&&i[0]>=0&&i[0]<=16777215)return"num"}});const v5=(i,n,o)=>{const h=i.num(),p=n.num();return new Ye(h+o*(p-h),"num")};kr.num=v5;const{floor:b5}=Math,x5=(...i)=>{i=si(i,"hcg");let[n,o,h]=i,p,b,_;h=h*255;const c=o*255;if(o===0)p=b=_=h;else{n===360&&(n=0),n>360&&(n-=360),n<0&&(n+=360),n/=60;const A=b5(n),O=n-A,B=h*(1-o),R=B+c*(1-O),C=B+c*O,Y=B+c;switch(A){case 0:[p,b,_]=[Y,C,B];break;case 1:[p,b,_]=[R,Y,B];break;case 2:[p,b,_]=[B,Y,C];break;case 3:[p,b,_]=[B,R,Y];break;case 4:[p,b,_]=[C,B,Y];break;case 5:[p,b,_]=[Y,B,R];break}}return[p,b,_,i.length>3?i[3]:1]},w5=(...i)=>{const[n,o,h]=si(i,"rgb"),p=B1(n,o,h),b=F1(n,o,h),_=b-p,c=_*100/255,A=p/(255-_)*100;let O;return _===0?O=Number.NaN:(n===b&&(O=(o-h)/_),o===b&&(O=2+(h-n)/_),h===b&&(O=4+(n-o)/_),O*=60,O<0&&(O+=360)),[O,c,A]};Ye.prototype.hcg=function(){return w5(this._rgb)};const T5=(...i)=>new Ye(...i,"hcg");Ti.hcg=T5;ri.format.hcg=x5;ri.autodetect.push({p:1,test:(...i)=>{if(i=si(i,"hcg"),pi(i)==="array"&&i.length===3)return"hcg"}});const S5=(i,n,o)=>Sc(i,n,o,"hcg");kr.hcg=S5;const{cos:rc}=Math,k5=(...i)=>{i=si(i,"hsi");let[n,o,h]=i,p,b,_;return isNaN(n)&&(n=0),isNaN(o)&&(o=0),n>360&&(n-=360),n<0&&(n+=360),n/=360,n<1/3?(_=(1-o)/3,p=(1+o*rc(ga*n)/rc(dm-ga*n))/3,b=1-(_+p)):n<2/3?(n-=1/3,p=(1-o)/3,b=(1+o*rc(ga*n)/rc(dm-ga*n))/3,_=1-(p+b)):(n-=2/3,b=(1-o)/3,_=(1+o*rc(ga*n)/rc(dm-ga*n))/3,p=1-(b+_)),p=tl(h*p*3),b=tl(h*b*3),_=tl(h*_*3),[p*255,b*255,_*255,i.length>3?i[3]:1]},{min:M5,sqrt:A5,acos:I5}=Math,E5=(...i)=>{let[n,o,h]=si(i,"rgb");n/=255,o/=255,h/=255;let p;const b=M5(n,o,h),_=(n+o+h)/3,c=_>0?1-b/_:0;return c===0?p=NaN:(p=(n-o+(n-h))/2,p/=A5((n-o)*(n-o)+(n-h)*(o-h)),p=I5(p),h>o&&(p=ga-p),p/=ga),[p*360,c,_]};Ye.prototype.hsi=function(){return E5(this._rgb)};const C5=(...i)=>new Ye(...i,"hsi");Ti.hsi=C5;ri.format.hsi=k5;ri.autodetect.push({p:2,test:(...i)=>{if(i=si(i,"hsi"),pi(i)==="array"&&i.length===3)return"hsi"}});const P5=(i,n,o)=>Sc(i,n,o,"hsi");kr.hsi=P5;const fg=(...i)=>{i=si(i,"hsl");const[n,o,h]=i;let p,b,_;if(o===0)p=b=_=h*255;else{const c=[0,0,0],A=[0,0,0],O=h<.5?h*(1+o):h+o-h*o,B=2*h-O,R=n/360;c[0]=R+1/3,c[1]=R,c[2]=R-1/3;for(let C=0;C<3;C++)c[C]<0&&(c[C]+=1),c[C]>1&&(c[C]-=1),6*c[C]<1?A[C]=B+(O-B)*6*c[C]:2*c[C]<1?A[C]=O:3*c[C]<2?A[C]=B+(O-B)*(2/3-c[C])*6:A[C]=B;[p,b,_]=[A[0]*255,A[1]*255,A[2]*255]}return i.length>3?[p,b,_,i[3]]:[p,b,_,1]},G1=(...i)=>{i=si(i,"rgba");let[n,o,h]=i;n/=255,o/=255,h/=255;const p=B1(n,o,h),b=F1(n,o,h),_=(b+p)/2;let c,A;return b===p?(c=0,A=Number.NaN):c=_<.5?(b-p)/(b+p):(b-p)/(2-b-p),n==b?A=(o-h)/(b-p):o==b?A=2+(h-n)/(b-p):h==b&&(A=4+(n-o)/(b-p)),A*=60,A<0&&(A+=360),i.length>3&&i[3]!==void 0?[A,c,_,i[3]]:[A,c,_]};Ye.prototype.hsl=function(){return G1(this._rgb)};const z5=(...i)=>new Ye(...i,"hsl");Ti.hsl=z5;ri.format.hsl=fg;ri.autodetect.push({p:2,test:(...i)=>{if(i=si(i,"hsl"),pi(i)==="array"&&i.length===3)return"hsl"}});const D5=(i,n,o)=>Sc(i,n,o,"hsl");kr.hsl=D5;const{floor:L5}=Math,R5=(...i)=>{i=si(i,"hsv");let[n,o,h]=i,p,b,_;if(h*=255,o===0)p=b=_=h;else{n===360&&(n=0),n>360&&(n-=360),n<0&&(n+=360),n/=60;const c=L5(n),A=n-c,O=h*(1-o),B=h*(1-o*A),R=h*(1-o*(1-A));switch(c){case 0:[p,b,_]=[h,R,O];break;case 1:[p,b,_]=[B,h,O];break;case 2:[p,b,_]=[O,h,R];break;case 3:[p,b,_]=[O,B,h];break;case 4:[p,b,_]=[R,O,h];break;case 5:[p,b,_]=[h,O,B];break}}return[p,b,_,i.length>3?i[3]:1]},{min:O5,max:B5}=Math,F5=(...i)=>{i=si(i,"rgb");let[n,o,h]=i;const p=O5(n,o,h),b=B5(n,o,h),_=b-p;let c,A,O;return O=b/255,b===0?(c=Number.NaN,A=0):(A=_/b,n===b&&(c=(o-h)/_),o===b&&(c=2+(h-n)/_),h===b&&(c=4+(n-o)/_),c*=60,c<0&&(c+=360)),[c,A,O]};Ye.prototype.hsv=function(){return F5(this._rgb)};const N5=(...i)=>new Ye(...i,"hsv");Ti.hsv=N5;ri.format.hsv=R5;ri.autodetect.push({p:2,test:(...i)=>{if(i=si(i,"hsv"),pi(i)==="array"&&i.length===3)return"hsv"}});const $5=(i,n,o)=>Sc(i,n,o,"hsv");kr.hsv=$5;function Xd(i,n){let o=i.length;Array.isArray(i[0])||(i=[i]),Array.isArray(n[0])||(n=n.map(_=>[_]));let h=n[0].length,p=n[0].map((_,c)=>n.map(A=>A[c])),b=i.map(_=>p.map(c=>Array.isArray(_)?_.reduce((A,O,B)=>A+O*(c[B]||0),0):c.reduce((A,O)=>A+O*_,0)));return o===1&&(b=b[0]),h===1?b.map(_=>_[0]):b}const Kg=(...i)=>{i=si(i,"lab");const[n,o,h,...p]=i,[b,_,c]=j5([n,o,h]),[A,O,B]=V1(b,_,c);return[A,O,B,...p.length>0&&p[0]<1?[p[0]]:[]]};function j5(i){var n=[[1.2268798758459243,-.5578149944602171,.2813910456659647],[-.0405757452148008,1.112286803280317,-.0717110580655164],[-.0763729366746601,-.4214933324022432,1.5869240198367816]],o=[[1,.3963377773761749,.2158037573099136],[1,-.1055613458156586,-.0638541728258133],[1,-.0894841775298119,-1.2914855480194092]],h=Xd(o,i);return Xd(n,h.map(p=>p**3))}const Jg=(...i)=>{const[n,o,h,...p]=si(i,"rgb"),b=U1(n,o,h);return[...V5(b),...p.length>0&&p[0]<1?[p[0]]:[]]};function V5(i){const n=[[.819022437996703,.3619062600528904,-.1288737815209879],[.0329836539323885,.9292868615863434,.0361446663506424],[.0481771893596242,.2642395317527308,.6335478284694309]],o=[[.210454268309314,.7936177747023054,-.0040720430116193],[1.9779985324311684,-2.42859224204858,.450593709617411],[.0259040424655478,.7827717124575296,-.8086757549230774]],h=Xd(n,i);return Xd(o,h.map(p=>Math.cbrt(p)))}Ye.prototype.oklab=function(){return Jg(this._rgb)};const U5=(...i)=>new Ye(...i,"oklab");Object.assign(Ti,{oklab:U5});ri.format.oklab=Kg;ri.autodetect.push({p:2,test:(...i)=>{if(i=si(i,"oklab"),pi(i)==="array"&&i.length===3)return"oklab"}});const W5=(i,n,o)=>{const h=i.oklab(),p=n.oklab();return new Ye(h[0]+o*(p[0]-h[0]),h[1]+o*(p[1]-h[1]),h[2]+o*(p[2]-h[2]),"oklab")};kr.oklab=W5;const q5=(i,n,o)=>Sc(i,n,o,"oklch");kr.oklch=q5;const{pow:ym,sqrt:_m,PI:vm,cos:y_,sin:__,atan2:Z5}=Math,G5=(i,n="lrgb",o=null)=>{const h=i.length;o||(o=Array.from(new Array(h)).map(()=>1));const p=h/o.reduce(function(R,C){return R+C});if(o.forEach((R,C)=>{o[C]*=p}),i=i.map(R=>new Ye(R)),n==="lrgb")return H5(i,o);const b=i.shift(),_=b.get(n),c=[];let A=0,O=0;for(let R=0;R<_.length;R++)if(_[R]=(_[R]||0)*o[0],c.push(isNaN(_[R])?0:o[0]),n.charAt(R)==="h"&&!isNaN(_[R])){const C=_[R]/180*vm;A+=y_(C)*o[0],O+=__(C)*o[0]}let B=b.alpha()*o[0];i.forEach((R,C)=>{const Y=R.get(n);B+=R.alpha()*o[C+1];for(let X=0;X<_.length;X++)if(!isNaN(Y[X]))if(c[X]+=o[C+1],n.charAt(X)==="h"){const H=Y[X]/180*vm;A+=y_(H)*o[C+1],O+=__(H)*o[C+1]}else _[X]+=Y[X]*o[C+1]});for(let R=0;R<_.length;R++)if(n.charAt(R)==="h"){let C=Z5(O/c[R],A/c[R])/vm*180;for(;C<0;)C+=360;for(;C>=360;)C-=360;_[R]=C}else _[R]=_[R]/c[R];return B/=h,new Ye(_,n).alpha(B>.99999?1:B,!0)},H5=(i,n)=>{const o=i.length,h=[0,0,0,0];for(let p=0;p<i.length;p++){const b=i[p],_=n[p]/o,c=b._rgb;h[0]+=ym(c[0],2)*_,h[1]+=ym(c[1],2)*_,h[2]+=ym(c[2],2)*_,h[3]+=c[3]*_}return h[0]=_m(h[0]),h[1]=_m(h[1]),h[2]=_m(h[2]),h[3]>.9999999&&(h[3]=1),new Ye(Zg(h))},{pow:X5}=Math;function Yd(i){let n="rgb",o=Ti("#ccc"),h=0,p=[0,1],b=[],_=[0,0],c=!1,A=[],O=!1,B=0,R=1,C=!1,Y={},X=!0,H=1;const ae=function(de){if(de=de||["#fff","#000"],de&&pi(de)==="string"&&Ti.brewer&&Ti.brewer[de.toLowerCase()]&&(de=Ti.brewer[de.toLowerCase()]),pi(de)==="array"){de.length===1&&(de=[de[0],de[0]]),de=de.slice(0);for(let Fe=0;Fe<de.length;Fe++)de[Fe]=Ti(de[Fe]);b.length=0;for(let Fe=0;Fe<de.length;Fe++)b.push(Fe/(de.length-1))}return ve(),A=de},Z=function(de){if(c!=null){const Fe=c.length-1;let Re=0;for(;Re<Fe&&de>=c[Re];)Re++;return Re-1}return 0};let te=de=>de,ne=de=>de;const _e=function(de,Fe){let Re,Le;if(Fe==null&&(Fe=!1),isNaN(de)||de===null)return o;Fe?Le=de:c&&c.length>2?Le=Z(de)/(c.length-2):R!==B?Le=(de-B)/(R-B):Le=1,Le=ne(Le),Fe||(Le=te(Le)),H!==1&&(Le=X5(Le,H)),Le=_[0]+Le*(1-_[0]-_[1]),Le=tl(Le,0,1);const Te=Math.floor(Le*1e4);if(X&&Y[Te])Re=Y[Te];else{if(pi(A)==="array")for(let we=0;we<b.length;we++){const fe=b[we];if(Le<=fe){Re=A[we];break}if(Le>=fe&&we===b.length-1){Re=A[we];break}if(Le>fe&&Le<b[we+1]){Le=(Le-fe)/(b[we+1]-fe),Re=Ti.interpolate(A[we],A[we+1],Le,n);break}}else pi(A)==="function"&&(Re=A(Le));X&&(Y[Te]=Re)}return Re};var ve=()=>Y={};ae(i);const Se=function(de){const Fe=Ti(_e(de));return O&&Fe[O]?Fe[O]():Fe};return Se.classes=function(de){if(de!=null){if(pi(de)==="array")c=de,p=[de[0],de[de.length-1]];else{const Fe=Ti.analyze(p);de===0?c=[Fe.min,Fe.max]:c=Ti.limits(Fe,"e",de)}return Se}return c},Se.domain=function(de){if(!arguments.length)return p;B=de[0],R=de[de.length-1],b=[];const Fe=A.length;if(de.length===Fe&&B!==R)for(let Re of Array.from(de))b.push((Re-B)/(R-B));else{for(let Re=0;Re<Fe;Re++)b.push(Re/(Fe-1));if(de.length>2){const Re=de.map((Te,we)=>we/(de.length-1)),Le=de.map(Te=>(Te-B)/(R-B));Le.every((Te,we)=>Re[we]===Te)||(ne=Te=>{if(Te<=0||Te>=1)return Te;let we=0;for(;Te>=Le[we+1];)we++;const fe=(Te-Le[we])/(Le[we+1]-Le[we]);return Re[we]+fe*(Re[we+1]-Re[we])})}}return p=[B,R],Se},Se.mode=function(de){return arguments.length?(n=de,ve(),Se):n},Se.range=function(de,Fe){return ae(de),Se},Se.out=function(de){return O=de,Se},Se.spread=function(de){return arguments.length?(h=de,Se):h},Se.correctLightness=function(de){return de==null&&(de=!0),C=de,ve(),C?te=function(Fe){const Re=_e(0,!0).lab()[0],Le=_e(1,!0).lab()[0],Te=Re>Le;let we=_e(Fe,!0).lab()[0];const fe=Re+(Le-Re)*Fe;let Ae=we-fe,Ce=0,Ve=1,Ue=20;for(;Math.abs(Ae)>.01&&Ue-- >0;)(function(){return Te&&(Ae*=-1),Ae<0?(Ce=Fe,Fe+=(Ve-Fe)*.5):(Ve=Fe,Fe+=(Ce-Fe)*.5),we=_e(Fe,!0).lab()[0],Ae=we-fe})();return Fe}:te=Fe=>Fe,Se},Se.padding=function(de){return de!=null?(pi(de)==="number"&&(de=[de,de]),_=de,Se):_},Se.colors=function(de,Fe){arguments.length<2&&(Fe="hex");let Re=[];if(arguments.length===0)Re=A.slice(0);else if(de===1)Re=[Se(.5)];else if(de>1){const Le=p[0],Te=p[1]-Le;Re=Y5(0,de).map(we=>Se(Le+we/(de-1)*Te))}else{i=[];let Le=[];if(c&&c.length>2)for(let Te=1,we=c.length,fe=1<=we;fe?Te<we:Te>we;fe?Te++:Te--)Le.push((c[Te-1]+c[Te])*.5);else Le=p;Re=Le.map(Te=>Se(Te))}return Ti[Fe]&&(Re=Re.map(Le=>Le[Fe]())),Re},Se.cache=function(de){return de!=null?(X=de,Se):X},Se.gamma=function(de){return de!=null?(H=de,Se):H},Se.nodata=function(de){return de!=null?(o=Ti(de),Se):o},Se}function Y5(i,n,o){let h=[],p=i<n,b=n;for(let _=i;p?_<b:_>b;p?_++:_--)h.push(_);return h}const K5=function(i){let n=[1,1];for(let o=1;o<i;o++){let h=[1];for(let p=1;p<=n.length;p++)h[p]=(n[p]||0)+n[p-1];n=h}return n},J5=function(i){let n,o,h,p;if(i=i.map(b=>new Ye(b)),i.length===2)[o,h]=i.map(b=>b.lab()),n=function(b){const _=[0,1,2].map(c=>o[c]+b*(h[c]-o[c]));return new Ye(_,"lab")};else if(i.length===3)[o,h,p]=i.map(b=>b.lab()),n=function(b){const _=[0,1,2].map(c=>(1-b)*(1-b)*o[c]+2*(1-b)*b*h[c]+b*b*p[c]);return new Ye(_,"lab")};else if(i.length===4){let b;[o,h,p,b]=i.map(_=>_.lab()),n=function(_){const c=[0,1,2].map(A=>(1-_)*(1-_)*(1-_)*o[A]+3*(1-_)*(1-_)*_*h[A]+3*(1-_)*_*_*p[A]+_*_*_*b[A]);return new Ye(c,"lab")}}else if(i.length>=5){let b,_,c;b=i.map(A=>A.lab()),c=i.length-1,_=K5(c),n=function(A){const O=1-A,B=[0,1,2].map(R=>b.reduce((C,Y,X)=>C+_[X]*O**(c-X)*A**X*Y[R],0));return new Ye(B,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return n},Q5=i=>{const n=J5(i);return n.scale=()=>Yd(n),n},{round:H1}=Math;Ye.prototype.rgb=function(i=!0){return i===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(H1)};Ye.prototype.rgba=function(i=!0){return this._rgb.slice(0,4).map((n,o)=>o<3?i===!1?n:H1(n):n)};const ek=(...i)=>new Ye(...i,"rgb");Object.assign(Ti,{rgb:ek});ri.format.rgb=(...i)=>{const n=si(i,"rgba");return n[3]===void 0&&(n[3]=1),n};ri.autodetect.push({p:3,test:(...i)=>{if(i=si(i,"rgba"),pi(i)==="array"&&(i.length===3||i.length===4&&pi(i[3])=="number"&&i[3]>=0&&i[3]<=1))return"rgb"}});const Ms=(i,n,o)=>{if(!Ms[o])throw new Error("unknown blend mode "+o);return Ms[o](i,n)},ho=i=>(n,o)=>{const h=Ti(o).rgb(),p=Ti(n).rgb();return Ti.rgb(i(h,p))},fo=i=>(n,o)=>{const h=[];return h[0]=i(n[0],o[0]),h[1]=i(n[1],o[1]),h[2]=i(n[2],o[2]),h},tk=i=>i,ik=(i,n)=>i*n/255,nk=(i,n)=>i>n?n:i,rk=(i,n)=>i>n?i:n,sk=(i,n)=>255*(1-(1-i/255)*(1-n/255)),ak=(i,n)=>n<128?2*i*n/255:255*(1-2*(1-i/255)*(1-n/255)),ok=(i,n)=>255*(1-(1-n/255)/(i/255)),lk=(i,n)=>i===255?255:(i=255*(n/255)/(1-i/255),i>255?255:i);Ms.normal=ho(fo(tk));Ms.multiply=ho(fo(ik));Ms.screen=ho(fo(sk));Ms.overlay=ho(fo(ak));Ms.darken=ho(fo(nk));Ms.lighten=ho(fo(rk));Ms.dodge=ho(fo(lk));Ms.burn=ho(fo(ok));const{pow:ck,sin:uk,cos:hk}=Math;function dk(i=300,n=-1.5,o=1,h=1,p=[0,1]){let b=0,_;pi(p)==="array"?_=p[1]-p[0]:(_=0,p=[p,p]);const c=function(A){const O=ga*((i+120)/360+n*A),B=ck(p[0]+_*A,h),C=(b!==0?o[0]+A*b:o)*B*(1-B)/2,Y=hk(O),X=uk(O),H=B+C*(-.14861*Y+1.78277*X),ae=B+C*(-.29227*Y-.90649*X),Z=B+C*(1.97294*Y);return Ti(Zg([H*255,ae*255,Z*255,1]))};return c.start=function(A){return A==null?i:(i=A,c)},c.rotations=function(A){return A==null?n:(n=A,c)},c.gamma=function(A){return A==null?h:(h=A,c)},c.hue=function(A){return A==null?o:(o=A,pi(o)==="array"?(b=o[1]-o[0],b===0&&(o=o[1])):b=0,c)},c.lightness=function(A){return A==null?p:(pi(A)==="array"?(p=A,_=A[1]-A[0]):(p=[A,A],_=0),c)},c.scale=()=>Ti.scale(c),c.hue(o),c}const fk="0123456789abcdef",{floor:pk,random:mk}=Math,gk=()=>{let i="#";for(let n=0;n<6;n++)i+=fk.charAt(pk(mk()*16));return new Ye(i,"hex")},{log:v_,pow:yk,floor:_k,abs:vk}=Math;function X1(i,n=null){const o={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return pi(i)==="object"&&(i=Object.values(i)),i.forEach(h=>{n&&pi(h)==="object"&&(h=h[n]),h!=null&&!isNaN(h)&&(o.values.push(h),o.sum+=h,h<o.min&&(o.min=h),h>o.max&&(o.max=h),o.count+=1)}),o.domain=[o.min,o.max],o.limits=(h,p)=>Y1(o,h,p),o}function Y1(i,n="equal",o=7){pi(i)=="array"&&(i=X1(i));const{min:h,max:p}=i,b=i.values.sort((c,A)=>c-A);if(o===1)return[h,p];const _=[];if(n.substr(0,1)==="c"&&(_.push(h),_.push(p)),n.substr(0,1)==="e"){_.push(h);for(let c=1;c<o;c++)_.push(h+c/o*(p-h));_.push(p)}else if(n.substr(0,1)==="l"){if(h<=0)throw new Error("Logarithmic scales are only possible for values > 0");const c=Math.LOG10E*v_(h),A=Math.LOG10E*v_(p);_.push(h);for(let O=1;O<o;O++)_.push(yk(10,c+O/o*(A-c)));_.push(p)}else if(n.substr(0,1)==="q"){_.push(h);for(let c=1;c<o;c++){const A=(b.length-1)*c/o,O=_k(A);if(O===A)_.push(b[O]);else{const B=A-O;_.push(b[O]*(1-B)+b[O+1]*B)}}_.push(p)}else if(n.substr(0,1)==="k"){let c;const A=b.length,O=new Array(A),B=new Array(o);let R=!0,C=0,Y=null;Y=[],Y.push(h);for(let ae=1;ae<o;ae++)Y.push(h+ae/o*(p-h));for(Y.push(p);R;){for(let Z=0;Z<o;Z++)B[Z]=0;for(let Z=0;Z<A;Z++){const te=b[Z];let ne=Number.MAX_VALUE,_e;for(let ve=0;ve<o;ve++){const Se=vk(Y[ve]-te);Se<ne&&(ne=Se,_e=ve),B[_e]++,O[Z]=_e}}const ae=new Array(o);for(let Z=0;Z<o;Z++)ae[Z]=null;for(let Z=0;Z<A;Z++)c=O[Z],ae[c]===null?ae[c]=b[Z]:ae[c]+=b[Z];for(let Z=0;Z<o;Z++)ae[Z]*=1/B[Z];R=!1;for(let Z=0;Z<o;Z++)if(ae[Z]!==Y[Z]){R=!0;break}Y=ae,C++,C>200&&(R=!1)}const X={};for(let ae=0;ae<o;ae++)X[ae]=[];for(let ae=0;ae<A;ae++)c=O[ae],X[c].push(b[ae]);let H=[];for(let ae=0;ae<o;ae++)H.push(X[ae][0]),H.push(X[ae][X[ae].length-1]);H=H.sort((ae,Z)=>ae-Z),_.push(H[0]);for(let ae=1;ae<H.length;ae+=2){const Z=H[ae];!isNaN(Z)&&_.indexOf(Z)===-1&&_.push(Z)}}return _}const bk=(i,n)=>{i=new Ye(i),n=new Ye(n);const o=i.luminance(),h=n.luminance();return o>h?(o+.05)/(h+.05):(h+.05)/(o+.05)};/**
 * @license
 *
 * The APCA contrast prediction algorithm is based of the formulas published
 * in the APCA-1.0.98G specification by Myndex. The specification is available at:
 * https://raw.githubusercontent.com/Myndex/apca-w3/master/images/APCAw3_0.1.17_APCA0.0.98G.svg
 *
 * Note that the APCA implementation is still beta, so please update to
 * future versions of chroma.js when they become available.
 *
 * You can read more about the APCA Readability Criterion at
 * https://readtech.org/ARC/
 */const b_=.027,xk=5e-4,wk=.1,x_=1.14,Ld=.022,w_=1.414,Tk=(i,n)=>{i=new Ye(i),n=new Ye(n),i.alpha()<1&&(i=xc(n,i,i.alpha(),"rgb"));const o=T_(...i.rgb()),h=T_(...n.rgb()),p=o>=Ld?o:o+Math.pow(Ld-o,w_),b=h>=Ld?h:h+Math.pow(Ld-h,w_),_=Math.pow(b,.56)-Math.pow(p,.57),c=Math.pow(b,.65)-Math.pow(p,.62),A=Math.abs(b-p)<xk?0:p<b?_*x_:c*x_;return(Math.abs(A)<wk?0:A>0?A-b_:A+b_)*100};function T_(i,n,o){return .2126729*Math.pow(i/255,2.4)+.7151522*Math.pow(n/255,2.4)+.072175*Math.pow(o/255,2.4)}const{sqrt:fa,pow:Ln,min:Sk,max:kk,atan2:S_,abs:k_,cos:Rd,sin:M_,exp:Mk,PI:A_}=Math;function Ak(i,n,o=1,h=1,p=1){var b=function(Nt){return 360*Nt/(2*A_)},_=function(Nt){return 2*A_*Nt/360};i=new Ye(i),n=new Ye(n);const[c,A,O]=Array.from(i.lab()),[B,R,C]=Array.from(n.lab()),Y=(c+B)/2,X=fa(Ln(A,2)+Ln(O,2)),H=fa(Ln(R,2)+Ln(C,2)),ae=(X+H)/2,Z=.5*(1-fa(Ln(ae,7)/(Ln(ae,7)+Ln(25,7)))),te=A*(1+Z),ne=R*(1+Z),_e=fa(Ln(te,2)+Ln(O,2)),ve=fa(Ln(ne,2)+Ln(C,2)),Se=(_e+ve)/2,de=b(S_(O,te)),Fe=b(S_(C,ne)),Re=de>=0?de:de+360,Le=Fe>=0?Fe:Fe+360,Te=k_(Re-Le)>180?(Re+Le+360)/2:(Re+Le)/2,we=1-.17*Rd(_(Te-30))+.24*Rd(_(2*Te))+.32*Rd(_(3*Te+6))-.2*Rd(_(4*Te-63));let fe=Le-Re;fe=k_(fe)<=180?fe:Le<=Re?fe+360:fe-360,fe=2*fa(_e*ve)*M_(_(fe)/2);const Ae=B-c,Ce=ve-_e,Ve=1+.015*Ln(Y-50,2)/fa(20+Ln(Y-50,2)),Ue=1+.045*Se,Ge=1+.015*Se*we,Oe=30*Mk(-Ln((Te-275)/25,2)),We=-(2*fa(Ln(Se,7)/(Ln(Se,7)+Ln(25,7))))*M_(2*_(Oe)),Et=fa(Ln(Ae/(o*Ve),2)+Ln(Ce/(h*Ue),2)+Ln(fe/(p*Ge),2)+We*(Ce/(h*Ue))*(fe/(p*Ge)));return kk(0,Sk(100,Et))}function Ik(i,n,o="lab"){i=new Ye(i),n=new Ye(n);const h=i.get(o),p=n.get(o);let b=0;for(let _ in h){const c=(h[_]||0)-(p[_]||0);b+=c*c}return Math.sqrt(b)}const Ek=(...i)=>{try{return new Ye(...i),!0}catch{return!1}},Ck={cool(){return Yd([Ti.hsl(180,1,.9),Ti.hsl(250,.7,.4)])},hot(){return Yd(["#000","#f00","#ff0","#fff"]).mode("rgb")}},pg={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},K1=Object.keys(pg),I_=new Map(K1.map(i=>[i.toLowerCase(),i])),Pk=typeof Proxy=="function"?new Proxy(pg,{get(i,n){const o=n.toLowerCase();if(I_.has(o))return i[I_.get(o)]},getOwnPropertyNames(){return Object.getOwnPropertyNames(K1)}}):pg,zk=(...i)=>{i=si(i,"cmyk");const[n,o,h,p]=i,b=i.length>4?i[4]:1;return p===1?[0,0,0,b]:[n>=1?0:255*(1-n)*(1-p),o>=1?0:255*(1-o)*(1-p),h>=1?0:255*(1-h)*(1-p),b]},{max:E_}=Math,Dk=(...i)=>{let[n,o,h]=si(i,"rgb");n=n/255,o=o/255,h=h/255;const p=1-E_(n,E_(o,h)),b=p<1?1/(1-p):0,_=(1-n-p)*b,c=(1-o-p)*b,A=(1-h-p)*b;return[_,c,A,p]};Ye.prototype.cmyk=function(){return Dk(this._rgb)};const Lk=(...i)=>new Ye(...i,"cmyk");Object.assign(Ti,{cmyk:Lk});ri.format.cmyk=zk;ri.autodetect.push({p:2,test:(...i)=>{if(i=si(i,"cmyk"),pi(i)==="array"&&i.length===4)return"cmyk"}});const Rk=(...i)=>{const n=si(i,"hsla");let o=Tc(i)||"lsa";return n[0]=ps(n[0]||0)+"deg",n[1]=ps(n[1]*100)+"%",n[2]=ps(n[2]*100)+"%",o==="hsla"||n.length>3&&n[3]<1?(n[3]="/ "+(n.length>3?n[3]:1),o="hsla"):n.length=3,`${o.substr(0,3)}(${n.join(" ")})`},Ok=(...i)=>{const n=si(i,"lab");let o=Tc(i)||"lab";return n[0]=ps(n[0])+"%",n[1]=ps(n[1]),n[2]=ps(n[2]),o==="laba"||n.length>3&&n[3]<1?n[3]="/ "+(n.length>3?n[3]:1):n.length=3,`lab(${n.join(" ")})`},Bk=(...i)=>{const n=si(i,"lch");let o=Tc(i)||"lab";return n[0]=ps(n[0])+"%",n[1]=ps(n[1]),n[2]=isNaN(n[2])?"none":ps(n[2])+"deg",o==="lcha"||n.length>3&&n[3]<1?n[3]="/ "+(n.length>3?n[3]:1):n.length=3,`lch(${n.join(" ")})`},Fk=(...i)=>{const n=si(i,"lab");return n[0]=ps(n[0]*100)+"%",n[1]=dg(n[1]),n[2]=dg(n[2]),n.length>3&&n[3]<1?n[3]="/ "+(n.length>3?n[3]:1):n.length=3,`oklab(${n.join(" ")})`},J1=(...i)=>{const[n,o,h,...p]=si(i,"rgb"),[b,_,c]=Jg(n,o,h),[A,O,B]=q1(b,_,c);return[A,O,B,...p.length>0&&p[0]<1?[p[0]]:[]]},Nk=(...i)=>{const n=si(i,"lch");return n[0]=ps(n[0]*100)+"%",n[1]=dg(n[1]),n[2]=isNaN(n[2])?"none":ps(n[2])+"deg",n.length>3&&n[3]<1?n[3]="/ "+(n.length>3?n[3]:1):n.length=3,`oklch(${n.join(" ")})`},{round:bm}=Math,$k=(...i)=>{const n=si(i,"rgba");let o=Tc(i)||"rgb";if(o.substr(0,3)==="hsl")return Rk(G1(n),o);if(o.substr(0,3)==="lab"){const h=sh();_a("d50");const p=Ok(Hg(n),o);return _a(h),p}if(o.substr(0,3)==="lch"){const h=sh();_a("d50");const p=Bk(Yg(n),o);return _a(h),p}return o.substr(0,5)==="oklab"?Fk(Jg(n)):o.substr(0,5)==="oklch"?Nk(J1(n)):(n[0]=bm(n[0]),n[1]=bm(n[1]),n[2]=bm(n[2]),(o==="rgba"||n.length>3&&n[3]<1)&&(n[3]="/ "+(n.length>3?n[3]:1),o="rgba"),`${o.substr(0,3)}(${n.slice(0,o==="rgb"?3:4).join(" ")})`)},Q1=(...i)=>{i=si(i,"lch");const[n,o,h,...p]=i,[b,_,c]=W1(n,o,h),[A,O,B]=Kg(b,_,c);return[A,O,B,...p.length>0&&p[0]<1?[p[0]]:[]]},va=/((?:-?\d+)|(?:-?\d+(?:\.\d+)?)%|none)/.source,ks=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)%?)|none)/.source,Kd=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)%)|none)/.source,ms=/\s*/.source,kc=/\s+/.source,Qg=/\s*,\s*/.source,Tf=/((?:-?(?:\d+(?:\.\d*)?|\.\d+)(?:deg)?)|none)/.source,Mc=/\s*(?:\/\s*((?:[01]|[01]?\.\d+)|\d+(?:\.\d+)?%))?/.source,eb=new RegExp("^rgba?\\("+ms+[va,va,va].join(kc)+Mc+"\\)$"),tb=new RegExp("^rgb\\("+ms+[va,va,va].join(Qg)+ms+"\\)$"),ib=new RegExp("^rgba\\("+ms+[va,va,va,ks].join(Qg)+ms+"\\)$"),nb=new RegExp("^hsla?\\("+ms+[Tf,Kd,Kd].join(kc)+Mc+"\\)$"),rb=new RegExp("^hsl?\\("+ms+[Tf,Kd,Kd].join(Qg)+ms+"\\)$"),sb=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,ab=new RegExp("^lab\\("+ms+[ks,ks,ks].join(kc)+Mc+"\\)$"),ob=new RegExp("^lch\\("+ms+[ks,ks,Tf].join(kc)+Mc+"\\)$"),lb=new RegExp("^oklab\\("+ms+[ks,ks,ks].join(kc)+Mc+"\\)$"),cb=new RegExp("^oklch\\("+ms+[ks,ks,Tf].join(kc)+Mc+"\\)$"),{round:ub}=Math,sc=i=>i.map((n,o)=>o<=2?tl(ub(n),0,255):n),Rn=(i,n=0,o=100,h=!1)=>(typeof i=="string"&&i.endsWith("%")&&(i=parseFloat(i.substring(0,i.length-1))/100,h?i=n+(i+1)*.5*(o-n):i=n+i*(o-n)),+i),Lr=(i,n)=>i==="none"?n:i,e0=i=>{if(i=i.toLowerCase().trim(),i==="transparent")return[0,0,0,0];let n;if(ri.format.named)try{return ri.format.named(i)}catch{}if((n=i.match(eb))||(n=i.match(tb))){let o=n.slice(1,4);for(let p=0;p<3;p++)o[p]=+Rn(Lr(o[p],0),0,255);o=sc(o);const h=n[4]!==void 0?+Rn(n[4],0,1):1;return o[3]=h,o}if(n=i.match(ib)){const o=n.slice(1,5);for(let h=0;h<4;h++)o[h]=+Rn(o[h],0,255);return o}if((n=i.match(nb))||(n=i.match(rb))){const o=n.slice(1,4);o[0]=+Lr(o[0].replace("deg",""),0),o[1]=+Rn(Lr(o[1],0),0,100)*.01,o[2]=+Rn(Lr(o[2],0),0,100)*.01;const h=sc(fg(o)),p=n[4]!==void 0?+Rn(n[4],0,1):1;return h[3]=p,h}if(n=i.match(sb)){const o=n.slice(1,4);o[1]*=.01,o[2]*=.01;const h=fg(o);for(let p=0;p<3;p++)h[p]=ub(h[p]);return h[3]=+n[4],h}if(n=i.match(ab)){const o=n.slice(1,4);o[0]=Rn(Lr(o[0],0),0,100),o[1]=Rn(Lr(o[1],0),-125,125,!0),o[2]=Rn(Lr(o[2],0),-125,125,!0);const h=sh();_a("d50");const p=sc(Gg(o));_a(h);const b=n[4]!==void 0?+Rn(n[4],0,1):1;return p[3]=b,p}if(n=i.match(ob)){const o=n.slice(1,4);o[0]=Rn(o[0],0,100),o[1]=Rn(Lr(o[1],0),0,150,!1),o[2]=+Lr(o[2].replace("deg",""),0);const h=sh();_a("d50");const p=sc(Xg(o));_a(h);const b=n[4]!==void 0?+Rn(n[4],0,1):1;return p[3]=b,p}if(n=i.match(lb)){const o=n.slice(1,4);o[0]=Rn(Lr(o[0],0),0,1),o[1]=Rn(Lr(o[1],0),-.4,.4,!0),o[2]=Rn(Lr(o[2],0),-.4,.4,!0);const h=sc(Kg(o)),p=n[4]!==void 0?+Rn(n[4],0,1):1;return h[3]=p,h}if(n=i.match(cb)){const o=n.slice(1,4);o[0]=Rn(Lr(o[0],0),0,1),o[1]=Rn(Lr(o[1],0),0,.4,!1),o[2]=+Lr(o[2].replace("deg",""),0);const h=sc(Q1(o)),p=n[4]!==void 0?+Rn(n[4],0,1):1;return h[3]=p,h}};e0.test=i=>eb.test(i)||nb.test(i)||ab.test(i)||ob.test(i)||lb.test(i)||cb.test(i)||tb.test(i)||ib.test(i)||rb.test(i)||sb.test(i)||i==="transparent";Ye.prototype.css=function(i){return $k(this._rgb,i)};const jk=(...i)=>new Ye(...i,"css");Ti.css=jk;ri.format.css=e0;ri.autodetect.push({p:5,test:(i,...n)=>{if(!n.length&&pi(i)==="string"&&e0.test(i))return"css"}});ri.format.gl=(...i)=>{const n=si(i,"rgba");return n[0]*=255,n[1]*=255,n[2]*=255,n};const Vk=(...i)=>new Ye(...i,"gl");Ti.gl=Vk;Ye.prototype.gl=function(){const i=this._rgb;return[i[0]/255,i[1]/255,i[2]/255,i[3]]};Ye.prototype.hex=function(i){return j1(this._rgb,i)};const Uk=(...i)=>new Ye(...i,"hex");Ti.hex=Uk;ri.format.hex=$1;ri.autodetect.push({p:4,test:(i,...n)=>{if(!n.length&&pi(i)==="string"&&[3,4,5,6,7,8,9].indexOf(i.length)>=0)return"hex"}});const{log:Od}=Math,hb=i=>{const n=i/100;let o,h,p;return n<66?(o=255,h=n<6?0:-155.25485562709179-.44596950469579133*(h=n-2)+104.49216199393888*Od(h),p=n<20?0:-254.76935184120902+.8274096064007395*(p=n-10)+115.67994401066147*Od(p)):(o=351.97690566805693+.114206453784165*(o=n-55)-40.25366309332127*Od(o),h=325.4494125711974+.07943456536662342*(h=n-50)-28.0852963507957*Od(h),p=255),[o,h,p,1]},{round:Wk}=Math,qk=(...i)=>{const n=si(i,"rgb"),o=n[0],h=n[2];let p=1e3,b=4e4;const _=.4;let c;for(;b-p>_;){c=(b+p)*.5;const A=hb(c);A[2]/A[0]>=h/o?b=c:p=c}return Wk(c)};Ye.prototype.temp=Ye.prototype.kelvin=Ye.prototype.temperature=function(){return qk(this._rgb)};const xm=(...i)=>new Ye(...i,"temp");Object.assign(Ti,{temp:xm,kelvin:xm,temperature:xm});ri.format.temp=ri.format.kelvin=ri.format.temperature=hb;Ye.prototype.oklch=function(){return J1(this._rgb)};const Zk=(...i)=>new Ye(...i,"oklch");Object.assign(Ti,{oklch:Zk});ri.format.oklch=Q1;ri.autodetect.push({p:2,test:(...i)=>{if(i=si(i,"oklch"),pi(i)==="array"&&i.length===3)return"oklch"}});Object.assign(Ti,{analyze:X1,average:G5,bezier:Q5,blend:Ms,brewer:Pk,Color:Ye,colors:bc,contrast:bk,contrastAPCA:Tk,cubehelix:dk,deltaE:Ak,distance:Ik,input:ri,interpolate:xc,limits:Y1,mix:xc,random:gk,scale:Yd,scales:Ck,valid:Ek});const Ga={DARKEST_FLOOD_COLOR:"#519EA2",PMTILES_URL:"tiles.pmtiles",CONFIG:{center:[80.15,13.1],maxZoom:15,hash:!0,minZoom:12,pitch:45,antialias:!0,zoom:12.7,maxBounds:[[79.9,12.9],[80.4,13.3]]}},Gk=()=>{const i=new ES;Gd.addProtocol("pmtiles",i.tile);const n=new hg("basemap.pmtiles");return i.add(n),n},Hk=Gk(),so=vn(null);let Xk=class{constructor(){lr(this,"map");lr(this,"markers",[])}initializeLayers(){this.map&&(this.map.addSource("pmtiles-source",{type:"vector",url:`pmtiles://${Ga.PMTILES_URL}`,attribution:' <a href="https://openstreetmap.org">OpenStreetMap</a>'}),this.map.addLayer({id:"pmtiles-layer",type:"fill",source:"pmtiles-source","source-layer":"stream_influence_reclass",paint:{"fill-color":["interpolate",["linear"],["get","VALUE"],2,"#C4CDD020",3,"#abced0",4,"skyblue"],"fill-opacity":.8}},"landcover_grass"))}setupEventListeners(){this.map&&(this.map.addControl(new Gd.NavigationControl,"bottom-right"),this.map.on("click",()=>so.set(null)),so.subscribe(n=>{if(n&&this.map){const o=this.markers.find(h=>h.name===n);o&&this.map.flyTo({center:o.coordinates,zoom:14,duration:2e3})}}))}createMarker(n){if(!this.map)return;const o=n.geometry.coordinates,h=n.properties.name;this.markers.push({name:h,coordinates:o});const p=new US(this.map),b=p.onAdd();b.addEventListener("click",_=>{_.stopPropagation(),so.set(h)}),new Gd.Marker({element:b,anchor:"left",offset:[0,-10],clickTolerance:10,pitchAlignment:"viewport",rotationAlignment:"viewport"}).setLngLat(o).addTo(this.map),p.render(h)}initializeMarkers(){v1.features.reduce((o,h)=>{const p=o.findIndex(b=>b.properties.name===h.properties.name);return p===-1?o.push(h):parseInt(h.properties.date)>parseInt(o[p].properties.date)&&(o[p]=h),o},[]).forEach(o=>this.createMarker(o))}addBlinkingCircle(n){if(!this.map)return;this.map.addSource("pulse-point",{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:n},properties:{}}}),this.map.addLayer({id:"pulse-point-outer",type:"circle",source:"pulse-point",paint:{"circle-radius":15,"circle-color":Ga.DARKEST_FLOOD_COLOR,"circle-opacity":.2}}),this.map.addLayer({id:"pulse-point-inner",type:"circle",source:"pulse-point",paint:{"circle-radius":8,"circle-color":Ga.DARKEST_FLOOD_COLOR,"circle-stroke-width":2,"circle-stroke-color":"#ffffff"}});const o=3e3,h=performance.now(),p=30,b=15,_=c=>{if(!this.map)return;const A=c-h,O=A/o,B=(p-b)/2,C=b+B+B*Math.sin(O*Math.PI*6);this.map.setPaintProperty("pulse-point-outer","circle-radius",C),A<o?requestAnimationFrame(_):(this.map.getLayer("pulse-point-outer")&&this.map.removeLayer("pulse-point-outer"),this.map.getLayer("pulse-point-inner")&&this.map.removeLayer("pulse-point-inner"),this.map.getSource("pulse-point")&&this.map.removeSource("pulse-point"))};requestAnimationFrame(_)}init(n){Hk.getHeader().then(()=>{this.map=new Gd.Map({container:n,style:tS,...Ga.CONFIG}),this.map.on("load",()=>{this.initializeLayers(),this.setupEventListeners(),this.initializeMarkers()})})}cleanup(){this.map&&this.map.remove()}setLayerOpacity(n){this.map&&this.map.setPaintProperty("pmtiles-layer","fill-opacity",n)}locate(){if(!this.map)return Promise.resolve({type:"error",message:"Map not initialized"});const n=new Promise(h=>{setTimeout(()=>{h({type:"error",message:"Location request timed out. Please try again."})},5e3)}),o=new Promise(h=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(p=>{var A;const{longitude:b,latitude:_}=p.coords,c=[b,_];b>=Ga.CONFIG.maxBounds[0][0]&&b<=Ga.CONFIG.maxBounds[1][0]&&_>=Ga.CONFIG.maxBounds[0][1]&&_<=Ga.CONFIG.maxBounds[1][1]?((A=this.map)==null||A.flyTo({center:c,zoom:15,pitch:0,duration:2e3}),this.addBlinkingCircle(c),h({type:"success"})):h({type:"error",message:"We couldn't locate you, you seem to be outside the map bounds of Chennai. Bet the traffic is better."})},p=>{console.error("Error getting location:",p),h({type:"error",message:"Unable to get your location. Please check your browser permissions."})},{enableHighAccuracy:!0,timeout:8e3,maximumAge:0}):h({type:"error",message:"Geolocation is not supported by your browser"})});return Promise.race([o,n])}};/**
 * @license lucide-svelte v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yk={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Kk=Jv("<svg><!><!></svg>");function po(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]),h=Ji(o,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);un(n,!1);let p=tt(n,"name",8,void 0),b=tt(n,"color",8,"currentColor"),_=tt(n,"size",8,24),c=tt(n,"strokeWidth",8,2),A=tt(n,"absoluteStrokeWidth",8,!1),O=tt(n,"iconNode",24,()=>[]);const B=(...H)=>H.filter((ae,Z,te)=>!!ae&&te.indexOf(ae)===Z).join(" ");cn();var R=Kk();let C;var Y=pt(R);vc(Y,1,O,_c,(H,ae)=>{let Z=()=>De(ae)[0],te=()=>De(ae)[1];var ne=vi(),_e=ni(ne);IT(_e,Z,!0,(ve,Se)=>{let de;Ai(()=>de=Or(ve,de,{...te()},void 0,ve.namespaceURI===l1,ve.nodeName.includes("-")))}),rt(H,ne)});var X=Ht(Y);zi(X,n,"default",{},null),ut(R),Ai(()=>C=Or(R,C,{...Yk,...h,width:_(),height:_(),stroke:b(),"stroke-width":A()?Number(c())*24/Number(_()):c(),class:B("lucide-icon","lucide",p()?`lucide-${p()}`:"",o.class)},void 0,!0)),rt(i,R),hn()}function Jk(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]);po(i,Vr({name:"arrow-left-from-line"},()=>o,{iconNode:[["path",{d:"m9 6-6 6 6 6"}],["path",{d:"M3 12h14"}],["path",{d:"M21 19V5"}]],children:(p,b)=>{var _=vi(),c=ni(_);zi(c,n,"default",{},null),rt(p,_)},$$slots:{default:!0}}))}function Qk(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]);po(i,Vr({name:"arrow-right-from-line"},()=>o,{iconNode:[["path",{d:"M3 5v14"}],["path",{d:"M21 12H7"}],["path",{d:"m15 18 6-6-6-6"}]],children:(p,b)=>{var _=vi(),c=ni(_);zi(c,n,"default",{},null),rt(p,_)},$$slots:{default:!0}}))}function eM(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]);po(i,Vr({name:"arrow-right"},()=>o,{iconNode:[["path",{d:"M5 12h14"}],["path",{d:"m12 5 7 7-7 7"}]],children:(p,b)=>{var _=vi(),c=ni(_);zi(c,n,"default",{},null),rt(p,_)},$$slots:{default:!0}}))}function tM(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]);po(i,Vr({name:"circle-help"},()=>o,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]],children:(p,b)=>{var _=vi(),c=ni(_);zi(c,n,"default",{},null),rt(p,_)},$$slots:{default:!0}}))}function iM(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]);po(i,Vr({name:"external-link"},()=>o,{iconNode:[["path",{d:"M15 3h6v6"}],["path",{d:"M10 14 21 3"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}]],children:(p,b)=>{var _=vi(),c=ni(_);zi(c,n,"default",{},null),rt(p,_)},$$slots:{default:!0}}))}function nM(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]);po(i,Vr({name:"loader-circle"},()=>o,{iconNode:[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]],children:(p,b)=>{var _=vi(),c=ni(_);zi(c,n,"default",{},null),rt(p,_)},$$slots:{default:!0}}))}function rM(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]);po(i,Vr({name:"locate"},()=>o,{iconNode:[["line",{x1:"2",x2:"5",y1:"12",y2:"12"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22"}],["circle",{cx:"12",cy:"12",r:"7"}]],children:(p,b)=>{var _=vi(),c=ni(_);zi(c,n,"default",{},null),rt(p,_)},$$slots:{default:!0}}))}function sM(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]);po(i,Vr({name:"waves"},()=>o,{iconNode:[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"}]],children:(p,b)=>{var _=vi(),c=ni(_);zi(c,n,"default",{},null),rt(p,_)},$$slots:{default:!0}}))}var aM=Wt('<div class="bubble svelte-6l9yru"></div>'),oM=Wt('<header class="absolute top-0 left-0 right-0 w-full min-h-[60px] p-3 md:p-4 svelte-6l9yru"><div class="flex pointer-events-none justify-center items-center md:ml-0 ml-[72px] relative flex-col gap-2 svelte-6l9yru"><div class="relative max-w-[300px] bg-white px-2 flex md:flex-col gap-1 flex-row items-center md:h-full h-[66px] p-2 md:p-3 rounded-lg shadow-md overflow-hidden w-full md:w-auto svelte-6l9yru"><h1 class="font-khand-bold w-[90%] md:text-4xl text-2xl md:text-center font-bold uppercase svelte-6l9yru">Chennai Flood Simulation</h1> <p class="md:text-sm md:w-full w-[90%] text-xs md:text-center font-semibold svelte-6l9yru">Mapping where water drains and flows</p> <div class="absolute bottom-0 left-0 right-0 min-h-[3.5rem] overflow-hidden svelte-6l9yru"><div class="water-level h-full svelte-6l9yru"><div class="paper-boat svelte-6l9yru"></div></div> <div class="bubbles svelte-6l9yru"></div></div></div> <div class="w-full max-w-[300px] flex justify-end svelte-6l9yru"><button class="bg-white p-2 rounded-md shadow-md hover:bg-zinc-50 transition-colors duration-200 pointer-events-auto md:absolute md:right-0 md:top-0 svelte-6l9yru" aria-label="Show methodology"><!></button></div></div></header>');function db(i,n){un(n,!1);const o=cl(),h=30;cn();var p=oM(),b=pt(p),_=pt(b),c=Ht(pt(_),4),A=pt(c);ki(A,"style",`animation-duration: ${h}s;`);var O=Ht(A,2);vc(O,4,()=>Array(10),_c,(Y,X,H)=>{var ae=aM();ki(ae,"style",`--delay: ${H*.2}s; --position: ${Math.random()*100}%`),rt(Y,ae)}),ut(O),ut(c),ut(_);var B=Ht(_,2),R=pt(B),C=pt(R);tM(C,{class:"w-5 h-5 text-zinc-700"}),ut(R),ut(B),ut(b),ut(p),Ct("click",R,()=>o("showMethodology")),rt(i,p),hn()}function lM(i){return i[i.length-1]}function mg(i){return Object.keys(i).reduce((n,o)=>i[o]===void 0?n:n+`${o}:${i[o]};`,"")}mg({position:"absolute",opacity:0,"pointer-events":"none",margin:0,transform:"translateX(-100%)"});function cM(i){if(i!==null)return""}function C_(i){function n(o){return o(i),()=>{}}return{subscribe:n}}const Bd=i=>new Proxy(i,{get(n,o,h){return Reflect.get(n,o,h)},ownKeys(n){return Reflect.ownKeys(n).filter(o=>o!=="action")}}),P_=i=>typeof i=="function";Ja("empty");function Ja(i,n){const{stores:o,action:h,returned:p}=n??{},b=(()=>{if(o&&p)return jr(o,c=>{const A=p(c);if(P_(A)){const O=(...B)=>Bd({...A(...B),[`data-melt-${i}`]:"",action:h??On});return O.action=h??On,O}return Bd({...A,[`data-melt-${i}`]:"",action:h??On})});{const c=p,A=c==null?void 0:c();if(P_(A)){const O=(...B)=>Bd({...A(...B),[`data-melt-${i}`]:"",action:h??On});return O.action=h??On,C_(O)}return C_(Bd({...A,[`data-melt-${i}`]:"",action:h??On}))}})(),_=h??(()=>{});return _.subscribe=b.subscribe,_}function uM(i){const n=b=>b?`${i}-${b}`:i,o=b=>`data-melt-${i}${b?`-${b}`:""}`,h=b=>`[data-melt-${i}${b?`-${b}`:""}]`;return{name:n,attribute:o,selector:h,getEl:b=>document.querySelector(h(b))}}const hM=typeof document<"u",fb=i=>typeof i=="function";function t0(i){return i instanceof Element}function oo(i){return i instanceof HTMLElement}function dM(i){return i!==null&&typeof i=="object"}function fM(i){return dM(i)&&"subscribe"in i}function hc(...i){return(...n)=>{for(const o of i)typeof o=="function"&&o(...n)}}function On(){}function ma(i,n,o,h){const p=Array.isArray(n)?n:[n];return p.forEach(b=>i.addEventListener(b,o,h)),()=>{p.forEach(b=>i.removeEventListener(b,o,h))}}function Fd(i,n,o,h){const p=Array.isArray(n)?n:[n];if(typeof o=="function"){const b=mM(_=>o(_));return p.forEach(_=>i.addEventListener(_,b,h)),()=>{p.forEach(_=>i.removeEventListener(_,b,h))}}return()=>void 0}function pM(i){const n=i.currentTarget;if(!oo(n))return null;const o=new CustomEvent(`m-${i.type}`,{detail:{originalEvent:i},cancelable:!0});return n.dispatchEvent(o),o}function mM(i){return n=>{const o=pM(n);if(!(o!=null&&o.defaultPrevented))return i(n)}}const gM=i=>{try{d1(i)}catch{return i}};function pb(i,...n){const o={};for(const h of Object.keys(i))n.includes(h)||(o[h]=i[h]);return o}function gh(i){return{...i,get:()=>ot(i)}}gh.writable=function(i){const n=vn(i);let o=i;return{subscribe:n.subscribe,set(h){n.set(h),o=h},update(h){const p=h(o);n.set(p),o=p},get(){return o}}};gh.derived=function(i,n){const o=new Map,h=()=>{const b=Array.isArray(i)?i.map(_=>_.get()):i.get();return n(b)};return{get:h,subscribe:b=>{const _=[];return(Array.isArray(i)?i:[i]).forEach(A=>{_.push(A.subscribe(()=>{b(h())}))}),b(h()),o.set(b,_),()=>{const A=o.get(b);if(A)for(const O of A)O();o.delete(b)}}}};const yM=(i,n)=>{const o=gh(i),h=(b,_)=>{o.update(c=>{const A=b(c);let O=A;return n&&(O=n({curr:c,next:A})),_==null||_(O),O})};return{...o,update:h,set:b=>{h(()=>b)}}};function mb(i){return new Promise(n=>setTimeout(n,i))}let _M="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",vM=(i=21)=>{let n="",o=i|0;for(;o--;)n+=_M[Math.random()*64|0];return n};function bM(){return vM(10)}function xM(i){return i.reduce((n,o)=>(n[o]=bM(),n),{})}const Hu={ALT:"Alt",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",ARROW_UP:"ArrowUp",BACKSPACE:"Backspace",CAPS_LOCK:"CapsLock",CONTROL:"Control",DELETE:"Delete",END:"End",ENTER:"Enter",ESCAPE:"Escape",F1:"F1",F10:"F10",F11:"F11",F12:"F12",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",HOME:"Home",META:"Meta",PAGE_DOWN:"PageDown",PAGE_UP:"PageUp",SHIFT:"Shift",SPACE:" ",TAB:"Tab",CTRL:"Control",ASTERISK:"*",A:"a",P:"p"},gb=()=>typeof window<"u";function wM(){const i=navigator.userAgentData;return(i==null?void 0:i.platform)??navigator.platform}const yb=i=>gb()&&i.test(wM().toLowerCase()),TM=()=>gb()&&!!navigator.maxTouchPoints,SM=()=>yb(/^mac/)&&!TM(),kM=()=>yb(/mac|iphone|ipad|ipod/i),MM=()=>kM()&&!SM(),wm="data-melt-scroll-lock";function z_(i,n){if(!i)return;const o=i.style.cssText;return Object.assign(i.style,n),()=>{i.style.cssText=o}}function AM(i,n,o){if(!i)return;const h=i.style.getPropertyValue(n);return i.style.setProperty(n,o),()=>{h?i.style.setProperty(n,h):i.style.removeProperty(n)}}function IM(i){const n=i.getBoundingClientRect().left;return Math.round(n)+i.scrollLeft?"paddingLeft":"paddingRight"}function EM(i){const n=document,o=n.defaultView??window,{documentElement:h,body:p}=n;if(p.hasAttribute(wm))return On;p.setAttribute(wm,"");const _=o.innerWidth-h.clientWidth,c=()=>AM(h,"--scrollbar-width",`${_}px`),A=IM(h),O=o.getComputedStyle(p)[A],B=()=>z_(p,{overflow:"hidden",[A]:`calc(${O} + ${_}px)`}),R=()=>{const{scrollX:Y,scrollY:X,visualViewport:H}=o,ae=(H==null?void 0:H.offsetLeft)??0,Z=(H==null?void 0:H.offsetTop)??0,te=z_(p,{position:"fixed",overflow:"hidden",top:`${-(X-Math.floor(Z))}px`,left:`${-(Y-Math.floor(ae))}px`,right:"0",[A]:`calc(${O} + ${_}px)`});return()=>{te==null||te(),o.scrollTo(Y,X)}},C=[c(),MM()?R():B()];return()=>{C.forEach(Y=>Y==null?void 0:Y()),p.removeAttribute(wm)}}function Ko(i,n){let o;const h=jr(i,b=>{o==null||o(),o=n(b)}).subscribe(On),p=()=>{h(),o==null||o()};return gM(p),p}function D_(i){const n={};return Object.keys(i).forEach(o=>{const h=o,p=i[h];n[h]=gh(vn(p))}),n}function CM(i){let n=i.parentElement;for(;oo(n)&&!n.hasAttribute("data-portal");)n=n.parentElement;return n||"body"}function PM(i,n){return n!==void 0?n:CM(i)==="body"?document.body:null}async function L_(i){const{prop:n,defaultEl:o}=i;if(await Promise.all([mb(1),xf]),n===void 0){o==null||o.focus();return}const h=fb(n)?n(o):n;if(typeof h=="string"){const p=document.querySelector(h);if(!oo(p))return;p.focus()}else oo(h)&&h.focus()}ro(void 0,i=>{function n(h){i(h),i(void 0)}return ma(document,"pointerup",n,{passive:!1,capture:!0})});const zM=ro(void 0,i=>{function n(h){h&&h.key===Hu.ESCAPE&&i(h),i(void 0)}return ma(document,"keydown",n,{passive:!1})}),R_=(i,n={})=>{let o=On;function h(p={}){o();const b={enabled:!0,...p},_=fM(b.enabled)?b.enabled:ro(b.enabled);o=hc(zM.subscribe(c=>{var O;if(!c||!ot(_))return;const A=c.target;if(!(!oo(A)||A.closest("[data-escapee]")!==i)){if(c.preventDefault(),b.ignore){if(fb(b.ignore)){if(b.ignore(c))return}else if(Array.isArray(b.ignore)&&b.ignore.length>0&&b.ignore.some(B=>B&&A===B))return}(O=b.handler)==null||O.call(b,c)}}),Ko(_,c=>{c?i.dataset.escapee="":delete i.dataset.escapee}))}return h(n),{update:h,destroy(){i.removeAttribute("data-escapee"),o()}}};/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var _b=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],Jd=_b.join(","),vb=typeof Element>"u",nl=vb?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Qd=!vb&&Element.prototype.getRootNode?function(i){var n;return i==null||(n=i.getRootNode)===null||n===void 0?void 0:n.call(i)}:function(i){return i==null?void 0:i.ownerDocument},ef=function i(n,o){var h;o===void 0&&(o=!0);var p=n==null||(h=n.getAttribute)===null||h===void 0?void 0:h.call(n,"inert"),b=p===""||p==="true",_=b||o&&n&&i(n.parentNode);return _},DM=function(n){var o,h=n==null||(o=n.getAttribute)===null||o===void 0?void 0:o.call(n,"contenteditable");return h===""||h==="true"},bb=function(n,o,h){if(ef(n))return[];var p=Array.prototype.slice.apply(n.querySelectorAll(Jd));return o&&nl.call(n,Jd)&&p.unshift(n),p=p.filter(h),p},xb=function i(n,o,h){for(var p=[],b=Array.from(n);b.length;){var _=b.shift();if(!ef(_,!1))if(_.tagName==="SLOT"){var c=_.assignedElements(),A=c.length?c:_.children,O=i(A,!0,h);h.flatten?p.push.apply(p,O):p.push({scopeParent:_,candidates:O})}else{var B=nl.call(_,Jd);B&&h.filter(_)&&(o||!n.includes(_))&&p.push(_);var R=_.shadowRoot||typeof h.getShadowRoot=="function"&&h.getShadowRoot(_),C=!ef(R,!1)&&(!h.shadowRootFilter||h.shadowRootFilter(_));if(R&&C){var Y=i(R===!0?_.children:R.children,!0,h);h.flatten?p.push.apply(p,Y):p.push({scopeParent:_,candidates:Y})}else b.unshift.apply(b,_.children)}}return p},wb=function(n){return!isNaN(parseInt(n.getAttribute("tabindex"),10))},Qo=function(n){if(!n)throw new Error("No node provided");return n.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(n.tagName)||DM(n))&&!wb(n)?0:n.tabIndex},LM=function(n,o){var h=Qo(n);return h<0&&o&&!wb(n)?0:h},RM=function(n,o){return n.tabIndex===o.tabIndex?n.documentOrder-o.documentOrder:n.tabIndex-o.tabIndex},Tb=function(n){return n.tagName==="INPUT"},OM=function(n){return Tb(n)&&n.type==="hidden"},BM=function(n){var o=n.tagName==="DETAILS"&&Array.prototype.slice.apply(n.children).some(function(h){return h.tagName==="SUMMARY"});return o},FM=function(n,o){for(var h=0;h<n.length;h++)if(n[h].checked&&n[h].form===o)return n[h]},NM=function(n){if(!n.name)return!0;var o=n.form||Qd(n),h=function(c){return o.querySelectorAll('input[type="radio"][name="'+c+'"]')},p;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")p=h(window.CSS.escape(n.name));else try{p=h(n.name)}catch(_){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",_.message),!1}var b=FM(p,n.form);return!b||b===n},$M=function(n){return Tb(n)&&n.type==="radio"},jM=function(n){return $M(n)&&!NM(n)},VM=function(n){var o,h=n&&Qd(n),p=(o=h)===null||o===void 0?void 0:o.host,b=!1;if(h&&h!==n){var _,c,A;for(b=!!((_=p)!==null&&_!==void 0&&(c=_.ownerDocument)!==null&&c!==void 0&&c.contains(p)||n!=null&&(A=n.ownerDocument)!==null&&A!==void 0&&A.contains(n));!b&&p;){var O,B,R;h=Qd(p),p=(O=h)===null||O===void 0?void 0:O.host,b=!!((B=p)!==null&&B!==void 0&&(R=B.ownerDocument)!==null&&R!==void 0&&R.contains(p))}}return b},O_=function(n){var o=n.getBoundingClientRect(),h=o.width,p=o.height;return h===0&&p===0},UM=function(n,o){var h=o.displayCheck,p=o.getShadowRoot;if(getComputedStyle(n).visibility==="hidden")return!0;var b=nl.call(n,"details>summary:first-of-type"),_=b?n.parentElement:n;if(nl.call(_,"details:not([open]) *"))return!0;if(!h||h==="full"||h==="legacy-full"){if(typeof p=="function"){for(var c=n;n;){var A=n.parentElement,O=Qd(n);if(A&&!A.shadowRoot&&p(A)===!0)return O_(n);n.assignedSlot?n=n.assignedSlot:!A&&O!==n.ownerDocument?n=O.host:n=A}n=c}if(VM(n))return!n.getClientRects().length;if(h!=="legacy-full")return!0}else if(h==="non-zero-area")return O_(n);return!1},WM=function(n){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(n.tagName))for(var o=n.parentElement;o;){if(o.tagName==="FIELDSET"&&o.disabled){for(var h=0;h<o.children.length;h++){var p=o.children.item(h);if(p.tagName==="LEGEND")return nl.call(o,"fieldset[disabled] *")?!0:!p.contains(n)}return!0}o=o.parentElement}return!1},tf=function(n,o){return!(o.disabled||ef(o)||OM(o)||UM(o,n)||BM(o)||WM(o))},gg=function(n,o){return!(jM(o)||Qo(o)<0||!tf(n,o))},qM=function(n){var o=parseInt(n.getAttribute("tabindex"),10);return!!(isNaN(o)||o>=0)},ZM=function i(n){var o=[],h=[];return n.forEach(function(p,b){var _=!!p.scopeParent,c=_?p.scopeParent:p,A=LM(c,_),O=_?i(p.candidates):c;A===0?_?o.push.apply(o,O):o.push(c):h.push({documentOrder:b,tabIndex:A,item:p,isScope:_,content:O})}),h.sort(RM).reduce(function(p,b){return b.isScope?p.push.apply(p,b.content):p.push(b.content),p},[]).concat(o)},GM=function(n,o){o=o||{};var h;return o.getShadowRoot?h=xb([n],o.includeContainer,{filter:gg.bind(null,o),flatten:!1,getShadowRoot:o.getShadowRoot,shadowRootFilter:qM}):h=bb(n,o.includeContainer,gg.bind(null,o)),ZM(h)},HM=function(n,o){o=o||{};var h;return o.getShadowRoot?h=xb([n],o.includeContainer,{filter:tf.bind(null,o),flatten:!0,getShadowRoot:o.getShadowRoot}):h=bb(n,o.includeContainer,tf.bind(null,o)),h},ac=function(n,o){if(o=o||{},!n)throw new Error("No node provided");return nl.call(n,Jd)===!1?!1:gg(o,n)},XM=_b.concat("iframe").join(","),Tm=function(n,o){if(o=o||{},!n)throw new Error("No node provided");return nl.call(n,XM)===!1?!1:tf(o,n)};/*!
* focus-trap 7.6.2
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function yg(i,n){(n==null||n>i.length)&&(n=i.length);for(var o=0,h=Array(n);o<n;o++)h[o]=i[o];return h}function YM(i){if(Array.isArray(i))return yg(i)}function KM(i,n,o){return(n=iA(n))in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function JM(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function QM(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function B_(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);n&&(h=h.filter(function(p){return Object.getOwnPropertyDescriptor(i,p).enumerable})),o.push.apply(o,h)}return o}function F_(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?B_(Object(o),!0).forEach(function(h){KM(i,h,o[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):B_(Object(o)).forEach(function(h){Object.defineProperty(i,h,Object.getOwnPropertyDescriptor(o,h))})}return i}function eA(i){return YM(i)||JM(i)||nA(i)||QM()}function tA(i,n){if(typeof i!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var h=o.call(i,n||"default");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(i)}function iA(i){var n=tA(i,"string");return typeof n=="symbol"?n:n+""}function nA(i,n){if(i){if(typeof i=="string")return yg(i,n);var o={}.toString.call(i).slice(8,-1);return o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set"?Array.from(i):o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?yg(i,n):void 0}}var N_={activateTrap:function(n,o){if(n.length>0){var h=n[n.length-1];h!==o&&h.pause()}var p=n.indexOf(o);p===-1||n.splice(p,1),n.push(o)},deactivateTrap:function(n,o){var h=n.indexOf(o);h!==-1&&n.splice(h,1),n.length>0&&n[n.length-1].unpause()}},rA=function(n){return n.tagName&&n.tagName.toLowerCase()==="input"&&typeof n.select=="function"},sA=function(n){return(n==null?void 0:n.key)==="Escape"||(n==null?void 0:n.key)==="Esc"||(n==null?void 0:n.keyCode)===27},Qu=function(n){return(n==null?void 0:n.key)==="Tab"||(n==null?void 0:n.keyCode)===9},aA=function(n){return Qu(n)&&!n.shiftKey},oA=function(n){return Qu(n)&&n.shiftKey},$_=function(n){return setTimeout(n,0)},ju=function(n){for(var o=arguments.length,h=new Array(o>1?o-1:0),p=1;p<o;p++)h[p-1]=arguments[p];return typeof n=="function"?n.apply(void 0,h):n},Nd=function(n){return n.target.shadowRoot&&typeof n.composedPath=="function"?n.composedPath()[0]:n.target},lA=[],cA=function(n,o){var h=(o==null?void 0:o.document)||document,p=(o==null?void 0:o.trapStack)||lA,b=F_({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:aA,isKeyBackward:oA},o),_={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},c,A=function(fe,Ae,Ce){return fe&&fe[Ae]!==void 0?fe[Ae]:b[Ce||Ae]},O=function(fe,Ae){var Ce=typeof(Ae==null?void 0:Ae.composedPath)=="function"?Ae.composedPath():void 0;return _.containerGroups.findIndex(function(Ve){var Ue=Ve.container,Ge=Ve.tabbableNodes;return Ue.contains(fe)||(Ce==null?void 0:Ce.includes(Ue))||Ge.find(function(Oe){return Oe===fe})})},B=function(fe){var Ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ce=Ae.hasFallback,Ve=Ce===void 0?!1:Ce,Ue=Ae.params,Ge=Ue===void 0?[]:Ue,Oe=b[fe];if(typeof Oe=="function"&&(Oe=Oe.apply(void 0,eA(Ge))),Oe===!0&&(Oe=void 0),!Oe){if(Oe===void 0||Oe===!1)return Oe;throw new Error("`".concat(fe,"` was specified but was not a node, or did not return a node"))}var Xe=Oe;if(typeof Oe=="string"){try{Xe=h.querySelector(Oe)}catch(We){throw new Error("`".concat(fe,'` appears to be an invalid selector; error="').concat(We.message,'"'))}if(!Xe&&!Ve)throw new Error("`".concat(fe,"` as selector refers to no known node"))}return Xe},R=function(){var fe=B("initialFocus",{hasFallback:!0});if(fe===!1)return!1;if(fe===void 0||fe&&!Tm(fe,b.tabbableOptions))if(O(h.activeElement)>=0)fe=h.activeElement;else{var Ae=_.tabbableGroups[0],Ce=Ae&&Ae.firstTabbableNode;fe=Ce||B("fallbackFocus")}else fe===null&&(fe=B("fallbackFocus"));if(!fe)throw new Error("Your focus-trap needs to have at least one focusable element");return fe},C=function(){if(_.containerGroups=_.containers.map(function(fe){var Ae=GM(fe,b.tabbableOptions),Ce=HM(fe,b.tabbableOptions),Ve=Ae.length>0?Ae[0]:void 0,Ue=Ae.length>0?Ae[Ae.length-1]:void 0,Ge=Ce.find(function(We){return ac(We)}),Oe=Ce.slice().reverse().find(function(We){return ac(We)}),Xe=!!Ae.find(function(We){return Qo(We)>0});return{container:fe,tabbableNodes:Ae,focusableNodes:Ce,posTabIndexesFound:Xe,firstTabbableNode:Ve,lastTabbableNode:Ue,firstDomTabbableNode:Ge,lastDomTabbableNode:Oe,nextTabbableNode:function(Et){var Nt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,_t=Ae.indexOf(Et);return _t<0?Nt?Ce.slice(Ce.indexOf(Et)+1).find(function(Xt){return ac(Xt)}):Ce.slice(0,Ce.indexOf(Et)).reverse().find(function(Xt){return ac(Xt)}):Ae[_t+(Nt?1:-1)]}}}),_.tabbableGroups=_.containerGroups.filter(function(fe){return fe.tabbableNodes.length>0}),_.tabbableGroups.length<=0&&!B("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(_.containerGroups.find(function(fe){return fe.posTabIndexesFound})&&_.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},Y=function(fe){var Ae=fe.activeElement;if(Ae)return Ae.shadowRoot&&Ae.shadowRoot.activeElement!==null?Y(Ae.shadowRoot):Ae},X=function(fe){if(fe!==!1&&fe!==Y(document)){if(!fe||!fe.focus){X(R());return}fe.focus({preventScroll:!!b.preventScroll}),_.mostRecentlyFocusedNode=fe,rA(fe)&&fe.select()}},H=function(fe){var Ae=B("setReturnFocus",{params:[fe]});return Ae||(Ae===!1?!1:fe)},ae=function(fe){var Ae=fe.target,Ce=fe.event,Ve=fe.isBackward,Ue=Ve===void 0?!1:Ve;Ae=Ae||Nd(Ce),C();var Ge=null;if(_.tabbableGroups.length>0){var Oe=O(Ae,Ce),Xe=Oe>=0?_.containerGroups[Oe]:void 0;if(Oe<0)Ue?Ge=_.tabbableGroups[_.tabbableGroups.length-1].lastTabbableNode:Ge=_.tabbableGroups[0].firstTabbableNode;else if(Ue){var We=_.tabbableGroups.findIndex(function(ai){var fi=ai.firstTabbableNode;return Ae===fi});if(We<0&&(Xe.container===Ae||Tm(Ae,b.tabbableOptions)&&!ac(Ae,b.tabbableOptions)&&!Xe.nextTabbableNode(Ae,!1))&&(We=Oe),We>=0){var Et=We===0?_.tabbableGroups.length-1:We-1,Nt=_.tabbableGroups[Et];Ge=Qo(Ae)>=0?Nt.lastTabbableNode:Nt.lastDomTabbableNode}else Qu(Ce)||(Ge=Xe.nextTabbableNode(Ae,!1))}else{var _t=_.tabbableGroups.findIndex(function(ai){var fi=ai.lastTabbableNode;return Ae===fi});if(_t<0&&(Xe.container===Ae||Tm(Ae,b.tabbableOptions)&&!ac(Ae,b.tabbableOptions)&&!Xe.nextTabbableNode(Ae))&&(_t=Oe),_t>=0){var Xt=_t===_.tabbableGroups.length-1?0:_t+1,$t=_.tabbableGroups[Xt];Ge=Qo(Ae)>=0?$t.firstTabbableNode:$t.firstDomTabbableNode}else Qu(Ce)||(Ge=Xe.nextTabbableNode(Ae))}}else Ge=B("fallbackFocus");return Ge},Z=function(fe){var Ae=Nd(fe);if(!(O(Ae,fe)>=0)){if(ju(b.clickOutsideDeactivates,fe)){c.deactivate({returnFocus:b.returnFocusOnDeactivate});return}ju(b.allowOutsideClick,fe)||fe.preventDefault()}},te=function(fe){var Ae=Nd(fe),Ce=O(Ae,fe)>=0;if(Ce||Ae instanceof Document)Ce&&(_.mostRecentlyFocusedNode=Ae);else{fe.stopImmediatePropagation();var Ve,Ue=!0;if(_.mostRecentlyFocusedNode)if(Qo(_.mostRecentlyFocusedNode)>0){var Ge=O(_.mostRecentlyFocusedNode),Oe=_.containerGroups[Ge].tabbableNodes;if(Oe.length>0){var Xe=Oe.findIndex(function(We){return We===_.mostRecentlyFocusedNode});Xe>=0&&(b.isKeyForward(_.recentNavEvent)?Xe+1<Oe.length&&(Ve=Oe[Xe+1],Ue=!1):Xe-1>=0&&(Ve=Oe[Xe-1],Ue=!1))}}else _.containerGroups.some(function(We){return We.tabbableNodes.some(function(Et){return Qo(Et)>0})})||(Ue=!1);else Ue=!1;Ue&&(Ve=ae({target:_.mostRecentlyFocusedNode,isBackward:b.isKeyBackward(_.recentNavEvent)})),X(Ve||_.mostRecentlyFocusedNode||R())}_.recentNavEvent=void 0},ne=function(fe){var Ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;_.recentNavEvent=fe;var Ce=ae({event:fe,isBackward:Ae});Ce&&(Qu(fe)&&fe.preventDefault(),X(Ce))},_e=function(fe){(b.isKeyForward(fe)||b.isKeyBackward(fe))&&ne(fe,b.isKeyBackward(fe))},ve=function(fe){sA(fe)&&ju(b.escapeDeactivates,fe)!==!1&&(fe.preventDefault(),c.deactivate())},Se=function(fe){var Ae=Nd(fe);O(Ae,fe)>=0||ju(b.clickOutsideDeactivates,fe)||ju(b.allowOutsideClick,fe)||(fe.preventDefault(),fe.stopImmediatePropagation())},de=function(){if(_.active)return N_.activateTrap(p,c),_.delayInitialFocusTimer=b.delayInitialFocus?$_(function(){X(R())}):X(R()),h.addEventListener("focusin",te,!0),h.addEventListener("mousedown",Z,{capture:!0,passive:!1}),h.addEventListener("touchstart",Z,{capture:!0,passive:!1}),h.addEventListener("click",Se,{capture:!0,passive:!1}),h.addEventListener("keydown",_e,{capture:!0,passive:!1}),h.addEventListener("keydown",ve),c},Fe=function(){if(_.active)return h.removeEventListener("focusin",te,!0),h.removeEventListener("mousedown",Z,!0),h.removeEventListener("touchstart",Z,!0),h.removeEventListener("click",Se,!0),h.removeEventListener("keydown",_e,!0),h.removeEventListener("keydown",ve),c},Re=function(fe){var Ae=fe.some(function(Ce){var Ve=Array.from(Ce.removedNodes);return Ve.some(function(Ue){return Ue===_.mostRecentlyFocusedNode})});Ae&&X(R())},Le=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(Re):void 0,Te=function(){Le&&(Le.disconnect(),_.active&&!_.paused&&_.containers.map(function(fe){Le.observe(fe,{subtree:!0,childList:!0})}))};return c={get active(){return _.active},get paused(){return _.paused},activate:function(fe){if(_.active)return this;var Ae=A(fe,"onActivate"),Ce=A(fe,"onPostActivate"),Ve=A(fe,"checkCanFocusTrap");Ve||C(),_.active=!0,_.paused=!1,_.nodeFocusedBeforeActivation=h.activeElement,Ae==null||Ae();var Ue=function(){Ve&&C(),de(),Te(),Ce==null||Ce()};return Ve?(Ve(_.containers.concat()).then(Ue,Ue),this):(Ue(),this)},deactivate:function(fe){if(!_.active)return this;var Ae=F_({onDeactivate:b.onDeactivate,onPostDeactivate:b.onPostDeactivate,checkCanReturnFocus:b.checkCanReturnFocus},fe);clearTimeout(_.delayInitialFocusTimer),_.delayInitialFocusTimer=void 0,Fe(),_.active=!1,_.paused=!1,Te(),N_.deactivateTrap(p,c);var Ce=A(Ae,"onDeactivate"),Ve=A(Ae,"onPostDeactivate"),Ue=A(Ae,"checkCanReturnFocus"),Ge=A(Ae,"returnFocus","returnFocusOnDeactivate");Ce==null||Ce();var Oe=function(){$_(function(){Ge&&X(H(_.nodeFocusedBeforeActivation)),Ve==null||Ve()})};return Ge&&Ue?(Ue(H(_.nodeFocusedBeforeActivation)).then(Oe,Oe),this):(Oe(),this)},pause:function(fe){if(_.paused||!_.active)return this;var Ae=A(fe,"onPause"),Ce=A(fe,"onPostPause");return _.paused=!0,Ae==null||Ae(),Fe(),Te(),Ce==null||Ce(),this},unpause:function(fe){if(!_.paused||!_.active)return this;var Ae=A(fe,"onUnpause"),Ce=A(fe,"onPostUnpause");return _.paused=!1,Ae==null||Ae(),C(),de(),Te(),Ce==null||Ce(),this},updateContainerElements:function(fe){var Ae=[].concat(fe).filter(Boolean);return _.containers=Ae.map(function(Ce){return typeof Ce=="string"?h.querySelector(Ce):Ce}),_.active&&C(),Te(),this}},c.updateContainerElements(n),c};function uA(i={}){let n;const{immediate:o,...h}=i,p=vn(!1),b=vn(!1),_=R=>n==null?void 0:n.activate(R),c=R=>{n==null||n.deactivate(R)},A=()=>{n&&(n.pause(),b.set(!0))},O=()=>{n&&(n.unpause(),b.set(!1))};return{useFocusTrap:R=>(n=cA(R,{...h,onActivate(){var C;p.set(!0),(C=i.onActivate)==null||C.call(i)},onDeactivate(){var C;p.set(!1),(C=i.onDeactivate)==null||C.call(i)}}),o&&_(),{destroy(){c(),n=void 0}}),hasFocus:u_(p),isPaused:u_(b),activate:_,deactivate:c,pause:A,unpause:O}}const $d=[],hA=(i,n)=>{let o=On;function h(){const b=$d.indexOf(i);b>=0&&$d.splice(b,1)}function p(b){o();const{open:_,onClose:c,shouldCloseOnInteractOutside:A,closeOnInteractOutside:O}=b;mb(100).then(()=>{_?$d.push(i):h()});function B(){return lM($d)===i}function R(){B()&&c&&(c(),h())}function C(X){const H=X.target;t0(H)&&H&&B()&&(X.preventDefault(),X.stopPropagation(),X.stopImmediatePropagation())}function Y(X){A!=null&&A(X)&&B()&&(X.preventDefault(),X.stopPropagation(),X.stopImmediatePropagation(),R())}o=fA(i,{onInteractOutsideStart:C,onInteractOutside:O?Y:void 0,enabled:_}).destroy}return p(n),{update:p,destroy(){h(),o()}}},dA=(i,n="body")=>{let o;if(!oo(n)&&typeof n!="string")return{destroy:On};async function h(b){if(n=b,typeof n=="string"){if(o=document.querySelector(n),o===null&&(await xf(),o=document.querySelector(n)),o===null)throw new Error(`No element found matching css selector: "${n}"`)}else if(n instanceof HTMLElement)o=n;else throw new TypeError(`Unknown portal target type: ${n===null?"null":typeof n}. Allowed types: string (CSS selector) or HTMLElement.`);i.dataset.portal="",o.appendChild(i),i.hidden=!1}function p(){i.remove()}return h(n),{update:h,destroy:p}},fA=(i,n)=>{let o=On,h=On,p=!1,b=!1,_=!1;function c(B){o(),h();const{onInteractOutside:R,onInteractOutsideStart:C,enabled:Y}=B;if(!Y)return;function X(Z){R&&j_(Z,i)&&(C==null||C(Z));const te=Z.target;t0(te)&&Sb(i,te)&&(b=!0),p=!0}function H(Z){R==null||R(Z)}const ae=pA(i);if(typeof PointerEvent<"u"){const Z=te=>{h();const ne=_e=>{A(_e)&&H(_e),O()};if(te.pointerType==="touch"){h=ma(ae,"click",ne,{capture:!0,once:!0});return}ne(te)};o=hc(ma(ae,"pointerdown",X,!0),ma(ae,"pointerup",Z,!0))}else{const Z=ne=>{_?_=!1:A(ne)&&H(ne),O()},te=ne=>{_=!0,A(ne)&&H(ne),O()};o=hc(ma(ae,"mousedown",X,!0),ma(ae,"mouseup",Z,!0),ma(ae,"touchstart",X,!0),ma(ae,"touchend",te,!0))}}function A(B){return!!(p&&!b&&j_(B,i))}function O(){p=!1,b=!1}return c(n),{update:c,destroy(){o(),h()}}};function j_(i,n){if("button"in i&&i.button>0)return!1;const o=i.target;if(!t0(o))return!1;const h=o.ownerDocument;return!h||!h.documentElement.contains(o)?!1:n&&!Sb(n,o)}function Sb(i,n){return i===n||i.contains(n)}function pA(i){return(i==null?void 0:i.ownerDocument)??document}ro(!1),ro(!1),ro(void 0);const mA={isDateDisabled:void 0,isDateUnavailable:void 0,value:void 0,preventDeselect:!1,numberOfMonths:1,pagedNavigation:!1,weekStartsOn:0,fixedWeeks:!1,calendarLabel:"Event Date",locale:"en",minValue:void 0,maxValue:void 0,disabled:!1,readonly:!1,weekdayFormat:"narrow"};({...pb(mA,"isDateDisabled","isDateUnavailable","value","locale","disabled","readonly","minValue","maxValue","weekdayFormat")});const{name:Xo}=uM("dialog"),gA={preventScroll:!0,closeOnEscape:!0,closeOnOutsideClick:!0,role:"dialog",defaultOpen:!1,portal:void 0,forceVisible:!1,openFocus:void 0,closeFocus:void 0,onOutsideClick:void 0},yA=["content","title","description"];function _A(i){const n={...gA,...i},o=D_(pb(n,"ids")),{preventScroll:h,closeOnEscape:p,closeOnOutsideClick:b,role:_,portal:c,forceVisible:A,openFocus:O,closeFocus:B,onOutsideClick:R}=o,C=gh.writable(null),Y=D_({...xM(yA),...n.ids}),X=n.open??vn(n.defaultOpen),H=yM(X,n==null?void 0:n.onOpenChange),ae=jr([H,A],([Te,we])=>Te||we);let Z=On;function te(Te){const we=Te.currentTarget,fe=Te.currentTarget;!oo(we)||!oo(fe)||(H.set(!0),C.set(fe))}function ne(){H.set(!1),L_({prop:B.get(),defaultEl:C.get()})}const _e=Ja(Xo("trigger"),{stores:[H],returned:([Te])=>({"aria-haspopup":"dialog","aria-expanded":Te,type:"button"}),action:Te=>({destroy:hc(Fd(Te,"click",fe=>{te(fe)}),Fd(Te,"keydown",fe=>{fe.key!==Hu.ENTER&&fe.key!==Hu.SPACE||(fe.preventDefault(),te(fe))}))})}),ve=Ja(Xo("overlay"),{stores:[ae,H],returned:([Te,we])=>({hidden:Te?void 0:!0,tabindex:-1,style:mg({display:Te?void 0:"none"}),"aria-hidden":!0,"data-state":we?"open":"closed"}),action:Te=>{let we=On;return p.get()&&(we=R_(Te,{handler:()=>{ne()}}).destroy),{destroy(){we()}}}}),Se=Ja(Xo("content"),{stores:[ae,Y.content,Y.description,Y.title,H],returned:([Te,we,fe,Ae,Ce])=>({id:we,role:_.get(),"aria-describedby":fe,"aria-labelledby":Ae,"aria-modal":Te?"true":void 0,"data-state":Ce?"open":"closed",tabindex:-1,hidden:Te?void 0:!0,style:mg({display:Te?void 0:"none"})}),action:Te=>{let we=On,fe=On;const Ae=hc(Ko([H,b,p],([Ce,Ve,Ue])=>{if(!Ce)return;const Ge=uA({immediate:!1,escapeDeactivates:Ue,clickOutsideDeactivates:Ve,allowOutsideClick:!0,returnFocusOnDeactivate:!1,fallbackFocus:Te});we=Ge.activate,fe=Ge.deactivate;const Oe=Ge.useFocusTrap(Te);return Oe&&Oe.destroy?Oe.destroy:Ge.deactivate}),Ko([b,H],([Ce,Ve])=>hA(Te,{open:Ve,closeOnInteractOutside:Ce,onClose(){ne()},shouldCloseOnInteractOutside(Ue){var Ge;return(Ge=R.get())==null||Ge(Ue),!Ue.defaultPrevented}}).destroy),Ko([p],([Ce])=>Ce?R_(Te,{handler:ne}).destroy:On),Ko([ae],([Ce])=>{xf().then(()=>{Ce?we():fe()})}));return{destroy:()=>{Z(),Ae()}}}}),de=Ja(Xo("portalled"),{stores:c,returned:Te=>({"data-portal":cM(Te)}),action:Te=>{const we=Ko([c],([fe])=>{if(fe===null)return On;const Ae=PM(Te,fe);return Ae===null?On:dA(Te,Ae).destroy});return{destroy(){we()}}}}),Fe=Ja(Xo("title"),{stores:[Y.title],returned:([Te])=>({id:Te})}),Re=Ja(Xo("description"),{stores:[Y.description],returned:([Te])=>({id:Te})}),Le=Ja(Xo("close"),{returned:()=>({type:"button"}),action:Te=>({destroy:hc(Fd(Te,"click",()=>{ne()}),Fd(Te,"keydown",fe=>{fe.key!==Hu.SPACE&&fe.key!==Hu.ENTER||(fe.preventDefault(),ne())}))})});return Ko([H,h],([Te,we])=>{if(hM){if(we&&Te&&(Z=EM()),Te){const fe=document.getElementById(Y.content.get());L_({prop:O.get(),defaultEl:fe})}return()=>{A.get()||Z()}}}),{ids:Y,elements:{content:Se,trigger:_e,title:Fe,description:Re,overlay:ve,close:Le,portalled:de},states:{open:H},options:o}}function vA(i,n){const o={};return n.forEach(h=>{o[h]={[`data-${i}-${h}`]:""}}),h=>o[h]}function bA(){const i=cl();return n=>{const{originalEvent:o}=n.detail,{cancelable:h}=n,p=o.type;i(p,{originalEvent:o,currentTarget:o.currentTarget},{cancelable:h})||n.preventDefault()}}function xA(i){const n={};for(const o in i){const h=i[o];h!==void 0&&(n[o]=h)}return n}function wA(i){return function(n,o){if(o===void 0)return;const h=i[n];h&&h.set(o)}}function kb(){return{NAME:"dialog",PARTS:["close","content","description","overlay","portal","title","trigger"]}}function TA(i){const{NAME:n,PARTS:o}=kb(),h=vA(n,o),p={..._A({...xA(i),role:"dialog",forceVisible:!0}),getAttrs:h};return u1(n,p),{...p,updateOption:wA(p.options)}}function Sf(){const{NAME:i}=kb();return Wg(i)}function SA(i,n){un(n,!1);const o=As(),h=()=>kn(ae,"$idValues",o);let p=tt(n,"preventScroll",24,()=>{}),b=tt(n,"closeOnEscape",24,()=>{}),_=tt(n,"closeOnOutsideClick",24,()=>{}),c=tt(n,"portal",24,()=>{}),A=tt(n,"open",28,()=>{}),O=tt(n,"onOpenChange",24,()=>{}),B=tt(n,"openFocus",24,()=>{}),R=tt(n,"closeFocus",24,()=>{}),C=tt(n,"onOutsideClick",24,()=>{});const{states:{open:Y},updateOption:X,ids:H}=TA({closeOnEscape:b(),preventScroll:p(),closeOnOutsideClick:_(),portal:c(),forceVisible:!0,defaultOpen:A(),openFocus:B(),closeFocus:R(),onOutsideClick:C(),onOpenChange:({next:ne})=>{var _e;return A()!==ne&&((_e=O())==null||_e(ne),A(ne)),ne}}),ae=jr([H.content,H.description,H.title],([ne,_e,ve])=>({content:ne,description:_e,title:ve}));ei(()=>Mi(A()),()=>{A()!==void 0&&Y.set(A())}),ei(()=>Mi(p()),()=>{X("preventScroll",p())}),ei(()=>Mi(b()),()=>{X("closeOnEscape",b())}),ei(()=>Mi(_()),()=>{X("closeOnOutsideClick",_())}),ei(()=>Mi(c()),()=>{X("portal",c())}),ei(()=>Mi(B()),()=>{X("openFocus",B())}),ei(()=>Mi(R()),()=>{X("closeFocus",R())}),ei(()=>Mi(C()),()=>{X("onOutsideClick",C())}),Br(),cn();var Z=vi(),te=ni(Z);zi(te,n,"default",{get ids(){return h()}},null),rt(i,Z),hn()}var kA=Wt("<div><!></div>");function MA(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]),h=Ji(o,["asChild","el"]);un(n,!1);const p=As(),b=()=>kn(O,"$portalled",p),_=qi();let c=tt(n,"asChild",8,!1),A=tt(n,"el",28,()=>{});const{elements:{portalled:O},getAttrs:B}=Sf(),R=B("portal");ei(()=>b(),()=>{di(_,b())}),ei(()=>De(_),()=>{Object.assign(De(_),R)}),Br(),cn();var C=vi(),Y=ni(C);{var X=ae=>{var Z=vi(),te=ni(Z);zi(te,n,"default",{get builder(){return De(_)}},null),rt(ae,Z)},H=ae=>{var Z=kA();let te;var ne=pt(Z);zi(ne,n,"default",{get builder(){return De(_)}},null),ut(Z),Rr(Z,_e=>A(_e),()=>A()),Tr(Z,_e=>{var ve,Se;return(Se=(ve=De(_)).action)==null?void 0:Se.call(ve,_e)}),Ai(()=>te=Or(Z,te,{...De(_),...h})),rt(ae,Z)};ji(Y,ae=>{c()?ae(X):ae(H,!1)})}rt(i,C),hn()}var AA=Wt("<div><!></div>"),IA=Wt("<div><!></div>"),EA=Wt("<div><!></div>"),CA=Wt("<div><!></div>"),PA=Wt("<div><!></div>");function zA(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]),h=Ji(o,["transition","transitionConfig","inTransition","inTransitionConfig","outTransition","outTransitionConfig","asChild","id","el"]);un(n,!1);const p=As(),b=()=>kn(Z,"$content",p),_=()=>kn(te,"$open",p),c=qi();let A=tt(n,"transition",24,()=>{}),O=tt(n,"transitionConfig",24,()=>{}),B=tt(n,"inTransition",24,()=>{}),R=tt(n,"inTransitionConfig",24,()=>{}),C=tt(n,"outTransition",24,()=>{}),Y=tt(n,"outTransitionConfig",24,()=>{}),X=tt(n,"asChild",8,!1),H=tt(n,"id",24,()=>{}),ae=tt(n,"el",28,()=>{});const{elements:{content:Z},states:{open:te},ids:ne,getAttrs:_e}=Sf(),ve=_e("content");ei(()=>Mi(H()),()=>{H()&&ne.content.set(H())}),ei(()=>b(),()=>{di(c,b())}),ei(()=>De(c),()=>{Object.assign(De(c),ve)}),Br(),cn();var Se=vi(),de=ni(Se);{var Fe=Le=>{var Te=vi(),we=ni(Te);zi(we,n,"default",{get builder(){return De(c)}},null),rt(Le,Te)},Re=Le=>{var Te=vi(),we=ni(Te);{var fe=Ce=>{var Ve=AA();let Ue;var Ge=pt(Ve);zi(Ge,n,"default",{get builder(){return De(c)}},null),ut(Ve),Rr(Ve,Oe=>ae(Oe),()=>ae()),Tr(Ve,Oe=>{var Xe,We;return(We=(Xe=De(c)).action)==null?void 0:We.call(Xe,Oe)}),Lt(()=>Ct("pointerdown",Ve,function(Oe){Ft.call(this,n,Oe)})),Lt(()=>Ct("pointermove",Ve,function(Oe){Ft.call(this,n,Oe)})),Lt(()=>Ct("pointerup",Ve,function(Oe){Ft.call(this,n,Oe)})),Lt(()=>Ct("touchcancel",Ve,function(Oe){Ft.call(this,n,Oe)})),Lt(()=>Ct("touchend",Ve,function(Oe){Ft.call(this,n,Oe)})),Lt(()=>Ct("touchmove",Ve,function(Oe){Ft.call(this,n,Oe)},void 0,!1)),Lt(()=>Ct("touchstart",Ve,function(Oe){Ft.call(this,n,Oe)},void 0,!1)),Ai(()=>Ue=Or(Ve,Ue,{...De(c),...h})),Vn(3,Ve,A,O),rt(Ce,Ve)},Ae=Ce=>{var Ve=vi(),Ue=ni(Ve);{var Ge=Xe=>{var We=IA();let Et;var Nt=pt(We);zi(Nt,n,"default",{get builder(){return De(c)}},null),ut(We),Rr(We,_t=>ae(_t),()=>ae()),Tr(We,_t=>{var Xt,$t;return($t=(Xt=De(c)).action)==null?void 0:$t.call(Xt,_t)}),Lt(()=>Ct("pointerdown",We,function(_t){Ft.call(this,n,_t)})),Lt(()=>Ct("pointermove",We,function(_t){Ft.call(this,n,_t)})),Lt(()=>Ct("pointerup",We,function(_t){Ft.call(this,n,_t)})),Lt(()=>Ct("touchcancel",We,function(_t){Ft.call(this,n,_t)})),Lt(()=>Ct("touchend",We,function(_t){Ft.call(this,n,_t)})),Lt(()=>Ct("touchmove",We,function(_t){Ft.call(this,n,_t)},void 0,!1)),Lt(()=>Ct("touchstart",We,function(_t){Ft.call(this,n,_t)},void 0,!1)),Ai(()=>Et=Or(We,Et,{...De(c),...h})),Vn(1,We,B,R),Vn(2,We,C,Y),rt(Xe,We)},Oe=Xe=>{var We=vi(),Et=ni(We);{var Nt=Xt=>{var $t=EA();let ai;var fi=pt($t);zi(fi,n,"default",{get builder(){return De(c)}},null),ut($t),Rr($t,qt=>ae(qt),()=>ae()),Tr($t,qt=>{var bi,Yt;return(Yt=(bi=De(c)).action)==null?void 0:Yt.call(bi,qt)}),Lt(()=>Ct("pointerdown",$t,function(qt){Ft.call(this,n,qt)})),Lt(()=>Ct("pointermove",$t,function(qt){Ft.call(this,n,qt)})),Lt(()=>Ct("pointerup",$t,function(qt){Ft.call(this,n,qt)})),Lt(()=>Ct("touchcancel",$t,function(qt){Ft.call(this,n,qt)})),Lt(()=>Ct("touchend",$t,function(qt){Ft.call(this,n,qt)})),Lt(()=>Ct("touchmove",$t,function(qt){Ft.call(this,n,qt)},void 0,!1)),Lt(()=>Ct("touchstart",$t,function(qt){Ft.call(this,n,qt)},void 0,!1)),Ai(()=>ai=Or($t,ai,{...De(c),...h})),Vn(1,$t,B,R),rt(Xt,$t)},_t=Xt=>{var $t=vi(),ai=ni($t);{var fi=bi=>{var Yt=CA();let Oi;var Qi=pt(Yt);zi(Qi,n,"default",{get builder(){return De(c)}},null),ut(Yt),Rr(Yt,hi=>ae(hi),()=>ae()),Tr(Yt,hi=>{var xi,Me;return(Me=(xi=De(c)).action)==null?void 0:Me.call(xi,hi)}),Lt(()=>Ct("pointerdown",Yt,function(hi){Ft.call(this,n,hi)})),Lt(()=>Ct("pointermove",Yt,function(hi){Ft.call(this,n,hi)})),Lt(()=>Ct("pointerup",Yt,function(hi){Ft.call(this,n,hi)})),Lt(()=>Ct("touchcancel",Yt,function(hi){Ft.call(this,n,hi)})),Lt(()=>Ct("touchend",Yt,function(hi){Ft.call(this,n,hi)})),Lt(()=>Ct("touchmove",Yt,function(hi){Ft.call(this,n,hi)},void 0,!1)),Lt(()=>Ct("touchstart",Yt,function(hi){Ft.call(this,n,hi)},void 0,!1)),Ai(()=>Oi=Or(Yt,Oi,{...De(c),...h})),Vn(2,Yt,C,Y),rt(bi,Yt)},qt=bi=>{var Yt=vi(),Oi=ni(Yt);{var Qi=hi=>{var xi=PA();let Me;var dn=pt(xi);zi(dn,n,"default",{get builder(){return De(c)}},null),ut(xi),Rr(xi,Ii=>ae(Ii),()=>ae()),Tr(xi,Ii=>{var Kt,Ei;return(Ei=(Kt=De(c)).action)==null?void 0:Ei.call(Kt,Ii)}),Lt(()=>Ct("pointerdown",xi,function(Ii){Ft.call(this,n,Ii)})),Lt(()=>Ct("pointermove",xi,function(Ii){Ft.call(this,n,Ii)})),Lt(()=>Ct("pointerup",xi,function(Ii){Ft.call(this,n,Ii)})),Lt(()=>Ct("touchcancel",xi,function(Ii){Ft.call(this,n,Ii)})),Lt(()=>Ct("touchend",xi,function(Ii){Ft.call(this,n,Ii)})),Lt(()=>Ct("touchmove",xi,function(Ii){Ft.call(this,n,Ii)},void 0,!1)),Lt(()=>Ct("touchstart",xi,function(Ii){Ft.call(this,n,Ii)},void 0,!1)),Ai(()=>Me=Or(xi,Me,{...De(c),...h})),rt(hi,xi)};ji(Oi,hi=>{_()&&hi(Qi)},!0)}rt(bi,Yt)};ji(ai,bi=>{C()&&_()?bi(fi):bi(qt,!1)},!0)}rt(Xt,$t)};ji(Et,Xt=>{B()&&_()?Xt(Nt):Xt(_t,!1)},!0)}rt(Xe,We)};ji(Ue,Xe=>{B()&&C()&&_()?Xe(Ge):Xe(Oe,!1)},!0)}rt(Ce,Ve)};ji(we,Ce=>{A()&&_()?Ce(fe):Ce(Ae,!1)},!0)}rt(Le,Te)};ji(de,Le=>{X()&&_()?Le(Fe):Le(Re,!1)})}rt(i,Se),hn()}var DA=Wt("<div></div>"),LA=Wt("<div></div>"),RA=Wt("<div></div>"),OA=Wt("<div></div>"),BA=Wt("<div></div>");function FA(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]),h=Ji(o,["transition","transitionConfig","inTransition","inTransitionConfig","outTransition","outTransitionConfig","asChild","el"]);un(n,!1);const p=As(),b=()=>kn(ae,"$overlay",p),_=()=>kn(Z,"$open",p),c=qi();let A=tt(n,"transition",24,()=>{}),O=tt(n,"transitionConfig",24,()=>{}),B=tt(n,"inTransition",24,()=>{}),R=tt(n,"inTransitionConfig",24,()=>{}),C=tt(n,"outTransition",24,()=>{}),Y=tt(n,"outTransitionConfig",24,()=>{}),X=tt(n,"asChild",8,!1),H=tt(n,"el",28,()=>{});const{elements:{overlay:ae},states:{open:Z},getAttrs:te}=Sf(),ne=te("overlay");ei(()=>b(),()=>{di(c,b())}),ei(()=>De(c),()=>{Object.assign(De(c),ne)}),Br(),cn();var _e=vi(),ve=ni(_e);{var Se=Fe=>{var Re=vi(),Le=ni(Re);zi(Le,n,"default",{get builder(){return De(c)}},null),rt(Fe,Re)},de=Fe=>{var Re=vi(),Le=ni(Re);{var Te=fe=>{var Ae=DA();let Ce;Lt(()=>Ct("mouseup",Ae,function(Ve){Ft.call(this,n,Ve)})),Rr(Ae,Ve=>H(Ve),()=>H()),Tr(Ae,Ve=>{var Ue,Ge;return(Ge=(Ue=De(c)).action)==null?void 0:Ge.call(Ue,Ve)}),Ai(()=>Ce=Or(Ae,Ce,{...De(c),...h})),Vn(3,Ae,A,O),rt(fe,Ae)},we=fe=>{var Ae=vi(),Ce=ni(Ae);{var Ve=Ge=>{var Oe=LA();let Xe;Rr(Oe,We=>H(We),()=>H()),Tr(Oe,We=>{var Et,Nt;return(Nt=(Et=De(c)).action)==null?void 0:Nt.call(Et,We)}),Lt(()=>Ct("mouseup",Oe,function(We){Ft.call(this,n,We)})),Ai(()=>Xe=Or(Oe,Xe,{...De(c),...h})),Vn(1,Oe,B,R),Vn(2,Oe,C,Y),rt(Ge,Oe)},Ue=Ge=>{var Oe=vi(),Xe=ni(Oe);{var We=Nt=>{var _t=RA();let Xt;Rr(_t,$t=>H($t),()=>H()),Tr(_t,$t=>{var ai,fi;return(fi=(ai=De(c)).action)==null?void 0:fi.call(ai,$t)}),Lt(()=>Ct("mouseup",_t,function($t){Ft.call(this,n,$t)})),Ai(()=>Xt=Or(_t,Xt,{...De(c),...h})),Vn(1,_t,B,R),rt(Nt,_t)},Et=Nt=>{var _t=vi(),Xt=ni(_t);{var $t=fi=>{var qt=OA();let bi;Rr(qt,Yt=>H(Yt),()=>H()),Tr(qt,Yt=>{var Oi,Qi;return(Qi=(Oi=De(c)).action)==null?void 0:Qi.call(Oi,Yt)}),Lt(()=>Ct("mouseup",qt,function(Yt){Ft.call(this,n,Yt)})),Ai(()=>bi=Or(qt,bi,{...De(c),...h})),Vn(2,qt,C,Y),rt(fi,qt)},ai=fi=>{var qt=vi(),bi=ni(qt);{var Yt=Oi=>{var Qi=BA();let hi;Rr(Qi,xi=>H(xi),()=>H()),Tr(Qi,xi=>{var Me,dn;return(dn=(Me=De(c)).action)==null?void 0:dn.call(Me,xi)}),Lt(()=>Ct("mouseup",Qi,function(xi){Ft.call(this,n,xi)})),Ai(()=>hi=Or(Qi,hi,{...De(c),...h})),rt(Oi,Qi)};ji(bi,Oi=>{_()&&Oi(Yt)},!0)}rt(fi,qt)};ji(Xt,fi=>{C()&&_()?fi($t):fi(ai,!1)},!0)}rt(Nt,_t)};ji(Xe,Nt=>{B()&&_()?Nt(We):Nt(Et,!1)},!0)}rt(Ge,Oe)};ji(Ce,Ge=>{B()&&C()&&_()?Ge(Ve):Ge(Ue,!1)},!0)}rt(fe,Ae)};ji(Le,fe=>{A()&&_()?fe(Te):fe(we,!1)},!0)}rt(Fe,Re)};ji(ve,Fe=>{X()&&_()?Fe(Se):Fe(de,!1)})}rt(i,_e),hn()}var NA=Wt("<button><!></button>");function V_(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]),h=Ji(o,["asChild","el"]);un(n,!1);const p=As(),b=()=>kn(O,"$trigger",p),_=qi();let c=tt(n,"asChild",8,!1),A=tt(n,"el",28,()=>{});const{elements:{trigger:O},getAttrs:B}=Sf(),R=bA(),C=B("trigger");ei(()=>b(),()=>{di(_,b())}),ei(()=>De(_),()=>{Object.assign(De(_),C)}),Br(),cn();var Y=vi(),X=ni(Y);{var H=Z=>{var te=vi(),ne=ni(te);zi(ne,n,"default",{get builder(){return De(_)}},null),rt(Z,te)},ae=Z=>{var te=NA();let ne;var _e=pt(te);zi(_e,n,"default",{get builder(){return De(_)}},null),ut(te),Rr(te,ve=>A(ve),()=>A()),Tr(te,ve=>{var Se,de;return(de=(Se=De(_)).action)==null?void 0:de.call(Se,ve)}),Lt(()=>Ct("m-click",te,R)),Lt(()=>Ct("m-keydown",te,R)),Ai(()=>ne=Or(te,ne,{...De(_),type:"button",...h})),rt(Z,te)};ji(X,Z=>{c()?Z(H):Z(ae,!1)})}rt(i,Y),hn()}function $A(i){return function(n,o){if(o===void 0)return;const h=i[n];h&&h.set(o)}}const tn={DURATION:.5,EASE:[.32,.72,0,1]},Mb=.4;function Ss(i,n){if(typeof document>"u")return()=>{};const o=jA(i,(h,p)=>({stores:h,onUnsubscribe:p})).subscribe(({stores:h,onUnsubscribe:p})=>{const b=n(h);b&&p(b)});return Ab(o),o}function jA(i,n){let o=[];const h=c=>{o.push(c)},p=()=>{o.forEach(c=>c()),o=[]},b=jr(i,c=>(p(),n(c,h)));return Ab(p),{...b,subscribe:(...c)=>{const A=b.subscribe(...c);return()=>{A(),p()}}}}const Ab=i=>{try{d1(i)}catch{return i()}},U_=(i,n)=>{const o=(p,b)=>{i.update(_=>{const c=p(_);let A=c;return n&&(A=n({curr:_,next:c})),b==null||b(A),A})};return{...i,update:o,set:p=>{o(()=>p)}}};function VA(i){const n={};return Object.keys(i).forEach(o=>{const h=o,p=i[h];n[h]=vn(p)}),n}function UA(i,...n){const o={};for(const h of Object.keys(i))n.includes(h)||(o[h]=i[h]);return o}function WA(i){const n={};for(const o in i){const h=i[o];h!==void 0&&(n[o]=h)}return n}const Ib=new WeakMap;function on(i,n,o=!1){if(!i||!(i instanceof HTMLElement)||!n)return;const h={};Object.entries(n).forEach(([p,b])=>{if(p.startsWith("--")){i.style.setProperty(p,b);return}h[p]=i.style[p],i.style[p]=b}),!o&&Ib.set(i,h)}function Vu(i,n){if(!i||!(i instanceof HTMLElement))return;const o=Ib.get(i);o&&(n?i.style[n]=o[n]:Object.entries(o).forEach(([h,p])=>{i.style[h]=p}))}function jd(i,n){const o=window.getComputedStyle(i),h=o.transform||o.webkitTransform||o.mozTransform;let p=h.match(/^matrix3d\((.+)\)$/);return p?parseFloat(p[1].split(", ")[jn(n)?13:12]):(p=h.match(/^matrix\((.+)\)$/),p?parseFloat(p[1].split(", ")[jn(n)?5:4]):null)}function qA(i){return Object.keys(i).reduce((n,o)=>i[o]===void 0?n:n+`${o}:${i[o]};`,"")}function _g(){}function eo(i,n,o,h){const p=Array.isArray(n)?n:[n];return p.forEach(b=>i.addEventListener(b,o,h)),()=>{p.forEach(b=>i.removeEventListener(b,o,h))}}const ZA=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]),GA=typeof document<"u";function nf(i){return i instanceof HTMLInputElement&&!ZA.has(i.type)||i instanceof HTMLTextAreaElement||i instanceof HTMLElement&&i.isContentEditable}function jn(i){return i==="top"||i==="bottom"}function W_(i){return i==="bottom"||i==="right"}function rf(...i){return(...n)=>{for(const o of i)typeof o=="function"&&o(...n)}}function HA(i){return new Promise(n=>setTimeout(n,i))}function XA({activeSnapPoint:i,snapPoints:n,drawerRef:o,overlayRef:h,fadeFromIndex:p,openTime:b,direction:_}){const c=jr([n,i],([Z,te])=>te===(Z==null?void 0:Z[Z.length-1])),A=jr([n,p,i],([Z,te,ne])=>Z&&Z.length>0&&(te||te===0)&&!Number.isNaN(te)&&Z[te]===ne||!Z),O=jr([n,i],([Z,te])=>(Z==null?void 0:Z.findIndex(ne=>ne===te))??null),B=jr(n,Z=>Z?Z.map(te=>{const ne=typeof window<"u",_e=typeof te=="string";let ve=0;_e&&(ve=parseInt(te,10));const Se=ot(_);if(jn(Se)){const Fe=_e?ve:ne?te*window.innerHeight:0;return ne?Se==="bottom"?window.innerHeight-Fe:window.innerHeight+Fe:Fe}const de=_e?ve:ne?te*window.innerWidth:0;return ne?Se==="right"?window.innerWidth-de:window.innerWidth+de:de}):[]),R=jr([B,O],([Z,te])=>te!==null?Z==null?void 0:Z[te]:null);Ss([i,o],([Z,te])=>{if(Z&&te){const ne=ot(n),_e=ot(B),ve=(ne==null?void 0:ne.findIndex(Se=>Se===Z))??-1;_e&&ve!==-1&&typeof _e[ve]=="number"&&C(_e[ve])}});function C(Z){xf().then(()=>{const te=ot(B),ne=(te==null?void 0:te.findIndex(Fe=>Fe===Z))??null,_e=ot(o),ve=ot(_);ae(ne),on(_e,{transition:`transform ${tn.DURATION}s cubic-bezier(${tn.EASE.join(",")})`,transform:jn(ve)?`translate3d(0, ${Z}px, 0)`:`translate3d(${Z}px, 0, 0)`});const Se=ot(p),de=ot(h);ne!==te.length-1&&ne!==Se?on(de,{transition:`opacity ${tn.DURATION}s cubic-bezier(${tn.EASE.join(",")})`,opacity:"0"}):on(de,{transition:`opacity ${tn.DURATION}s cubic-bezier(${tn.EASE.join(",")})`,opacity:"1"}),i.update(()=>{const Fe=ot(n);return ne===null||!Fe?null:Fe[ne]})})}function Y({draggedDistance:Z,closeDrawer:te,velocity:ne,dismissible:_e}){const ve=ot(p);if(ve===void 0)return;const Se=ot(R),de=ot(O),Fe=ot(h),Re=ot(B),Le=ot(n),Te=ot(_),we=Te==="bottom"||Te==="right"?(Se??0)-Z:(Se??0)+Z,fe=de===ve-1,Ae=de===0,Ce=Z>0;if(fe&&on(Fe,{transition:`opacity ${tn.DURATION}s cubic-bezier(${tn.EASE.join(",")})`}),ne>2&&!Ce){_e?te():C(Re[0]);return}if(ne>2&&Ce&&Re&&Le){C(Re[Le.length-1]);return}const Ve=Re==null?void 0:Re.reduce((Ge,Oe)=>typeof Ge!="number"||typeof Oe!="number"?Ge:Math.abs(Oe-we)<Math.abs(Ge-we)?Oe:Ge),Ue=jn(Te)?window.innerHeight:window.innerWidth;if(ne>Mb&&Math.abs(Z)<Ue*.4){const Ge=Ce?1:-1;if(Ge>0&&ot(c)&&Le){C(Re[Le.length-1]);return}if(Ae&&Ge<0&&_e&&te(),de===null)return;C(Re[de+Ge]);return}C(Ve)}function X({draggedDistance:Z}){const te=ot(o),ne=ot(R);if(ne===null)return;const _e=ot(B),ve=ot(_),Se=ve==="bottom"||ve==="right"?ne-Z:ne+Z,de=_e[_e.length-1];W_(ve)&&Se<de||!W_(ve)&&Se>de||on(te,{transform:jn(ve)?`translate3d(0, ${Se}px, 0)`:`translate3d(${Se}px, 0, 0)`})}function H(Z,te){const ne=ot(O),_e=ot(B),ve=ot(n),Se=ot(p);if(!ve||typeof ne!="number"||!_e||Se===void 0)return null;const de=ne===Se-1;if(ne>=Se&&te)return 0;if(de&&!te)return 1;if(!ot(A)&&!de)return null;const Re=de?ne+1:ne-1,Le=de?_e[Re]-_e[Re-1]:_e[Re+1]-_e[Re],Te=Z/Math.abs(Le);return de?1-Te:Te}function ae(Z){const te=ot(n),ne=ot(B);te&&Z===ne.length-1&&b.set(new Date)}return{isLastSnapPoint:c,shouldFade:A,getPercentageDragged:H,activeSnapPointIndex:O,onRelease:Y,onDrag:X,snapPointsOffset:B}}function YA(){return i0(/^Mac/)}function KA(){return i0(/^iPhone/)}function JA(){return i0(/^iPad/)||YA()&&navigator.maxTouchPoints>1}function Eb(){return KA()||JA()}function i0(i){return typeof window<"u"&&window.navigator!=null?i.test(window.navigator.platform):void 0}const Sm=typeof document<"u"&&window.visualViewport;function q_(i){const n=window.getComputedStyle(i);return/(auto|scroll)/.test(n.overflow+n.overflowX+n.overflowY)}function Cb(i){for(q_(i)&&(i=i.parentElement);i&&!q_(i);)i=i.parentElement;return i||document.scrollingElement||document.documentElement}let Vd=0,km;function QA(){return typeof document>"u"?()=>{}:(Vd++,Vd===1&&(Eb()?km=n3():km=i3()),()=>{Vd--,Vd===0&&km()})}function e3(i){const n=i.getBoundingClientRect().left;return Math.round(n)+i.scrollLeft?"paddingLeft":"paddingRight"}function t3(i,n,o){if(!i)return;const h=i.style.getPropertyValue(n);return i.style.setProperty(n,o),()=>{h?i.style.setProperty(n,h):i.style.removeProperty(n)}}function i3(){if(typeof document>"u")return()=>{};const i=document.defaultView??window,{documentElement:n,body:o}=document,h=i.innerWidth-n.clientWidth,p=()=>t3(n,"--scrollbar-width",`${h}px`),b=e3(n),_=i.getComputedStyle(o)[b];return rf(p(),sf(o,b,`calc(${_} + ${h}px)`),sf(o,"overflow","hidden"))}function n3(){let i,n=0;const{documentElement:o,body:h,activeElement:p}=document;function b(X){i=Cb(X.target),!(i===o&&i===h)&&(n=X.changedTouches[0].pageY)}function _(X){if(!i||i===o||i===h){X.preventDefault();return}const H=X.changedTouches[0].pageY,ae=i.scrollTop,Z=i.scrollHeight-i.clientHeight;Z!==0&&((ae<=0&&H>n||ae>=Z&&H<n)&&X.preventDefault(),n=H)}function c(X){const H=X.target;nf(H)&&H!==p&&(X.preventDefault(),H.style.transform="translateY(-2000px)",H.focus(),requestAnimationFrame(()=>{H.style.transform=""}))}function A(X){const H=X.target;nf(H)&&(H.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{H.style.transform="",Sm&&(Sm.height<window.innerHeight?requestAnimationFrame(()=>{Z_(H)}):Sm.addEventListener("resize",()=>Z_(H),{once:!0}))}))}function O(){window.scrollTo(0,0)}const B=window.pageXOffset,R=window.pageYOffset,C=rf(sf(o,"paddingRight",`${window.innerWidth-o.clientWidth}px`),sf(o,"overflow","hidden"));window.scrollTo(0,0);const Y=rf(eo(document,"touchstart",b,{passive:!1,capture:!0}),eo(document,"touchmove",_,{passive:!1,capture:!0}),eo(document,"touchend",c,{passive:!1,capture:!0}),eo(document,"focus",A,!0),eo(window,"scroll",O));return()=>{C(),Y(),window.scrollTo(B,R)}}function sf(i,n,o){const h=i.style[n];return i.style[n]=o,()=>{i.style[n]=h}}function Z_(i){const{documentElement:n,body:o,scrollingElement:h}=document,p=h||n;for(;i&&i!==p;){const b=Cb(i);if(b!==n&&b!==o&&b!==i){const _=b.getBoundingClientRect().top,c=i.getBoundingClientRect().top,A=i.getBoundingClientRect().bottom,O=b.getBoundingClientRect().bottom;A>O&&(b.scrollTop+=c-_)}i=b.parentElement}}const r3=ro(void 0,i=>{function n(h){h&&h.key==="Escape"&&i(h),i(void 0)}return eo(document,"keydown",n,{passive:!1})});function s3(i,n){let o=_g;function h(p){o(),o=rf(r3.subscribe(b=>{if(!b)return;const _=b.target;!a3(_)||_.closest("[data-escapee]")!==i||(b.preventDefault(),p(b))})),i.setAttribute("data-escapee","")}return h(n),()=>{o(),i.removeAttribute("data-escapee")}}function a3(i){return i instanceof HTMLElement}let Ha=null;function o3({isOpen:i,modal:n,nested:o,hasBeenOpened:h}){const p=vn(typeof window<"u"?window.location.href:"");let b=0;function _(A){if(!(Ha===null&&A))return;Ha={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height};const{scrollX:O,innerHeight:B}=window;document.body.style.setProperty("position","fixed","important"),document.body.style.top=`${-b}px`,document.body.style.left=`${-O}px`,document.body.style.right="0px",document.body.style.height="auto",setTimeout(()=>requestAnimationFrame(()=>{const R=B-window.innerHeight;R&&b>=B&&(document.body.style.top=`${-(b+R)}px`)}),300)}function c(){if(Ha===null)return;const A=ot(p),O=-parseInt(document.body.style.top,10),B=-parseInt(document.body.style.left,10);document.body.style.position=Ha.position,document.body.style.top=Ha.top,document.body.style.left=Ha.left,document.body.style.height=Ha.height,document.body.style.right="unset",requestAnimationFrame(()=>{if(A!==window.location.href){p.set(window.location.href);return}window.scrollTo(B,O)}),Ha=null}return ph(()=>{function A(){b=window.scrollY}return A(),eo(window,"scroll",A),()=>{}}),Ss([i,p],([A,O])=>{typeof document>"u"||ot(o)||!ot(h)||(A?(_(A),ot(n)||setTimeout(()=>{c()},500)):c())}),{restorePositionSetting:c}}const l3=.25,c3=100,G_=8,Yo=16,Pb=26,H_="vaul-dragging",Mm=vn([]),u3={closeThreshold:l3,shouldScaleBackground:!0,scrollLockTimeout:c3,onDrag:void 0,onRelease:void 0,snapPoints:void 0,fadeFromIndex:void 0,defaultActiveSnapPoint:void 0,onActiveSnapPointChange:void 0,defaultOpen:!1,onOpenChange:void 0,fixed:void 0,dismissible:!0,modal:!0,nested:!1,onClose:void 0,direction:"bottom"},h3=["defaultOpen","onOpenChange","defaultActiveSnapPoint","onActiveSnapPointChange","onDrag","onRelease","onClose"];function d3(i){var Qn;const{snapPoints:n,fadeFromIndex:o=n&&n.length-1,...h}={...u3,...WA(i)},p=VA(UA({...h,snapPoints:n,fadeFromIndex:o},...h3)),b=vn(void 0),{onDrag:_,onRelease:c,onClose:A,onOpenChange:O}=h,{snapPoints:B,fadeFromIndex:R,fixed:C,dismissible:Y,modal:X,nested:H,shouldScaleBackground:ae,scrollLockTimeout:Z,closeThreshold:te,direction:ne}=p,_e=vn(h.defaultOpen),ve=U_(_e,h.onOpenChange),Se=vn(!1),de=vn(!1),Fe=vn(!1),Re=vn(void 0),Le=vn(null),Te=vn(!1),we=vn(void 0),fe=vn(void 0);let Ae=!1,Ce=null,Ve=!1,Ue=0,Ge=null,Oe=null,Xe=!1,We=((Qn=ot(we))==null?void 0:Qn.getBoundingClientRect().height)||0,Et=0,Nt=0,_t=null;const Xt=U_(vn(h.defaultActiveSnapPoint),h.onActiveSnapPointChange),{activeSnapPointIndex:$t,getPercentageDragged:ai,onDrag:fi,onRelease:qt,shouldFade:bi,snapPointsOffset:Yt}=XA({snapPoints:B,activeSnapPoint:Xt,drawerRef:we,fadeFromIndex:R,overlayRef:Re,openTime:Le,direction:ne}),Oi=jr([Yt],([xt])=>(Tt="")=>{if(xt&&xt.length>0){const ze=qA({"--snap-point-height":`${xt[0]}px`});return Tt+ze}return Tt});Ss([we],([xt])=>{xt&&fe.set(xt.id)}),Ss([ve],([xt])=>{HA(100).then(()=>{const Tt=ot(fe);xt&&Tt?Mm.update(ze=>(ze.includes(Tt)||ze.push(Tt),ze)):Mm.update(ze=>ze.filter(jt=>jt!==jt))})}),Ss([ve],([xt])=>{if(!xt&&ot(ae)){const Tt=setTimeout(()=>{Vu(document.body,"background")},200);return()=>clearTimeout(Tt)}}),Ss([ve],([xt])=>{let Tt=()=>{};return xt&&(Tt=QA()),Tt});const{restorePositionSetting:Qi}=o3({isOpen:ve,modal:X,nested:H,hasBeenOpened:Se});Ss([we],([xt])=>{let Tt=_g;return xt&&(Tt=s3(xt,()=>{Kt(!0)})),()=>{Tt()}});function hi(){Ve||(Se.set(!0),ve.set(!0))}function xi(xt){const Tt=ot(we);!ot(Y)&&!ot(B)||Tt&&!Tt.contains(xt.target)||(We=(Tt==null?void 0:Tt.getBoundingClientRect().height)||0,Ae=!0,Ce=new Date,Eb()&&window.addEventListener("touchend",()=>Xe=!1,{once:!0}),xt.target.setPointerCapture(xt.pointerId),Ue=jn(ot(ne))?xt.screenY:xt.screenX)}function Me(xt,Tt){var Di;const ze=ot(we);let jt=xt;const Ut=(Di=window.getSelection())==null?void 0:Di.toString(),Qt=ot(ne),Bi=ze?jd(ze,Qt):null,Ze=new Date;if(jt.hasAttribute("data-vaul-no-drag")||jt.closest("[data-vaul-no-drag]"))return!1;const Dt=ot(Le);if(Dt&&Ze.getTime()-Dt.getTime()<500)return!1;if(Bi!==null&&(Qt==="bottom"||Qt==="right"?Bi>0:Bi<0)||Bi!==null&&Bi>0)return!0;if(Ut&&Ut.length>0)return!1;const kt=ot(Z);if(Oe&&Ze.getTime()-Oe.getTime()<kt&&Bi===0||Tt)return Oe=Ze,!1;for(;jt;){if(jt.scrollHeight>jt.clientHeight){if(jt.scrollTop!==0)return Oe=new Date,!1;if(jt.getAttribute("role")==="dialog")return!0}jt=jt.parentNode}return!0}function dn(xt){const Tt=ot(we);if(!Tt||!Ae)return;const ze=ot(ne),jt=Y_(ze),Ut=X_(Ue,ze,xt)*jt,Qt=Ut>0,Bi=ot($t),Ze=ot(B);if(Ze&&Bi===0&&!ot(Y)||!Xe&&!Me(xt.target,Qt))return;Tt.classList.add(H_),Xe=!0,on(Tt,{transition:"none"});const Dt=ot(Re);if(on(Dt,{transition:"none"}),Ze&&fi({draggedDistance:Ut}),Qt&&!Ze){const En=f3(Ut),ie=Math.min(En*-1,0)*jt;on(Tt,{transform:jn(ze)?`translate3d(0, ${ie}px, 0)`:`translate3d(${ie}px, 0, 0)`});return}const kt=Math.abs(Ut);let Di=kt/We;const Fn=ai(kt,Qt);Fn!==null&&(Di=Fn);const Rt=1-Di,Mn=ot(R);(ot(bi)||Mn&&Bi===Mn-1)&&(_==null||_(xt,Di),on(Dt,{opacity:`${Rt}`,transition:"none"},!0));const Ur=document.querySelector("[data-vaul-drawer-wrapper]");if(Ur&&Dt&&ot(ae)){const En=Math.min(oc()+Di*(1-oc()),1),ie=8-Di*8,F=Math.max(0,14-Di*14);on(Ur,{borderRadius:`${ie}px`,transform:jn(ze)?`scale(${En}) translate3d(0, ${F}px, 0)`:`scale(${En}) translate3d(${F}px, 0, 0)`,transition:"none"},!0)}if(!Ze){const En=kt*jt;on(Tt,{transform:jn(ze)?`translate3d(0, ${En}px, 0)`:`translate3d(${En}px, 0, 0)`})}}function Ii(xt,Tt="black"){const ze=document.querySelector("[data-vaul-drawer-wrapper]");if(!ze||!ot(ae))return;const jt=ot(ne);xt?(on(document.body,{background:document.body.style.backgroundColor||document.body.style.background}),on(document.body,{background:Tt},!0),on(ze,{borderRadius:`${G_}px`,overflow:"hidden",...jn(jt)?{transform:`scale(${oc()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${oc()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${tn.DURATION}s`,transitionTimingFunction:`cubic-bezier(${tn.EASE.join(",")})`})):(Vu(ze,"overflow"),Vu(ze,"transform"),Vu(ze,"borderRadius"),on(ze,{transitionProperty:"transform, border-radius",transitionDuration:`${tn.DURATION}s`,transitionTimingFunction:`cubic-bezier(${tn.EASE.join(",")})`}))}Ss([$t,B,Yt],([xt,Tt,ze])=>{function jt(){var Dt;const Qt=ot(we);if(!Qt)return;const Bi=ot(Te),Ze=document.activeElement;if(nf(Ze)||Bi){const kt=((Dt=window.visualViewport)==null?void 0:Dt.height)||0;let Di=window.innerHeight-kt;const Fn=Qt.getBoundingClientRect().height||0;Nt||(Nt=Fn);const Rt=Qt.getBoundingClientRect().top;if(Math.abs(Et-Di)>60&&Te.set(!Bi),Tt&&Tt.length>0&&ze&&xt){const Mn=ze[xt]||0;Di+=Mn}if(Et=Di,Fn>kt||Bi){const Mn=Qt.getBoundingClientRect().height;let Mr=Mn;Mn>kt&&(Mr=kt-Pb),ot(C)?Qt.style.height=`${Mn-Math.max(Di,0)}px`:Qt.style.height=`${Math.max(Mr,kt-Rt)}px`}else Qt.style.height=`${Nt}px`;Tt&&Tt.length>0&&!Bi?Qt.style.bottom="0px":Qt.style.bottom=`${Math.max(Di,0)}px`}}let Ut=_g;return window.visualViewport&&(Ut=eo(window.visualViewport,"resize",jt)),()=>{Ut()}});function Kt(xt=!1){if(Ve)return;const Tt=ot(we);if(!Tt)return;const ze=ot(ne);A==null||A(),on(Tt,{transform:jn(ze)?`translate3d(0, ${ze==="bottom"?"100%":"-100%"}, 0)`:`translate3d(${ze==="right"?"100%":"-100%"}, 0, 0)`,transition:`transform ${tn.DURATION}s cubic-bezier(${tn.EASE.join(",")})`}),on(ot(Re),{opacity:"0",transition:`opacity ${tn.DURATION}s cubic-bezier(${tn.EASE.join(",")})`}),Ii(!1),Ve=!0,setTimeout(()=>{var Ut;de.set(!1),ve.set(!1),Ve=!1,xt&&((Ut=ot(b))==null||Ut.focus())},300);const jt=ot(B);setTimeout(()=>{Vu(document.documentElement,"scrollBehavior"),jt&&Xt.set(jt[0])},tn.DURATION*1e3)}Ss([ve],([xt])=>{xt?Se.set(!0):Kt()});function Ei(){const xt=ot(we);if(!xt)return;const Tt=ot(Re),ze=document.querySelector("[data-vaul-drawer-wrapper]"),jt=ot(ne),Ut=jd(xt,jt);on(xt,{transform:"translate3d(0, 0, 0)",transition:`transform ${tn.DURATION}s cubic-bezier(${tn.EASE.join(",")})`}),on(Tt,{transition:`opacity ${tn.DURATION}s cubic-bezier(${tn.EASE.join(",")})`,opacity:"1"});const Qt=ot(ae),Bi=ot(ve);Qt&&Ut&&Ut>0&&Bi&&on(ze,{borderRadius:`${G_}px`,overflow:"hidden",...jn(jt)?{transform:`scale(${oc()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${oc()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${tn.DURATION}s`,transitionTimingFunction:`cubic-bezier(${tn.EASE.join(",")})`},!0)}function dr(xt){var Dt;const Tt=ot(we);if(!Ae||!Tt)return;Xe&&nf(xt.target)&&xt.target.blur(),Tt.classList.remove(H_),Xe=!1,Ae=!1,Ge=new Date;const ze=ot(ne),jt=jd(Tt,ze);if(xt.target&&!Me(xt.target,!1)||!jt||Number.isNaN(jt)||Ce===null)return;const Ut=Ge.getTime()-Ce.getTime(),Qt=X_(Ue,ze,xt),Bi=Math.abs(Qt)/Ut;if(Bi>.05&&(Fe.set(!0),setTimeout(()=>{Fe.set(!1)},200)),ot(B)){qt({draggedDistance:Qt*Y_(ze),closeDrawer:Kt,velocity:Bi,dismissible:ot(Y)}),c==null||c(xt,!0);return}if(ze==="bottom"||ze==="right"?Qt>0:Qt<0){Ei(),c==null||c(xt,!0);return}if(Bi>Mb){Kt(),c==null||c(xt,!1);return}const Ze=Math.min(((Dt=ot(we))==null?void 0:Dt.getBoundingClientRect().height)??0,window.innerHeight);if(jt>=Ze*ot(te)){Kt(),c==null||c(xt,!1);return}c==null||c(xt,!0),Ei()}Ss([ve],([xt])=>{xt&&(GA&&on(document.documentElement,{scrollBehavior:"auto"}),Le.set(new Date),Ii(!0,i.backgroundColor))}),Ss([de],([xt])=>{if(!xt)return;const Tt=ot(we);if(!Tt)return;Tt.querySelectorAll("*").forEach(jt=>{const Ut=jt;(Ut.scrollHeight>Ut.clientHeight||Ut.scrollWidth>Ut.clientWidth)&&Ut.classList.add("vaul-scrollable")})});function bn(xt){const Tt=ot(we),ze=xt?(window.innerWidth-Yo)/window.innerWidth:1,jt=xt?-Yo:0;_t&&window.clearTimeout(_t),on(Tt,{transition:`transform ${tn.DURATION}s cubic-bezier(${tn.EASE.join(",")})`,transform:`scale(${ze}) translate3d(0, ${jt}px, 0)`}),!xt&&Tt&&(_t=setTimeout(()=>{const Ut=ot(ne),Qt=jd(Tt,Ut);on(Tt,{transition:"none",transform:jn(Ut)?`translate3d(0, ${Qt}px, 0)`:`translate3d(${Qt}px, 0, 0)`})},500))}function Jn(xt,Tt){if(Tt<0)return;const ze=(window.innerWidth-Yo)/window.innerWidth,jt=ze+Tt*(1-ze),Ut=-Yo+Tt*Yo,Qt=ot(ne);on(ot(we),{transform:jn(Qt)?`scale(${jt}) translate3d(0, ${Ut}px, 0)`:`scale(${jt}) translate3d(${Ut}px, 0, 0)`,transition:"none"})}function Is(xt,Tt){const ze=ot(ne),jt=jn(ze)?window.innerHeight:window.innerWidth,Ut=Tt?(jt-Yo)/jt:1,Qt=Tt?-Yo:0;Tt&&on(ot(we),{transition:`transform ${tn.DURATION}s cubic-bezier(${tn.EASE.join(",")})`,transform:jn(ze)?`scale(${Ut}) translate3d(0, ${Qt}px, 0)`:`scale(${Ut}) translate3d(${Qt}px, 0, 0)`})}return{states:{isOpen:ve,hasBeenOpened:Se,snapPoints:B,activeSnapPoint:Xt,snapPointsOffset:Yt,keyboardIsOpen:Te,shouldFade:bi,visible:de,drawerId:fe,openDrawerIds:Mm},helpers:{getContentStyle:Oi},methods:{closeDrawer:Kt,onOpenChange:O,onPress:xi,onRelease:dr,onDrag:dn,scaleBackground:Ii,onNestedDrag:Jn,onNestedOpenChange:bn,onNestedRelease:Is,restorePositionSetting:Qi,openDrawer:hi},refs:{drawerRef:we,overlayRef:Re,triggerRef:b},options:p}}function f3(i){return 8*(Math.log(i+1)-2)}function oc(){return(window.innerWidth-Pb)/window.innerWidth}function X_(i,n,o){return o.type.startsWith("touch")?m3(i,n,o):p3(i,n,o)}function p3(i,n,o){return i-(jn(n)?o.screenY:o.screenX)}function m3(i,n,o){return i-(jn(n)?o.changedTouches[0].screenY:o.changedTouches[0].screenX)}function Y_(i){return i==="bottom"||i==="right"?1:-1}const zb=Symbol("VAUL_ROOT");function g3(i={}){const n=d3(i),o=$A(n.options);return u1(zb,{...n,updateOption:o}),{...n,updateOption:o}}function yh(){return Wg(zb)}function y3(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]),h=Ji(o,["open","onOpenChange","closeThreshold","scrollLockTimeout","snapPoints","fadeFromIndex","openFocus","onOutsideClick","closeOnOutsideClick","backgroundColor","nested","shouldScaleBackground","activeSnapPoint","onActiveSnapPointChange","onRelease","onDrag","onClose","dismissible","direction"]);un(n,!1);const p=As(),b=()=>kn(Ce,"$isOpen",p),_=()=>kn(Te,"$keyboardIsOpen",p),c=()=>kn(Ge,"$localDismissible",p);let A=tt(n,"open",12,!1),O=tt(n,"onOpenChange",24,()=>{}),B=tt(n,"closeThreshold",24,()=>{}),R=tt(n,"scrollLockTimeout",24,()=>{}),C=tt(n,"snapPoints",24,()=>{}),Y=tt(n,"fadeFromIndex",24,()=>{}),X=tt(n,"openFocus",24,()=>{}),H=tt(n,"onOutsideClick",24,()=>{}),ae=tt(n,"closeOnOutsideClick",8,!0),Z=tt(n,"backgroundColor",8,"black"),te=tt(n,"nested",8,!1),ne=tt(n,"shouldScaleBackground",8,!1),_e=tt(n,"activeSnapPoint",28,()=>{}),ve=tt(n,"onActiveSnapPointChange",24,()=>{}),Se=tt(n,"onRelease",24,()=>{}),de=tt(n,"onDrag",24,()=>{}),Fe=tt(n,"onClose",24,()=>{}),Re=tt(n,"dismissible",24,()=>{}),Le=tt(n,"direction",8,"bottom");const{states:{keyboardIsOpen:Te,activeSnapPoint:we,drawerId:fe,openDrawerIds:Ae,isOpen:Ce},methods:{closeDrawer:Ve,openDrawer:Ue},options:{dismissible:Ge},updateOption:Oe}=g3({defaultOpen:A(),defaultActiveSnapPoint:_e(),onOpenChange:({next:Xe})=>{var We;return A()!==Xe&&((We=O())==null||We(Xe),A(Xe)),Xe},onActiveSnapPointChange:({next:Xe})=>{var We,Et;if(Xe===void 0&&C()&&_e()!==Xe){const Nt=C()[0];return(We=ve())==null||We(Nt),_e(Nt),Nt}return _e()!==Xe&&((Et=ve())==null||Et(Xe),_e(Xe)),Xe},closeThreshold:B(),scrollLockTimeout:R(),snapPoints:C(),fadeFromIndex:Y(),nested:te(),onDrag:de(),onClose:Fe(),onRelease:Se(),shouldScaleBackground:ne(),backgroundColor:Z(),dismissible:Re(),direction:Le()});ei(()=>Mi(_e()),()=>{_e()!==void 0&&we.set(_e())}),ei(()=>Mi(B()),()=>{Oe("closeThreshold",B())}),ei(()=>Mi(R()),()=>{Oe("scrollLockTimeout",R())}),ei(()=>Mi(C()),()=>{Oe("snapPoints",C())}),ei(()=>Mi(Y()),()=>{Oe("fadeFromIndex",Y())}),ei(()=>Mi(X()),()=>{Oe("openFocus",X())}),ei(()=>Mi(ne()),()=>{Oe("shouldScaleBackground",ne())}),ei(()=>Mi(Z()),()=>{Oe("backgroundColor",Z())}),ei(()=>Mi(Re()),()=>{Oe("dismissible",Re())}),ei(()=>Mi(Le()),()=>{Oe("direction",Le())}),ei(()=>(Mi(A()),b()),()=>{A()&&!b()&&Ue()}),ei(()=>(Mi(A()),b()),()=>{!A()&&b()&&Ve()}),Br(),cn(),SA(i,Vr({get closeOnOutsideClick(){return ae()},closeOnEscape:!1,preventScroll:!1,onOpenChange:Xe=>{var We;(We=O())==null||We(Xe),Xe?Xe&&Ue():Ve()},onOutsideClick:Xe=>{var Nt,_t;if(!ae()||((Nt=H())==null||Nt(Xe),Xe!=null&&Xe.defaultPrevented)||(_()&&Te.set(!1),Xe.preventDefault(),!c()))return;const We=ot(Ae);We[We.length-1]===ot(fe)&&((_t=O())==null||_t(!1),Ve())}},()=>h,{get open(){return A()},set open(Xe){A(Xe)},children:(Xe,We)=>{var Et=vi(),Nt=ni(Et);zi(Nt,n,"default",{},null),rt(Xe,Et)},$$slots:{default:!0},$$legacy:!0})),hn()}function _3(i,n){un(n,!1);const{states:{visible:o},methods:{scaleBackground:h,restorePositionSetting:p}}=yh();ph(()=>(o.set(!0),()=>{h(!1),p()})),cn(),hn()}var v3=Wt("<!> <!>",1);function b3(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]),h=Ji(o,["style"]);un(n,!1);const p=As(),b=()=>kn(O,"$drawerRef",p),_=()=>kn(R,"$getContentStyle",p),c=()=>kn(H,"$direction",p),A=()=>kn(B,"$visible",p),{refs:{drawerRef:O},states:{visible:B},helpers:{getContentStyle:R},methods:{onPress:C,onDrag:Y,onRelease:X},options:{direction:H}}=yh();let ae=tt(n,"style",8,"");cn();var Z=ur(()=>_()(ae())),te=ur(()=>A()?"true":"false");zA(i,Vr({get style(){return De(Z)},"data-vaul-drawer":"",get"data-vaul-drawer-direction"(){return c()},get"data-vaul-drawer-visible"(){return De(te)}},()=>h,{get el(){return h1(),b()},set el(ne){rh(O,ne)},$$events:{pointerdown:ne=>{C(ne)},pointerup:ne=>{X(ne)},pointermove:ne=>{Y(ne)},touchend:ne=>{X(ne)},touchmove:ne=>{Y(ne)}},children:(ne,_e)=>{var ve=v3(),Se=ni(ve);_3(Se,{});var de=Ht(Se,2);zi(de,n,"default",{},null),rt(ne,ve)},$$slots:{default:!0},$$legacy:!0})),hn()}function x3(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]),h=Ji(o,[]);un(n,!1);const p=As(),b=()=>kn(X,"$snapPoints",p),_=()=>kn(R,"$overlayRef",p),c=()=>kn(Y,"$visible",p),A=()=>kn(C,"$isOpen",p),O=()=>kn(H,"$shouldFade",p),B=qi(),{refs:{overlayRef:R},states:{isOpen:C,visible:Y,snapPoints:X,shouldFade:H},methods:{onRelease:ae}}=yh();ei(()=>b(),()=>{di(B,b()&&b().length>0)}),Br(),cn();var Z=ur(()=>c()?"true":"false"),te=ur(()=>A()&&De(B)?"true":"false"),ne=ur(()=>A()&&O()?"true":"false");FA(i,Vr({get"data-vaul-drawer-visible"(){return De(Z)},"data-vaul-overlay":"",get"data-vaul-snap-points"(){return De(te)},get"data-vaul-snap-points-overlay"(){return De(ne)}},()=>h,{get el(){return h1(),_()},set el(_e){rh(R,_e)},$$events:{mouseup:ae},$$legacy:!0})),hn()}function w3(i,n){un(n,!1);const o=qi(),h=qi();let p=tt(n,"meltBuilder",8);const{refs:{triggerRef:b}}=yh(),_=O=>(b.set(O),De(o)(O));ei(()=>(De(o),De(h),Mi(p())),()=>{(O=>(di(o,O.action),di(h,uT(O,["action"]))))(p())}),ei(()=>De(h),()=>{Object.assign(De(h),{action:_})}),Br(),cn();var c=vi(),A=ni(c);zi(A,n,"default",{get newBuilder(){return De(h)}},null),rt(i,c),hn()}function T3(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]),h=Ji(o,["el","asChild"]);un(n,!1);const{refs:{triggerRef:p}}=yh();let b=tt(n,"el",28,()=>{}),_=tt(n,"asChild",8,!1);ei(()=>Mi(b()),()=>{b()&&p.set(b())}),Br(),cn();var c=vi(),A=ni(c);{var O=R=>{V_(R,Vr({get asChild(){return _()}},()=>h,{get el(){return b()},set el(C){b(C)},$$events:{click(C){Ft.call(this,n,C)},keydown(C){Ft.call(this,n,C)}},children:om,$$slots:{default:(C,Y)=>{const X=ur(()=>Y.builder);w3(C,{get meltBuilder(){return De(X)},children:om,$$slots:{default:(H,ae)=>{const Z=ur(()=>ae.newBuilder);var te=vi(),ne=ni(te);zi(ne,n,"default",{get builder(){return De(Z)}},null),rt(H,te)}}})}},$$legacy:!0}))},B=R=>{V_(R,Vr(()=>h,{get el(){return b()},set el(C){b(C)},$$events:{click(C){Ft.call(this,n,C)},keydown(C){Ft.call(this,n,C)}},children:om,$$slots:{default:(C,Y)=>{const X=ur(()=>Y.builder);var H=vi(),ae=ni(H);zi(ae,n,"default",{get builder(){return De(X)}},null),rt(C,H)}},$$legacy:!0}))};ji(A,R=>{_()?R(O):R(B,!1)})}rt(i,c),hn()}const S3=MA;function K_(i){return i<.5?4*i*i*i:.5*Math.pow(2*i-2,3)+1}function J_(i){return i*i}const k3=i=>i;function M3(i){const n=i-1;return n*n*n+1}function af(i,{delay:n=0,duration:o=400,easing:h=k3}={}){const p=+getComputedStyle(i).opacity;return{delay:n,duration:o,easing:h,css:b=>`opacity: ${b*p}`}}function Q_(i,{delay:n=0,duration:o=400,easing:h=M3,start:p=0,opacity:b=0}={}){const _=getComputedStyle(i),c=+_.opacity,A=_.transform==="none"?"":_.transform,O=1-p,B=c*(1-b);return{delay:n,duration:o,easing:h,css:(R,C)=>`
			transform: ${A} scale(${1-O*C});
			opacity: ${c-B*C}
		`}}function Db(i,n,o){i=+i,n=+n,o=(p=arguments.length)<2?(n=i,i=0,1):p<3?1:+o;for(var h=-1,p=Math.max(0,Math.ceil((n-i)/o))|0,b=new Array(p);++h<p;)b[h]=i+h*o;return b}function A3(i){return new Promise(n=>setTimeout(n,i))}function Am(i,n={restoreFocus:!1,delay:0,disabled:!1}){if(!n.disabled){let o=document.activeElement;return i.tabIndex=-1,A3(n.delay??0).then(()=>{i.focus()}),{destroy(){!n.disabled&&n.restoreFocus&&o instanceof HTMLElement&&o.focus()}}}return{}}const dc=(i,n)=>{const o={fallbackTarget:i.closest(".PortalTarget")??document.querySelector(".PortalTarget"),originalParent:i.parentElement};let h=ev(i,n,o);return{update(p){h=ev(i,p,o)},destroy(){h&&i.parentElement===h&&h.removeChild(i)}}};function ev(i,n={},o){var b;if((typeof n=="boolean"?n:n.enabled)===!1)return o.originalParent!==i.parentElement&&((b=o.originalParent)==null||b.appendChild(i)),o.originalParent;const p=I3(n,o.fallbackTarget);return p==null||p.appendChild(i),p}function I3(i={},n){const o=typeof i=="object"?i.target:void 0;return o instanceof HTMLElement?o:typeof o=="string"?document.querySelector(o):n??document.body}const Im=(i,n)=>{function p(c){const A=c.currentTarget??c.target;if(!A)return;const{clientWidth:O,clientHeight:B,scrollWidth:R,scrollHeight:C,scrollTop:Y,scrollLeft:X}=A,H=Y/(C-B),ae=X/(R-O);let Z=null;if(C!=B){const te=[];if(H>0){const ne=Math.min(Y/5,50);te.push(`rgba(0, 0, 0, 0), rgba(0, 0, 0, 1) ${ne}px`)}if(H<1){const ne=Math.min((C-B-Y)/5,50);te.push(`rgba(0, 0, 0, 1) calc(100% - ${ne}px), rgba(0, 0, 0, 0)`)}Z=`linear-gradient(to bottom, ${te.join(",")})`}else if(R!==O){const te=[];if(ae>0){const ne=Math.min(X/5,50);te.push(`rgba(0, 0, 0, 0), rgba(0, 0, 0, 1) ${ne}px`)}if(ae<1){const ne=Math.min((R-O-X)/5,50);te.push(`rgba(0, 0, 0, 1) calc(100% - ${ne}px), rgba(0, 0, 0, 0)`)}Z=`linear-gradient(to right, ${te.join(",")})`}i.style.webkitMaskImage=Z??"",i.style.maskImage=Z??""}i.classList.add("overflow-auto"),i.addEventListener("scroll",p,{passive:!0}),i.addEventListener("transitionend",p),i.addEventListener("animationend",p);let b=new ResizeObserver((c,A)=>{p({target:i})});b.observe(i);let _=new MutationObserver((c,A)=>{p({target:i})});return _.observe(i,{childList:!0,subtree:!0}),{destroy(){i.removeEventListener("scroll",p),i.removeEventListener("transitionend",p),i.removeEventListener("animationend",p),b.disconnect(),_.disconnect()}}};function E3(i){return Object.keys(i)}function Lb(i){return i instanceof Map?Array.from(i.entries()):Object.entries(i)}function Rb(i){return Object.fromEntries(i)}function C3(i){throw new Error(`Unhandled enum case: ${i}`)}var Ob=typeof global=="object"&&global&&global.Object===Object&&global,P3=typeof self=="object"&&self&&self.Object===Object&&self,Ac=Ob||P3||Function("return this")(),of=Ac.Symbol,Bb=Object.prototype,z3=Bb.hasOwnProperty,D3=Bb.toString,Uu=of?of.toStringTag:void 0;function L3(i){var n=z3.call(i,Uu),o=i[Uu];try{i[Uu]=void 0;var h=!0}catch{}var p=D3.call(i);return h&&(n?i[Uu]=o:delete i[Uu]),p}var R3=Object.prototype,O3=R3.toString;function B3(i){return O3.call(i)}var F3="[object Null]",N3="[object Undefined]",tv=of?of.toStringTag:void 0;function kf(i){return i==null?i===void 0?N3:F3:tv&&tv in Object(i)?L3(i):B3(i)}function _h(i){return i!=null&&typeof i=="object"}var vg=Array.isArray;function ba(i){var n=typeof i;return i!=null&&(n=="object"||n=="function")}function Fb(i){return i}var $3="[object AsyncFunction]",j3="[object Function]",V3="[object GeneratorFunction]",U3="[object Proxy]";function n0(i){if(!ba(i))return!1;var n=kf(i);return n==j3||n==V3||n==$3||n==U3}var Em=Ac["__core-js_shared__"],iv=function(){var i=/[^.]+$/.exec(Em&&Em.keys&&Em.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}();function W3(i){return!!iv&&iv in i}var q3=Function.prototype,Z3=q3.toString;function G3(i){if(i!=null){try{return Z3.call(i)}catch{}try{return i+""}catch{}}return""}var H3=/[\\^$.*+?()[\]{}|]/g,X3=/^\[object .+?Constructor\]$/,Y3=Function.prototype,K3=Object.prototype,J3=Y3.toString,Q3=K3.hasOwnProperty,eI=RegExp("^"+J3.call(Q3).replace(H3,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function tI(i){if(!ba(i)||W3(i))return!1;var n=n0(i)?eI:X3;return n.test(G3(i))}function iI(i,n){return i==null?void 0:i[n]}function r0(i,n){var o=iI(i,n);return tI(o)?o:void 0}var nv=Object.create,nI=function(){function i(){}return function(n){if(!ba(n))return{};if(nv)return nv(n);i.prototype=n;var o=new i;return i.prototype=void 0,o}}();function Nb(i,n,o){switch(o.length){case 0:return i.call(n);case 1:return i.call(n,o[0]);case 2:return i.call(n,o[0],o[1]);case 3:return i.call(n,o[0],o[1],o[2])}return i.apply(n,o)}function rI(i,n){var o=-1,h=i.length;for(n||(n=Array(h));++o<h;)n[o]=i[o];return n}var sI=800,aI=16,oI=Date.now;function lI(i){var n=0,o=0;return function(){var h=oI(),p=aI-(h-o);if(o=h,p>0){if(++n>=sI)return arguments[0]}else n=0;return i.apply(void 0,arguments)}}function cI(i){return function(){return i}}var lf=function(){try{var i=r0(Object,"defineProperty");return i({},"",{}),i}catch{}}(),uI=lf?function(i,n){return lf(i,"toString",{configurable:!0,enumerable:!1,value:cI(n),writable:!0})}:Fb,hI=lI(uI),dI=9007199254740991,fI=/^(?:0|[1-9]\d*)$/;function $b(i,n){var o=typeof i;return n=n??dI,!!n&&(o=="number"||o!="symbol"&&fI.test(i))&&i>-1&&i%1==0&&i<n}function s0(i,n,o){n=="__proto__"&&lf?lf(i,n,{configurable:!0,enumerable:!0,value:o,writable:!0}):i[n]=o}function Mf(i,n){return i===n||i!==i&&n!==n}var pI=Object.prototype,mI=pI.hasOwnProperty;function gI(i,n,o){var h=i[n];(!(mI.call(i,n)&&Mf(h,o))||o===void 0&&!(n in i))&&s0(i,n,o)}function yI(i,n,o,h){var p=!o;o||(o={});for(var b=-1,_=n.length;++b<_;){var c=n[b],A=void 0;A===void 0&&(A=i[c]),p?s0(o,c,A):gI(o,c,A)}return o}var rv=Math.max;function _I(i,n,o){return n=rv(n===void 0?i.length-1:n,0),function(){for(var h=arguments,p=-1,b=rv(h.length-n,0),_=Array(b);++p<b;)_[p]=h[n+p];p=-1;for(var c=Array(n+1);++p<n;)c[p]=h[p];return c[n]=o(_),Nb(i,this,c)}}function jb(i,n){return hI(_I(i,n,Fb),i+"")}var vI=9007199254740991;function Vb(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=vI}function a0(i){return i!=null&&Vb(i.length)&&!n0(i)}function bI(i,n,o){if(!ba(o))return!1;var h=typeof n;return(h=="number"?a0(o)&&$b(n,o.length):h=="string"&&n in o)?Mf(o[n],i):!1}function xI(i){return jb(function(n,o){var h=-1,p=o.length,b=p>1?o[p-1]:void 0,_=p>2?o[2]:void 0;for(b=i.length>3&&typeof b=="function"?(p--,b):void 0,_&&bI(o[0],o[1],_)&&(b=p<3?void 0:b,p=1),n=Object(n);++h<p;){var c=o[h];c&&i(n,c,h,b)}return n})}var wI=Object.prototype;function Ub(i){var n=i&&i.constructor,o=typeof n=="function"&&n.prototype||wI;return i===o}function TI(i,n){for(var o=-1,h=Array(i);++o<i;)h[o]=n(o);return h}var SI="[object Arguments]";function sv(i){return _h(i)&&kf(i)==SI}var Wb=Object.prototype,kI=Wb.hasOwnProperty,MI=Wb.propertyIsEnumerable,bg=sv(function(){return arguments}())?sv:function(i){return _h(i)&&kI.call(i,"callee")&&!MI.call(i,"callee")};function AI(){return!1}var qb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,av=qb&&typeof module=="object"&&module&&!module.nodeType&&module,II=av&&av.exports===qb,ov=II?Ac.Buffer:void 0,EI=ov?ov.isBuffer:void 0,Zb=EI||AI,CI="[object Arguments]",PI="[object Array]",zI="[object Boolean]",DI="[object Date]",LI="[object Error]",RI="[object Function]",OI="[object Map]",BI="[object Number]",FI="[object Object]",NI="[object RegExp]",$I="[object Set]",jI="[object String]",VI="[object WeakMap]",UI="[object ArrayBuffer]",WI="[object DataView]",qI="[object Float32Array]",ZI="[object Float64Array]",GI="[object Int8Array]",HI="[object Int16Array]",XI="[object Int32Array]",YI="[object Uint8Array]",KI="[object Uint8ClampedArray]",JI="[object Uint16Array]",QI="[object Uint32Array]",ln={};ln[qI]=ln[ZI]=ln[GI]=ln[HI]=ln[XI]=ln[YI]=ln[KI]=ln[JI]=ln[QI]=!0;ln[CI]=ln[PI]=ln[UI]=ln[zI]=ln[WI]=ln[DI]=ln[LI]=ln[RI]=ln[OI]=ln[BI]=ln[FI]=ln[NI]=ln[$I]=ln[jI]=ln[VI]=!1;function eE(i){return _h(i)&&Vb(i.length)&&!!ln[kf(i)]}function tE(i){return function(n){return i(n)}}var Gb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,eh=Gb&&typeof module=="object"&&module&&!module.nodeType&&module,iE=eh&&eh.exports===Gb,Cm=iE&&Ob.process,lv=function(){try{var i=eh&&eh.require&&eh.require("util").types;return i||Cm&&Cm.binding&&Cm.binding("util")}catch{}}(),cv=lv&&lv.isTypedArray,Hb=cv?tE(cv):eE;function nE(i,n){var o=vg(i),h=!o&&bg(i),p=!o&&!h&&Zb(i),b=!o&&!h&&!p&&Hb(i),_=o||h||p||b,c=_?TI(i.length,String):[],A=c.length;for(var O in i)_&&(O=="length"||p&&(O=="offset"||O=="parent")||b&&(O=="buffer"||O=="byteLength"||O=="byteOffset")||$b(O,A))||c.push(O);return c}function rE(i,n){return function(o){return i(n(o))}}function sE(i){var n=[];if(i!=null)for(var o in Object(i))n.push(o);return n}var aE=Object.prototype,oE=aE.hasOwnProperty;function lE(i){if(!ba(i))return sE(i);var n=Ub(i),o=[];for(var h in i)h=="constructor"&&(n||!oE.call(i,h))||o.push(h);return o}function Xb(i){return a0(i)?nE(i):lE(i)}var ah=r0(Object,"create");function cE(){this.__data__=ah?ah(null):{},this.size=0}function uE(i){var n=this.has(i)&&delete this.__data__[i];return this.size-=n?1:0,n}var hE="__lodash_hash_undefined__",dE=Object.prototype,fE=dE.hasOwnProperty;function pE(i){var n=this.__data__;if(ah){var o=n[i];return o===hE?void 0:o}return fE.call(n,i)?n[i]:void 0}var mE=Object.prototype,gE=mE.hasOwnProperty;function yE(i){var n=this.__data__;return ah?n[i]!==void 0:gE.call(n,i)}var _E="__lodash_hash_undefined__";function vE(i,n){var o=this.__data__;return this.size+=this.has(i)?0:1,o[i]=ah&&n===void 0?_E:n,this}function rl(i){var n=-1,o=i==null?0:i.length;for(this.clear();++n<o;){var h=i[n];this.set(h[0],h[1])}}rl.prototype.clear=cE;rl.prototype.delete=uE;rl.prototype.get=pE;rl.prototype.has=yE;rl.prototype.set=vE;function bE(){this.__data__=[],this.size=0}function Af(i,n){for(var o=i.length;o--;)if(Mf(i[o][0],n))return o;return-1}var xE=Array.prototype,wE=xE.splice;function TE(i){var n=this.__data__,o=Af(n,i);if(o<0)return!1;var h=n.length-1;return o==h?n.pop():wE.call(n,o,1),--this.size,!0}function SE(i){var n=this.__data__,o=Af(n,i);return o<0?void 0:n[o][1]}function kE(i){return Af(this.__data__,i)>-1}function ME(i,n){var o=this.__data__,h=Af(o,i);return h<0?(++this.size,o.push([i,n])):o[h][1]=n,this}function xa(i){var n=-1,o=i==null?0:i.length;for(this.clear();++n<o;){var h=i[n];this.set(h[0],h[1])}}xa.prototype.clear=bE;xa.prototype.delete=TE;xa.prototype.get=SE;xa.prototype.has=kE;xa.prototype.set=ME;var Yb=r0(Ac,"Map");function AE(){this.size=0,this.__data__={hash:new rl,map:new(Yb||xa),string:new rl}}function IE(i){var n=typeof i;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?i!=="__proto__":i===null}function If(i,n){var o=i.__data__;return IE(n)?o[typeof n=="string"?"string":"hash"]:o.map}function EE(i){var n=If(this,i).delete(i);return this.size-=n?1:0,n}function CE(i){return If(this,i).get(i)}function PE(i){return If(this,i).has(i)}function zE(i,n){var o=If(this,i),h=o.size;return o.set(i,n),this.size+=o.size==h?0:1,this}function Ic(i){var n=-1,o=i==null?0:i.length;for(this.clear();++n<o;){var h=i[n];this.set(h[0],h[1])}}Ic.prototype.clear=AE;Ic.prototype.delete=EE;Ic.prototype.get=CE;Ic.prototype.has=PE;Ic.prototype.set=zE;var Kb=rE(Object.getPrototypeOf,Object),DE="[object Object]",LE=Function.prototype,RE=Object.prototype,Jb=LE.toString,OE=RE.hasOwnProperty,BE=Jb.call(Object);function FE(i){if(!_h(i)||kf(i)!=DE)return!1;var n=Kb(i);if(n===null)return!0;var o=OE.call(n,"constructor")&&n.constructor;return typeof o=="function"&&o instanceof o&&Jb.call(o)==BE}function NE(){this.__data__=new xa,this.size=0}function $E(i){var n=this.__data__,o=n.delete(i);return this.size=n.size,o}function jE(i){return this.__data__.get(i)}function VE(i){return this.__data__.has(i)}var UE=200;function WE(i,n){var o=this.__data__;if(o instanceof xa){var h=o.__data__;if(!Yb||h.length<UE-1)return h.push([i,n]),this.size=++o.size,this;o=this.__data__=new Ic(h)}return o.set(i,n),this.size=o.size,this}function Ec(i){var n=this.__data__=new xa(i);this.size=n.size}Ec.prototype.clear=NE;Ec.prototype.delete=$E;Ec.prototype.get=jE;Ec.prototype.has=VE;Ec.prototype.set=WE;var Qb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,uv=Qb&&typeof module=="object"&&module&&!module.nodeType&&module,qE=uv&&uv.exports===Qb,hv=qE?Ac.Buffer:void 0;hv&&hv.allocUnsafe;function ZE(i,n){return i.slice()}var dv=Ac.Uint8Array;function GE(i){var n=new i.constructor(i.byteLength);return new dv(n).set(new dv(i)),n}function HE(i,n){var o=GE(i.buffer);return new i.constructor(o,i.byteOffset,i.length)}function XE(i){return typeof i.constructor=="function"&&!Ub(i)?nI(Kb(i)):{}}function YE(i){return function(n,o,h){for(var p=-1,b=Object(n),_=h(n),c=_.length;c--;){var A=_[++p];if(o(b[A],A,b)===!1)break}return n}}var KE=YE();function xg(i,n,o){(o!==void 0&&!Mf(i[n],o)||o===void 0&&!(n in i))&&s0(i,n,o)}function JE(i){return _h(i)&&a0(i)}function wg(i,n){if(!(n==="constructor"&&typeof i[n]=="function")&&n!="__proto__")return i[n]}function QE(i){return yI(i,Xb(i))}function eC(i,n,o,h,p,b,_){var c=wg(i,o),A=wg(n,o),O=_.get(A);if(O){xg(i,o,O);return}var B=b?b(c,A,o+"",i,n,_):void 0,R=B===void 0;if(R){var C=vg(A),Y=!C&&Zb(A),X=!C&&!Y&&Hb(A);B=A,C||Y||X?vg(c)?B=c:JE(c)?B=rI(c):Y?(R=!1,B=ZE(A)):X?(R=!1,B=HE(A)):B=[]:FE(A)||bg(A)?(B=c,bg(c)?B=QE(c):(!ba(c)||n0(c))&&(B=XE(A))):R=!1}R&&(_.set(A,B),p(B,A,h,b,_),_.delete(A)),xg(i,o,B)}function o0(i,n,o,h,p){i!==n&&KE(n,function(b,_){if(p||(p=new Ec),ba(b))eC(i,n,_,o,o0,h,p);else{var c=h?h(wg(i,_),b,_+"",i,n,p):void 0;c===void 0&&(c=b),xg(i,_,c)}},Xb)}function ex(i,n,o,h,p,b){return ba(i)&&ba(n)&&(b.set(n,i),o0(i,n,void 0,ex,b),b.delete(n)),i}var tC=xI(function(i,n,o,h){o0(i,n,o,h)}),fv=jb(function(i){return i.push(void 0,ex),Nb(tC,void 0,i)});const iC=864e5,tx=6e4,ix=36e5,pv=Symbol.for("constructDateFrom");function Ef(i,n){return typeof i=="function"?i(n):i&&typeof i=="object"&&pv in i?i[pv](n):i instanceof Date?new i.constructor(n):new Date(n)}function Vs(i,n){return Ef(n||i,i)}function Tg(i,n,o){const h=Vs(i,o==null?void 0:o.in);return isNaN(n)?Ef(i,NaN):(n&&h.setDate(h.getDate()+n),h)}let nC={};function nx(){return nC}function rC(i,n){var c,A,O,B;const o=nx(),h=(n==null?void 0:n.weekStartsOn)??((A=(c=n==null?void 0:n.locale)==null?void 0:c.options)==null?void 0:A.weekStartsOn)??o.weekStartsOn??((B=(O=o.locale)==null?void 0:O.options)==null?void 0:B.weekStartsOn)??0,p=Vs(i,n==null?void 0:n.in),b=p.getDay(),_=(b<h?7:0)+b-h;return p.setDate(p.getDate()-_),p.setHours(0,0,0,0),p}function mv(i){const n=Vs(i),o=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return o.setUTCFullYear(n.getFullYear()),+i-+o}function rx(i,...n){const o=Ef.bind(null,n.find(h=>typeof h=="object"));return n.map(o)}function gv(i,n){const o=Vs(i,n==null?void 0:n.in);return o.setHours(0,0,0,0),o}function sC(i,n,o){const[h,p]=rx(o==null?void 0:o.in,i,n),b=gv(h),_=gv(p),c=+b-mv(b),A=+_-mv(_);return Math.round((c-A)/iC)}function aC(i,n,o){const[h,p]=rx(o==null?void 0:o.in,i,n),b=yv(h,p),_=Math.abs(sC(h,p));h.setDate(h.getDate()-b*_);const c=+(yv(h,p)===-b),A=b*(_-c);return A===0?0:A}function yv(i,n){const o=i.getFullYear()-n.getFullYear()||i.getMonth()-n.getMonth()||i.getDate()-n.getDate()||i.getHours()-n.getHours()||i.getMinutes()-n.getMinutes()||i.getSeconds()-n.getSeconds()||i.getMilliseconds()-n.getMilliseconds();return o<0?-1:o>0?1:o}function oC(i,n){const o=Vs(i,n==null?void 0:n.in),h=o.getMonth(),p=h-h%3;return o.setMonth(p,1),o.setHours(0,0,0,0),o}function lC(i,n){var c,A,O,B;const o=nx(),h=(n==null?void 0:n.weekStartsOn)??((A=(c=n==null?void 0:n.locale)==null?void 0:c.options)==null?void 0:A.weekStartsOn)??o.weekStartsOn??((B=(O=o.locale)==null?void 0:O.options)==null?void 0:B.weekStartsOn)??0,p=Vs(i,n==null?void 0:n.in),b=p.getDay(),_=(b<h?-7:0)+6-(b-h);return p.setDate(p.getDate()+_),p.setHours(23,59,59,999),p}function cC(i,n){const o=Vs(i,n==null?void 0:n.in),h=o.getMonth(),p=h-h%3+3;return o.setMonth(p,0),o.setHours(23,59,59,999),o}function Xa(i,n){const o=i<0?"-":"",h=Math.abs(i).toString().padStart(n,"0");return o+h}function uC(i,n){const o=Vs(i,n==null?void 0:n.in);if(isNaN(+o))throw new RangeError("Invalid time value");let h="",p="";const b="-",_=":";{const c=Xa(o.getDate(),2),A=Xa(o.getMonth()+1,2);h=`${Xa(o.getFullYear(),4)}${b}${A}${b}${c}`}{const c=o.getTimezoneOffset();if(c!==0){const Y=Math.abs(c),X=Xa(Math.trunc(Y/60),2),H=Xa(Y%60,2);p=`${c<0?"+":"-"}${X}:${H}`}else p="Z";const A=Xa(o.getHours(),2),O=Xa(o.getMinutes(),2),B=Xa(o.getSeconds(),2),R=h===""?"":"T",C=[A,O,B].join(_);h=`${h}${R}${C}${p}`}return h}function hC(i,n){const o=()=>Ef(n==null?void 0:n.in,NaN),p=mC(i);let b;if(p.date){const O=gC(p.date,2);b=yC(O.restDateString,O.year)}if(!b||isNaN(+b))return o();const _=+b;let c=0,A;if(p.time&&(c=_C(p.time),isNaN(c)))return o();if(p.timezone){if(A=vC(p.timezone),isNaN(A))return o()}else{const O=new Date(_+c),B=Vs(0,n==null?void 0:n.in);return B.setFullYear(O.getUTCFullYear(),O.getUTCMonth(),O.getUTCDate()),B.setHours(O.getUTCHours(),O.getUTCMinutes(),O.getUTCSeconds(),O.getUTCMilliseconds()),B}return Vs(_+c+A,n==null?void 0:n.in)}const Ud={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},dC=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,fC=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,pC=/^([+-])(\d{2})(?::?(\d{2}))?$/;function mC(i){const n={},o=i.split(Ud.dateTimeDelimiter);let h;if(o.length>2)return n;if(/:/.test(o[0])?h=o[0]:(n.date=o[0],h=o[1],Ud.timeZoneDelimiter.test(n.date)&&(n.date=i.split(Ud.timeZoneDelimiter)[0],h=i.substr(n.date.length,i.length))),h){const p=Ud.timezone.exec(h);p?(n.time=h.replace(p[1],""),n.timezone=p[1]):n.time=h}return n}function gC(i,n){const o=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+n)+"})|(\\d{2}|[+-]\\d{"+(2+n)+"})$)"),h=i.match(o);if(!h)return{year:NaN,restDateString:""};const p=h[1]?parseInt(h[1]):null,b=h[2]?parseInt(h[2]):null;return{year:b===null?p:b*100,restDateString:i.slice((h[1]||h[2]).length)}}function yC(i,n){if(n===null)return new Date(NaN);const o=i.match(dC);if(!o)return new Date(NaN);const h=!!o[4],p=Wu(o[1]),b=Wu(o[2])-1,_=Wu(o[3]),c=Wu(o[4]),A=Wu(o[5])-1;if(h)return SC(n,c,A)?bC(n,c,A):new Date(NaN);{const O=new Date(0);return!wC(n,b,_)||!TC(n,p)?new Date(NaN):(O.setUTCFullYear(n,b,Math.max(p,_)),O)}}function Wu(i){return i?parseInt(i):1}function _C(i){const n=i.match(fC);if(!n)return NaN;const o=Pm(n[1]),h=Pm(n[2]),p=Pm(n[3]);return kC(o,h,p)?o*ix+h*tx+p*1e3:NaN}function Pm(i){return i&&parseFloat(i.replace(",","."))||0}function vC(i){if(i==="Z")return 0;const n=i.match(pC);if(!n)return 0;const o=n[1]==="+"?-1:1,h=parseInt(n[2]),p=n[3]&&parseInt(n[3])||0;return MC(h,p)?o*(h*ix+p*tx):NaN}function bC(i,n,o){const h=new Date(0);h.setUTCFullYear(i,0,4);const p=h.getUTCDay()||7,b=(n-1)*7+o+1-p;return h.setUTCDate(h.getUTCDate()+b),h}const xC=[31,null,31,30,31,30,31,31,30,31,30,31];function sx(i){return i%400===0||i%4===0&&i%100!==0}function wC(i,n,o){return n>=0&&n<=11&&o>=1&&o<=(xC[n]||(sx(i)?29:28))}function TC(i,n){return n>=1&&n<=(sx(i)?366:365)}function SC(i,n,o){return n>=1&&n<=53&&o>=0&&o<=6}function kC(i,n,o){return i===24?n===0&&o===0:o>=0&&o<60&&n>=0&&n<60&&i>=0&&i<25}function MC(i,n){return n>=0&&n<=59}var Ne;(function(i){i[i.Custom=1]="Custom",i[i.Day=10]="Day",i[i.DayTime=11]="DayTime",i[i.TimeOnly=15]="TimeOnly",i[i.Week=20]="Week",i[i.WeekSun=21]="WeekSun",i[i.WeekMon=22]="WeekMon",i[i.WeekTue=23]="WeekTue",i[i.WeekWed=24]="WeekWed",i[i.WeekThu=25]="WeekThu",i[i.WeekFri=26]="WeekFri",i[i.WeekSat=27]="WeekSat",i[i.Month=30]="Month",i[i.MonthYear=31]="MonthYear",i[i.Quarter=40]="Quarter",i[i.CalendarYear=50]="CalendarYear",i[i.FiscalYearOctober=60]="FiscalYearOctober",i[i.BiWeek1=70]="BiWeek1",i[i.BiWeek1Sun=71]="BiWeek1Sun",i[i.BiWeek1Mon=72]="BiWeek1Mon",i[i.BiWeek1Tue=73]="BiWeek1Tue",i[i.BiWeek1Wed=74]="BiWeek1Wed",i[i.BiWeek1Thu=75]="BiWeek1Thu",i[i.BiWeek1Fri=76]="BiWeek1Fri",i[i.BiWeek1Sat=77]="BiWeek1Sat",i[i.BiWeek2=80]="BiWeek2",i[i.BiWeek2Sun=81]="BiWeek2Sun",i[i.BiWeek2Mon=82]="BiWeek2Mon",i[i.BiWeek2Tue=83]="BiWeek2Tue",i[i.BiWeek2Wed=84]="BiWeek2Wed",i[i.BiWeek2Thu=85]="BiWeek2Thu",i[i.BiWeek2Fri=86]="BiWeek2Fri",i[i.BiWeek2Sat=87]="BiWeek2Sat"})(Ne||(Ne={}));var oh;(function(i){i[i.Sunday=0]="Sunday",i[i.Monday=1]="Monday",i[i.Tuesday=2]="Tuesday",i[i.Wednesday=3]="Wednesday",i[i.Thursday=4]="Thursday",i[i.Friday=5]="Friday",i[i.Saturday=6]="Saturday"})(oh||(oh={}));var mt;(function(i){i.Year_numeric="yyy",i.Year_2Digit="yy",i.Month_long="MMMM",i.Month_short="MMM",i.Month_2Digit="MM",i.Month_numeric="M",i.Hour_numeric="h",i.Hour_2Digit="hh",i.Hour_wAMPM="a",i.Hour_woAMPM="aaaaaa",i.Minute_numeric="m",i.Minute_2Digit="mm",i.Second_numeric="s",i.Second_2Digit="ss",i.MiliSecond_3="SSS",i.DayOfMonth_numeric="d",i.DayOfMonth_2Digit="dd",i.DayOfMonth_withOrdinal="do",i.DayOfWeek_narrow="eeeee",i.DayOfWeek_long="eeee",i.DayOfWeek_short="eee"})(mt||(mt={}));const l0="-",AC=i=>{const n=EC(i),{conflictingClassGroups:o,conflictingClassGroupModifiers:h}=i;return{getClassGroupId:_=>{const c=_.split(l0);return c[0]===""&&c.length!==1&&c.shift(),ax(c,n)||IC(_)},getConflictingClassGroupIds:(_,c)=>{const A=o[_]||[];return c&&h[_]?[...A,...h[_]]:A}}},ax=(i,n)=>{var _;if(i.length===0)return n.classGroupId;const o=i[0],h=n.nextPart.get(o),p=h?ax(i.slice(1),h):void 0;if(p)return p;if(n.validators.length===0)return;const b=i.join(l0);return(_=n.validators.find(({validator:c})=>c(b)))==null?void 0:_.classGroupId},_v=/^\[(.+)\]$/,IC=i=>{if(_v.test(i)){const n=_v.exec(i)[1],o=n==null?void 0:n.substring(0,n.indexOf(":"));if(o)return"arbitrary.."+o}},EC=i=>{const{theme:n,prefix:o}=i,h={nextPart:new Map,validators:[]};return PC(Object.entries(i.classGroups),o).forEach(([b,_])=>{Sg(_,h,b,n)}),h},Sg=(i,n,o,h)=>{i.forEach(p=>{if(typeof p=="string"){const b=p===""?n:vv(n,p);b.classGroupId=o;return}if(typeof p=="function"){if(CC(p)){Sg(p(h),n,o,h);return}n.validators.push({validator:p,classGroupId:o});return}Object.entries(p).forEach(([b,_])=>{Sg(_,vv(n,b),o,h)})})},vv=(i,n)=>{let o=i;return n.split(l0).forEach(h=>{o.nextPart.has(h)||o.nextPart.set(h,{nextPart:new Map,validators:[]}),o=o.nextPart.get(h)}),o},CC=i=>i.isThemeGetter,PC=(i,n)=>n?i.map(([o,h])=>{const p=h.map(b=>typeof b=="string"?n+b:typeof b=="object"?Object.fromEntries(Object.entries(b).map(([_,c])=>[n+_,c])):b);return[o,p]}):i,zC=i=>{if(i<1)return{get:()=>{},set:()=>{}};let n=0,o=new Map,h=new Map;const p=(b,_)=>{o.set(b,_),n++,n>i&&(n=0,h=o,o=new Map)};return{get(b){let _=o.get(b);if(_!==void 0)return _;if((_=h.get(b))!==void 0)return p(b,_),_},set(b,_){o.has(b)?o.set(b,_):p(b,_)}}},ox="!",DC=i=>{const{separator:n,experimentalParseClassName:o}=i,h=n.length===1,p=n[0],b=n.length,_=c=>{const A=[];let O=0,B=0,R;for(let ae=0;ae<c.length;ae++){let Z=c[ae];if(O===0){if(Z===p&&(h||c.slice(ae,ae+b)===n)){A.push(c.slice(B,ae)),B=ae+b;continue}if(Z==="/"){R=ae;continue}}Z==="["?O++:Z==="]"&&O--}const C=A.length===0?c:c.substring(B),Y=C.startsWith(ox),X=Y?C.substring(1):C,H=R&&R>B?R-B:void 0;return{modifiers:A,hasImportantModifier:Y,baseClassName:X,maybePostfixModifierPosition:H}};return o?c=>o({className:c,parseClassName:_}):_},LC=i=>{if(i.length<=1)return i;const n=[];let o=[];return i.forEach(h=>{h[0]==="["?(n.push(...o.sort(),h),o=[]):o.push(h)}),n.push(...o.sort()),n},RC=i=>({cache:zC(i.cacheSize),parseClassName:DC(i),...AC(i)}),OC=/\s+/,BC=(i,n)=>{const{parseClassName:o,getClassGroupId:h,getConflictingClassGroupIds:p}=n,b=[],_=i.trim().split(OC);let c="";for(let A=_.length-1;A>=0;A-=1){const O=_[A],{modifiers:B,hasImportantModifier:R,baseClassName:C,maybePostfixModifierPosition:Y}=o(O);let X=!!Y,H=h(X?C.substring(0,Y):C);if(!H){if(!X){c=O+(c.length>0?" "+c:c);continue}if(H=h(C),!H){c=O+(c.length>0?" "+c:c);continue}X=!1}const ae=LC(B).join(":"),Z=R?ae+ox:ae,te=Z+H;if(b.includes(te))continue;b.push(te);const ne=p(H,X);for(let _e=0;_e<ne.length;++_e){const ve=ne[_e];b.push(Z+ve)}c=O+(c.length>0?" "+c:c)}return c};function FC(){let i=0,n,o,h="";for(;i<arguments.length;)(n=arguments[i++])&&(o=lx(n))&&(h&&(h+=" "),h+=o);return h}const lx=i=>{if(typeof i=="string")return i;let n,o="";for(let h=0;h<i.length;h++)i[h]&&(n=lx(i[h]))&&(o&&(o+=" "),o+=n);return o};function bv(i,...n){let o,h,p,b=_;function _(A){const O=n.reduce((B,R)=>R(B),i());return o=RC(O),h=o.cache.get,p=o.cache.set,b=c,c(A)}function c(A){const O=h(A);if(O)return O;const B=BC(A,o);return p(A,B),B}return function(){return b(FC.apply(null,arguments))}}const an=i=>{const n=o=>o[i]||[];return n.isThemeGetter=!0,n},cx=/^\[(?:([a-z-]+):)?(.+)\]$/i,NC=/^\d+\/\d+$/,$C=new Set(["px","full","screen"]),jC=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,VC=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,UC=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,WC=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,qC=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,pa=i=>fc(i)||$C.has(i)||NC.test(i),Ya=i=>Cc(i,"length",QC),fc=i=>!!i&&!Number.isNaN(Number(i)),zm=i=>Cc(i,"number",fc),qu=i=>!!i&&Number.isInteger(Number(i)),ZC=i=>i.endsWith("%")&&fc(i.slice(0,-1)),ui=i=>cx.test(i),Ka=i=>jC.test(i),GC=new Set(["length","size","percentage"]),HC=i=>Cc(i,GC,ux),XC=i=>Cc(i,"position",ux),YC=new Set(["image","url"]),KC=i=>Cc(i,YC,t4),JC=i=>Cc(i,"",e4),Zu=()=>!0,Cc=(i,n,o)=>{const h=cx.exec(i);return h?h[1]?typeof n=="string"?h[1]===n:n.has(h[1]):o(h[2]):!1},QC=i=>VC.test(i)&&!UC.test(i),ux=()=>!1,e4=i=>WC.test(i),t4=i=>qC.test(i),xv=()=>{const i=an("colors"),n=an("spacing"),o=an("blur"),h=an("brightness"),p=an("borderColor"),b=an("borderRadius"),_=an("borderSpacing"),c=an("borderWidth"),A=an("contrast"),O=an("grayscale"),B=an("hueRotate"),R=an("invert"),C=an("gap"),Y=an("gradientColorStops"),X=an("gradientColorStopPositions"),H=an("inset"),ae=an("margin"),Z=an("opacity"),te=an("padding"),ne=an("saturate"),_e=an("scale"),ve=an("sepia"),Se=an("skew"),de=an("space"),Fe=an("translate"),Re=()=>["auto","contain","none"],Le=()=>["auto","hidden","clip","visible","scroll"],Te=()=>["auto",ui,n],we=()=>[ui,n],fe=()=>["",pa,Ya],Ae=()=>["auto",fc,ui],Ce=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Ve=()=>["solid","dashed","dotted","double","none"],Ue=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ge=()=>["start","end","center","between","around","evenly","stretch"],Oe=()=>["","0",ui],Xe=()=>["auto","avoid","all","avoid-page","page","left","right","column"],We=()=>[fc,ui];return{cacheSize:500,separator:":",theme:{colors:[Zu],spacing:[pa,Ya],blur:["none","",Ka,ui],brightness:We(),borderColor:[i],borderRadius:["none","","full",Ka,ui],borderSpacing:we(),borderWidth:fe(),contrast:We(),grayscale:Oe(),hueRotate:We(),invert:Oe(),gap:we(),gradientColorStops:[i],gradientColorStopPositions:[ZC,Ya],inset:Te(),margin:Te(),opacity:We(),padding:we(),saturate:We(),scale:We(),sepia:Oe(),skew:We(),space:we(),translate:we()},classGroups:{aspect:[{aspect:["auto","square","video",ui]}],container:["container"],columns:[{columns:[Ka]}],"break-after":[{"break-after":Xe()}],"break-before":[{"break-before":Xe()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ce(),ui]}],overflow:[{overflow:Le()}],"overflow-x":[{"overflow-x":Le()}],"overflow-y":[{"overflow-y":Le()}],overscroll:[{overscroll:Re()}],"overscroll-x":[{"overscroll-x":Re()}],"overscroll-y":[{"overscroll-y":Re()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[H]}],"inset-x":[{"inset-x":[H]}],"inset-y":[{"inset-y":[H]}],start:[{start:[H]}],end:[{end:[H]}],top:[{top:[H]}],right:[{right:[H]}],bottom:[{bottom:[H]}],left:[{left:[H]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",qu,ui]}],basis:[{basis:Te()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ui]}],grow:[{grow:Oe()}],shrink:[{shrink:Oe()}],order:[{order:["first","last","none",qu,ui]}],"grid-cols":[{"grid-cols":[Zu]}],"col-start-end":[{col:["auto",{span:["full",qu,ui]},ui]}],"col-start":[{"col-start":Ae()}],"col-end":[{"col-end":Ae()}],"grid-rows":[{"grid-rows":[Zu]}],"row-start-end":[{row:["auto",{span:[qu,ui]},ui]}],"row-start":[{"row-start":Ae()}],"row-end":[{"row-end":Ae()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ui]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ui]}],gap:[{gap:[C]}],"gap-x":[{"gap-x":[C]}],"gap-y":[{"gap-y":[C]}],"justify-content":[{justify:["normal",...Ge()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ge(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ge(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[te]}],px:[{px:[te]}],py:[{py:[te]}],ps:[{ps:[te]}],pe:[{pe:[te]}],pt:[{pt:[te]}],pr:[{pr:[te]}],pb:[{pb:[te]}],pl:[{pl:[te]}],m:[{m:[ae]}],mx:[{mx:[ae]}],my:[{my:[ae]}],ms:[{ms:[ae]}],me:[{me:[ae]}],mt:[{mt:[ae]}],mr:[{mr:[ae]}],mb:[{mb:[ae]}],ml:[{ml:[ae]}],"space-x":[{"space-x":[de]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[de]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ui,n]}],"min-w":[{"min-w":[ui,n,"min","max","fit"]}],"max-w":[{"max-w":[ui,n,"none","full","min","max","fit","prose",{screen:[Ka]},Ka]}],h:[{h:[ui,n,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ui,n,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ui,n,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ui,n,"auto","min","max","fit"]}],"font-size":[{text:["base",Ka,Ya]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",zm]}],"font-family":[{font:[Zu]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ui]}],"line-clamp":[{"line-clamp":["none",fc,zm]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",pa,ui]}],"list-image":[{"list-image":["none",ui]}],"list-style-type":[{list:["none","disc","decimal",ui]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[i]}],"placeholder-opacity":[{"placeholder-opacity":[Z]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[i]}],"text-opacity":[{"text-opacity":[Z]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Ve(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",pa,Ya]}],"underline-offset":[{"underline-offset":["auto",pa,ui]}],"text-decoration-color":[{decoration:[i]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:we()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ui]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ui]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Z]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ce(),XC]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",HC]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},KC]}],"bg-color":[{bg:[i]}],"gradient-from-pos":[{from:[X]}],"gradient-via-pos":[{via:[X]}],"gradient-to-pos":[{to:[X]}],"gradient-from":[{from:[Y]}],"gradient-via":[{via:[Y]}],"gradient-to":[{to:[Y]}],rounded:[{rounded:[b]}],"rounded-s":[{"rounded-s":[b]}],"rounded-e":[{"rounded-e":[b]}],"rounded-t":[{"rounded-t":[b]}],"rounded-r":[{"rounded-r":[b]}],"rounded-b":[{"rounded-b":[b]}],"rounded-l":[{"rounded-l":[b]}],"rounded-ss":[{"rounded-ss":[b]}],"rounded-se":[{"rounded-se":[b]}],"rounded-ee":[{"rounded-ee":[b]}],"rounded-es":[{"rounded-es":[b]}],"rounded-tl":[{"rounded-tl":[b]}],"rounded-tr":[{"rounded-tr":[b]}],"rounded-br":[{"rounded-br":[b]}],"rounded-bl":[{"rounded-bl":[b]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[Z]}],"border-style":[{border:[...Ve(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Z]}],"divide-style":[{divide:Ve()}],"border-color":[{border:[p]}],"border-color-x":[{"border-x":[p]}],"border-color-y":[{"border-y":[p]}],"border-color-s":[{"border-s":[p]}],"border-color-e":[{"border-e":[p]}],"border-color-t":[{"border-t":[p]}],"border-color-r":[{"border-r":[p]}],"border-color-b":[{"border-b":[p]}],"border-color-l":[{"border-l":[p]}],"divide-color":[{divide:[p]}],"outline-style":[{outline:["",...Ve()]}],"outline-offset":[{"outline-offset":[pa,ui]}],"outline-w":[{outline:[pa,Ya]}],"outline-color":[{outline:[i]}],"ring-w":[{ring:fe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[i]}],"ring-opacity":[{"ring-opacity":[Z]}],"ring-offset-w":[{"ring-offset":[pa,Ya]}],"ring-offset-color":[{"ring-offset":[i]}],shadow:[{shadow:["","inner","none",Ka,JC]}],"shadow-color":[{shadow:[Zu]}],opacity:[{opacity:[Z]}],"mix-blend":[{"mix-blend":[...Ue(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ue()}],filter:[{filter:["","none"]}],blur:[{blur:[o]}],brightness:[{brightness:[h]}],contrast:[{contrast:[A]}],"drop-shadow":[{"drop-shadow":["","none",Ka,ui]}],grayscale:[{grayscale:[O]}],"hue-rotate":[{"hue-rotate":[B]}],invert:[{invert:[R]}],saturate:[{saturate:[ne]}],sepia:[{sepia:[ve]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[o]}],"backdrop-brightness":[{"backdrop-brightness":[h]}],"backdrop-contrast":[{"backdrop-contrast":[A]}],"backdrop-grayscale":[{"backdrop-grayscale":[O]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[B]}],"backdrop-invert":[{"backdrop-invert":[R]}],"backdrop-opacity":[{"backdrop-opacity":[Z]}],"backdrop-saturate":[{"backdrop-saturate":[ne]}],"backdrop-sepia":[{"backdrop-sepia":[ve]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[_]}],"border-spacing-x":[{"border-spacing-x":[_]}],"border-spacing-y":[{"border-spacing-y":[_]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ui]}],duration:[{duration:We()}],ease:[{ease:["linear","in","out","in-out",ui]}],delay:[{delay:We()}],animate:[{animate:["none","spin","ping","pulse","bounce",ui]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[_e]}],"scale-x":[{"scale-x":[_e]}],"scale-y":[{"scale-y":[_e]}],rotate:[{rotate:[qu,ui]}],"translate-x":[{"translate-x":[Fe]}],"translate-y":[{"translate-y":[Fe]}],"skew-x":[{"skew-x":[Se]}],"skew-y":[{"skew-y":[Se]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ui]}],accent:[{accent:["auto",i]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ui]}],"caret-color":[{caret:[i]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":we()}],"scroll-mx":[{"scroll-mx":we()}],"scroll-my":[{"scroll-my":we()}],"scroll-ms":[{"scroll-ms":we()}],"scroll-me":[{"scroll-me":we()}],"scroll-mt":[{"scroll-mt":we()}],"scroll-mr":[{"scroll-mr":we()}],"scroll-mb":[{"scroll-mb":we()}],"scroll-ml":[{"scroll-ml":we()}],"scroll-p":[{"scroll-p":we()}],"scroll-px":[{"scroll-px":we()}],"scroll-py":[{"scroll-py":we()}],"scroll-ps":[{"scroll-ps":we()}],"scroll-pe":[{"scroll-pe":we()}],"scroll-pt":[{"scroll-pt":we()}],"scroll-pr":[{"scroll-pr":we()}],"scroll-pb":[{"scroll-pb":we()}],"scroll-pl":[{"scroll-pl":we()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ui]}],fill:[{fill:[i,"none"]}],"stroke-w":[{stroke:[pa,Ya,zm]}],stroke:[{stroke:[i,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},i4=(i,{cacheSize:n,prefix:o,separator:h,experimentalParseClassName:p,extend:b={},override:_={}})=>{Xu(i,"cacheSize",n),Xu(i,"prefix",o),Xu(i,"separator",h),Xu(i,"experimentalParseClassName",p);for(const c in _)n4(i[c],_[c]);for(const c in b)r4(i[c],b[c]);return i},Xu=(i,n,o)=>{o!==void 0&&(i[n]=o)},n4=(i,n)=>{if(n)for(const o in n)Xu(i,o,n[o])},r4=(i,n)=>{if(n)for(const o in n){const h=n[o];h!==void 0&&(i[o]=(i[o]||[]).concat(h))}},s4=(i,...n)=>typeof i=="function"?bv(xv,i,...n):bv(()=>i4(xv(),i),...n),a4=s4({extend:{classGroups:{shadow:["shadow-border-l","shadow-border-r","shadow-border-t","shadow-border-b","elevation-none",...Db(1,25).map(i=>`elevation-${i}`)]}}}),to=(...i)=>a4(m1(...i));class Dm{constructor(n,o){lr(this,"theme");lr(this,"dark");this.theme=n,this.dark=o}get resolvedTheme(){return this.theme?this.theme:this.dark?"dark":"light"}}function o4(i){let n=vn(new Dm(null,!1)),o=window.matchMedia("(prefers-color-scheme: dark)");function h({matches:_}){_&&i.dark.length?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),n.set(new Dm(null,_))}function p(_){if(_==="system")localStorage.removeItem("theme"),delete document.documentElement.dataset.theme,h(o),o.addEventListener("change",h);else{o.removeEventListener("change",h),localStorage.theme=_,document.documentElement.dataset.theme=_;let c=i.dark.includes(_);c?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),n.set(new Dm(_,c))}}let b=localStorage.getItem("theme")||"system";return p(b),{subscribe:n.subscribe,setTheme:p}}function l4(i){var h;if(!i)return oh.Sunday;const n=new Intl.Locale(i),o=n.weekInfo??((h=n.getWeekInfo)==null?void 0:h.call(n));return((o==null?void 0:o.firstDay)??0)%7}function c4(i,n){return jr(i,o=>{let h;return o!=null&&o.length&&(Array.isArray(o)?h=o[0]:h=o),h??n??"en"})}function u4(i,n){let o=vn(i??null);return{...c4(o,n),set(p){o.set(p)}}}const h4={locale:"en",dictionary:{Ok:"Ok",Cancel:"Cancel",Date:{Start:"Start",End:"End",Empty:"Empty",Day:"Day",DayTime:"Day Time",Time:"Time",Week:"Week",BiWeek:"Bi-Week",Month:"Month",Quarter:"Quarter",CalendarYear:"Calendar Year",FiscalYearOct:"Fiscal Year (Oct)",PeriodDay:{Current:"Today",Last:"Yesterday",LastX:"Last {0} days"},PeriodWeek:{Current:"This week",Last:"Last week",LastX:"Last {0} weeks"},PeriodBiWeek:{Current:"This bi-week",Last:"Last bi-week",LastX:"Last {0} bi-weeks"},PeriodMonth:{Current:"This month",Last:"Last month",LastX:"Last {0} months"},PeriodQuarter:{Current:"This quarter",Last:"Last quarter",LastX:"Last {0} quarters"},PeriodQuarterSameLastyear:"Same quarter last year",PeriodYear:{Current:"This year",Last:"Last year",LastX:"Last {0} years"},PeriodFiscalYear:{Current:"This fiscal year",Last:"Last fiscal year",LastX:"Last {0} fiscal years"}}},formats:{numbers:{defaults:{currency:"USD",fractionDigits:2,currencyDisplay:"symbol"}},dates:{baseParsing:"MM/dd/yyyy",weekStartsOn:oh.Sunday,ordinalSuffixes:{one:"st",two:"nd",few:"rd",other:"th"},presets:{day:{short:[mt.DayOfMonth_numeric,mt.Month_numeric],default:[mt.DayOfMonth_numeric,mt.Month_numeric,mt.Year_numeric],long:[mt.DayOfMonth_numeric,mt.Month_short,mt.Year_numeric]},dayTime:{short:[mt.DayOfMonth_numeric,mt.Month_numeric,mt.Year_numeric,mt.Hour_numeric,mt.Minute_numeric],default:[mt.DayOfMonth_numeric,mt.Month_numeric,mt.Year_numeric,mt.Hour_2Digit,mt.Minute_2Digit],long:[mt.DayOfMonth_numeric,mt.Month_numeric,mt.Year_numeric,mt.Hour_2Digit,mt.Minute_2Digit,mt.Second_2Digit]},timeOnly:{short:[mt.Hour_numeric,mt.Minute_numeric],default:[mt.Hour_2Digit,mt.Minute_2Digit,mt.Second_2Digit],long:[mt.Hour_2Digit,mt.Minute_2Digit,mt.Second_2Digit,mt.MiliSecond_3]},week:{short:[mt.DayOfMonth_numeric,mt.Month_numeric],default:[mt.DayOfMonth_numeric,mt.Month_numeric,mt.Year_numeric],long:[mt.DayOfMonth_numeric,mt.Month_numeric,mt.Year_numeric]},month:{short:mt.Month_short,default:mt.Month_short,long:mt.Month_long},monthsYear:{short:[mt.Month_short,mt.Year_2Digit],default:[mt.Month_long,mt.Year_numeric],long:[mt.Month_long,mt.Year_numeric]},year:{short:mt.Year_2Digit,default:mt.Year_numeric,long:mt.Year_numeric}}}}};function hx(i,n=h4){var o,h,p,b;return(h=(o=i.formats)==null?void 0:o.dates)!=null&&h.ordinalSuffixes&&(i.formats.dates.ordinalSuffixes={one:"",two:"",few:"",other:"",zero:"",many:"",...i.formats.dates.ordinalSuffixes}),((b=(p=i.formats)==null?void 0:p.dates)==null?void 0:b.weekStartsOn)===void 0&&(i=fv(i,{formats:{dates:{weekStartsOn:l4(i.locale)}}})),fv(i,n)}const d4=hx({locale:"en"});function f4(i){const n=i?Lb(i).map(([o,h])=>[o,hx(h)]):[];return{en:d4,...Rb(n)}}function p4(i){return E3.length===0?i:Rb(Lb(i).filter(([n,o])=>o!=null))}function Sn(i,n){const o=new Date(2024,0,7+i);return new Intl.DateTimeFormat(n,{weekday:"short"}).format(o)}function m4(i,n){const{locale:o,dictionary:{Date:h}}=i;switch(n){case Ne.Custom:return"Custom";case Ne.Day:return h.Day;case Ne.DayTime:return h.DayTime;case Ne.TimeOnly:return h.Time;case Ne.WeekSun:return`${h.Week} (${Sn(oh.Sunday,o)})`;case Ne.WeekMon:return`${h.Week} (${Sn(1,o)})`;case Ne.WeekTue:return`${h.Week} (${Sn(2,o)})`;case Ne.WeekWed:return`${h.Week} (${Sn(3,o)})`;case Ne.WeekThu:return`${h.Week} (${Sn(4,o)})`;case Ne.WeekFri:return`${h.Week} (${Sn(5,o)})`;case Ne.WeekSat:return`${h.Week} (${Sn(6,o)})`;case Ne.Week:return h.Week;case Ne.Month:return h.Month;case Ne.MonthYear:return h.Month;case Ne.Quarter:return h.Quarter;case Ne.CalendarYear:return h.CalendarYear;case Ne.FiscalYearOctober:return h.FiscalYearOct;case Ne.BiWeek1Sun:return`${h.BiWeek} (${Sn(0,o)})`;case Ne.BiWeek1Mon:return`${h.BiWeek} (${Sn(1,o)})`;case Ne.BiWeek1Tue:return`${h.BiWeek} (${Sn(2,o)})`;case Ne.BiWeek1Wed:return`${h.BiWeek} (${Sn(3,o)})`;case Ne.BiWeek1Thu:return`${h.BiWeek} (${Sn(4,o)})`;case Ne.BiWeek1Fri:return`${h.BiWeek} (${Sn(5,o)})`;case Ne.BiWeek1Sat:return`${h.BiWeek} (${Sn(6,o)})`;case Ne.BiWeek1:return h.BiWeek;case Ne.BiWeek2Sun:return`${h.BiWeek} 2 (${Sn(0,o)})`;case Ne.BiWeek2Mon:return`${h.BiWeek} 2 (${Sn(1,o)})`;case Ne.BiWeek2Tue:return`${h.BiWeek} 2 (${Sn(2,o)})`;case Ne.BiWeek2Wed:return`${h.BiWeek} 2 (${Sn(3,o)})`;case Ne.BiWeek2Thu:return`${h.BiWeek} 2 (${Sn(4,o)})`;case Ne.BiWeek2Fri:return`${h.BiWeek} 2 (${Sn(5,o)})`;case Ne.BiWeek2Sat:return`${h.BiWeek} 2 (${Sn(6,o)})`;case Ne.BiWeek2:return`${h.BiWeek} 2`;default:C3(n)}}Ne.Custom+"",Ne.Day+"",Ne.DayTime+"",Ne.TimeOnly+"",Ne.WeekSun+"",Ne.WeekMon+"",Ne.WeekTue+"",Ne.WeekWed+"",Ne.WeekThu+"",Ne.WeekFri+"",Ne.WeekSat+"",Ne.Week+"",Ne.Month+"",Ne.MonthYear+"",Ne.Quarter+"",Ne.CalendarYear+"",Ne.FiscalYearOctober+"",Ne.BiWeek1Sun+"",Ne.BiWeek1Mon+"",Ne.BiWeek1Tue+"",Ne.BiWeek1Wed+"",Ne.BiWeek1Thu+"",Ne.BiWeek1Fri+"",Ne.BiWeek1Sat+"",Ne.BiWeek1+"",Ne.BiWeek2Sun+"",Ne.BiWeek2Mon+"",Ne.BiWeek2Tue+"",Ne.BiWeek2Wed+"",Ne.BiWeek2Thu+"",Ne.BiWeek2Fri+"",Ne.BiWeek2Sat+"",Ne.BiWeek2+"";function g4(i=new Date,n){return i===null?NaN:i.getMonth()>=10-1?i.getFullYear()+1:i.getFullYear()}const y4=[new Date("1799-12-22T00:00"),new Date("1799-12-15T00:00")];function dx(i,n,o){var h=y4[n-1],p=Tg(h,o),b=Math.floor(aC(i,p)/14);return Tg(p,b*14)}function _4(i,n,o){return Tg(dx(i,n,o),13)}function fs(i,n,o){const{locale:h,formats:{dates:{ordinalSuffixes:p}}}=i;function b(A,O=!1){if(O){const B=new Intl.PluralRules(h,{type:"ordinal"});return A.formatToParts(n).map(C=>{if(C.type==="day"){const Y=B.select(parseInt(C.value,10)),X=p[Y];return`${C.value}${X}`}return C.value}).join("")}return A.format(n)}if(typeof o!="string"&&!Array.isArray(o))return b(new Intl.DateTimeFormat(h,o),o.withOrdinal);const _=Array.isArray(o)?o.join(""):o,c=new Intl.DateTimeFormat(h,{year:_.includes(mt.Year_numeric)?"numeric":_.includes(mt.Year_2Digit)?"2-digit":void 0,month:_.includes(mt.Month_long)?"long":_.includes(mt.Month_short)?"short":_.includes(mt.Month_2Digit)?"2-digit":_.includes(mt.Month_numeric)?"numeric":void 0,day:_.includes(mt.DayOfMonth_2Digit)?"2-digit":_.includes(mt.DayOfMonth_numeric)?"numeric":void 0,hour:_.includes(mt.Hour_2Digit)?"2-digit":_.includes(mt.Hour_numeric)?"numeric":void 0,hour12:_.includes(mt.Hour_woAMPM)?!1:_.includes(mt.Hour_wAMPM)?!0:void 0,minute:_.includes(mt.Minute_2Digit)?"2-digit":_.includes(mt.Minute_numeric)?"numeric":void 0,second:_.includes(mt.Second_2Digit)?"2-digit":_.includes(mt.Second_numeric)?"numeric":void 0,fractionalSecondDigits:_.includes(mt.MiliSecond_3)?3:void 0,weekday:_.includes(mt.DayOfWeek_narrow)?"narrow":_.includes(mt.DayOfWeek_long)?"long":_.includes(mt.DayOfWeek_short)?"short":void 0});return b(c,_.includes(mt.DayOfMonth_withOrdinal))}function In(i,n,o,h,p=void 0){const b=p===void 0?rC(n,{weekStartsOn:o}):dx(n,p,o),_=p===void 0?lC(n,{weekStartsOn:o}):_4(n,p,o);return fs(i,b,h)+" - "+fs(i,_,h)}function v4(i,n){return n===Ne.Week?n=[Ne.WeekSun,Ne.WeekMon,Ne.WeekTue,Ne.WeekWed,Ne.WeekThu,Ne.WeekFri,Ne.WeekSat][i]:n===Ne.BiWeek1?n=[Ne.BiWeek1Sun,Ne.BiWeek1Mon,Ne.BiWeek1Tue,Ne.BiWeek1Wed,Ne.BiWeek1Thu,Ne.BiWeek1Fri,Ne.BiWeek1Sat][i]:n===Ne.BiWeek2&&(n=[Ne.BiWeek2Sun,Ne.BiWeek2Mon,Ne.BiWeek2Tue,Ne.BiWeek2Wed,Ne.BiWeek2Thu,Ne.BiWeek2Fri,Ne.BiWeek2Sat][i]),n}function b4(i,n,o,h={}){if(typeof n=="string"&&(n=hC(n)),n==null||isNaN(n))return"";const p=h.weekStartsOn??i.formats.dates.weekStartsOn,{day:b,dayTime:_,timeOnly:c,week:A,month:O,monthsYear:B,year:R}=i.formats.dates.presets;o=v4(p,o)??o;function C(Y){return h.variant==="custom"?h.custom??Y.default:h.custom&&!h.variant?h.custom:Y[h.variant??"default"]}switch(o){case Ne.Custom:return fs(i,n,h.custom);case Ne.Day:return fs(i,n,C(b));case Ne.DayTime:return fs(i,n,C(_));case Ne.TimeOnly:return fs(i,n,C(c));case Ne.Week:case Ne.WeekSun:return In(i,n,0,C(A));case Ne.WeekMon:return In(i,n,1,C(A));case Ne.WeekTue:return In(i,n,2,C(A));case Ne.WeekWed:return In(i,n,3,C(A));case Ne.WeekThu:return In(i,n,4,C(A));case Ne.WeekFri:return In(i,n,5,C(A));case Ne.WeekSat:return In(i,n,6,C(A));case Ne.Month:return fs(i,n,C(O));case Ne.MonthYear:return fs(i,n,C(B));case Ne.Quarter:return[fs(i,oC(n),C(O)),fs(i,cC(n),C(B))].join(" - ");case Ne.CalendarYear:return fs(i,n,C(R));case Ne.FiscalYearOctober:const Y=new Date(g4(n),0,1);return fs(i,Y,C(R));case Ne.BiWeek1:case Ne.BiWeek1Sun:return In(i,n,0,C(A),1);case Ne.BiWeek1Mon:return In(i,n,1,C(A),1);case Ne.BiWeek1Tue:return In(i,n,2,C(A),1);case Ne.BiWeek1Wed:return In(i,n,3,C(A),1);case Ne.BiWeek1Thu:return In(i,n,4,C(A),1);case Ne.BiWeek1Fri:return In(i,n,5,C(A),1);case Ne.BiWeek1Sat:return In(i,n,6,C(A),1);case Ne.BiWeek2:case Ne.BiWeek2Sun:return In(i,n,0,C(A),2);case Ne.BiWeek2Mon:return In(i,n,1,C(A),2);case Ne.BiWeek2Tue:return In(i,n,2,C(A),2);case Ne.BiWeek2Wed:return In(i,n,3,C(A),2);case Ne.BiWeek2Thu:return In(i,n,4,C(A),2);case Ne.BiWeek2Fri:return In(i,n,5,C(A),2);case Ne.BiWeek2Sat:return In(i,n,6,C(A),2);default:return uC(n)}}const x4=/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(.\d+|)(Z|(-|\+)\d{2}:\d{2}))?$/;function w4(i){return x4.test(i)}function T4(i,n){const{numbers:o}=i.formats,h=n&&n!="none"?o[n]:{};return{...o.defaults,...h}}function S4(i,n,o,h={}){if(n==null)return"";if(o==="none")return`${n}`;o==null&&(o=Number.isInteger(n)?"integer":"decimal");const p=T4(i,o),_=Intl.NumberFormat(i.locale,{...p,...o!=="default"&&{style:o},minimumFractionDigits:h.fractionDigits??p.fractionDigits,maximumFractionDigits:h.fractionDigits??p.fractionDigits,...p4(h),...o==="currencyRound"&&{style:"currency",minimumFractionDigits:0,maximumFractionDigits:0},...o==="percentRound"&&{style:"percent",minimumFractionDigits:0,maximumFractionDigits:0},...o==="metric"&&{style:"decimal",notation:"compact",minimumFractionDigits:0,maximumFractionDigits:0},...o==="integer"&&{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}}).format(n);let c=h.suffix??"";return c&&Math.abs(n)>=2&&h.suffixExtraIfMany!==""&&(c+=h.suffixExtraIfMany??"s"),`${_}${c}`}function k4(i,n,o,h){return typeof o=="function"?o(n):n instanceof Date||w4(n)||o&&o in Ne?b4(i,n,o??Ne.Day,h):typeof n=="number"?S4(i,n,o,h):typeof n=="string"?n:n==null?"":`${n}`}function M4(i){const n=(o,h,p)=>k4(i,o,h,p);return n.settings=i,n.getDayOfWeekName=o=>Sn(o,i.locale),n.getPeriodTypeName=o=>m4(i,o),n}function mo(i){{const n=window.matchMedia(i);return ro(n.matches,o=>{const h=p=>o(p.matches);return n.addEventListener("change",h),()=>n.removeEventListener("change",h)})}}const vh=i=>mo(`(min-width: ${i}px)`),Pc={sm:640,md:768,lg:1024,xl:1280,xxl:1536},A4=vh(Pc.sm);vh(Pc.md);vh(Pc.lg);vh(Pc.xl);vh(Pc.xxl);mo("screen");mo("print");mo("(prefers-color-scheme: dark)");mo("(prefers-color-scheme: light)");mo("(prefers-reduced-motion: reduce)");mo("(orientation: landscape)");mo("(orientation: portrait)");const I4=Symbol();function E4(i){if(i.locale&&i.localeSettings&&i.format)return{locale:i.locale,localeSettings:i.localeSettings,format:i.format};let n=f4(i.localeFormats),o=u4(i.forceLocale,i.fallbackLocale),h=jr(o,p=>{let b=n[p];return b||{...n.en,locale:p}});return{locale:o,localeSettings:h,format:jr(h,M4)}}function C4(){return vn(window.innerWidth>=Pc.md)}let Lm=null;function wv(){return Lm=Lm??{currentTheme:o4({light:["light"],dark:["dark"]}),componentSettingsCache:{},showDrawer:C4(),...E4({})},Lm}function P4(){try{return Wg(I4)??wv()}catch{return wv()}}function z4(i){return typeof i=="string"?{root:i}:i??{}}function Cf(i){var o,h;const n=P4();return z4((h=(o=n==null?void 0:n.components)==null?void 0:o[i])==null?void 0:h.classes)}var D4=Jv('<circle class="track svelte-c2dy19" fill="transparent"></circle>'),L4=Wt('<div><svg xmlns="http://www.w3.org/2000/svg" class="svelte-c2dy19"><!><circle class="path svelte-c2dy19" fill="transparent"></circle></svg> <div class="info svelte-c2dy19"><!></div></div>');function R4(i,n){const o=Ji(n,["children","$$slots","$$events","$$legacy"]);un(n,!1);const h=qi(),p=qi(),b=qi(),_=qi(),c=qi(),A=qi();let O=tt(n,"value",8,null),B=tt(n,"rotate",8,0),R=tt(n,"size",8,40),C=tt(n,"width",8,4),Y=tt(n,"track",8,!1),X=tt(n,"class",8,void 0);const H=Cf("ProgressCircle"),ae=20;ei(()=>Mi(O()),()=>{di(h,O()==null)}),ei(()=>{},()=>{di(p,2*Math.PI*ae)}),ei(()=>De(p),()=>{di(b,Math.round(De(p)*1e3)/1e3)}),ei(()=>(Mi(O()),De(p)),()=>{di(_,(100-(O()??0))/100*De(p)+"px")}),ei(()=>(Mi(C()),Mi(R())),()=>{di(c,ae/(1-C()/R()))}),ei(()=>(Mi(C()),Mi(R()),De(c)),()=>{di(A,C()/R()*De(c)*2)}),Br(),cn();var Z=L4();let te;var ne=pt(Z),_e=pt(ne);{var ve=Re=>{var Le=D4();ki(Le,"r",ae),ki(Le,"stroke-dashoffset",0),Ai(()=>{ki(Le,"cx",2*De(c)),ki(Le,"cy",2*De(c)),ki(Le,"stroke-width",De(A)),ki(Le,"stroke-dasharray",De(b))}),rt(Re,Le)};ji(_e,Re=>{Y()&&Re(ve)})}var Se=Ht(_e);ki(Se,"r",ae),ut(ne);var de=Ht(ne,2),Fe=pt(de);zi(Fe,n,"default",{},null),ut(de),ut(Z),Ai(()=>{te=Or(Z,te,{...o,class:to("ProgressCircular","relative inline-flex justify-center items-center align-middle",H.root,X()),style:`height: ${R()??""}px; width: ${R()??""}px; ${o.style??""}`},"svelte-c2dy19"),zT(Z,"indeterminate",De(h)),ki(ne,"style",`transform: rotate(${B()-(De(h)?0:90)}deg)`),ki(ne,"viewBox",`${De(c)??""}
    ${De(c)??""}
    ${2*De(c)}
    ${2*De(c)}`),ki(Se,"cx",2*De(c)),ki(Se,"cy",2*De(c)),ki(Se,"stroke-width",De(A)),ki(Se,"stroke-dasharray",De(b)),ki(Se,"stroke-dashoffset",De(_))}),rt(i,Z),hn()}var O4=Wt("<div><!></div>");function B4(i,n){un(n,!1);const o=qi(),h=qi();let p=tt(n,"center",8,!1),b=tt(n,"transition",24,()=>[af,{duration:100}]),_=tt(n,"class",8,void 0);const c=Cf("Overlay");ei(()=>(De(o),De(h),Mi(b())),()=>{(R=>(di(o,R[0]),di(h,R[1])))(b())}),Br(),cn();var A=O4();const O=ur(()=>el(to("Overlay","absolute top-0 bottom-0 left-0 right-0 z-30 bg-surface-100/75",p()&&"flex items-center justify-center",c.root,_())));var B=pt(A);zi(B,n,"default",{},null),ut(A),Ai(()=>lc(A,De(O),"")),Vn(3,A,()=>De(o),()=>De(h)),rt(i,A),hn()}var F4=Wt('<div role="none"><!></div>');function N4(i,n){un(n,!1);let o=tt(n,"blur",8,!1),h=tt(n,"portal",8,!1),p=tt(n,"class",8,void 0),b=tt(n,"fadeParams",24,()=>({duration:300}));const _=Cf("Backdrop");cn();var c=F4();const A=ur(()=>el(to("Backdrop","fixed top-0 bottom-0 left-0 right-0 flex items-center justify-center bg-surface-content/50 dark:bg-surface-300/70",o()&&"backdrop-blur-sm",_.root,p())));var O=pt(c);zi(O,n,"default",{},null),ut(c),Lt(()=>Ct("keydown",c,function(B){Ft.call(this,n,B)})),Lt(()=>Ct("keyup",c,function(B){Ft.call(this,n,B)})),Lt(()=>Ct("keypress",c,function(B){Ft.call(this,n,B)})),Lt(()=>Ct("click",c,function(B){Ft.call(this,n,B)})),Lt(()=>Ct("mousedown",c,function(B){Ft.call(this,n,B)})),Lt(()=>Ct("mouseup",c,function(B){Ft.call(this,n,B)})),Tr(c,(B,R)=>dc==null?void 0:dc(B,R),h),Ai(()=>lc(c,De(A),"")),Vn(5,c,()=>af,b),Vn(2,c,()=>af,b),rt(i,c),hn()}var $4=Wt("<div><!></div>"),j4=Wt("<div><!></div>"),V4=Wt('<div role="presentation"><div role="dialog"><!> <!> <!> <!></div></div>'),U4=Wt("<!> <!>",1);function W4(i,n){const o=AT(n),h=Ji(n,["children","$$slots","$$events","$$legacy"]);un(n,!1);const p=cl();let b=tt(n,"open",12,!1),_=tt(n,"portal",8,!0),c=tt(n,"persistent",8,!1),A=tt(n,"loading",8,null),O=tt(n,"classes",24,()=>({}));const B=Cf("Dialog");let R=qi(),C=qi();function Y(_e){try{if(!(_e.target instanceof Element))return;De(C)==null||De(C).contains(_e.target)&&_e.target!=De(C)&&!_e.target.hasAttribute("slot")&&X()}catch(ve){console.error(ve)}}function X(_e){const ve=(_e==null?void 0:_e.force)??!1;b()&&(!c()||ve?b(!1):p("closeAttempt"))}ei(()=>Mi(b()),()=>{b()?p("open"):p("close")}),Br(),cn();var H=U4(),ae=ni(H);{var Z=_e=>{var ve=ur(()=>to("z-50",B.backdrop,O().backdrop));N4(_e,{get class(){return De(ve)},fadeParams:{duration:150},get portal(){return _()},$$events:{click:()=>X(),mouseup:Se=>{Se.stopPropagation()}}})};ji(ae,_e=>{b()&&_e(Z)})}var te=Ht(ae,2);{var ne=_e=>{var ve=V4();const Se=ur(()=>el(to("Dialog","fixed top-0 left-0 w-full h-full z-50 flex items-center justify-center pointer-events-none",B.root,O().root)));var de=pt(ve);const Fe=ur(()=>el(to("dialog rounded bg-surface-100 elevation-4 overflow-y-auto pointer-events-auto relative outline-none",B.dialog,O().dialog,h.class)));var Re=pt(de);{var Le=Ce=>{B4(Ce,{center:!0,class:"rounded",children:(Ve,Ue)=>{R4(Ve,{})},$$slots:{default:!0}})};ji(Re,Ce=>{A()&&Ce(Le)})}var Te=Ht(Re,2);zi(Te,n,"header",{get open(){return b()},close:X},Ce=>{var Ve=vi(),Ue=ni(Ve);{var Ge=Oe=>{var Xe=$4();const We=ur(()=>el(to("text-xl font-bold pt-4 pb-2 px-6",B.title,O().title)));var Et=pt(Xe);zi(Et,n,"title",{get open(){return b()},close:X},null),ut(Xe),Ai(()=>lc(Xe,De(We),"")),rt(Oe,Xe)};ji(Ue,Oe=>{o.title&&Oe(Ge)})}rt(Ce,Ve)});var we=Ht(Te,2);zi(we,n,"default",{get open(){return b()},close:X},null);var fe=Ht(we,2);{var Ae=Ce=>{var Ve=j4();const Ue=ur(()=>el(to("actions flex w-full justify-end p-2 bg-surface-content/5 border-t",B.actions,O().actions)));var Ge=pt(Ve);zi(Ge,n,"actions",{get open(){return b()},close:X},null),ut(Ve),Rr(Ve,Oe=>di(C,Oe),()=>De(C)),Ai(()=>lc(Ve,De(Ue),"")),rt(Ce,Ve)};ji(fe,Ce=>{o.actions&&Ce(Ae)})}ut(de),Lt(()=>Ct("introstart",de,function(Ce){Ft.call(this,n,Ce)})),Lt(()=>Ct("outrostart",de,function(Ce){Ft.call(this,n,Ce)})),Lt(()=>Ct("introend",de,function(Ce){Ft.call(this,n,Ce)})),Lt(()=>Ct("outroend",de,function(Ce){Ft.call(this,n,Ce)})),Rr(de,Ce=>di(R,Ce),()=>De(R)),Tr(de,(Ce,Ve)=>Am==null?void 0:Am(Ce,Ve),()=>({restoreFocus:!0})),ut(ve),Lt(()=>Ct("click",ve,Y)),Lt(()=>Ct("keydown",ve,Ce=>{Ce.key==="Escape"&&(Ce.stopPropagation(),X())})),Tr(ve,(Ce,Ve)=>dc==null?void 0:dc(Ce,Ve),_),Ai(()=>{lc(ve,De(Se),""),lc(de,De(Fe),""),ki(de,"style",h.style)}),Vn(5,de,()=>Q_,()=>({duration:150,easing:J_})),Vn(2,de,()=>Q_,()=>({duration:150,easing:J_})),rt(_e,ve)};ji(te,_e=>{b()&&_e(ne)})}rt(i,H),hn()}var Tv;(function(i){i[i.Year=0]="Year",i[i.Day=1]="Day",i[i.Hour=2]="Hour",i[i.Minute=3]="Minute",i[i.Second=4]="Second",i[i.Millisecond=5]="Millisecond"})(Tv||(Tv={}));var c0=Symbol.for("immer-nothing"),th=Symbol.for("immer-draftable"),as=Symbol.for("immer-state");function Sr(i,...n){throw new Error(`[Immer] minified error nr: ${i}. Full error at: https://bit.ly/3cXEKWf`)}var sl=Object.getPrototypeOf;function al(i){return!!i&&!!i[as]}function lo(i){var n;return i?fx(i)||Array.isArray(i)||!!i[th]||!!((n=i.constructor)!=null&&n[th])||bh(i)||xh(i):!1}var q4=Object.prototype.constructor.toString();function fx(i){if(!i||typeof i!="object")return!1;const n=sl(i);if(n===null)return!0;const o=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return o===Object?!0:typeof o=="function"&&Function.toString.call(o)===q4}function lh(i,n){ol(i)===0?Reflect.ownKeys(i).forEach(o=>{n(o,i[o],i)}):i.forEach((o,h)=>n(h,o,i))}function ol(i){const n=i[as];return n?n.type_:Array.isArray(i)?1:bh(i)?2:xh(i)?3:0}function ch(i,n){return ol(i)===2?i.has(n):Object.prototype.hasOwnProperty.call(i,n)}function Rm(i,n){return ol(i)===2?i.get(n):i[n]}function px(i,n,o){const h=ol(i);h===2?i.set(n,o):h===3?i.add(o):i[n]=o}function Z4(i,n){return i===n?i!==0||1/i===1/n:i!==i&&n!==n}function bh(i){return i instanceof Map}function xh(i){return i instanceof Set}function Jo(i){return i.copy_||i.base_}function kg(i,n){if(bh(i))return new Map(i);if(xh(i))return new Set(i);if(Array.isArray(i))return Array.prototype.slice.call(i);const o=fx(i);if(n===!0||n==="class_only"&&!o){const h=Object.getOwnPropertyDescriptors(i);delete h[as];let p=Reflect.ownKeys(h);for(let b=0;b<p.length;b++){const _=p[b],c=h[_];c.writable===!1&&(c.writable=!0,c.configurable=!0),(c.get||c.set)&&(h[_]={configurable:!0,writable:!0,enumerable:c.enumerable,value:i[_]})}return Object.create(sl(i),h)}else{const h=sl(i);if(h!==null&&o)return{...i};const p=Object.create(h);return Object.assign(p,i)}}function u0(i,n=!1){return Pf(i)||al(i)||!lo(i)||(ol(i)>1&&(i.set=i.add=i.clear=i.delete=G4),Object.freeze(i),n&&Object.entries(i).forEach(([o,h])=>u0(h,!0))),i}function G4(){Sr(2)}function Pf(i){return Object.isFrozen(i)}var Mg={};function ll(i){const n=Mg[i];return n||Sr(0,i),n}function H4(i,n){Mg[i]||(Mg[i]=n)}var uh;function mx(){return uh}function X4(i,n){return{drafts_:[],parent_:i,immer_:n,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Sv(i,n){n&&(ll("Patches"),i.patches_=[],i.inversePatches_=[],i.patchListener_=n)}function Ag(i){Ig(i),i.drafts_.forEach(Y4),i.drafts_=null}function Ig(i){i===uh&&(uh=i.parent_)}function kv(i){return uh=X4(uh,i)}function Y4(i){const n=i[as];n.type_===0||n.type_===1?n.revoke_():n.revoked_=!0}function Mv(i,n){n.unfinalizedDrafts_=n.drafts_.length;const o=n.drafts_[0];return i!==void 0&&i!==o?(o[as].modified_&&(Ag(n),Sr(4)),lo(i)&&(i=cf(n,i),n.parent_||uf(n,i)),n.patches_&&ll("Patches").generateReplacementPatches_(o[as].base_,i,n.patches_,n.inversePatches_)):i=cf(n,o,[]),Ag(n),n.patches_&&n.patchListener_(n.patches_,n.inversePatches_),i!==c0?i:void 0}function cf(i,n,o){if(Pf(n))return n;const h=n[as];if(!h)return lh(n,(p,b)=>Av(i,h,n,p,b,o)),n;if(h.scope_!==i)return n;if(!h.modified_)return uf(i,h.base_,!0),h.base_;if(!h.finalized_){h.finalized_=!0,h.scope_.unfinalizedDrafts_--;const p=h.copy_;let b=p,_=!1;h.type_===3&&(b=new Set(p),p.clear(),_=!0),lh(b,(c,A)=>Av(i,h,p,c,A,o,_)),uf(i,p,!1),o&&i.patches_&&ll("Patches").generatePatches_(h,o,i.patches_,i.inversePatches_)}return h.copy_}function Av(i,n,o,h,p,b,_){if(al(p)){const c=b&&n&&n.type_!==3&&!ch(n.assigned_,h)?b.concat(h):void 0,A=cf(i,p,c);if(px(o,h,A),al(A))i.canAutoFreeze_=!1;else return}else _&&o.add(p);if(lo(p)&&!Pf(p)){if(!i.immer_.autoFreeze_&&i.unfinalizedDrafts_<1)return;cf(i,p),(!n||!n.scope_.parent_)&&typeof h!="symbol"&&Object.prototype.propertyIsEnumerable.call(o,h)&&uf(i,p)}}function uf(i,n,o=!1){!i.parent_&&i.immer_.autoFreeze_&&i.canAutoFreeze_&&u0(n,o)}function K4(i,n){const o=Array.isArray(i),h={type_:o?1:0,scope_:n?n.scope_:mx(),modified_:!1,finalized_:!1,assigned_:{},parent_:n,base_:i,draft_:null,copy_:null,revoke_:null,isManual_:!1};let p=h,b=h0;o&&(p=[h],b=hh);const{revoke:_,proxy:c}=Proxy.revocable(p,b);return h.draft_=c,h.revoke_=_,c}var h0={get(i,n){if(n===as)return i;const o=Jo(i);if(!ch(o,n))return J4(i,o,n);const h=o[n];return i.finalized_||!lo(h)?h:h===Om(i.base_,n)?(Bm(i),i.copy_[n]=Cg(h,i)):h},has(i,n){return n in Jo(i)},ownKeys(i){return Reflect.ownKeys(Jo(i))},set(i,n,o){const h=gx(Jo(i),n);if(h!=null&&h.set)return h.set.call(i.draft_,o),!0;if(!i.modified_){const p=Om(Jo(i),n),b=p==null?void 0:p[as];if(b&&b.base_===o)return i.copy_[n]=o,i.assigned_[n]=!1,!0;if(Z4(o,p)&&(o!==void 0||ch(i.base_,n)))return!0;Bm(i),Eg(i)}return i.copy_[n]===o&&(o!==void 0||n in i.copy_)||Number.isNaN(o)&&Number.isNaN(i.copy_[n])||(i.copy_[n]=o,i.assigned_[n]=!0),!0},deleteProperty(i,n){return Om(i.base_,n)!==void 0||n in i.base_?(i.assigned_[n]=!1,Bm(i),Eg(i)):delete i.assigned_[n],i.copy_&&delete i.copy_[n],!0},getOwnPropertyDescriptor(i,n){const o=Jo(i),h=Reflect.getOwnPropertyDescriptor(o,n);return h&&{writable:!0,configurable:i.type_!==1||n!=="length",enumerable:h.enumerable,value:o[n]}},defineProperty(){Sr(11)},getPrototypeOf(i){return sl(i.base_)},setPrototypeOf(){Sr(12)}},hh={};lh(h0,(i,n)=>{hh[i]=function(){return arguments[0]=arguments[0][0],n.apply(this,arguments)}});hh.deleteProperty=function(i,n){return hh.set.call(this,i,n,void 0)};hh.set=function(i,n,o){return h0.set.call(this,i[0],n,o,i[0])};function Om(i,n){const o=i[as];return(o?Jo(o):i)[n]}function J4(i,n,o){var p;const h=gx(n,o);return h?"value"in h?h.value:(p=h.get)==null?void 0:p.call(i.draft_):void 0}function gx(i,n){if(!(n in i))return;let o=sl(i);for(;o;){const h=Object.getOwnPropertyDescriptor(o,n);if(h)return h;o=sl(o)}}function Eg(i){i.modified_||(i.modified_=!0,i.parent_&&Eg(i.parent_))}function Bm(i){i.copy_||(i.copy_=kg(i.base_,i.scope_.immer_.useStrictShallowCopy_))}var Q4=class{constructor(i){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(n,o,h)=>{if(typeof n=="function"&&typeof o!="function"){const b=o;o=n;const _=this;return function(A=b,...O){return _.produce(A,B=>o.call(this,B,...O))}}typeof o!="function"&&Sr(6),h!==void 0&&typeof h!="function"&&Sr(7);let p;if(lo(n)){const b=kv(this),_=Cg(n,void 0);let c=!0;try{p=o(_),c=!1}finally{c?Ag(b):Ig(b)}return Sv(b,h),Mv(p,b)}else if(!n||typeof n!="object"){if(p=o(n),p===void 0&&(p=n),p===c0&&(p=void 0),this.autoFreeze_&&u0(p,!0),h){const b=[],_=[];ll("Patches").generateReplacementPatches_(n,p,b,_),h(b,_)}return p}else Sr(1,n)},this.produceWithPatches=(n,o)=>{if(typeof n=="function")return(_,...c)=>this.produceWithPatches(_,A=>n(A,...c));let h,p;return[this.produce(n,o,(_,c)=>{h=_,p=c}),h,p]},typeof(i==null?void 0:i.autoFreeze)=="boolean"&&this.setAutoFreeze(i.autoFreeze),typeof(i==null?void 0:i.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(i.useStrictShallowCopy)}createDraft(i){lo(i)||Sr(8),al(i)&&(i=eP(i));const n=kv(this),o=Cg(i,void 0);return o[as].isManual_=!0,Ig(n),o}finishDraft(i,n){const o=i&&i[as];(!o||!o.isManual_)&&Sr(9);const{scope_:h}=o;return Sv(h,n),Mv(void 0,h)}setAutoFreeze(i){this.autoFreeze_=i}setUseStrictShallowCopy(i){this.useStrictShallowCopy_=i}applyPatches(i,n){let o;for(o=n.length-1;o>=0;o--){const p=n[o];if(p.path.length===0&&p.op==="replace"){i=p.value;break}}o>-1&&(n=n.slice(o+1));const h=ll("Patches").applyPatches_;return al(i)?h(i,n):this.produce(i,p=>h(p,n))}};function Cg(i,n){const o=bh(i)?ll("MapSet").proxyMap_(i,n):xh(i)?ll("MapSet").proxySet_(i,n):K4(i,n);return(n?n.scope_:mx()).drafts_.push(o),o}function eP(i){return al(i)||Sr(10,i),yx(i)}function yx(i){if(!lo(i)||Pf(i))return i;const n=i[as];let o;if(n){if(!n.modified_)return n.base_;n.finalized_=!0,o=kg(i,n.scope_.immer_.useStrictShallowCopy_)}else o=kg(i,!0);return lh(o,(h,p)=>{px(o,h,yx(p))}),n&&(n.finalized_=!1),o}function tP(){const n="replace",o="add",h="remove";function p(C,Y,X,H){switch(C.type_){case 0:case 2:return _(C,Y,X,H);case 1:return b(C,Y,X,H);case 3:return c(C,Y,X,H)}}function b(C,Y,X,H){let{base_:ae,assigned_:Z}=C,te=C.copy_;te.length<ae.length&&([ae,te]=[te,ae],[X,H]=[H,X]);for(let ne=0;ne<ae.length;ne++)if(Z[ne]&&te[ne]!==ae[ne]){const _e=Y.concat([ne]);X.push({op:n,path:_e,value:R(te[ne])}),H.push({op:n,path:_e,value:R(ae[ne])})}for(let ne=ae.length;ne<te.length;ne++){const _e=Y.concat([ne]);X.push({op:o,path:_e,value:R(te[ne])})}for(let ne=te.length-1;ae.length<=ne;--ne){const _e=Y.concat([ne]);H.push({op:h,path:_e})}}function _(C,Y,X,H){const{base_:ae,copy_:Z}=C;lh(C.assigned_,(te,ne)=>{const _e=Rm(ae,te),ve=Rm(Z,te),Se=ne?ch(ae,te)?n:o:h;if(_e===ve&&Se===n)return;const de=Y.concat(te);X.push(Se===h?{op:Se,path:de}:{op:Se,path:de,value:ve}),H.push(Se===o?{op:h,path:de}:Se===h?{op:o,path:de,value:R(_e)}:{op:n,path:de,value:R(_e)})})}function c(C,Y,X,H){let{base_:ae,copy_:Z}=C,te=0;ae.forEach(ne=>{if(!Z.has(ne)){const _e=Y.concat([te]);X.push({op:h,path:_e,value:ne}),H.unshift({op:o,path:_e,value:ne})}te++}),te=0,Z.forEach(ne=>{if(!ae.has(ne)){const _e=Y.concat([te]);X.push({op:o,path:_e,value:ne}),H.unshift({op:h,path:_e,value:ne})}te++})}function A(C,Y,X,H){X.push({op:n,path:[],value:Y===c0?void 0:Y}),H.push({op:n,path:[],value:C})}function O(C,Y){return Y.forEach(X=>{const{path:H,op:ae}=X;let Z=C;for(let ve=0;ve<H.length-1;ve++){const Se=ol(Z);let de=H[ve];typeof de!="string"&&typeof de!="number"&&(de=""+de),(Se===0||Se===1)&&(de==="__proto__"||de==="constructor")&&Sr(19),typeof Z=="function"&&de==="prototype"&&Sr(19),Z=Rm(Z,de),typeof Z!="object"&&Sr(18,H.join("/"))}const te=ol(Z),ne=B(X.value),_e=H[H.length-1];switch(ae){case n:switch(te){case 2:return Z.set(_e,ne);case 3:Sr(16);default:return Z[_e]=ne}case o:switch(te){case 1:return _e==="-"?Z.push(ne):Z.splice(_e,0,ne);case 2:return Z.set(_e,ne);case 3:return Z.add(ne);default:return Z[_e]=ne}case h:switch(te){case 1:return Z.splice(_e,1);case 2:return Z.delete(_e);case 3:return Z.delete(X.value);default:return delete Z[_e]}default:Sr(17,ae)}}),C}function B(C){if(!lo(C))return C;if(Array.isArray(C))return C.map(B);if(bh(C))return new Map(Array.from(C.entries()).map(([X,H])=>[X,B(H)]));if(xh(C))return new Set(Array.from(C).map(B));const Y=Object.create(sl(C));for(const X in C)Y[X]=B(C[X]);return ch(C,th)&&(Y[th]=C[th]),Y}function R(C){return al(C)?B(C):C}H4("Patches",{applyPatches_:O,generatePatches_:p,generateReplacementPatches_:A})}var os=new Q4;os.produce;os.produceWithPatches.bind(os);var iP=os.setAutoFreeze.bind(os);os.setUseStrictShallowCopy.bind(os);os.applyPatches.bind(os);os.createDraft.bind(os);os.finishDraft.bind(os);tP();iP(!1);const _x=(i,n)=>{if(typeof i=="number"){if(n===3)return{mode:"rgb",r:(i>>8&15|i>>4&240)/255,g:(i>>4&15|i&240)/255,b:(i&15|i<<4&240)/255};if(n===4)return{mode:"rgb",r:(i>>12&15|i>>8&240)/255,g:(i>>8&15|i>>4&240)/255,b:(i>>4&15|i&240)/255,alpha:(i&15|i<<4&240)/255};if(n===6)return{mode:"rgb",r:(i>>16&255)/255,g:(i>>8&255)/255,b:(i&255)/255};if(n===8)return{mode:"rgb",r:(i>>24&255)/255,g:(i>>16&255)/255,b:(i>>8&255)/255,alpha:(i&255)/255}}},nP={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},rP=i=>_x(nP[i.toLowerCase()],6),sP=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,aP=i=>{let n;return(n=i.match(sP))?_x(parseInt(n[1],16),n[1].length):void 0},ao="([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)",ih=`${ao}%`,d0=`(?:${ao}%|${ao})`,oP=`(?:${ao}(deg|grad|rad|turn)|${ao})`,wc="\\s*,\\s*",lP=new RegExp(`^rgba?\\(\\s*${ao}${wc}${ao}${wc}${ao}\\s*(?:,\\s*${d0}\\s*)?\\)$`),cP=new RegExp(`^rgba?\\(\\s*${ih}${wc}${ih}${wc}${ih}\\s*(?:,\\s*${d0}\\s*)?\\)$`),uP=i=>{let n={mode:"rgb"},o;if(o=i.match(lP))o[1]!==void 0&&(n.r=o[1]/255),o[2]!==void 0&&(n.g=o[2]/255),o[3]!==void 0&&(n.b=o[3]/255);else if(o=i.match(cP))o[1]!==void 0&&(n.r=o[1]/100),o[2]!==void 0&&(n.g=o[2]/100),o[3]!==void 0&&(n.b=o[3]/100);else return;return o[4]!==void 0?n.alpha=Math.max(0,Math.min(1,o[4]/100)):o[5]!==void 0&&(n.alpha=Math.max(0,Math.min(1,+o[5]))),n},hP=(i,n)=>i===void 0?void 0:typeof i!="object"?wP(i):i.mode!==void 0?i:n?{...i,mode:n}:void 0,dP=(i="rgb")=>n=>(n=hP(n,i))!==void 0?n.mode===i?n:$s[n.mode][i]?$s[n.mode][i](n):i==="rgb"?$s[n.mode].rgb(n):$s.rgb[i]($s[n.mode].rgb(n)):void 0,$s={},vx={},hf=[],bx={},fP=i=>i,Zi=i=>($s[i.mode]={...$s[i.mode],...i.toMode},Object.keys(i.fromMode||{}).forEach(n=>{$s[n]||($s[n]={}),$s[n][i.mode]=i.fromMode[n]}),i.ranges||(i.ranges={}),i.difference||(i.difference={}),i.channels.forEach(n=>{if(i.ranges[n]===void 0&&(i.ranges[n]=[0,1]),!i.interpolate[n])throw new Error(`Missing interpolator for: ${n}`);typeof i.interpolate[n]=="function"&&(i.interpolate[n]={use:i.interpolate[n]}),i.interpolate[n].fixup||(i.interpolate[n].fixup=fP)}),vx[i.mode]=i,(i.parse||[]).forEach(n=>{mP(n,i.mode)}),dP(i.mode)),pP=i=>vx[i],mP=(i,n)=>{if(typeof i=="string"){if(!n)throw new Error("'mode' required when 'parser' is a string");bx[i]=n}else typeof i=="function"&&hf.indexOf(i)<0&&hf.push(i)},Pg=/[^\x00-\x7F]|[a-zA-Z_]/,gP=/[^\x00-\x7F]|[-\w]/,et={Function:"function",Ident:"ident",Number:"number",Percentage:"percentage",ParenClose:")",None:"none",Hue:"hue",Alpha:"alpha"};let Gt=0;function Wd(i){let n=i[Gt],o=i[Gt+1];return n==="-"||n==="+"?/\d/.test(o)||o==="."&&/\d/.test(i[Gt+2]):n==="."?/\d/.test(o):/\d/.test(n)}function zg(i){if(Gt>=i.length)return!1;let n=i[Gt];if(Pg.test(n))return!0;if(n==="-"){if(i.length-Gt<2)return!1;let o=i[Gt+1];return!!(o==="-"||Pg.test(o))}return!1}const yP={deg:1,rad:180/Math.PI,grad:9/10,turn:360};function Gu(i){let n="";if((i[Gt]==="-"||i[Gt]==="+")&&(n+=i[Gt++]),n+=qd(i),i[Gt]==="."&&/\d/.test(i[Gt+1])&&(n+=i[Gt++]+qd(i)),(i[Gt]==="e"||i[Gt]==="E")&&((i[Gt+1]==="-"||i[Gt+1]==="+")&&/\d/.test(i[Gt+2])?n+=i[Gt++]+i[Gt++]+qd(i):/\d/.test(i[Gt+1])&&(n+=i[Gt++]+qd(i))),zg(i)){let o=df(i);return o==="deg"||o==="rad"||o==="turn"||o==="grad"?{type:et.Hue,value:n*yP[o]}:void 0}return i[Gt]==="%"?(Gt++,{type:et.Percentage,value:+n}):{type:et.Number,value:+n}}function qd(i){let n="";for(;/\d/.test(i[Gt]);)n+=i[Gt++];return n}function df(i){let n="";for(;Gt<i.length&&gP.test(i[Gt]);)n+=i[Gt++];return n}function _P(i){let n=df(i);return i[Gt]==="("?(Gt++,{type:et.Function,value:n}):n==="none"?{type:et.None,value:void 0}:{type:et.Ident,value:n}}function vP(i=""){let n=i.trim(),o=[],h;for(Gt=0;Gt<n.length;){if(h=n[Gt++],h===`
`||h==="	"||h===" "){for(;Gt<n.length&&(n[Gt]===`
`||n[Gt]==="	"||n[Gt]===" ");)Gt++;continue}if(h===",")return;if(h===")"){o.push({type:et.ParenClose});continue}if(h==="+"){if(Gt--,Wd(n)){o.push(Gu(n));continue}return}if(h==="-"){if(Gt--,Wd(n)){o.push(Gu(n));continue}if(zg(n)){o.push({type:et.Ident,value:df(n)});continue}return}if(h==="."){if(Gt--,Wd(n)){o.push(Gu(n));continue}return}if(h==="/"){for(;Gt<n.length&&(n[Gt]===`
`||n[Gt]==="	"||n[Gt]===" ");)Gt++;let p;if(Wd(n)&&(p=Gu(n),p.type!==et.Hue)){o.push({type:et.Alpha,value:p});continue}if(zg(n)&&df(n)==="none"){o.push({type:et.Alpha,value:{type:et.None,value:void 0}});continue}return}if(/\d/.test(h)){Gt--,o.push(Gu(n));continue}if(Pg.test(h)){Gt--,o.push(_P(n));continue}return}return o}function bP(i){i._i=0;let n=i[i._i++];if(!n||n.type!==et.Function||n.value!=="color"||(n=i[i._i++],n.type!==et.Ident))return;const o=bx[n.value];if(!o)return;const h={mode:o},p=xx(i,!1);if(!p)return;const b=pP(o).channels;for(let _=0,c,A;_<b.length;_++)c=p[_],A=b[_],c.type!==et.None&&(h[A]=c.type===et.Number?c.value:c.value/100,A==="alpha"&&(h[A]=Math.max(0,Math.min(1,h[A]))));return h}function xx(i,n){const o=[];let h;for(;i._i<i.length;){if(h=i[i._i++],h.type===et.None||h.type===et.Number||h.type===et.Alpha||h.type===et.Percentage||n&&h.type===et.Hue){o.push(h);continue}if(h.type===et.ParenClose){if(i._i<i.length)return;continue}return}if(!(o.length<3||o.length>4)){if(o.length===4){if(o[3].type!==et.Alpha)return;o[3]=o[3].value}return o.length===3&&o.push({type:et.None,value:void 0}),o.every(p=>p.type!==et.Alpha)?o:void 0}}function xP(i,n){i._i=0;let o=i[i._i++];if(!o||o.type!==et.Function)return;let h=xx(i,n);if(h)return h.unshift(o.value),h}const wP=i=>{if(typeof i!="string")return;const n=vP(i),o=n?xP(n,!0):void 0;let h,p=0,b=hf.length;for(;p<b;)if((h=hf[p++](i,o))!==void 0)return h;return n?bP(n):void 0};function TP(i,n){if(!n||n[0]!=="rgb"&&n[0]!=="rgba")return;const o={mode:"rgb"},[,h,p,b,_]=n;if(!(h.type===et.Hue||p.type===et.Hue||b.type===et.Hue))return h.type!==et.None&&(o.r=h.type===et.Number?h.value/255:h.value/100),p.type!==et.None&&(o.g=p.type===et.Number?p.value/255:p.value/100),b.type!==et.None&&(o.b=b.type===et.Number?b.value/255:b.value/100),_.type!==et.None&&(o.alpha=Math.min(1,Math.max(0,_.type===et.Number?_.value:_.value/100))),o}const SP=i=>i==="transparent"?{mode:"rgb",r:0,g:0,b:0,alpha:0}:void 0,kP=(i,n,o)=>i+o*(n-i),MP=i=>{let n=[];for(let o=0;o<i.length-1;o++){let h=i[o],p=i[o+1];h===void 0&&p===void 0?n.push(void 0):h!==void 0&&p!==void 0?n.push([h,p]):n.push(h!==void 0?[h,h]:[p,p])}return n},AP=i=>n=>{let o=MP(n);return h=>{let p=h*o.length,b=h>=1?o.length-1:Math.max(Math.floor(p),0),_=o[b];return _===void 0?void 0:i(_[0],_[1],p-b)}},gt=AP(kP),Un=i=>{let n=!1,o=i.map(h=>h!==void 0?(n=!0,h):1);return n?o:i},zc={mode:"rgb",channels:["r","g","b","alpha"],parse:[TP,aP,uP,rP,SP,"srgb"],serialize:"srgb",interpolate:{r:gt,g:gt,b:gt,alpha:{use:gt,fixup:Un}},gamut:!0,white:{r:1,g:1,b:1},black:{r:0,g:0,b:0}},Fm=(i=0)=>Math.pow(Math.abs(i),563/256)*Math.sign(i),Iv=i=>{let n=Fm(i.r),o=Fm(i.g),h=Fm(i.b),p={mode:"xyz65",x:.5766690429101305*n+.1855582379065463*o+.1882286462349947*h,y:.297344975250536*n+.6273635662554661*o+.0752914584939979*h,z:.0270313613864123*n+.0706888525358272*o+.9913375368376386*h};return i.alpha!==void 0&&(p.alpha=i.alpha),p},Nm=i=>Math.pow(Math.abs(i),256/563)*Math.sign(i),Ev=({x:i,y:n,z:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p={mode:"a98",r:Nm(i*2.0415879038107465-n*.5650069742788597-.3447313507783297*o),g:Nm(i*-.9692436362808798+n*1.8759675015077206+.0415550574071756*o),b:Nm(i*.0134442806320312-n*.1183623922310184+1.0151749943912058*o)};return h!==void 0&&(p.alpha=h),p},$m=(i=0)=>{const n=Math.abs(i);return n<=.04045?i/12.92:(Math.sign(i)||1)*Math.pow((n+.055)/1.055,2.4)},Dc=({r:i,g:n,b:o,alpha:h})=>{let p={mode:"lrgb",r:$m(i),g:$m(n),b:$m(o)};return h!==void 0&&(p.alpha=h),p},ul=i=>{let{r:n,g:o,b:h,alpha:p}=Dc(i),b={mode:"xyz65",x:.4123907992659593*n+.357584339383878*o+.1804807884018343*h,y:.2126390058715102*n+.715168678767756*o+.0721923153607337*h,z:.0193308187155918*n+.119194779794626*o+.9505321522496607*h};return p!==void 0&&(b.alpha=p),b},jm=(i=0)=>{const n=Math.abs(i);return n>.0031308?(Math.sign(i)||1)*(1.055*Math.pow(n,1/2.4)-.055):i*12.92},Lc=({r:i,g:n,b:o,alpha:h},p="rgb")=>{let b={mode:p,r:jm(i),g:jm(n),b:jm(o)};return h!==void 0&&(b.alpha=h),b},hl=({x:i,y:n,z:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=Lc({r:i*3.2409699419045226-n*1.537383177570094-.4986107602930034*o,g:i*-.9692436362808796+n*1.8759675015077204+.0415550574071756*o,b:i*.0556300796969936-n*.2039769588889765+1.0569715142428784*o});return h!==void 0&&(p.alpha=h),p},IP={...zc,mode:"a98",parse:["a98-rgb"],serialize:"a98-rgb",fromMode:{rgb:i=>Ev(ul(i)),xyz65:Ev},toMode:{rgb:i=>hl(Iv(i)),xyz65:Iv}},hr=i=>(i=i%360)<0?i+360:i,EP=(i,n)=>i.map((o,h,p)=>{if(o===void 0)return o;let b=hr(o);return h===0||i[h-1]===void 0?b:n(b-hr(p[h-1]))}).reduce((o,h)=>!o.length||h===void 0||o[o.length-1]===void 0?(o.push(h),o):(o.push(h+o[o.length-1]),o),[]),wa=i=>EP(i,n=>Math.abs(n)<=180?n:n-360*Math.sign(n)),Kn=[-.14861,1.78277,-.29227,-.90649,1.97294,0],CP=Math.PI/180,PP=180/Math.PI;let Cv=Kn[3]*Kn[4],Pv=Kn[1]*Kn[4],zv=Kn[1]*Kn[2]-Kn[0]*Kn[3];const zP=({r:i,g:n,b:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=(zv*o+i*Cv-n*Pv)/(zv+Cv-Pv),b=o-p,_=(Kn[4]*(n-p)-Kn[2]*b)/Kn[3],c={mode:"cubehelix",l:p,s:p===0||p===1?void 0:Math.sqrt(b*b+_*_)/(Kn[4]*p*(1-p))};return c.s&&(c.h=Math.atan2(_,b)*PP-120),h!==void 0&&(c.alpha=h),c},DP=({h:i,s:n,l:o,alpha:h})=>{let p={mode:"rgb"};i=(i===void 0?0:i+120)*CP,o===void 0&&(o=0);let b=n===void 0?0:n*o*(1-o),_=Math.cos(i),c=Math.sin(i);return p.r=o+b*(Kn[0]*_+Kn[1]*c),p.g=o+b*(Kn[2]*_+Kn[3]*c),p.b=o+b*(Kn[4]*_+Kn[5]*c),h!==void 0&&(p.alpha=h),p},zf=(i,n)=>{if(i.h===void 0||n.h===void 0||!i.s||!n.s)return 0;let o=hr(i.h),h=hr(n.h),p=Math.sin((h-o+360)/2*Math.PI/180);return 2*Math.sqrt(i.s*n.s)*p},LP=(i,n)=>{if(i.h===void 0||n.h===void 0)return 0;let o=hr(i.h),h=hr(n.h);return Math.abs(h-o)>180?o-(h-360*Math.sign(h-o)):h-o},Df=(i,n)=>{if(i.h===void 0||n.h===void 0||!i.c||!n.c)return 0;let o=hr(i.h),h=hr(n.h),p=Math.sin((h-o+360)/2*Math.PI/180);return 2*Math.sqrt(i.c*n.c)*p},Ta=i=>{let n=i.reduce((h,p)=>{if(p!==void 0){let b=p*Math.PI/180;h.sin+=Math.sin(b),h.cos+=Math.cos(b)}return h},{sin:0,cos:0}),o=Math.atan2(n.sin,n.cos)*180/Math.PI;return o<0?360+o:o},RP={mode:"cubehelix",channels:["h","s","l","alpha"],parse:["--cubehelix"],serialize:"--cubehelix",ranges:{h:[0,360],s:[0,4.614],l:[0,1]},fromMode:{rgb:zP},toMode:{rgb:DP},interpolate:{h:{use:gt,fixup:wa},s:gt,l:gt,alpha:{use:gt,fixup:Un}},difference:{h:zf},average:{h:Ta}},co=({l:i,a:n,b:o,alpha:h},p="lch")=>{n===void 0&&(n=0),o===void 0&&(o=0);let b=Math.sqrt(n*n+o*o),_={mode:p,l:i,c:b};return b&&(_.h=hr(Math.atan2(o,n)*180/Math.PI)),h!==void 0&&(_.alpha=h),_},uo=({l:i,c:n,h:o,alpha:h},p="lab")=>{o===void 0&&(o=0);let b={mode:p,l:i,a:n?n*Math.cos(o/180*Math.PI):0,b:n?n*Math.sin(o/180*Math.PI):0};return h!==void 0&&(b.alpha=h),b},wx=Math.pow(29,3)/Math.pow(3,3),Tx=Math.pow(6,3)/Math.pow(29,3),Bn={X:.3457/.3585,Y:1,Z:(1-.3457-.3585)/.3585},pc={X:.3127/.329,Y:1,Z:(1-.3127-.329)/.329};let Vm=i=>Math.pow(i,3)>Tx?Math.pow(i,3):(116*i-16)/wx;const Sx=({l:i,a:n,b:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=(i+16)/116,b=n/500+p,_=p-o/200,c={mode:"xyz65",x:Vm(b)*pc.X,y:Vm(p)*pc.Y,z:Vm(_)*pc.Z};return h!==void 0&&(c.alpha=h),c},Lf=i=>hl(Sx(i)),Um=i=>i>Tx?Math.cbrt(i):(wx*i+16)/116,kx=({x:i,y:n,z:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=Um(i/pc.X),b=Um(n/pc.Y),_=Um(o/pc.Z),c={mode:"lab65",l:116*b-16,a:500*(p-b),b:200*(b-_)};return h!==void 0&&(c.alpha=h),c},Rf=i=>{let n=kx(ul(i));return i.r===i.b&&i.b===i.g&&(n.a=n.b=0),n},ff=1,Mx=1,dh=26/180*Math.PI,pf=Math.cos(dh),mf=Math.sin(dh),Ax=100/Math.log(139/100),Dg=({l:i,c:n,h:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p={mode:"lab65",l:(Math.exp(i*ff/Ax)-1)/.0039},b=(Math.exp(.0435*n*Mx*ff)-1)/.075,_=b*Math.cos(o/180*Math.PI-dh),c=b*Math.sin(o/180*Math.PI-dh);return p.a=_*pf-c/.83*mf,p.b=_*mf+c/.83*pf,h!==void 0&&(p.alpha=h),p},Lg=({l:i,a:n,b:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=n*pf+o*mf,b=.83*(o*pf-n*mf),_=Math.sqrt(p*p+b*b),c={mode:"dlch",l:Ax/ff*Math.log(1+.0039*i),c:Math.log(1+.075*_)/(.0435*Mx*ff)};return c.c&&(c.h=hr((Math.atan2(b,p)+dh)/Math.PI*180)),h!==void 0&&(c.alpha=h),c},Dv=i=>Dg(co(i,"dlch")),Lv=i=>uo(Lg(i),"dlab"),OP={mode:"dlab",parse:["--din99o-lab"],serialize:"--din99o-lab",toMode:{lab65:Dv,rgb:i=>Lf(Dv(i))},fromMode:{lab65:Lv,rgb:i=>Lv(Rf(i))},channels:["l","a","b","alpha"],ranges:{l:[0,100],a:[-40.09,45.501],b:[-40.469,44.344]},interpolate:{l:gt,a:gt,b:gt,alpha:{use:gt,fixup:Un}}},BP={mode:"dlch",parse:["--din99o-lch"],serialize:"--din99o-lch",toMode:{lab65:Dg,dlab:i=>uo(i,"dlab"),rgb:i=>Lf(Dg(i))},fromMode:{lab65:Lg,dlab:i=>co(i,"dlch"),rgb:i=>Lg(Rf(i))},channels:["l","c","h","alpha"],ranges:{l:[0,100],c:[0,51.484],h:[0,360]},interpolate:{l:gt,c:gt,h:{use:gt,fixup:wa},alpha:{use:gt,fixup:Un}},difference:{h:Df},average:{h:Ta}};function FP({h:i,s:n,i:o,alpha:h}){i=hr(i!==void 0?i:0),n===void 0&&(n=0),o===void 0&&(o=0);let p=Math.abs(i/60%2-1),b;switch(Math.floor(i/60)){case 0:b={r:o*(1+n*(3/(2-p)-1)),g:o*(1+n*(3*(1-p)/(2-p)-1)),b:o*(1-n)};break;case 1:b={r:o*(1+n*(3*(1-p)/(2-p)-1)),g:o*(1+n*(3/(2-p)-1)),b:o*(1-n)};break;case 2:b={r:o*(1-n),g:o*(1+n*(3/(2-p)-1)),b:o*(1+n*(3*(1-p)/(2-p)-1))};break;case 3:b={r:o*(1-n),g:o*(1+n*(3*(1-p)/(2-p)-1)),b:o*(1+n*(3/(2-p)-1))};break;case 4:b={r:o*(1+n*(3*(1-p)/(2-p)-1)),g:o*(1-n),b:o*(1+n*(3/(2-p)-1))};break;case 5:b={r:o*(1+n*(3/(2-p)-1)),g:o*(1-n),b:o*(1+n*(3*(1-p)/(2-p)-1))};break;default:b={r:o*(1-n),g:o*(1-n),b:o*(1-n)}}return b.mode="rgb",h!==void 0&&(b.alpha=h),b}function NP({r:i,g:n,b:o,alpha:h}){i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=Math.max(i,n,o),b=Math.min(i,n,o),_={mode:"hsi",s:i+n+o===0?0:1-3*b/(i+n+o),i:(i+n+o)/3};return p-b!==0&&(_.h=(p===i?(n-o)/(p-b)+(n<o)*6:p===n?(o-i)/(p-b)+2:(i-n)/(p-b)+4)*60),h!==void 0&&(_.alpha=h),_}const $P={mode:"hsi",toMode:{rgb:FP},parse:["--hsi"],serialize:"--hsi",fromMode:{rgb:NP},channels:["h","s","i","alpha"],ranges:{h:[0,360]},gamut:"rgb",interpolate:{h:{use:gt,fixup:wa},s:gt,i:gt,alpha:{use:gt,fixup:Un}},difference:{h:zf},average:{h:Ta}};function jP({h:i,s:n,l:o,alpha:h}){i=hr(i!==void 0?i:0),n===void 0&&(n=0),o===void 0&&(o=0);let p=o+n*(o<.5?o:1-o),b=p-(p-o)*2*Math.abs(i/60%2-1),_;switch(Math.floor(i/60)){case 0:_={r:p,g:b,b:2*o-p};break;case 1:_={r:b,g:p,b:2*o-p};break;case 2:_={r:2*o-p,g:p,b};break;case 3:_={r:2*o-p,g:b,b:p};break;case 4:_={r:b,g:2*o-p,b:p};break;case 5:_={r:p,g:2*o-p,b};break;default:_={r:2*o-p,g:2*o-p,b:2*o-p}}return _.mode="rgb",h!==void 0&&(_.alpha=h),_}function VP({r:i,g:n,b:o,alpha:h}){i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=Math.max(i,n,o),b=Math.min(i,n,o),_={mode:"hsl",s:p===b?0:(p-b)/(1-Math.abs(p+b-1)),l:.5*(p+b)};return p-b!==0&&(_.h=(p===i?(n-o)/(p-b)+(n<o)*6:p===n?(o-i)/(p-b)+2:(i-n)/(p-b)+4)*60),h!==void 0&&(_.alpha=h),_}const UP=(i,n)=>{switch(n){case"deg":return+i;case"rad":return i/Math.PI*180;case"grad":return i/10*9;case"turn":return i*360}},WP=new RegExp(`^hsla?\\(\\s*${oP}${wc}${ih}${wc}${ih}\\s*(?:,\\s*${d0}\\s*)?\\)$`),qP=i=>{let n=i.match(WP);if(!n)return;let o={mode:"hsl"};return n[3]!==void 0?o.h=+n[3]:n[1]!==void 0&&n[2]!==void 0&&(o.h=UP(n[1],n[2])),n[4]!==void 0&&(o.s=Math.min(Math.max(0,n[4]/100),1)),n[5]!==void 0&&(o.l=Math.min(Math.max(0,n[5]/100),1)),n[6]!==void 0?o.alpha=Math.max(0,Math.min(1,n[6]/100)):n[7]!==void 0&&(o.alpha=Math.max(0,Math.min(1,+n[7]))),o};function ZP(i,n){if(!n||n[0]!=="hsl"&&n[0]!=="hsla")return;const o={mode:"hsl"},[,h,p,b,_]=n;if(h.type!==et.None){if(h.type===et.Percentage)return;o.h=h.value}if(p.type!==et.None){if(p.type===et.Hue)return;o.s=p.value/100}if(b.type!==et.None){if(b.type===et.Hue)return;o.l=b.value/100}return _.type!==et.None&&(o.alpha=Math.min(1,Math.max(0,_.type===et.Number?_.value:_.value/100))),o}const Ix={mode:"hsl",toMode:{rgb:jP},fromMode:{rgb:VP},channels:["h","s","l","alpha"],ranges:{h:[0,360]},gamut:"rgb",parse:[ZP,qP],serialize:i=>`hsl(${i.h!==void 0?i.h:"none"} ${i.s!==void 0?i.s*100+"%":"none"} ${i.l!==void 0?i.l*100+"%":"none"}${i.alpha<1?` / ${i.alpha}`:""})`,interpolate:{h:{use:gt,fixup:wa},s:gt,l:gt,alpha:{use:gt,fixup:Un}},difference:{h:zf},average:{h:Ta}};function Ex({h:i,s:n,v:o,alpha:h}){i=hr(i!==void 0?i:0),n===void 0&&(n=0),o===void 0&&(o=0);let p=Math.abs(i/60%2-1),b;switch(Math.floor(i/60)){case 0:b={r:o,g:o*(1-n*p),b:o*(1-n)};break;case 1:b={r:o*(1-n*p),g:o,b:o*(1-n)};break;case 2:b={r:o*(1-n),g:o,b:o*(1-n*p)};break;case 3:b={r:o*(1-n),g:o*(1-n*p),b:o};break;case 4:b={r:o*(1-n*p),g:o*(1-n),b:o};break;case 5:b={r:o,g:o*(1-n),b:o*(1-n*p)};break;default:b={r:o*(1-n),g:o*(1-n),b:o*(1-n)}}return b.mode="rgb",h!==void 0&&(b.alpha=h),b}function Cx({r:i,g:n,b:o,alpha:h}){i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=Math.max(i,n,o),b=Math.min(i,n,o),_={mode:"hsv",s:p===0?0:1-b/p,v:p};return p-b!==0&&(_.h=(p===i?(n-o)/(p-b)+(n<o)*6:p===n?(o-i)/(p-b)+2:(i-n)/(p-b)+4)*60),h!==void 0&&(_.alpha=h),_}const Px={mode:"hsv",toMode:{rgb:Ex},parse:["--hsv"],serialize:"--hsv",fromMode:{rgb:Cx},channels:["h","s","v","alpha"],ranges:{h:[0,360]},gamut:"rgb",interpolate:{h:{use:gt,fixup:wa},s:gt,v:gt,alpha:{use:gt,fixup:Un}},difference:{h:zf},average:{h:Ta}};function GP({h:i,w:n,b:o,alpha:h}){if(n===void 0&&(n=0),o===void 0&&(o=0),n+o>1){let p=n+o;n/=p,o/=p}return Ex({h:i,s:o===1?1:1-n/(1-o),v:1-o,alpha:h})}function HP(i){let n=Cx(i);if(n===void 0)return;let o=n.s!==void 0?n.s:0,h=n.v!==void 0?n.v:0,p={mode:"hwb",w:(1-o)*h,b:1-h};return n.h!==void 0&&(p.h=n.h),n.alpha!==void 0&&(p.alpha=n.alpha),p}function XP(i,n){if(!n||n[0]!=="hwb")return;const o={mode:"hwb"},[,h,p,b,_]=n;if(h.type!==et.None){if(h.type===et.Percentage)return;o.h=h.value}if(p.type!==et.None){if(p.type===et.Hue)return;o.w=p.value/100}if(b.type!==et.None){if(b.type===et.Hue)return;o.b=b.value/100}return _.type!==et.None&&(o.alpha=Math.min(1,Math.max(0,_.type===et.Number?_.value:_.value/100))),o}const YP={mode:"hwb",toMode:{rgb:GP},fromMode:{rgb:HP},channels:["h","w","b","alpha"],ranges:{h:[0,360]},gamut:"rgb",parse:[XP],serialize:i=>`hwb(${i.h!==void 0?i.h:"none"} ${i.w!==void 0?i.w*100+"%":"none"} ${i.b!==void 0?i.b*100+"%":"none"}${i.alpha<1?` / ${i.alpha}`:""})`,interpolate:{h:{use:gt,fixup:wa},w:gt,b:gt,alpha:{use:gt,fixup:Un}},difference:{h:LP},average:{h:Ta}},zx=203,Of=.1593017578125,Dx=78.84375,Bf=.8359375,Ff=18.8515625,Nf=18.6875;function Wm(i){if(i<0)return 0;const n=Math.pow(i,1/Dx);return 1e4*Math.pow(Math.max(0,n-Bf)/(Ff-Nf*n),1/Of)}function qm(i){if(i<0)return 0;const n=Math.pow(i/1e4,Of);return Math.pow((Bf+Ff*n)/(1+Nf*n),Dx)}const Zm=i=>Math.max(i/zx,0),Rv=({i,t:n,p:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);const p=Wm(i+.008609037037932761*n+.11102962500302593*o),b=Wm(i-.00860903703793275*n-.11102962500302599*o),_=Wm(i+.5600313357106791*n-.32062717498731885*o),c={mode:"xyz65",x:Zm(2.070152218389422*p-1.3263473389671556*b+.2066510476294051*_),y:Zm(.3647385209748074*p+.680566024947227*b-.0453045459220346*_),z:Zm(-.049747207535812*p-.0492609666966138*b+1.1880659249923042*_)};return h!==void 0&&(c.alpha=h),c},Gm=(i=0)=>Math.max(i*zx,0),Ov=({x:i,y:n,z:o,alpha:h})=>{const p=Gm(i),b=Gm(n),_=Gm(o),c=qm(.3592832590121217*p+.6976051147779502*b-.0358915932320289*_),A=qm(-.1920808463704995*p+1.1004767970374323*b+.0753748658519118*_),O=qm(.0070797844607477*p+.0748396662186366*b+.8433265453898765*_),B=.5*c+.5*A,R=1.61376953125*c-3.323486328125*A+1.709716796875*O,C=4.378173828125*c-4.24560546875*A-.132568359375*O,Y={mode:"itp",i:B,t:R,p:C};return h!==void 0&&(Y.alpha=h),Y},KP={mode:"itp",channels:["i","t","p","alpha"],parse:["--ictcp"],serialize:"--ictcp",toMode:{xyz65:Rv,rgb:i=>hl(Rv(i))},fromMode:{xyz65:Ov,rgb:i=>Ov(ul(i))},ranges:{i:[0,.581],t:[-.369,.272],p:[-.164,.331]},interpolate:{i:gt,t:gt,p:gt,alpha:{use:gt,fixup:Un}}},JP=134.03437499999998,QP=16295499532821565e-27,Hm=i=>{if(i<0)return 0;let n=Math.pow(i/1e4,Of);return Math.pow((Bf+Ff*n)/(1+Nf*n),JP)},Xm=(i=0)=>Math.max(i*203,0),Lx=({x:i,y:n,z:o,alpha:h})=>{i=Xm(i),n=Xm(n),o=Xm(o);let p=1.15*i-.15*o,b=.66*n+.34*i,_=Hm(.41478972*p+.579999*b+.014648*o),c=Hm(-.20151*p+1.120649*b+.0531008*o),A=Hm(-.0166008*p+.2648*b+.6684799*o),O=(_+c)/2,B={mode:"jab",j:.44*O/(1-.56*O)-QP,a:3.524*_-4.066708*c+.542708*A,b:.199076*_+1.096799*c-1.295875*A};return h!==void 0&&(B.alpha=h),B},ez=134.03437499999998,Bv=16295499532821565e-27,Ym=i=>{if(i<0)return 0;let n=Math.pow(i,1/ez);return 1e4*Math.pow((Bf-n)/(Nf*n-Ff),1/Of)},Km=i=>i/203,Rx=({j:i,a:n,b:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=(i+Bv)/(.44+.56*(i+Bv)),b=Ym(p+.13860504*n+.058047316*o),_=Ym(p-.13860504*n-.058047316*o),c=Ym(p-.096019242*n-.8118919*o),A={mode:"xyz65",x:Km(1.661373024652174*b-.914523081304348*_+.23136208173913045*c),y:Km(-.3250758611844533*b+1.571847026732543*_-.21825383453227928*c),z:Km(-.090982811*b-.31272829*_+1.5227666*c)};return h!==void 0&&(A.alpha=h),A},Ox=i=>{let n=Lx(ul(i));return i.r===i.b&&i.b===i.g&&(n.a=n.b=0),n},Bx=i=>hl(Rx(i)),tz={mode:"jab",channels:["j","a","b","alpha"],parse:["--jzazbz"],serialize:"--jzazbz",fromMode:{rgb:Ox,xyz65:Lx},toMode:{rgb:Bx,xyz65:Rx},ranges:{j:[0,.222],a:[-.109,.129],b:[-.185,.134]},interpolate:{j:gt,a:gt,b:gt,alpha:{use:gt,fixup:Un}}},Fv=({j:i,a:n,b:o,alpha:h})=>{n===void 0&&(n=0),o===void 0&&(o=0);let p=Math.sqrt(n*n+o*o),b={mode:"jch",j:i,c:p};return p&&(b.h=hr(Math.atan2(o,n)*180/Math.PI)),h!==void 0&&(b.alpha=h),b},Nv=({j:i,c:n,h:o,alpha:h})=>{o===void 0&&(o=0);let p={mode:"jab",j:i,a:n?n*Math.cos(o/180*Math.PI):0,b:n?n*Math.sin(o/180*Math.PI):0};return h!==void 0&&(p.alpha=h),p},iz={mode:"jch",parse:["--jzczhz"],serialize:"--jzczhz",toMode:{jab:Nv,rgb:i=>Bx(Nv(i))},fromMode:{rgb:i=>Fv(Ox(i)),jab:Fv},channels:["j","c","h","alpha"],ranges:{j:[0,.221],c:[0,.19],h:[0,360]},interpolate:{h:{use:gt,fixup:wa},c:gt,j:gt,alpha:{use:gt,fixup:Un}},difference:{h:Df},average:{h:Ta}},$f=Math.pow(29,3)/Math.pow(3,3),f0=Math.pow(6,3)/Math.pow(29,3);let Jm=i=>Math.pow(i,3)>f0?Math.pow(i,3):(116*i-16)/$f;const p0=({l:i,a:n,b:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=(i+16)/116,b=n/500+p,_=p-o/200,c={mode:"xyz50",x:Jm(b)*Bn.X,y:Jm(p)*Bn.Y,z:Jm(_)*Bn.Z};return h!==void 0&&(c.alpha=h),c},wh=({x:i,y:n,z:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=Lc({r:i*3.1341359569958707-n*1.6173863321612538-.4906619460083532*o,g:i*-.978795502912089+n*1.916254567259524+.03344273116131949*o,b:i*.07195537988411677-n*.2289768264158322+1.405386058324125*o});return h!==void 0&&(p.alpha=h),p},Fx=i=>wh(p0(i)),Th=i=>{let{r:n,g:o,b:h,alpha:p}=Dc(i),b={mode:"xyz50",x:.436065742824811*n+.3851514688337912*o+.14307845442264197*h,y:.22249319175623702*n+.7168870538238823*o+.06061979053616537*h,z:.013923904500943465*n+.09708128566574634*o+.7140993584005155*h};return p!==void 0&&(b.alpha=p),b},Qm=i=>i>f0?Math.cbrt(i):($f*i+16)/116,m0=({x:i,y:n,z:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=Qm(i/Bn.X),b=Qm(n/Bn.Y),_=Qm(o/Bn.Z),c={mode:"lab",l:116*b-16,a:500*(p-b),b:200*(b-_)};return h!==void 0&&(c.alpha=h),c},Nx=i=>{let n=m0(Th(i));return i.r===i.b&&i.b===i.g&&(n.a=n.b=0),n};function nz(i,n){if(!n||n[0]!=="lab")return;const o={mode:"lab"},[,h,p,b,_]=n;if(!(h.type===et.Hue||p.type===et.Hue||b.type===et.Hue))return h.type!==et.None&&(o.l=Math.min(Math.max(0,h.value),100)),p.type!==et.None&&(o.a=p.type===et.Number?p.value:p.value*125/100),b.type!==et.None&&(o.b=b.type===et.Number?b.value:b.value*125/100),_.type!==et.None&&(o.alpha=Math.min(1,Math.max(0,_.type===et.Number?_.value:_.value/100))),o}const g0={mode:"lab",toMode:{xyz50:p0,rgb:Fx},fromMode:{xyz50:m0,rgb:Nx},channels:["l","a","b","alpha"],ranges:{l:[0,100],a:[-100,100],b:[-100,100]},parse:[nz],serialize:i=>`lab(${i.l!==void 0?i.l:"none"} ${i.a!==void 0?i.a:"none"} ${i.b!==void 0?i.b:"none"}${i.alpha<1?` / ${i.alpha}`:""})`,interpolate:{l:gt,a:gt,b:gt,alpha:{use:gt,fixup:Un}}},rz={...g0,mode:"lab65",parse:["--lab-d65"],serialize:"--lab-d65",toMode:{xyz65:Sx,rgb:Lf},fromMode:{xyz65:kx,rgb:Rf},ranges:{l:[0,100],a:[-86.182,98.234],b:[-107.86,94.477]}};function sz(i,n){if(!n||n[0]!=="lch")return;const o={mode:"lch"},[,h,p,b,_]=n;if(h.type!==et.None){if(h.type===et.Hue)return;o.l=Math.min(Math.max(0,h.value),100)}if(p.type!==et.None&&(o.c=Math.max(0,p.type===et.Number?p.value:p.value*150/100)),b.type!==et.None){if(b.type===et.Percentage)return;o.h=b.value}return _.type!==et.None&&(o.alpha=Math.min(1,Math.max(0,_.type===et.Number?_.value:_.value/100))),o}const y0={mode:"lch",toMode:{lab:uo,rgb:i=>Fx(uo(i))},fromMode:{rgb:i=>co(Nx(i)),lab:co},channels:["l","c","h","alpha"],ranges:{l:[0,100],c:[0,150],h:[0,360]},parse:[sz],serialize:i=>`lch(${i.l!==void 0?i.l:"none"} ${i.c!==void 0?i.c:"none"} ${i.h!==void 0?i.h:"none"}${i.alpha<1?` / ${i.alpha}`:""})`,interpolate:{h:{use:gt,fixup:wa},c:gt,l:gt,alpha:{use:gt,fixup:Un}},difference:{h:Df},average:{h:Ta}},az={...y0,mode:"lch65",parse:["--lch-d65"],serialize:"--lch-d65",toMode:{lab65:i=>uo(i,"lab65"),rgb:i=>Lf(uo(i,"lab65"))},fromMode:{rgb:i=>co(Rf(i),"lch65"),lab65:i=>co(i,"lch65")},ranges:{l:[0,100],c:[0,133.807],h:[0,360]}},$x=({l:i,u:n,v:o,alpha:h})=>{n===void 0&&(n=0),o===void 0&&(o=0);let p=Math.sqrt(n*n+o*o),b={mode:"lchuv",l:i,c:p};return p&&(b.h=hr(Math.atan2(o,n)*180/Math.PI)),h!==void 0&&(b.alpha=h),b},jx=({l:i,c:n,h:o,alpha:h})=>{o===void 0&&(o=0);let p={mode:"luv",l:i,u:n?n*Math.cos(o/180*Math.PI):0,v:n?n*Math.sin(o/180*Math.PI):0};return h!==void 0&&(p.alpha=h),p},Vx=(i,n,o)=>4*i/(i+15*n+3*o),Ux=(i,n,o)=>9*n/(i+15*n+3*o),oz=Vx(Bn.X,Bn.Y,Bn.Z),lz=Ux(Bn.X,Bn.Y,Bn.Z),cz=i=>i<=f0?$f*i:116*Math.cbrt(i)-16,Rg=({x:i,y:n,z:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=cz(n/Bn.Y),b=Vx(i,n,o),_=Ux(i,n,o);!isFinite(b)||!isFinite(_)?p=b=_=0:(b=13*p*(b-oz),_=13*p*(_-lz));let c={mode:"luv",l:p,u:b,v:_};return h!==void 0&&(c.alpha=h),c},uz=(i,n,o)=>4*i/(i+15*n+3*o),hz=(i,n,o)=>9*n/(i+15*n+3*o),dz=uz(Bn.X,Bn.Y,Bn.Z),fz=hz(Bn.X,Bn.Y,Bn.Z),Og=({l:i,u:n,v:o,alpha:h})=>{if(i===void 0&&(i=0),i===0)return{mode:"xyz50",x:0,y:0,z:0};n===void 0&&(n=0),o===void 0&&(o=0);let p=n/(13*i)+dz,b=o/(13*i)+fz,_=Bn.Y*(i<=8?i/$f:Math.pow((i+16)/116,3)),c=_*(9*p)/(4*b),A=_*(12-3*p-20*b)/(4*b),O={mode:"xyz50",x:c,y:_,z:A};return h!==void 0&&(O.alpha=h),O},pz=i=>$x(Rg(Th(i))),mz=i=>wh(Og(jx(i))),gz={mode:"lchuv",toMode:{luv:jx,rgb:mz},fromMode:{rgb:pz,luv:$x},channels:["l","c","h","alpha"],parse:["--lchuv"],serialize:"--lchuv",ranges:{l:[0,100],c:[0,176.956],h:[0,360]},interpolate:{h:{use:gt,fixup:wa},c:gt,l:gt,alpha:{use:gt,fixup:Un}},difference:{h:Df},average:{h:Ta}},yz={...zc,mode:"lrgb",toMode:{rgb:Lc},fromMode:{rgb:Dc},parse:["srgb-linear"],serialize:"srgb-linear"},_z={mode:"luv",toMode:{xyz50:Og,rgb:i=>wh(Og(i))},fromMode:{xyz50:Rg,rgb:i=>Rg(Th(i))},channels:["l","u","v","alpha"],parse:["--luv"],serialize:"--luv",ranges:{l:[0,100],u:[-84.936,175.042],v:[-125.882,87.243]},interpolate:{l:gt,u:gt,v:gt,alpha:{use:gt,fixup:Un}}},Wx=({r:i,g:n,b:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=Math.cbrt(.41222147079999993*i+.5363325363*n+.0514459929*o),b=Math.cbrt(.2119034981999999*i+.6806995450999999*n+.1073969566*o),_=Math.cbrt(.08830246189999998*i+.2817188376*n+.6299787005000002*o),c={mode:"oklab",l:.2104542553*p+.793617785*b-.0040720468*_,a:1.9779984951*p-2.428592205*b+.4505937099*_,b:.0259040371*p+.7827717662*b-.808675766*_};return h!==void 0&&(c.alpha=h),c},jf=i=>{let n=Wx(Dc(i));return i.r===i.b&&i.b===i.g&&(n.a=n.b=0),n},Sh=({l:i,a:n,b:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=Math.pow(i*.9999999984505198+.39633779217376786*n+.2158037580607588*o,3),b=Math.pow(i*1.0000000088817609-.10556134232365635*n-.06385417477170591*o,3),_=Math.pow(i*1.0000000546724108-.08948418209496575*n-1.2914855378640917*o,3),c={mode:"lrgb",r:4.076741661347994*p-3.307711590408193*b+.230969928729428*_,g:-1.2684380040921763*p+2.6097574006633715*b-.3413193963102197*_,b:-.004196086541837188*p-.7034186144594493*b+1.7076147009309444*_};return h!==void 0&&(c.alpha=h),c},Vf=i=>Lc(Sh(i));function Bg(i){const h=1.170873786407767;return .5*(h*i-.206+Math.sqrt((h*i-.206)*(h*i-.206)+4*.03*h*i))}function gf(i){return(i*i+.206*i)/(1.170873786407767*(i+.03))}function vz(i,n){let o,h,p,b,_,c,A,O;-1.88170328*i-.80936493*n>1?(o=1.19086277,h=1.76576728,p=.59662641,b=.75515197,_=.56771245,c=4.0767416621,A=-3.3077115913,O=.2309699292):1.81444104*i-1.19445276*n>1?(o=.73956515,h=-.45954404,p=.08285427,b=.1254107,_=.14503204,c=-1.2684380046,A=2.6097574011,O=-.3413193965):(o=1.35733652,h=-.00915799,p=-1.1513021,b=-.50559606,_=.00692167,c=-.0041960863,A=-.7034186147,O=1.707614701);let B=o+h*i+p*n+b*i*i+_*i*n,R=.3963377774*i+.2158037573*n,C=-.1055613458*i-.0638541728*n,Y=-.0894841775*i-1.291485548*n;{let X=1+B*R,H=1+B*C,ae=1+B*Y,Z=X*X*X,te=H*H*H,ne=ae*ae*ae,_e=3*R*X*X,ve=3*C*H*H,Se=3*Y*ae*ae,de=6*R*R*X,Fe=6*C*C*H,Re=6*Y*Y*ae,Le=c*Z+A*te+O*ne,Te=c*_e+A*ve+O*Se,we=c*de+A*Fe+O*Re;B=B-Le*Te/(Te*Te-.5*Le*we)}return B}function _0(i,n){let o=vz(i,n),h=Sh({l:1,a:o*i,b:o*n}),p=Math.cbrt(1/Math.max(h.r,h.g,h.b)),b=p*o;return[p,b]}function bz(i,n,o,h,p,b=null){b||(b=_0(i,n));let _;if((o-p)*b[1]-(b[0]-p)*h<=0)_=b[1]*p/(h*b[0]+b[1]*(p-o));else{_=b[1]*(p-1)/(h*(b[0]-1)+b[1]*(p-o));{let c=o-p,A=h,O=.3963377774*i+.2158037573*n,B=-.1055613458*i-.0638541728*n,R=-.0894841775*i-1.291485548*n,C=c+A*O,Y=c+A*B,X=c+A*R;{let H=p*(1-_)+_*o,ae=_*h,Z=H+ae*O,te=H+ae*B,ne=H+ae*R,_e=Z*Z*Z,ve=te*te*te,Se=ne*ne*ne,de=3*C*Z*Z,Fe=3*Y*te*te,Re=3*X*ne*ne,Le=6*C*C*Z,Te=6*Y*Y*te,we=6*X*X*ne,fe=4.0767416621*_e-3.3077115913*ve+.2309699292*Se-1,Ae=4.0767416621*de-3.3077115913*Fe+.2309699292*Re,Ce=4.0767416621*Le-3.3077115913*Te+.2309699292*we,Ve=Ae/(Ae*Ae-.5*fe*Ce),Ue=-fe*Ve,Ge=-1.2684380046*_e+2.6097574011*ve-.3413193965*Se-1,Oe=-1.2684380046*de+2.6097574011*Fe-.3413193965*Re,Xe=-1.2684380046*Le+2.6097574011*Te-.3413193965*we,We=Oe/(Oe*Oe-.5*Ge*Xe),Et=-Ge*We,Nt=-.0041960863*_e-.7034186147*ve+1.707614701*Se-1,_t=-.0041960863*de-.7034186147*Fe+1.707614701*Re,Xt=-.0041960863*Le-.7034186147*Te+1.707614701*we,$t=_t/(_t*_t-.5*Nt*Xt),ai=-Nt*$t;Ue=Ve>=0?Ue:1e6,Et=We>=0?Et:1e6,ai=$t>=0?ai:1e6,_+=Math.min(Ue,Math.min(Et,ai))}}}return _}function v0(i,n,o=null){o||(o=_0(i,n));let h=o[0],p=o[1];return[p/h,p/(1-h)]}function qx(i,n,o){let h=_0(n,o),p=bz(n,o,i,1,i,h),b=v0(n,o,h),_=.11516993+1/(7.4477897+4.1590124*o+n*(-2.19557347+1.75198401*o+n*(-2.13704948-10.02301043*o+n*(-4.24894561+5.38770819*o+4.69891013*n)))),c=.11239642+1/(1.6132032-.68124379*o+n*(.40370612+.90148123*o+n*(-.27087943+.6122399*o+n*(.00299215-.45399568*o-.14661872*n)))),A=p/Math.min(i*b[0],(1-i)*b[1]),O=i*_,B=(1-i)*c,R=.9*A*Math.sqrt(Math.sqrt(1/(1/(O*O*O*O)+1/(B*B*B*B))));return O=i*.4,B=(1-i)*.8,[Math.sqrt(1/(1/(O*O)+1/(B*B))),R,p]}function $v(i){const n=i.l!==void 0?i.l:0,o=i.a!==void 0?i.a:0,h=i.b!==void 0?i.b:0,p={mode:"okhsl",l:Bg(n)};i.alpha!==void 0&&(p.alpha=i.alpha);let b=Math.sqrt(o*o+h*h);if(!b)return p.s=0,p;let[_,c,A]=qx(n,o/b,h/b),O;if(b<c){let B=0,R=.8*_,C=1-R/c;O=(b-B)/(R+C*(b-B))*.8}else{let B=c,R=.2*c*c*1.25*1.25/_,C=1-R/(A-c);O=.8+.2*((b-B)/(R+C*(b-B)))}return O&&(p.s=O,p.h=hr(Math.atan2(h,o)*180/Math.PI)),p}function jv(i){let n=i.h!==void 0?i.h:0,o=i.s!==void 0?i.s:0,h=i.l!==void 0?i.l:0;const p={mode:"oklab",l:gf(h)};if(i.alpha!==void 0&&(p.alpha=i.alpha),!o||h===1)return p.a=p.b=0,p;let b=Math.cos(n/180*Math.PI),_=Math.sin(n/180*Math.PI),[c,A,O]=qx(p.l,b,_),B,R,C,Y;o<.8?(B=1.25*o,R=0,C=.8*c,Y=1-C/A):(B=5*(o-.8),R=A,C=.2*A*A*1.25*1.25/c,Y=1-C/(O-A));let X=R+B*C/(1-Y*B);return p.a=X*b,p.b=X*_,p}const xz={...Ix,mode:"okhsl",channels:["h","s","l","alpha"],parse:["--okhsl"],serialize:"--okhsl",fromMode:{oklab:$v,rgb:i=>$v(jf(i))},toMode:{oklab:jv,rgb:i=>Vf(jv(i))}};function Vv(i){let n=i.l!==void 0?i.l:0,o=i.a!==void 0?i.a:0,h=i.b!==void 0?i.b:0,p=Math.sqrt(o*o+h*h),b=p?o/p:1,_=p?h/p:1,[c,A]=v0(b,_),O=.5,B=1-O/c,R=A/(p+n*A),C=R*n,Y=R*p,X=gf(C),H=Y*X/C,ae=Sh({l:X,a:b*H,b:_*H}),Z=Math.cbrt(1/Math.max(ae.r,ae.g,ae.b,0));n=n/Z,p=p/Z*Bg(n)/n,n=Bg(n);const te={mode:"okhsv",s:p?(O+A)*Y/(A*O+A*B*Y):0,v:n?n/C:0};return te.s&&(te.h=hr(Math.atan2(h,o)*180/Math.PI)),i.alpha!==void 0&&(te.alpha=i.alpha),te}function Uv(i){const n={mode:"oklab"};i.alpha!==void 0&&(n.alpha=i.alpha);const o=i.h!==void 0?i.h:0,h=i.s!==void 0?i.s:0,p=i.v!==void 0?i.v:0,b=Math.cos(o/180*Math.PI),_=Math.sin(o/180*Math.PI),[c,A]=v0(b,_),O=.5,B=1-O/c,R=1-h*O/(O+A-A*B*h),C=h*A*O/(O+A-A*B*h),Y=gf(R),X=C*Y/R,H=Sh({l:Y,a:b*X,b:_*X}),ae=Math.cbrt(1/Math.max(H.r,H.g,H.b,0)),Z=gf(p*R),te=C*Z/R;return n.l=Z*ae,n.a=te*b*ae,n.b=te*_*ae,n}const wz={...Px,mode:"okhsv",channels:["h","s","v","alpha"],parse:["--okhsv"],serialize:"--okhsv",fromMode:{oklab:Vv,rgb:i=>Vv(jf(i))},toMode:{oklab:Uv,rgb:i=>Vf(Uv(i))}};function Tz(i,n){if(!n||n[0]!=="oklab")return;const o={mode:"oklab"},[,h,p,b,_]=n;if(!(h.type===et.Hue||p.type===et.Hue||b.type===et.Hue))return h.type!==et.None&&(o.l=Math.min(Math.max(0,h.type===et.Number?h.value:h.value/100),1)),p.type!==et.None&&(o.a=p.type===et.Number?p.value:p.value*.4/100),b.type!==et.None&&(o.b=b.type===et.Number?b.value:b.value*.4/100),_.type!==et.None&&(o.alpha=Math.min(1,Math.max(0,_.type===et.Number?_.value:_.value/100))),o}const Sz={...g0,mode:"oklab",toMode:{lrgb:Sh,rgb:Vf},fromMode:{lrgb:Wx,rgb:jf},ranges:{l:[0,1],a:[-.4,.4],b:[-.4,.4]},parse:[Tz],serialize:i=>`oklab(${i.l!==void 0?i.l:"none"} ${i.a!==void 0?i.a:"none"} ${i.b!==void 0?i.b:"none"}${i.alpha<1?` / ${i.alpha}`:""})`};function kz(i,n){if(!n||n[0]!=="oklch")return;const o={mode:"oklch"},[,h,p,b,_]=n;if(h.type!==et.None){if(h.type===et.Hue)return;o.l=Math.min(Math.max(0,h.type===et.Number?h.value:h.value/100),1)}if(p.type!==et.None&&(o.c=Math.max(0,p.type===et.Number?p.value:p.value*.4/100)),b.type!==et.None){if(b.type===et.Percentage)return;o.h=b.value}return _.type!==et.None&&(o.alpha=Math.min(1,Math.max(0,_.type===et.Number?_.value:_.value/100))),o}const Mz={...y0,mode:"oklch",toMode:{oklab:i=>uo(i,"oklab"),rgb:i=>Vf(uo(i,"oklab"))},fromMode:{rgb:i=>co(jf(i),"oklch"),oklab:i=>co(i,"oklch")},parse:[kz],serialize:i=>`oklch(${i.l!==void 0?i.l:"none"} ${i.c!==void 0?i.c:"none"} ${i.h!==void 0?i.h:"none"}${i.alpha<1?` / ${i.alpha}`:""})`,ranges:{l:[0,1],c:[0,.4],h:[0,360]}},Wv=i=>{let{r:n,g:o,b:h,alpha:p}=Dc(i),b={mode:"xyz65",x:.486570948648216*n+.265667693169093*o+.1982172852343625*h,y:.2289745640697487*n+.6917385218365062*o+.079286914093745*h,z:0*n+.0451133818589026*o+1.043944368900976*h};return p!==void 0&&(b.alpha=p),b},qv=({x:i,y:n,z:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p=Lc({r:i*2.4934969119414263-n*.9313836179191242-.402710784450717*o,g:i*-.8294889695615749+n*1.7626640603183465+.0236246858419436*o,b:i*.0358458302437845-n*.0761723892680418+.9568845240076871*o},"p3");return h!==void 0&&(p.alpha=h),p},Az={...zc,mode:"p3",parse:["display-p3"],serialize:"display-p3",fromMode:{rgb:i=>qv(ul(i)),xyz65:qv},toMode:{rgb:i=>hl(Wv(i)),xyz65:Wv}},eg=i=>{let n=Math.abs(i);return n>=1/512?Math.sign(i)*Math.pow(n,1/1.8):16*i},Zv=({x:i,y:n,z:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p={mode:"prophoto",r:eg(i*1.3457868816471585-n*.2555720873797946-.0511018649755453*o),g:eg(i*-.5446307051249019+n*1.5082477428451466+.0205274474364214*o),b:eg(i*0+n*0+1.2119675456389452*o)};return h!==void 0&&(p.alpha=h),p},tg=(i=0)=>{let n=Math.abs(i);return n>=16/512?Math.sign(i)*Math.pow(n,1.8):i/16},Gv=i=>{let n=tg(i.r),o=tg(i.g),h=tg(i.b),p={mode:"xyz50",x:.7977666449006423*n+.1351812974005331*o+.0313477341283922*h,y:.2880748288194013*n+.7118352342418731*o+899369387256e-16*h,z:0*n+0*o+.8251046025104602*h};return i.alpha!==void 0&&(p.alpha=i.alpha),p},Iz={...zc,mode:"prophoto",parse:["prophoto-rgb"],serialize:"prophoto-rgb",fromMode:{xyz50:Zv,rgb:i=>Zv(Th(i))},toMode:{xyz50:Gv,rgb:i=>wh(Gv(i))}},Hv=1.09929682680944,Ez=.018053968510807,ig=i=>{const n=Math.abs(i);return n>Ez?(Math.sign(i)||1)*(Hv*Math.pow(n,.45)-(Hv-1)):4.5*i},Xv=({x:i,y:n,z:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);let p={mode:"rec2020",r:ig(i*1.7166511879712683-n*.3556707837763925-.2533662813736599*o),g:ig(i*-.6666843518324893+n*1.6164812366349395+.0157685458139111*o),b:ig(i*.0176398574453108-n*.0427706132578085+.9421031212354739*o)};return h!==void 0&&(p.alpha=h),p},Yv=1.09929682680944,Cz=.018053968510807,ng=(i=0)=>{let n=Math.abs(i);return n<Cz*4.5?i/4.5:(Math.sign(i)||1)*Math.pow((n+Yv-1)/Yv,1/.45)},Kv=i=>{let n=ng(i.r),o=ng(i.g),h=ng(i.b),p={mode:"xyz65",x:.6369580483012911*n+.1446169035862083*o+.1688809751641721*h,y:.262700212011267*n+.6779980715188708*o+.059301716469862*h,z:0*n+.0280726930490874*o+1.0609850577107909*h};return i.alpha!==void 0&&(p.alpha=i.alpha),p},Pz={...zc,mode:"rec2020",fromMode:{xyz65:Xv,rgb:i=>Xv(ul(i))},toMode:{xyz65:Kv,rgb:i=>hl(Kv(i))},parse:["rec2020"],serialize:"rec2020"},il=.0037930732552754493,Zx=Math.cbrt(il),rg=i=>Math.cbrt(i)-Zx,zz=i=>{const{r:n,g:o,b:h,alpha:p}=Dc(i),b=rg(.3*n+.622*o+.078*h+il),_=rg(.23*n+.692*o+.078*h+il),c=rg(.2434226892454782*n+.2047674442449682*o+.5518098665095535*h+il),A={mode:"xyb",x:(b-_)/2,y:(b+_)/2,b:c-(b+_)/2};return p!==void 0&&(A.alpha=p),A},sg=i=>Math.pow(i+Zx,3),Dz=({x:i,y:n,b:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);const p=sg(i+n)-il,b=sg(n-i)-il,_=sg(o+n)-il,c=Lc({r:11.031566904639861*p-9.866943908131562*b-.16462299650829934*_,g:-3.2541473810744237*p+4.418770377582723*b-.16462299650829934*_,b:-3.6588512867136815*p+2.7129230459360922*b+1.9459282407775895*_});return h!==void 0&&(c.alpha=h),c},Lz={mode:"xyb",channels:["x","y","b","alpha"],parse:["--xyb"],serialize:"--xyb",toMode:{rgb:Dz},fromMode:{rgb:zz},ranges:{x:[-.0154,.0281],y:[0,.8453],b:[-.2778,.388]},interpolate:{x:gt,y:gt,b:gt,alpha:{use:gt,fixup:Un}}},Rz={mode:"xyz50",parse:["xyz-d50"],serialize:"xyz-d50",toMode:{rgb:wh,lab:m0},fromMode:{rgb:Th,lab:p0},channels:["x","y","z","alpha"],ranges:{x:[0,.964],y:[0,.999],z:[0,.825]},interpolate:{x:gt,y:gt,z:gt,alpha:{use:gt,fixup:Un}}},Oz=i=>{let{x:n,y:o,z:h,alpha:p}=i;n===void 0&&(n=0),o===void 0&&(o=0),h===void 0&&(h=0);let b={mode:"xyz50",x:1.0479298208405488*n+.0229467933410191*o-.0501922295431356*h,y:.0296278156881593*n+.990434484573249*o-.0170738250293851*h,z:-.0092430581525912*n+.0150551448965779*o+.7518742899580008*h};return p!==void 0&&(b.alpha=p),b},Bz=i=>{let{x:n,y:o,z:h,alpha:p}=i;n===void 0&&(n=0),o===void 0&&(o=0),h===void 0&&(h=0);let b={mode:"xyz65",x:.9554734527042182*n-.0230985368742614*o+.0632593086610217*h,y:-.0283697069632081*n+1.0099954580058226*o+.021041398966943*h,z:.0123140016883199*n-.0205076964334779*o+1.3303659366080753*h};return p!==void 0&&(b.alpha=p),b},Fz={mode:"xyz65",toMode:{rgb:hl,xyz50:Oz},fromMode:{rgb:ul,xyz50:Bz},ranges:{x:[0,.95],y:[0,1],z:[0,1.088]},channels:["x","y","z","alpha"],parse:["xyz","xyz-d65"],serialize:"xyz-d65",interpolate:{x:gt,y:gt,z:gt,alpha:{use:gt,fixup:Un}}},Nz=({r:i,g:n,b:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);const p={mode:"yiq",y:.29889531*i+.58662247*n+.11448223*o,i:.59597799*i-.2741761*n-.32180189*o,q:.21147017*i-.52261711*n+.31114694*o};return h!==void 0&&(p.alpha=h),p},$z=({y:i,i:n,q:o,alpha:h})=>{i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);const p={mode:"rgb",r:i+.95608445*n+.6208885*o,g:i-.27137664*n-.6486059*o,b:i-1.10561724*n+1.70250126*o};return h!==void 0&&(p.alpha=h),p},jz={mode:"yiq",toMode:{rgb:$z},fromMode:{rgb:Nz},channels:["y","i","q","alpha"],parse:["--yiq"],serialize:"--yiq",ranges:{i:[-.595,.595],q:[-.522,.522]},interpolate:{y:gt,i:gt,q:gt,alpha:{use:gt,fixup:Un}}};Zi(IP);Zi(RP);Zi(OP);Zi(BP);Zi($P);Zi(Ix);Zi(Px);Zi(YP);Zi(KP);Zi(tz);Zi(iz);Zi(g0);Zi(rz);Zi(y0);Zi(az);Zi(gz);Zi(yz);Zi(_z);Zi(xz);Zi(wz);Zi(Sz);Zi(Mz);Zi(Az);Zi(Iz);Zi(Pz);Zi(zc);Zi(Lz);Zi(Rz);Zi(Fz);Zi(jz);[...Db(100,1e3,100)];var Vz=Wt('<div class="legend-item svelte-szvm2v"><svg width="100" height="10"><rect width="150" opacity="0.8" height="10" stroke="#282828" stroke-width="0.3"></rect></svg></div>'),Uz=Wt('<div class="legend md:mx-0 mx-2"><h4 class=" inline-flex font-khand-bold items-center py-2 text-lg tracking-normal text-zinc-700">Higher chance of water accumulation <!></h4> <div class="legend-items svelte-szvm2v"></div></div>');function Wz(i){const n=[{color:"#ffffff"},{color:"#abced0"},{color:"#519ea2"}];var o=Uz(),h=pt(o),p=Ht(pt(h));eM(p,{class:"size-5 ml-2"}),ut(h);var b=Ht(h,2);vc(b,5,()=>n,_c,(_,c)=>{var A=Vz(),O=pt(A),B=pt(O);ut(O),ut(A),Ai(()=>ki(B,"fill",De(c).color)),rt(_,A)}),ut(b),ut(o),rt(i,o)}const qz=""+new URL("../assets/Layer 20.DxOYi3UK.png",import.meta.url).href,Zz="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAAAtCAYAAADxwQZkAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAADmhJREFUeJzFWnuMFdUdPufM495dlocosIqoRRAFURFQ/6iPmGqrrUpFxQiUtCpasa3RQH2gxhqtprGxNKTiIzRRE22iTVtqNdqKWuMDFCREqm0Tq1hFBRTC7r13Zs7p9/3mDg7D3N0Fdu2QYWbvncf5fef7fb/vd3a1GthN78G1bsBG0cu2J4Pcm2e2Os8214fzAd/6E4RiwLrFeX5zuaMr/Jw/DujWXyAUA261568tA4C7LfluQLf+AKEsWJM7GrU7ENmWDzzb80CUsaPft30FoVXgXu6oc0f98AM3jz9p+qTvtLVVD/N9/wDt+RV83MB3XdYmH3fXGs/Nmnvjn1a98XasdgVDqQECYl9AKAKQBV3c5fN7714wbuZ3T7+1GgZHK62dVr512sRa4VRpp7RxyjYqxgsSZ+32rq6uu8ccef4jaleGKDUAQOwtCEUA8kH7uV0+W7XyN5cddmjnFbg8kBgQPD62iN0o54BCgmfg3ASRdomnXOwTlCRRzy66+f55v330aTJlwIDYGxBaAZAFHuSP61596PqDOve/yLk015280VjEj+gTLQ9yDc8hcK2DpDnxeK4HdijQw6xdtPihM5Y/8lQeiP8rCNn1RfpnQe+yr3rhwR8fdujoWYgGASMFbALeK5l5p/xEq3qAdDBOeziPfC3B4dwADBcFip/r0IIyqxfeuGTm8odX1NXugrnP256AkC9xWa7nZz/MHcM/P3H3zOlTJ1xH2jvnJwg6dpxIUEJr6xlF2uOfZipQI/AzgsYjyAYDICJlDMBRvnZWJ9atHHHot2ar8srxlYJQlgL54Cs8Ll40Z+KPrphxnzE6cML/AGlgETIAUSbhM7SiJspzCQQ1ABOurBZAwBvtJwAFgMnPht83Gl0PdY6dcav6UizT+78iEMqqQJ76lQyE4fsNaYMOPBaGwQgIHAbPXIAIOpdWALBfacSK2RVasDLIG3CUHzVoENj0I0oGtMKESANen5gtW7bNGn/cnBdUP+pDbyDkUyAPQD4FMgYIEKtfXHb9IWNGnaWy0Ykg8j/THKxFuFZ+1q4bz/ETq8NI0kPehJRA7OkLG4EyYSzpwg8c1dRuPOv8609Y9eY7keqnitETCD0BkKVBHoDKTQu/N+knV130Ky0mAPR2HGPM6CkGRks68IERpV9yH+mC7/wYmJhUGH0r6SBCCb0wvlU2NtiaQWpTq3cvGT1h9m2qnzxEKxB6AyCvAbIPGzYYafDo8mo16OSUOZcwDZI06IYvA+RE4ruU+BAJnunIQ8SpOBI00QB5L1CxnhQTyoYJIwKgUVZxd23l39edMHPObZsKQOwVGGUglDnBskqwE4Rzzj6lc8k91/2ioz0Ya12CmcOYjEcgmP6s9xilZSYkzedalwogw8O/uGm5PcsqoeUWBEuxVJQV+AajBTJiRH+VWLvh2hvuP/PR3/21VgLEHoFRBKGVFc4DsIsQPv2HpRdPmTLxB0ZF7aS/cxF2mkEqYV4XNFhBE6RTVU/dEy7yYhYFLTLYCByNlNYpgZQGOnEg+igbnaQHhoBFtkHf/e+16zfOPfO8he+2AKJPYJQteuRnPy+CeR0I77nr2qkXX/jNW6ptHQejCmD+YwszhNc1tLVxM3TWRc50w7AaOFWJtKoFpH6ig9hZP4J2REYngZEyiCBFK8RSS+z0COIhDJ/jpdWERsp1B2kZ9RtRrP/yyuvrbz1/9m0bc2CUaUUpGGULIa2c4E4AXnl++ZUTxh9yudae52RWkN4uAvuxO5zDC8AGpyWQJVEcohL6a0ehJM2ZIAgCAoojqkMMBfRjoxsVCChcI9LCxXh+ANcIgPBMHD2xEo6MIkgkDQjhaK4qtUacPLf6zXduOufCGzIwim15KRBliyFFAML8/uxTyy6Zduy4RVSw5q2WKWCTBsYCPcBsOZUw6RPRP6kQNAtWNJ/soOozzwlGekXYSFzQ8HTM94HujapTQZSmAq02XSTuM45O08g8IXgtfgMckZGzqpAmNo7i5KUPPvj459NPvXKt6oNwFkFoBYBowPIHbj/tG6efdPXg9up45KSSWaexsRHOoAVgguJRsQqg7Nm4aQDxtYCjY6n4CIwBWuVFwjzY6gTnOu2qrKcbIdwlTj0yI0yDS8uooWbQdcFuGxfBUhqjmmkjZkwaLyEeJsKs2b69+96xR1+4QvVQTosrQi2N0DGTjxj2+MN33drRMWjsoPb2wx2rAEUOCm7jOic9cbaGgLs9zjYCjFkiecTs+U4Y4IiBiDvY4IslgkG0zm9II0VmpCVDeTqqNIeIW2ik2Ed4Mu9ME2GBlI4AJyylcmtaUWi3TVtMsrqkBoK6l957/+Nrp596+X9KWLFbNchXgcwDVLkv+/Xik087ZeqssOIPHzJ46JGYJdCAdI7AhAQVK0YOEAQnc6AkFwBEM/8NRE/WCuTtDMh5ErSil9BW8KF2iLVWXG8JPAqgCIvHBRh8zxKKFEH55JZqQSBBK/HVSBXN7hSg6CrUOTLO1knLT3DNhq4dO+47dNLsp1ShehTLYdEIVbP9mRX3zx01csSEIPSG7T982JG+p9uF9rYOXWSPHKeiCEASKH72DnFBCJRskIonzpGVghXgy9lILNlANySBZ1NkEE8iGSA9hyduiiM2oitgE7MH7TaISG1w6aINGy/orGKKNmgvtiJVP1SeV2/U6g8cfNTcx1SuAStWhDIWtPH46ouPXeP54RBMSPXgzv2mep5uk3UCUNuxPCTdeEjM2UGxDAiCFfvDVEA+W6SGsEGETTpkrhMwkUnkhKxiRUC/EDoXRIzaCmNEVVP/pE26LtE0mHw2QYE4eE0oPbXzYrDKRoyNbXwXJmcTGPoFVXXbjujKw4+Zuz5jQxkIYREA7qtefvynnmcG+UHQceDIoVNSpRcTDC1AjGAC/ALwRWawXabqQweMwUwxQRR8AQOFOzSSCuIhrNgINtm6VhH7KAwgMAE9REyxFIYYMgTEcGGD4zbyOYI3HsGnJnjiK0SAKRN1/JzQbhOEuo1rm0GLrfgAAuavHnX4zIWZPuRXif0CCJUmCNwrK55ceskhY0YeO6ijY9TgjkFjKGgM2iaxFRGAUFLg8B8SlSlPH0Cfy3VE6oLLcq9pfQUEukpEk/ieqldcuvhAOtM7xBYpYgwo79I+mz6BK1JKdIbANCrSfZIrqj2SJsP4eLikCi5hoybyU6cu2CTaxJugI92bPtlyzeQTv/9eKxCydNiFCZfOmzHumqvnzD9gxP4TfV8PElMsaUCDlECAvYhaYGiCXOpRjHSCzGMZlMkGr6WhoNBZj+IpxoczKWsGkc/VJav9OO2eCRg9g/Vc836VdliG+sElOvlEt0VOVyMIoyMzxGgpyUp859cwps+j2LyljV8Di1wcJ0+OOeLc3/eUDmFeFJt75flnls2ffPRRF0t5ZPJbBYoDZItDuiyG3knHTEO20r6KwrQS0A4j5REgTZCsN2vpMln+QAmuGYidBLmhCQDOcn0Rfkpr3pOuRqULMCa9lP/Qa2gH0DQvqYL7sjbppSXVa6YndsPUUl/Uk+A1qGe39tjmu/Wjx579yzIQPLWrP6jmjuFxx0zY749PLFna3t52EMuAi2u0y1LmEsvfIfDl0kUJGegKpXfEEXQPUymmkWFJZOVKO0mOIHG0zpazW0kZ08xtGCnNnkLYwyD5DAIpLRd1Id1FdGmmWCbZwfJevoK2OkZqJVsiG671PJguNDMY5j8OOvzcO1W6ZLWbWyxbMcr24MDO/dufXXHf4lEjh56IV8QoiIl0xun6gE2VP6HdY1n0KG7UD0kHJ4vNsoYmxknMtFQAWWUw8AaG5VNzFvlxuszWLKWGK/BZXWOTZQmK9vAvCo2uheIgJVEqALlBzxDzTvjruosbm1G1NoAFdWNo8OK/jR4/48EiCD0tnWXnWTPl33X7gimzLjjjqraq3wlBjMDfRCIDnVNAElF9aXKkhaZApkopfXK6vAh36UVWXs5rOBA0UuwwwQaUVfQTCVOK34sWKvoCEVWx0onTIUCIUVrRnTou3rCSBi7tRGVhF6JloySpb8QYP/S4gqW9LzZv3XbHpGnz3s6ng1J96B7Vly119tsls2zJwpNP+frUbw8eMvRrmCqYFzg6x5IlIdu0JwadyRLhsG0uFyIq0Jmts5Q6EU9x/IQSmdzepeRXVHGY9WoijDptNtIVaAlIsxrIhDJ+YR/fybYblQTNBwZRixpd6+v16LVarfbWypfWrFxw3dLP8cgkA0GVsKHVL1SKv2LbufZw/HETOhbMv+D4ESOGjQhDU/E9L+xoD4ZXK+GQ9vbqAZVKZVgYmP04TE4MSpmRnHZCFxA9gsVLV5WhuFFszY441jsAoAdHHnm+V4Wy83cTOvDMYC7nw1tUs5U4ad+tQ6NQQ3J622KrtzQa9v2t2+pvbdjw7kvz5t+5TtFCKhU3g+duiyCofFBq9xWl3X7HWLi+2IwVAVado4aHP7zsvHHTjj/iqP9+9NlHEyccNnnw4MqIrh3R5jXr/vX6LXcsX/PpZ5/Havdtl3HiOcHPFl867bPNm7d9+ukX299Y+8/NL7687vNmUEkz0LgZdH7PPt8JQB6E/GCLS2sZGPljHoS818jOi8/LB1H2Zzlln+WDL56X3Z8BUASiuGfXlILQCog8GPm/Pcj//UErJhSZln9fn5a+egAg/5ziH3okJXtcuGZnJ1n28GIQpsWuS449pkOLAPLH/OetxlYGgCoEV2SFVS0AKHto/mX5IIp072vgZQwoBlF2Xjaenu7PB5UHok9/AtQTzcqo3Bvle0uBngIpftbbfcX7i0vtZcDkr9u59eVFrYLqLeDeRC0fwL5sRTaVgaJKjr0OrmwrE9E9Oe9t25d0aHXep3Tbk0H29d7eUqw/Zr9sa5VWvW77AsJX+cy+bHsN7v8ApRADr8Sux0oAAAAASUVORK5CYII=",Gz=""+new URL("../assets/Layer 22.pilv1rDh.png",import.meta.url).href;var Hz=Wt('<div id="g-diagram-Artboard_84" class="g-artboard relative svelte-182pi3y" style=""><div style="padding: 0 0 85.5528% 0;" class="svelte-182pi3y"></div> <div id="g-diagram-Artboard_84-img" class="g-aiImg svelte-182pi3y"></div> <img class="absolute top-0 left-0 w-[8%] animate-cloud-1 svelte-182pi3y" alt=""> <img class="absolute top-2 left-10 w-[8%] animate-cloud-2 svelte-182pi3y" alt=""> <img class="absolute top-6 left-0 w-[8%] animate-cloud-3 svelte-182pi3y" alt=""> <div id="g-ai0-2" class="g-Layer_1 g-aiAbs svelte-182pi3y" style="top:22.2277%;right:-1.3684%;width:62.3443%;"><p class="svelte-182pi3y">Water runs through natural channels in the land...</p></div> <div id="g-ai0-3" class="g-Layer_1 g-aiAbs svelte-182pi3y" style="top:75.4315%;right:23.9912%;width:55.459%;"><p class="g-pstyle1 svelte-182pi3y">...towards the lowest points where it is bound to collect</p></div></div>'),Xz=Wt('<div id="g-diagram-box" class="svelte-182pi3y"><!></div>');function Yz(i,n){un(n,!1);let o=tt(n,"assetsPath",8,"./"),h=qi(null),p=tt(n,"onAiMounted",8,()=>{});ph(()=>{p()()}),cn();var b=Xz(),_=pt(b);{var c=A=>{var O=Hz(),B=Ht(pt(O),2);const R=ur(()=>`background-image: url(${o().replace(new RegExp("/([^/.]+)$"),"/$1/")||"/"}ai2html/diagram-Artboard_84.webp);`);var C=Ht(B,2);ki(C,"src",qz);var Y=Ht(C,2);ki(Y,"src",Zz);var X=Ht(Y,2);ki(X,"src",Gz),yc(4),ut(O),Ai(()=>ki(B,"style",De(R))),rt(A,O)};ji(_,A=>{De(h)&&De(h)>=0&&A(c)})}ut(b),NT(b,"clientWidth",A=>di(h,A)),rt(i,b),hn()}var Kz=Wt('<button class=" py-2 px-4 text-center text-sm md:text-base transition-colors w-full duration-200 hover:bg-zinc-100 hover:text-black"> </button>'),Jz=Wt(`<div class="flex flex-col h-full p-4 bg-white rounded-t-xl"><div class="grid grid-cols-1 md:grid-cols-8 gap-2"><div class="col-span-1 md:col-span-4"><h2 class="mb-2 font-khand-bold text-xl text-black/80 md:text-3xl uppercase bg-white">The way of water</h2> <p class="text-sm leading-relaxed text-gray-600 md:text-base">Natural water channels crisscross Chennai's landscape - the city's
        original drainage system. When these old waterways get blocked or built
        over, that's usually where you'll spot flooding during rains.</p></div> <div class="col-span-1 mx-auto md:max-w-full max-w-[20rem] md:col-span-4 w-full px-2 items-center"><!></div></div> <div class="flex pt-2 h-full gap-2"><div class="w-1/3 h-full md:w-2/3 flex items-start flex-col justify-between"><p class="text-xs md:text-base font-medium text-zinc-500">Some of the same places are often mentioned in the news.</p> <button class="text-xs -ml-2 px-2 py-2 hover:text-black md:text-sm underline underline-offset-8 text-zinc-500">Methodology</button></div> <div class="flex flex-col divide-y w-full max-h-[8rem] md:max-h-[9rem] divide-zinc-100 items-center overflow-y-auto"></div></div></div>`);function Qz(i,n){un(n,!1),As();const o=qi();let h=tt(n,"pois",8);const p=cl(),b=["Ecospace","Kendriya Vihar","Manyata Tech Park","Nayandahalli"];function _(H,ae){const Z=b.indexOf(H),te=b.indexOf(ae);return Z!==-1&&te!==-1?Z-te:Z!==-1?-1:te!==-1?1:H.localeCompare(ae)}ei(()=>Mi(h()),()=>{di(o,Object.keys(h()).sort(_))}),Br(),cn();var c=Jz(),A=pt(c),O=Ht(pt(A),2),B=pt(O);hT(B,()=>Yz,(H,ae)=>{ae(H,{})}),ut(O),ut(A);var R=Ht(A,2),C=pt(R),Y=Ht(pt(C),2);ut(C);var X=Ht(C,2);vc(X,5,()=>De(o),_c,(H,ae)=>{var Z=Kz(),te=pt(Z,!0);ut(Z),Ai(()=>no(te,De(ae))),Ct("click",Z,()=>{rh(so,De(ae)),p("selectedPOI",De(ae))}),rt(H,Z)}),ut(X),Tr(X,H=>Im==null?void 0:Im(H)),ut(R),ut(c),Ct("click",Y,()=>{p("showMethodology")}),rt(i,c),hn()}const e6=""+new URL("../assets/HansIndia.BEnVVKQ2.png",import.meta.url).href,t6=Object.freeze(Object.defineProperty({__proto__:null,default:e6},Symbol.toStringTag,{value:"Module"})),i6=""+new URL("../assets/TelanganaToday.C86c_dWF.jpg",import.meta.url).href,n6=Object.freeze(Object.defineProperty({__proto__:null,default:i6},Symbol.toStringTag,{value:"Module"})),r6=""+new URL("../assets/bangaloremirror.indiatimes.com.RVn6--4E.png",import.meta.url).href,s6=Object.freeze(Object.defineProperty({__proto__:null,default:r6},Symbol.toStringTag,{value:"Module"})),a6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEHklEQVR4nNVWW2xUVRRd+5z7mjudqWNbKrEUDIRKNcFREBAVLUFLSBSjUWKiAdQY/4x+GAkfBP+MJpIQY6wENCb6I6ANQeSjYEqakKjUkjTG1KDYRulDZzozd+7jnO3HndKmTyzFxP13XnvtvdY++xzK7b4DN9LEDfX+XwAYC+aJCCAAYL3QALHrKGAVAUSmBSmh9QIBEEFFHPqibolc1AgVqss/cTFHtrsQACQ49MlNO8/usTZuJzelh/o5P+KfOhJ2fUWWA+brEJkIKhSpTPLV9+0tz5Gb8k+0lT54XdQ1uK+8azSvZ98DiesAYGbWzvP7ZNNaAP7JQ17bG+QkKZUBIDK3QCvQvCkSkot5s+UZ895WAKqv2z96QGTq1S89wTefMOvwu9Nku9B6fgAEFVL1zXbr7njsn/6Yi3lK3oRywTu8FwAlUiDCPEUWgouj1obHZMNKAPqPS9EPZ8hJQkcgQVUZANAaYMzrJhO0Itu1Nj0Vj4Oudi78BSkr61pBq9j7dAAkICRIQAgIOXkVgCD2S7JpjVy5BgAHnrpwBjTdTgCTKRKSAx+BByEAApic5OQTDADWxu3xSPV1q0s95LhXr+7MACTYGxW1txp3PiCXNbNXUD9/H/V0giiWCwCIEAWifpmRfTieCM9/zWFAljNGyZSEx0/6Jev+J6r2H3N27qN0rf3oLve1D62WHRyWQVe3CfZL5t2bqSoDZvYK0cVOMi3wDO4rAEJwuWRkWxIvvU3pWu+jPd7hvQwGYK5tBckxxQgqIjdtZDfHMUUXO/nKbzDtuQC0Jsuxtr0IKaMfz4Zd7Qj98NyXXBoNutrButKHCRwFckmTsWpd3JOjnk4OJuQ3nRkxrVTXKBubAYTd38IvwbTKn77lHz+oc1fIciotngTCwLzv8bg/69xQdKGDnOSkB2BqBgStKV1DhgkApTyAuEB1bpAMa1yk0Bf1S417tsQT4bnjengAhjkLPzEAgwQKf3MUAqDqWoDAABFNPCwk+yXzwSdFzWIAnBsMOz6DYc1UPBMAmCENPdyvB/oAmKs3USIJVpXSJAIJSAOFnFyRtbe+EAte/uI91d83zt6sGQBScrkYnDwEQK5abz70tM4PIyhDKUQh+yXOD1Pj7YmX36FEFUD+ibag43NyU9BqjvgB+WZ2EZjJtPSvvbqYM5s3mNkWclw9NEAESqTE4tvslh2JXftFXQOi0D92sHz0AJl2pbTmMhr/eBFxuSRX3GU9stNat5XLRR4dgVMl0jUQggMv6j7rnzqies+T44Jodm2nA0DlxgEQ1bVy+WpRvxSmzV6BR/5Ul3v14O/QmhJJMF+j9ykAAIQAAyrkwIcKwRy3VTJtGCZAc6o6yaY8OHFTlAa55gSWeSzqaw18ZoCKw39Bwuz2///8/gP6eMZ+vF0j7wAAAABJRU5ErkJggg==",o6=Object.freeze(Object.defineProperty({__proto__:null,default:a6},Symbol.toStringTag,{value:"Module"})),l6=""+new URL("../assets/timesofindia.indiatimes.com.-R40g9bv.png",import.meta.url).href,c6=Object.freeze(Object.defineProperty({__proto__:null,default:l6},Symbol.toStringTag,{value:"Module"})),u6=""+new URL("../assets/www.deccanchronicle.com.BrrKx9PX.png",import.meta.url).href,h6=Object.freeze(Object.defineProperty({__proto__:null,default:u6},Symbol.toStringTag,{value:"Module"})),d6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAE3klEQVR4nO2WS2yVRRTHfzPz3WcftL3gxVKgFZACjbwWYhCUaCAVMTGoSDAxmqiJCSExRuPCxLgxMSx0BUJcQIwmkCAxETAqWiSAWCgVQktoaWl5pPTNbe/je8y4+O7tgz4SZOHC/jczmTlz5n/O/M/MwBSm8B9DDPeEnNxSCIwxGKNHjY304cNgjLkvm/siLKX6NwsndghQMmM2K9duASNx7BRCCALBKMFQHkIIMul+brT8TXtzLYn+bgDmLniMymUb0S44ThIhBFIGiESjXL7wE9cazrD08U2Ulq8kk05itIsxEAoX4DgJ6k8fovtOqwWAY6dx0imee/VjYvE4WsP1q5dpbjiB6zjMr1rL5jc/p735IkcPfsK5Pw6RTiWxMwNUv/IBM2aW4XnQ29XFL9/vJDnQB0B/720WVBWwaduHBIJhlAVXL53l18Nf4tgpAD+ddibJjdZ6+nuaCAbjFE8v5/C+9zh64DMa63/m9M9fk+i/RUXlMtZU7+BudzsNdcdpvXIWKyDQGgqL5nO2Zj+H933EwN0uhBD0dd/i2pVTuM4g+YWzyS+YzoGvdlB74gC2nQZjrKHDUFYQO5PEzgxiBYZF6beCmh/3MrNsHtpTvPzWLtqaa2lrvojWDk4mgbIAJFJJfJ36IlMqhJ0aQGsHZYFU4axfMDCsfO26SGkhlZVbC4DRXlbJ0HKlltttF8gvCvH089uHCAoZyPYF2tPZSvHXaK0RVmBElfnOs1UwovSEP2kYrzz8sfbmOpQVpa8ryaLlLw4TzK0REqUUSlkoZSGE8NtxPGYxee3fCzuTIhwJ0X2nhfxp04mXzcd1Mn6GBDiZJJ7n4XkunudgjCGdSgzZjBOaNXZoUgRwXU1qsI9QCIpjs/E8FyEVrg0VC1ezceun+OkUGO0SzivCUhkcJ4MYm4r7I2CMwXUyBEMGqSAYjmKMzt6SEAxHKHkoPppAtIjBxG3f7oEzYDwsyyIYiuC5/pEIIdFaEwhC06Xf+W7Xu8Dw1R0K57Om+nUWVG1Ajz2D+9OAFbTQRjCt+GHSKY/ezlaUsiB7r0tlIYS/eU71ygr417cx42VgMgLD5jnixbFS7PQAsXgpd3vb6bh5DSsQHvVAGUP20RpVbhPhHgJCIHIbi+FWZqN5dOk6wpECQhE4c3y3Py0lZhx1jQxEjJwfbTtMQCoL7dpo7QIMtQLQ2mNW+ULis+awaMVmGi+c4cSRvX6E2sW4TjZajVQSISW5vAkhcF17KEtG6+y4hJEi9BybaH6MUKQQT0PJjDlDTkvnVrJt+x4eqVxDe3M9+794jUR/T5Z4iGC4ANf1nRqtMSa3gQEM0bxipLRwXZDZmLNE/HQUxWbx5Ia3Wf/S+xQWRdEe2HaGxro/sQKKioWr6Ovu4Pypb/nth530dHYwZ14Vy1dvZd0L71Aci+G5kOhPcvLYHv6q+YbWq+dYsmI9q555gyee3YKUIKTgZksTNUd2c+7kQXrutOUIlLJkZTV2Jo3r+reWQBCKFGK0R193Ox23GujtvAn45VVWvpiKyqdIJwf9NVIihCJ/WgmtjSe53nSexcvXE4vPY3Cgl9wvKBjMwwooLtcdo7fzxiTaGQdSqdGCenCIoVbKiUrStzFGj/kPTvSP9G2N/1JOQFhrDeM+fFOYwv8M/wDEIiYcLEpe3QAAAABJRU5ErkJggg==",f6=Object.freeze(Object.defineProperty({__proto__:null,default:d6},Symbol.toStringTag,{value:"Module"})),p6=""+new URL("../assets/www.hindustantimes.com.DDwj_hdt.png",import.meta.url).href,m6=Object.freeze(Object.defineProperty({__proto__:null,default:p6},Symbol.toStringTag,{value:"Module"})),g6=""+new URL("../assets/www.moneycontrol.com.CrAVhKu1.png",import.meta.url).href,y6=Object.freeze(Object.defineProperty({__proto__:null,default:g6},Symbol.toStringTag,{value:"Module"})),_6=""+new URL("../assets/www.newindianexpress.com.C8Fg5Ukv.png",import.meta.url).href,v6=Object.freeze(Object.defineProperty({__proto__:null,default:_6},Symbol.toStringTag,{value:"Module"})),b6=""+new URL("../assets/www.thehindu.com.v50iOG2k.png",import.meta.url).href,x6=Object.freeze(Object.defineProperty({__proto__:null,default:b6},Symbol.toStringTag,{value:"Module"})),w6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3R0RVh0WE1MOmNvbS5hZG9iZS54bXAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjBlNjJkOGQzLTljOTktNDU5ZS1hNzZjLWQ0NGEyZjQzMWU3NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3N0UzM0I0N0IxQjQxMUVEOUREM0Y1NjlBNzMzNDc2QiIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3N0UzM0I0NkIxQjQxMUVEOUREM0Y1NjlBNzMzNDc2QiIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjBlNjJkOGQzLTljOTktNDU5ZS1hNzZjLWQ0NGEyZjQzMWU3NyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowZTYyZDhkMy05Yzk5LTQ1OWUtYTc2Yy1kNDRhMmY0MzFlNzciLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4OFa6mAAAEyElEQVR4nO2XS2xVVRSGv7XP7rm3r3tv7a1VSksRAVsK1gbRKI2RiQMfmKhxYhyBzIwxISYa4gDixBjUKNHEgYmPiQ4IGnBkGsRojFYg2oiWKlDgpk+g93keezngUgFboqbaiSs5yTlnn531/2v//15ni6qymGEWNfv/AAB7+cO19CAiiwtAVTFm4QsmcyQV4D+zxmwFyuUyW7ZuJYgiTYjUpCA7AWdrRKQShrqss5MXd+yQxsZGVdWFWxLnHKrK5Jkzta3Wrs/CXTXQ0gJ9gGeMEcBbtXx5/VguJ6o6O2chrksVENPQUPJ8f9SoJo0x0yvh9mYoT4nk/DBsbBepC8bGJmhtHV8Y6hfjClVVwjCuxHEchGF8IgxHfgrDoeYouvkG1Z4p1fOlXK51IZPDVS64KhIAAeAgXyfiGru7hwHPhaEgolwcc4Aa8BzEVVZGq+8AxPNiMWZOYc+6IAhDPv7wwyRxbANj8tnmZj+CIAWZSLXcXlu7ZGV//6hNJoMFo8/cNiQql/3BPXse/UH14CiMroDVvmriTKGQ63PuMQ9qijA1A2eH4AvArINNP8JACEEXbByH4R64P21Mc9vmzR819/YeQ3W2cpfiiiWIo0iMtVrO5/0j27d/sN+51/bCMxthUxqWDsPAg/DEAdjlQ/0GeOoATE7D1CvwyVuwPg9Tj8A2RMx+1V8SqdTYqxs2tNDbe2wu+14BwPM8ABo8Lz3ueQO90DUk0hfDhSYgDeLBhTycKsDYbXBnF9w5CT9HcGIVrC3BhQhySWv9RKWSrNxzz56W++4LgD+xh/mbkT/pXG6/c7sfcO65eudSsXNR5Fx4nXPt/c493ubcLcec+7bdua5bnXton3O72pzr6XZu04hz378bhs9mIbXp0KEDEwMDdwCK6p/yzQcgboTrv4HPxmDkYXi+CNMJaPwNBt+HF47CwEk43AYrO2D9Z/BOFm5aCfceh0Ml1fLb1m7ZNz395cn33ntaATHGXZ1oPhvG51XPAexVffkO2FaEShFmlkL3k/DSOJw+AG8WIR6HbwHOwHAjLDkFw4+J7EhGUVPW85a09Pd/KoA6JyKiXKaDOV2gYegPHTzYkYNhB9wAnQGUA5jpgHU+1BetHRsROboElgVQnIDxDGTqIHUWTraLrGqNojVRU9NIQ0/PEWvtnE1uTgBXf3P5xEtK/mVgYPnWnTt/zSYS9bWq6QAqJZhRIIAgBimJaEsUXR8XCv4EjCYrlcxtd9+df3n37sirtvZ5d0IXRebyXU4v3oNzxvN9NzE4uO7g55/nV4gsL6iGAVR8aIugFIIWYSyA4k2wJoCZcyJlq5pp9rwW4vg4VT3M+4dhrHXWWqy1GGtjz1r1rFVjbQxourv7eB+sFWMKGHOh05i2vDGj08b82mXMqhpjjDXGpI3xzhtzfLUxXQYiWy43i3OzxK/VC64Z5UpFv4Ov6pyrr1XNzEAYg8YgU5CvgTqFmgKUPGiYMGYyAJnOZIac5wWXmP99AFUFL+vrO/36G2+UEp4XJSHwYSYPBQcuCYdTkK6BhtPwdRZuzIucTEdRS1NHh2+qGx78NRH+q/GPl0BVJYoirTpaALTqFuEPpyuogFTHRETwrJ1lvegVWPSDyf8AFh3A71ZKZHCYQCk/AAAAAElFTkSuQmCC",T6=Object.freeze(Object.defineProperty({__proto__:null,default:w6},Symbol.toStringTag,{value:"Module"})),S6=""+new URL("../assets/www.youtube.com.CUYxzsz0.png",import.meta.url).href,k6=Object.freeze(Object.defineProperty({__proto__:null,default:S6},Symbol.toStringTag,{value:"Module"})),M6={" ":{url:" ",title:" ",description:"",image:" ",favicon:"/src/lib/assets/favicons/",siteName:" "}};var A6=Wt('<div class="block flex-shrink-0"><img alt="" class="size-28 object-cover rounded-sm bg-zinc-100"></div>'),I6=Wt('<p class="text-sm text-zinc-500 line-clamp-2 mt-1"> </p>'),E6=Wt('<img alt="" class="w-4 h-4 rounded-sm">'),C6=Wt('<div class="flex gap-3"><!> <div class="flex-1 min-w-0"><div class="flex items-start justify-between gap-2"><h3 class=" font-medium text-zinc-800 leading-relaxed line-clamp-2 md:text-base text-sm"> </h3> <!></div> <!> <div class="flex items-center gap-2 mt-2"><!> <p class="text-xs text-zinc-400 truncate"> </p></div></div></div>'),P6=Wt('<div class="text-sm text-zinc-600 break-all"> </div>'),z6=Wt('<a target="_blank" rel="noopener noreferrer" class="block border rounded-lg hover:bg-zinc-50 transition-colors duration-100"><div class="p-3"><!></div></a>');function D6(i,n){un(n,!1);const o=qi(),h=qi(),p=Object.assign({"/src/lib/assets/favicons/HansIndia.png":t6,"/src/lib/assets/favicons/TelanganaToday.jpg":n6,"/src/lib/assets/favicons/bangaloremirror.indiatimes.com.png":s6,"/src/lib/assets/favicons/scroll.in.png":o6,"/src/lib/assets/favicons/timesofindia.indiatimes.com.png":c6,"/src/lib/assets/favicons/www.deccanchronicle.com.png":h6,"/src/lib/assets/favicons/www.deccanherald.com.png":f6,"/src/lib/assets/favicons/www.hindustantimes.com.png":m6,"/src/lib/assets/favicons/www.moneycontrol.com.png":y6,"/src/lib/assets/favicons/www.newindianexpress.com.png":v6,"/src/lib/assets/favicons/www.thehindu.com.png":x6,"/src/lib/assets/favicons/www.thenewsminute.com.png":T6,"/src/lib/assets/favicons/www.youtube.com.png":k6});let b=tt(n,"url",8);ei(()=>Mi(b()),()=>{di(o,M6[b()])}),ei(()=>De(o),()=>{var R,C;di(h,(R=De(o))!=null&&R.favicon?(C=p[De(o).favicon])==null?void 0:C.default:null)}),Br(),cn();var _=z6(),c=pt(_),A=pt(c);{var O=R=>{var C=C6(),Y=pt(C);{var X=Te=>{var we=A6(),fe=pt(we);ut(we),Ai(()=>ki(fe,"src",De(o).image)),rt(Te,we)};ji(Y,Te=>{De(o).image&&Te(X)})}var H=Ht(Y,2),ae=pt(H),Z=pt(ae),te=pt(Z,!0);ut(Z);var ne=Ht(Z,2);iM(ne,{class:"size-4 flex-shrink-0 text-zinc-400"}),ut(ae);var _e=Ht(ae,2);{var ve=Te=>{var we=I6(),fe=pt(we,!0);ut(we),Ai(()=>no(fe,De(o).description)),rt(Te,we)};ji(_e,Te=>{De(o).description&&Te(ve)})}var Se=Ht(_e,2),de=pt(Se);{var Fe=Te=>{var we=E6();Ai(()=>ki(we,"src",De(h))),rt(Te,we)};ji(de,Te=>{De(h)&&Te(Fe)})}var Re=Ht(de,2),Le=pt(Re,!0);ut(Re),ut(Se),ut(H),ut(C),Ai(()=>{no(te,De(o).title),no(Le,De(o).siteName||new URL(b()).hostname)}),rt(R,C)},B=R=>{var C=P6(),Y=pt(C,!0);ut(C),Ai(()=>no(Y,b())),rt(R,C)};ji(A,R=>{De(o)?R(O):R(B,!1)})}ut(c),ut(_),Ai(()=>ki(_,"href",b())),rt(i,_),hn()}const L6=""+new URL("../assets/frog.CB-X4g8D.png",import.meta.url).href;var R6=Wt("<li><!></li>"),O6=Wt('<div class="flex mt-4 md:flex-row flex-col gap-4 mb-6"><div class=" md:mb-0 flex items-start"><p class=" rounded-lg font-bold text-zinc-600 whitespace-nowrap"> </p></div> <div><ul class="space-y-3 w-full"></ul></div></div>'),B6=Wt(`<div class="h-full flex flex-col"><div class="flex mx-4 py-4 justify-between border-b border-zinc-200 items-center"><div><h2 class="font-bold text-2xl text-zinc-900"> </h2> <p class="text-zinc-500"> </p></div> <button class=" text-center text-sm w-[7rem] transition-all duration-100 bg-zinc-100 hover:bg-zinc-800 hover:text-white font-bold text-zinc-600 px-4 py-4 rounded-md flex items-center justify-center gap-2"><!> Back</button></div> <div class="px-4 pt-2"><h3 class="font-bold pb-2 text-lg text-zinc-900 border-b border-zinc-200">In the news</h3> <!></div> <div class="flex-1 pb-8 m-2 flex items-center justify-center h-full text-center text-zinc-400"><div class="flex gap-y-2 items-center justify-center flex-col"><img class="size-24 md:size-28 opacity-60 grayscale-[30%]" alt="Frog rowing a boat"> <p class="font-medium text-sm">That's all we've collected for now</p></div></div></div>`);function F6(i,n){un(n,!1);const o=As(),h=()=>kn(so,"$selectedPOI",o);let p=tt(n,"pois",8);console.log(p());const b=cl();cn();var _=B6(),c=pt(_),A=pt(c),O=pt(A),B=pt(O,!0);ut(O);var R=Ht(O,2),C=pt(R,!0);ut(R),ut(A);var Y=Ht(A,2),X=pt(Y);Jk(X,{class:"size-4"}),yc(),ut(Y),ut(c);var H=Ht(c,2),ae=Ht(pt(H),2);{var Z=ve=>{var Se=vi(),de=ni(Se);vc(de,1,()=>Object.entries(p()[h()].links).sort((Fe,Re)=>Number(Re[0])-Number(Fe[0])),_c,(Fe,Re)=>{let Le=()=>De(Re)[0],Te=()=>De(Re)[1];var we=O6(),fe=pt(we),Ae=pt(fe),Ce=pt(Ae,!0);ut(Ae),ut(fe);var Ve=Ht(fe,2),Ue=pt(Ve);vc(Ue,5,Te,_c,(Ge,Oe)=>{var Xe=R6(),We=pt(Xe);D6(We,{get url(){return De(Oe)}}),ut(Xe),rt(Ge,Xe)}),ut(Ue),ut(Ve),ut(we),Ai(()=>no(Ce,Le())),rt(Fe,we)}),rt(ve,Se)};ji(ae,ve=>{var Se;h()&&((Se=p()[h()])!=null&&Se.links)&&ve(Z)})}ut(H);var te=Ht(H,2),ne=pt(te),_e=pt(ne);ki(_e,"src",L6),yc(2),ut(ne),ut(te),ut(_),Ai(()=>{no(B,h()),no(C,p()[h()].neighborhood)}),Ct("click",Y,()=>{b("back")}),rt(i,_),hn()}var N6=Wt(`<div class="h-full flex flex-col"><div class="flex mx-4 py-4 justify-between border-b border-zinc-200 items-center"><div><h2 class="font-bold text-2xl text-zinc-900">Methodology</h2> <p class="text-zinc-500">How we built this map</p></div> <button class="text-center text-sm w-[7rem] transition-all duration-100 bg-zinc-100 hover:bg-zinc-800 hover:text-white font-bold text-zinc-900 px-4 py-4 rounded-lg flex items-center justify-center gap-2">Back <!></button></div> <div class="px-4 py-6 flex-1 text-sm text-zinc-600 flex flex-col"><div class="flex-1"><p class="max-w-[30rem]">Using a 30m digital elevation model from <a href="https://spacedata.copernicus.eu/collections/copernicus-digital-elevation-model" target="_blank" rel="noopener noreferrer" class="svelte-znp55x">Copernicus</a>, we analyzed the city's terrain to understand it's water flow
        patterns. We used WhiteboxTools, a geospatial analysis library, to map
        water accumulation, and identify major streams across the landscape. To
        produce the graduated layer you see on the map, we smoothened these
        accumulation values and reclassified them into distinct categories.</p></div></div></div>`);function $6(i,n){un(n,!1);const o=cl();cn();var h=N6(),p=pt(h),b=Ht(pt(p),2),_=Ht(pt(b));Qk(_,{class:"size-4"}),ut(b),ut(p),yc(2),ut(h),Ct("click",b,()=>o("back")),rt(i,h),hn()}var j6=Wt('<!> <div class="mx-auto my-2 h-1.5 w-12 flex-shrink-0 rounded-full bg-zinc-300"></div>',1),V6=Wt('<div class="absolute top-28 right-1/2 translate-x-1/2 transform -translate-x-1/2"><p class="text-white uppercase text-xl font-bold">tap to close</p></div>'),U6=Wt('<div class="h-full"><!></div>'),W6=Wt('<div class="h-full"><!></div>'),q6=Wt('<div class="h-full"><!></div>'),Z6=Wt('<div class="bg-white overflow-x-hidden overflow-y-auto rounded-t-[20px] flex-1 relative"><div class="relative h-full"><!></div></div>'),G6=Wt("<!> <!> <!>",1),H6=Wt("<!> <!>",1),X6=Wt('<!> <div class="fixed w-full md:w-fit bottom-0 -left-5 md:left-1/2 transform md:-translate-x-1/2 z-50"><div class="w-full max-w-[19rem] md:max-w-sm mx-auto"><div class="flex gap-2 w-full items-center"><div class="px-4 w-full py-2 z-10 justify-center items-center flex gap-1 border-zinc-300 border bg-white rounded-lg md:shadow-lg"><!> <input type="range" min="0" max="0.8" step="0.1" class="w-full h-2 rounded-lg appearance-none cursor-pointer relative [&amp;::-webkit-slider-runnable-track]:h-2 [&amp;::-webkit-slider-runnable-track]:rounded-lg [&amp;::-webkit-slider-thumb]:appearance-none [&amp;::-webkit-slider-thumb]:w-[20px] [&amp;::-webkit-slider-thumb]:h-[20px] [&amp;::-webkit-slider-thumb]:rounded-full [&amp;::-webkit-slider-thumb]:bg-[#74B1B5] [&amp;::-webkit-slider-thumb]:shadow-md [&amp;::-webkit-slider-thumb]:transition-colors [&amp;::-webkit-slider-thumb]:mt-[-4px] hover:[&amp;::-webkit-slider-thumb]:brightness-95 [&amp;::-moz-range-thumb]:w-[20px] [&amp;::-moz-range-thumb]:h-[20px] [&amp;::-moz-range-thumb]:rounded-full [&amp;::-moz-range-thumb]:bg-[#74B1B5] [&amp;::-moz-range-thumb]:border-none [&amp;::-moz-range-thumb]:shadow-md [&amp;::-moz-range-thumb]:transition-colors hover:[&amp;::-moz-range-thumb]:brightness-95 [&amp;::-moz-range-progress]:bg-[#74B1B5] [&amp;::-moz-range-track]:bg-zinc-200 svelte-1gwje1d"></div> <button class="px-4 hover:bg-zinc-100 py-2 my-2 z-10 md:my-4 justify-center items-center flex gap-1 border-zinc-300 border bg-white rounded-lg md:shadow-lg"><!></button></div> <!></div></div>',1);function Y6(i,n){un(n,!1);const o=As(),h=()=>kn(so,"$selectedPOI",o),p=()=>kn(A4,"$smScreen",o);let b=tt(n,"pois",8),_=tt(n,"isLocating",8,!1);const c=cl();let A=qi("default"),O=qi("default"),B=qi(!1),R=qi(!1),C=qi(.8);function Y(Ue,Ge){const Oe={default:0,methodology:-1,poi:1};return Oe[Ge]>Oe[Ue]?1:-1}function X(Ue,{duration:Ge,direction:Oe=1,delay:Xe=0}){return{delay:Xe,duration:Ge,css:(We,Et)=>`
        position: absolute;
        width: 100%;
        transform: translateX(${K_(Oe*Et)*100}%);
        opacity: ${K_(We)};
      `}}function H(Ue){const Ge=parseFloat(Ue.target.value);c("opacityChange",Ge)}function ae(){di(A,"default"),rh(so,null),di(R,!1),di(B,!1)}function Z(Ue){di(O,De(A)),di(A,Ue),di(B,!0)}function te(Ue){Ue==="poi"&&rh(so,null),Z("default")}ei(()=>(h(),De(A),De(R),p()),()=>{h()&&De(A)==="default"&&(Z("poi"),!De(R)&&!p()&&(di(R,!0),setTimeout(()=>di(R,!1),12e3)))}),Br(),cn();var ne=X6(),_e=ni(ne);db(_e,{$$events:{showMethodology:()=>Z("methodology")}});var ve=Ht(_e,2),Se=pt(ve),de=pt(Se),Fe=pt(de),Re=pt(Fe);sM(Re,{class:"size-6 stroke-[#74B1B5]"});var Le=Ht(Re,2);ET(Le),ut(Fe);var Te=Ht(Fe,2),we=pt(Te);{var fe=Ue=>{nM(Ue,{class:"size-6 stroke-[#74B1B5] animate-spin"})},Ae=Ue=>{rM(Ue,{class:"size-6 stroke-[#74B1B5]"})};ji(we,Ue=>{_()?Ue(fe):Ue(Ae,!1)})}ut(Te),ut(de);var Ce=Ht(de,2),Ve=ur(()=>h()!==null||De(B));y3(Ce,{onClose:ae,get open(){return De(Ve)},closeOnOutsideClick:!0,children:(Ue,Ge)=>{var Oe=H6(),Xe=ni(Oe);T3(Xe,{class:"bg-white shadow-2xl shadow-black w-full max-w-[44rem] rounded-t-2xl rounded-b-none md:px-6 py-2",children:(Et,Nt)=>{var _t=j6(),Xt=ni(_t);Wz(Xt),yc(2),rt(Et,_t)},$$slots:{default:!0}});var We=Ht(Xe,2);S3(We,{children:(Et,Nt)=>{var _t=G6(),Xt=ni(_t);x3(Xt,{class:"fixed isolate inset-0 z-100 bg-black/40"});var $t=Ht(Xt,2);{var ai=qt=>{var bi=V6();Vn(3,bi,()=>af),Ct("click",bi,()=>di(R,!1)),rt(qt,bi)};ji($t,qt=>{De(R)&&qt(ai)})}var fi=Ht($t,2);b3(fi,{class:"bg-zinc-100 overflow-x-hidden overflow-y-clip max-w-2xl md:mx-auto mx-2 z-50 flex flex-col h-[35rem] md:h-1/2 rounded-t-[20px] absolute bottom-0 left-0 right-0",children:(qt,bi)=>{var Yt=Z6(),Oi=pt(Yt),Qi=pt(Oi);{var hi=Me=>{var dn=U6(),Ii=pt(dn);F6(Ii,{get pois(){return b()},$$events:{back:()=>te("poi")}}),ut(dn),Vn(3,dn,()=>X,()=>({duration:400,direction:Y(De(O),"poi")})),rt(Me,dn)},xi=Me=>{var dn=vi(),Ii=ni(dn);{var Kt=dr=>{var bn=W6(),Jn=pt(bn);$6(Jn,{$$events:{back:()=>te("methodology")}}),ut(bn),Vn(3,bn,()=>X,()=>({duration:400,direction:Y(De(O),"methodology")})),rt(dr,bn)},Ei=dr=>{var bn=q6(),Jn=pt(bn);Qz(Jn,{get pois(){return b()},$$events:{showMethodology:()=>Z("methodology"),selectPoi:()=>Z("poi")}}),ut(bn),Vn(3,bn,()=>X,()=>({duration:400,direction:Y(De(O),"default")})),rt(dr,bn)};ji(Ii,dr=>{De(A)==="methodology"?dr(Kt):dr(Ei,!1)},!0)}rt(Me,dn)};ji(Qi,Me=>{De(A)==="poi"&&h()?Me(hi):Me(xi,!1)})}ut(Oi),ut(Yt),rt(qt,Yt)},$$slots:{default:!0}}),rt(Et,_t)},$$slots:{default:!0}}),rt(Ue,Oe)},$$slots:{default:!0}}),ut(Se),ut(ve),Ai(()=>ki(Le,"style",`--range-progress: ${De(C)*120}%;`)),BT(Le,()=>De(C),Ue=>di(C,Ue)),Ct("input",Le,H),Ct("click",Te,()=>c("locate")),rt(i,ne),hn()}var K6=Wt('<meta name="description"> <meta name="keywords"> <meta name="author"> <meta name="robots" content="index, follow"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="language" content="English"> <meta name="revisit-after" content="7 days"> <meta name="distribution" content="global"> <meta http-equiv="content-type" content="text/html; charset=utf-8">',1);function J6(i,n){un(n,!1);let o=tt(n,"description",8,"Default description of your website"),h=tt(n,"keywords",8,"svelte, seo, web development"),p=tt(n,"author",8,"Your Name");ph(()=>{}),cn(),wT(b=>{var _=K6(),c=ni(_),A=Ht(c,2),O=Ht(A,2);yc(12),Ai(()=>{ki(c,"content",o()),ki(A,"content",h()),ki(O,"content",p())}),rt(b,_)}),hn()}const Q6=""+new URL("../assets/submerged.zgDpJ5-g.webp",import.meta.url).href;var eD=Wt('<div class="p-4 relative"><div class="absolute inset-0 bg-white/80"></div> <div class="relative"><div class="text-3xl font-khand-bold font-medium text-center text-zinc-900">Oops!</div> <div class="font-medium text-center text-zinc-900 font-supreme py-3"><!></div></div></div>');function tD(i,n){let o=tt(n,"open",12,!1),h=tt(n,"message",8,"Are you sure you want to do that?");W4(i,{classes:{dialog:"w-[25rem] mx-2  bg-white rounded-lg shadow-xl border border-zinc-300",backdrop:"dark:bg-black/40 bg-black/40"},get open(){return o()},set open(p){o(p)},children:(p,b)=>{var _=eD();ki(_,"style",`background-image: url(${Q6});
  background-size: cover;
  background-position: bottom;
  background-repeat: no-repeat;`);var c=Ht(pt(_),2),A=Ht(pt(c),2),O=pt(A);MT(O,h),ut(A),ut(c),ut(_),rt(p,_)},$$slots:{default:!0},$$legacy:!0})}var iD=Wt('<main data-vaul-drawer-wrapper=""><!> <div class="map-container svelte-1l78r9"></div> <!> <!> <!></main>');function fD(i,n){un(n,!1);let o=tt(n,"data",8),h=qi(),p,b=qi(!1),_=qi(""),c=qi(!1);ph(()=>(p=new Xk,p.init(De(h)),()=>{p.cleanup()}));let A={title:"BLR Water Log",description:"Where does Bangalore's water flow and accumulate?",date:"2024-11-18",categories:["gis","map","blr","flood","bangalore","water"],author:["Aman Bhargava","Vivek Matthew"].join(", "),ogImage:"/sharecard.jpg"};function O(Z){p&&p.setLayerOpacity(Z)}async function B(){if(!De(c))try{di(c,!0);const Z=await p.locate();Z.type==="error"&&Z.message&&(di(_,Z.message),di(b,!0))}catch(Z){console.error("Location error:",Z),di(_,"Something went wrong while trying to locate you"),di(b,!0)}finally{di(c,!1)}}cn();var R=iD(),C=pt(R);J6(C,Vr(A));var Y=Ht(C,2);Rr(Y,Z=>di(h,Z),()=>De(h));var X=Ht(Y,2);db(X,{});var H=Ht(X,2);Y6(H,{get pois(){return o().pois},get isLocating(){return De(c)},$$events:{opacityChange:Z=>O(Z.detail),locate:B}});var ae=Ht(H,2);tD(ae,{get message(){return De(_)},get open(){return De(b)},set open(Z){di(b,Z)},$$legacy:!0}),ut(R),rt(i,R),hn()}export{fD as component,hD as universal};
